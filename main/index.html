<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui"><title>üá´üá∑ Devops : Docker</title><link rel="stylesheet" href="./reveal.js/dist/reset.css"><link rel="stylesheet" href="./reveal.js/dist/reveal.css"><link rel="stylesheet" href="./styles/build.css" id="theme"><!--This CSS is generated by the Asciidoctor reveal.js converter to further integrate AsciiDoc's existing semantic with reveal.js--><style type="text/css">.reveal div.right {
  float: right
}

/* source blocks */
.reveal .listingblock.stretch > .content {
  height: 100%
}

.reveal .listingblock.stretch > .content > pre {
  height: 100%
}

.reveal .listingblock.stretch > .content > pre > code {
  height: 100%;
  max-height: 100%
}

/* auto-animate feature */
/* hide the scrollbar when auto-animating source blocks */
.reveal pre[data-auto-animate-target] {
  overflow: hidden;
}

.reveal pre[data-auto-animate-target] code {
  overflow: hidden;
}

/* add a min width to avoid horizontal shift on line numbers */
code.hljs .hljs-ln-line.hljs-ln-n {
  min-width: 1.25em;
}

/* tables */
table {
  border-collapse: collapse;
  border-spacing: 0
}

table {
  margin-bottom: 1.25em;
  border: solid 1px #dedede
}

table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td {
  padding: .5em .625em .625em;
  font-size: inherit;
  text-align: left
}

table tr th, table tr td {
  padding: .5625em .625em;
  font-size: inherit
}

table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td {
  display: table-cell;
  line-height: 1.6
}

td.tableblock > .content {
  margin-bottom: 1.25em
}

td.tableblock > .content > :last-child {
  margin-bottom: -1.25em
}

table.tableblock, th.tableblock, td.tableblock {
  border: 0 solid #dedede
}

table.grid-all > thead > tr > .tableblock, table.grid-all > tbody > tr > .tableblock {
  border-width: 0 1px 1px 0
}

table.grid-all > tfoot > tr > .tableblock {
  border-width: 1px 1px 0 0
}

table.grid-cols > * > tr > .tableblock {
  border-width: 0 1px 0 0
}

table.grid-rows > thead > tr > .tableblock, table.grid-rows > tbody > tr > .tableblock {
  border-width: 0 0 1px
}

table.grid-rows > tfoot > tr > .tableblock {
  border-width: 1px 0 0
}

table.grid-all > * > tr > .tableblock:last-child, table.grid-cols > * > tr > .tableblock:last-child {
  border-right-width: 0
}

table.grid-all > tbody > tr:last-child > .tableblock, table.grid-all > thead:last-child > tr > .tableblock, table.grid-rows > tbody > tr:last-child > .tableblock, table.grid-rows > thead:last-child > tr > .tableblock {
  border-bottom-width: 0
}

table.frame-all {
  border-width: 1px
}

table.frame-sides {
  border-width: 0 1px
}

table.frame-topbot, table.frame-ends {
  border-width: 1px 0
}

.reveal table th.halign-left, .reveal table td.halign-left {
  text-align: left
}

.reveal table th.halign-right, .reveal table td.halign-right {
  text-align: right
}

.reveal table th.halign-center, .reveal table td.halign-center {
  text-align: center
}

.reveal table th.valign-top, .reveal table td.valign-top {
  vertical-align: top
}

.reveal table th.valign-bottom, .reveal table td.valign-bottom {
  vertical-align: bottom
}

.reveal table th.valign-middle, .reveal table td.valign-middle {
  vertical-align: middle
}

table thead th, table tfoot th {
  font-weight: bold
}

tbody tr th {
  display: table-cell;
  line-height: 1.6
}

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p {
  font-weight: bold
}

thead {
  display: table-header-group
}

.reveal table.grid-none th, .reveal table.grid-none td {
  border-bottom: 0 !important
}

/* kbd macro */
kbd {
  font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace;
  display: inline-block;
  color: rgba(0, 0, 0, .8);
  font-size: .65em;
  line-height: 1.45;
  background: #f7f7f7;
  border: 1px solid #ccc;
  -webkit-border-radius: 3px;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, .2), 0 0 0 .1em white inset;
  box-shadow: 0 1px 0 rgba(0, 0, 0, .2), 0 0 0 .1em #fff inset;
  margin: 0 .15em;
  padding: .2em .5em;
  vertical-align: middle;
  position: relative;
  top: -.1em;
  white-space: nowrap
}

.keyseq kbd:first-child {
  margin-left: 0
}

.keyseq kbd:last-child {
  margin-right: 0
}

/* callouts */
.conum[data-value] {
  display: inline-block;
  color: #fff !important;
  background: rgba(0, 0, 0, .8);
  -webkit-border-radius: 50%;
  border-radius: 50%;
  text-align: center;
  font-size: .75em;
  width: 1.67em;
  height: 1.67em;
  line-height: 1.67em;
  font-family: "Open Sans", "DejaVu Sans", sans-serif;
  font-style: normal;
  font-weight: bold
}

.conum[data-value] * {
  color: #fff !important
}

.conum[data-value] + b {
  display: none
}

.conum[data-value]:after {
  content: attr(data-value)
}

pre .conum[data-value] {
  position: relative;
  top: -.125em
}

b.conum * {
  color: inherit !important
}

.conum:not([data-value]):empty {
  display: none
}

/* Callout list */
.hdlist > table, .colist > table {
  border: 0;
  background: none
}

.hdlist > table > tbody > tr, .colist > table > tbody > tr {
  background: none
}

td.hdlist1, td.hdlist2 {
  vertical-align: top;
  padding: 0 .625em
}

td.hdlist1 {
  font-weight: bold;
  padding-bottom: 1.25em
}

/* Disabled from Asciidoctor CSS because it caused callout list to go under the
 * source listing when .stretch is applied (see #335)
 * .literalblock+.colist,.listingblock+.colist{margin-top:-.5em} */
.colist td:not([class]):first-child {
  padding: .4em .75em 0;
  line-height: 1;
  vertical-align: top
}

.colist td:not([class]):first-child img {
  max-width: none
}

.colist td:not([class]):last-child {
  padding: .25em 0
}

/* Override Asciidoctor CSS that causes issues with reveal.js features */
.reveal .hljs table {
  border: 0
}

/* Callout list rows would have a bottom border with some reveal.js themes (see #335) */
.reveal .colist > table th, .reveal .colist > table td {
  border-bottom: 0
}

/* Fixes line height with Highlight.js source listing when linenums enabled (see #331) */
.reveal .hljs table thead tr th, .reveal .hljs table tfoot tr th, .reveal .hljs table tbody tr td, .reveal .hljs table tr td, .reveal .hljs table tfoot tr td {
  line-height: inherit
}

/* Columns layout */
.columns .slide-content {
  display: flex;
}

.columns.wrap .slide-content {
  flex-wrap: wrap;
}

.columns.is-vcentered .slide-content {
  align-items: center;
}

.columns .slide-content > .column {
  display: block;
  flex-basis: 0;
  flex-grow: 1;
  flex-shrink: 1;
}

.columns .slide-content > .column > * {
  padding: .75rem;
}

/* See #353 */
.columns.wrap .slide-content > .column {
  flex-basis: auto;
}

.columns .slide-content > .column.is-full {
  flex: none;
  width: 100%;
}

.columns .slide-content > .column.is-four-fifths {
  flex: none;
  width: 80%;
}

.columns .slide-content > .column.is-three-quarters {
  flex: none;
  width: 75%;
}

.columns .slide-content > .column.is-two-thirds {
  flex: none;
  width: 66.6666%;
}

.columns .slide-content > .column.is-three-fifths {
  flex: none;
  width: 60%;
}

.columns .slide-content > .column.is-half {
  flex: none;
  width: 50%;
}

.columns .slide-content > .column.is-two-fifths {
  flex: none;
  width: 40%;
}

.columns .slide-content > .column.is-one-third {
  flex: none;
  width: 33.3333%;
}

.columns .slide-content > .column.is-one-quarter {
  flex: none;
  width: 25%;
}

.columns .slide-content > .column.is-one-fifth {
  flex: none;
  width: 20%;
}

.columns .slide-content > .column.has-text-left {
  text-align: left;
}

.columns .slide-content > .column.has-text-justified {
  text-align: justify;
}

.columns .slide-content > .column.has-text-right {
  text-align: right;
}

.columns .slide-content > .column.has-text-left {
  text-align: left;
}

.columns .slide-content > .column.has-text-justified {
  text-align: justify;
}

.columns .slide-content > .column.has-text-right {
  text-align: right;
}

.text-left {
  text-align: left !important
}

.text-right {
  text-align: right !important
}

.text-center {
  text-align: center !important
}

.text-justify {
  text-align: justify !important
}

.footnotes {
  border-top: 1px solid rgba(0, 0, 0, 0.2);
  padding: 0.5em 0 0 0;
  font-size: 0.65em;
  margin-top: 4em;
}

.byline {
  font-size:.8em
}
ul.byline {
  list-style-type: none;
}
ul.byline li + li {
  margin-top: 0.25em;
}
</style><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/v4-shims.min.css"><link rel="stylesheet" href="./styles/build.css"></head><body><div class="reveal"><div class="slides"><section class="title" data-state="title"><h1>üá´üá∑ Devops </h1><h2>Docker</h2><div class="preamble"><div class="paragraph title"><p>2024/2025</p></div>
<div class="imageblock"><img src="media/qrcode.png" alt="QRCode to this presentation" height="150"></div>
<div class="ulist small"><ul><li><p>Pr√©sentation disponible √† l‚Äôadresse: <a href="https://gounthar.github.io/gounthar/cours-devops-docker/main">https://gounthar.github.io/gounthar/cours-devops-docker/main</a></p></li><li><p>Version PDF de la pr√©sentation : <a href="slides.pdf" target="_blank"><span class="icon"><i class="fa fa-file-pdf"></i></span> Cliquez ici</a></p></li><li><p>Contenu sous licence <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">Creative Commons Attribution 4.0 International License</a></p></li><li><p>Code source de la pr√©sentation: <a href="https://github.com/gounthar/gounthar/cours-devops-docker" target="_blank"><span class="icon"><i class="fab fa-github"></i></span> https://github.com/gounthar/gounthar/cours-devops-docker</a></p></li></ul></div></div></section>
<section id="comment_utiliser_cette_pr√©sentation" class="dark background columns" data-background-color="MediumBlue" data-background-image="media/logo-t-shirt-transparent-1080.png" data-background-size="contain" data-background-position="left"><h2>Comment utiliser cette pr√©sentation ?</h2><div class="slide-content"><div class="openblock column"><div class="content"></div></div>
<div class="openblock column"><div class="content"><div class="ulist"><ul><li><p>Pour naviguer, utilisez les fl√®ches en bas √† droite (ou celles de votre clavier)</p><div class="ulist"><ul><li><p>Gauche/Droite: changer de chapitre</p></li><li><p>Haut/Bas: naviguer dans un chapitre</p></li></ul></div></li><li><p>Pour avoir une vue globale : utiliser la touche "o" (pour "<strong>Overview</strong>")</p></li></ul></div></div></div></div></section>
<section><section id="bonjour" data-background-color="rgb(248, 228, 130)" data-state="invert"><h2>Bonjour !</h2><div class="slide-content"><div class="imageblock"><img src="media/bitmoji-hello.png" alt="bitmoji hello" width="200"></div><div class="imageblock"><img src="media/hello-from-docker.svg" alt="hello from docker"></div><div class="paragraph small"><small>La suite: vers le bas ‚¨áÔ∏è</small></div></div></section><section data-background-color="rgb(248, 228, 130)" data-background-image="media/docker_love.png" data-background-size="contain" data-background-position="center" data-state="invert"><div class="slide-content">
<aside class="notes"><div class="paragraph"><p>On en reparlera apr√®s, mais j&#8217;aime Docker depuis longtemps, d&#8217;un amour platonique et non r√©ciproque.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>ESN, s√©curit√© des laptops et m√©fiance</p></li><li><p>Early days, Raspberry Pi &amp; consorts</p></li><li><p>Ce n&#8217;est pas qu&#8217;un projet open source. Et si j&#8217;y bossais ?</p></li></ol></div></aside></div></section><section class="columns" data-background-color="rgb(248, 228, 130)" data-background-image="media/logo.svg" data-background-size="contain" data-background-position="left" data-state="invert"><div class="slide-content"><div class="openblock column"><div class="content"></div></div>
<div class="openblock column"><div class="content"><div class="paragraph strong"><p>Bruno VERACHTEN</p></div>
<div class="imageblock"><img src="media/cloudbees.svg" alt="cloudbees"></div>
<div class="ulist"><ul><li><p>Sr Developer Relations chez <a href="https://www.cloudbees.com" target="_blank">CloudBees</a> pour le projet <a href="https://www.jenkins.io/" target="_blank">Jenkins</a> üë®üèª‚Äç‚öñÔ∏è</p></li><li><p>Me contacter :</p><div class="ulist"><ul><li><p><span class="icon"><i class="fa fa-envelope"></i></span> <a href="mailto:gounthar@gmail.com">gounthar@gmail.com</a></p></li><li><p><a href="https://github.com/gounthar" target="_blank"><span class="icon"><i class="fab fa-github"></i></span> gounthar</a></p></li><li><p><a href="https://bruno.verachten.fr/" class="bare">https://bruno.verachten.fr/</a></p></li><li><p><a href="https://fr.linkedin.com/in/poddingue" target="_blank"><span class="icon"><i class="fab fa-linkedin"></i></span> Bruno Verachten</a></p></li><li><p><a href="https://twitter.com/poddingue" target="_blank"><span class="icon"><i class="fab fa-twitter"></i></span> @poddingue</a></p></li></ul></div></li></ul></div></div></div></div></section><section id="et_vous"><h2>Et vous ?</h2><div class="slide-content"><div class="videoblock"><video src="media/yourturn.mp4" width="600" height="100%" data-autoplay>Your browser does not support the video tag.</video></div></div></section><section id="a_propos_du_cours" data-background-color="rgb(248, 228, 130)" data-state="invert"><h2>A propos du cours</h2><div class="slide-content"><div class="ulist"><ul><li><p>Premi√®re it√©ration d&#8217;une d√©couverte Docker dans le cadre du DevOps</p></li><li><p>Contenu enti√®rement libre et open-source</p></li><li><p>M√©chamment bas√© sur le travail de <a href="https://github.com/dduportal">Damien Duportal</a> et <a href="https://www.linkedin.com/in/awillemant/?originalSubdomain=fr">Amaury Willemant</a></p></li></ul></div>
<div class="ulist small"><ul><li><p>N&#8217;h√©sitez pas ouvrir des Pull Request si vous voyez des am√©liorations ou probl√®mes: <a href="https://github.com/gounthar/gounthar/cours-devops-docker/pulls" target="_blank">sur cette page</a> (üòâ wink wink)</p></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>Ceci n&#8217;est pas un cours exhaustif de Docker, nous n&#8217;en avons pas le temps, et ce n&#8217;est pas le but.</p></li><li><p>Ce que nous voulons est vous enseigner les rudiments pour que vous soyez arm√©s pour la seconde partie de ce module</p></li><li><p>La partie Gitlab a besoin de ces pr√©-requis</p></li></ul></div></aside></div></section><section id="calendrier"><h2>Calendrier</h2><div class="slide-content"><div class="paragraph"><p>üöß Work in progress&#8230;&#8203; üöß</p></div>
<div class="ulist"><ul><li><p>26 septembre apr√®s-midi</p></li><li><p>24 octobre apr√®s-midi</p></li><li><p>07 novembre apr√®s-midi</p></li><li><p>&#8230;&#8203;</p></li></ul></div></div></section><section id="√©valuation"><h2>üìä √âvaluation</h2><div class="slide-content"><div class="videoblock"><video src="media/ohno.mp4" width="200" height="100%" data-autoplay loop>Your browser does not support the video tag.</video></div>
<div class="ulist"><ul><li><p>Pourquoi ? s&#8217;assurer que vous avez acquis un minimum de concepts</p></li><li><p>Quoi ? Sans doute une note sur 20, bas√©e sur une liste de crit√®res exhaustifs</p></li><li><p>Comment ? Un projet Gitlab (probable) ou GitHub (peu probable) √† me rendre (timing √† d√©terminer ensemble)</p></li></ul></div></div></section><section id="plan" data-background-video="media/plan.mp4" data-background-video-loop data-background-video-muted><h2>Plan</h2><div class="slide-content"><div class="ulist"><ul><li><p>Intro</p></li><li><p>Base</p></li><li><p>Containers</p></li><li><p>Images</p></li><li><p>Fichiers, nommage, inspect</p></li><li><p>Volumes</p></li><li><p>R√©seaux</p></li><li><p>Docker Compose</p></li><li><p>Bonus</p></li></ul></div>
<div class="paragraph small"><small>La suite: vers la droite ‚û°Ô∏è</small></div></div></section></section>
<section><section id="docker" class="container background" data-background-color="rgb(248, 228, 130)" data-background-image="media/empty_harbor.png" data-background-size="cover" data-background-position="left" data-state="invert"><h2>Docker</h2><div class="slide-content"><div class="paragraph"><p>"La Base"</p></div></div></section><section id="pourquoi"><h2>Pourquoi ?</h2><div class="slide-content"><div class="imageblock"><img src="media/docker-logo-monochromatic.png" alt="docker logo monochromatic" width="200"></div>
<div class="paragraph"><p>ü§î Quel est le probl√®me ?</p></div></div></section><section id="pourquoi_commencer_par_un_probl√®me" data-auto-animate><h2>Pourquoi commencer par un probl√®me ?</h2><div class="slide-content"><div class="imageblock"><img src="media/docker-logo-monochromatic.png" alt="docker logo monochromatic" width="200"></div>
<div class="paragraph"><p>ü§î Commen√ßons plut√¥t par une d√©finition:</p></div>
<div class="quoteblock"><blockquote><div class="paragraph"><p>Docker c&#8217;est &#8230;&#8203;</p></div></blockquote></div>
<aside class="notes"><div class="ulist"><ul><li><p>Demander √† l&#8217;assistance une d√©finition</p></li></ul></div></aside></div></section><section id="pourquoi_commencer_par_un_probl√®me_2" data-auto-animate><h2>Pourquoi commencer par un probl√®me ?</h2><div class="slide-content"><div class="imageblock"><img src="media/docker-logo-monochromatic.png" alt="docker logo monochromatic" width="200"></div>
<div class="paragraph"><p>ü§î D√©finition quelque peu dat√©e (2014):</p></div>
<div class="quoteblock"><blockquote><div class="paragraph"><p>Docker is &#8230;&#8203;</p></div></blockquote></div>
<aside class="notes"><div class="ulist"><ul><li><p>Demander √† l&#8217;assistance une d√©finition</p></li><li><p>make a point</p></li></ul></div></aside></div></section><section id="pourquoi_commencer_par_un_probl√®me_3" data-auto-animate><h2>Pourquoi commencer par un probl√®me ?</h2><div class="slide-content"><div class="imageblock"><img src="media/docker-logo-monochromatic.png" alt="docker logo monochromatic" width="200"></div>
<div class="paragraph"><p>ü§î D√©finition quelque peu dat√©e (2014):</p></div>
<div class="quoteblock"><blockquote><div class="paragraph"><p>Docker is a toolset for Linux containers designed to ‚Äòbuild, ship and run‚Äô distributed applications.</p></div></blockquote></div>
<div class="paragraph small"><small><a href="https://www.infoq.com/articles/docker-future/" class="bare">https://www.infoq.com/articles/docker-future/</a></small></div>
<aside class="notes"><div class="ulist"><ul><li><p><a href="https://www.infoq.com/articles/docker-future/" class="bare">https://www.infoq.com/articles/docker-future/</a></p></li></ul></div></aside></div></section><section id="linux_containers" data-auto-animate><h2>Linux containers ?</h2><div class="slide-content"><div class="imageblock"><img src="media/docker-logo-monochromatic.png" alt="docker logo monochromatic" width="200"></div>
<div class="paragraph"><p>ü§î Nous voil√† bien&#8230;&#8203;</p></div>
<div class="quoteblock"><blockquote><div class="paragraph"><p>C&#8217;est quoi un container?</p></div></blockquote></div>
<aside class="notes"><div class="ulist"><ul><li><p><a href="https://www.infoq.com/articles/docker-future/" class="bare">https://www.infoq.com/articles/docker-future/</a></p></li></ul></div></aside></div></section><section id="linux_containers_2" data-auto-animate><h2>Linux containers ?</h2><div class="slide-content"><div class="imageblock"><img src="media/docker-logo-monochromatic.png" alt="docker logo monochromatic" width="200"></div>
<div class="paragraph"><p>ü§î Nous voil√† bien&#8230;&#8203;</p></div>
<div class="quoteblock"><blockquote><div class="paragraph"><p>C&#8217;est quoi un container?</p></div></blockquote></div>
<div class="paragraph small"><small>Vous voulez la version enfant de 5 ans? Je ne crois pas&#8230;&#8203;</small></div>
<aside class="notes"><div class="ulist"><ul><li><p>J&#8217;ai la version "les containers expliqu√©s √† un enfant de 5 ans", mais pas s√ªr que vous appr√©ciez&#8230;&#8203;</p></li><li><p>On va donc passer √† la suite, et on y revient dans un moment.</p></li><li><p>Imagine que tu as une bo√Æte magique appel√©e "conteneur".</p></li><li><p>Cette bo√Æte peut contenir toutes sortes de choses, comme des jouets, des bonbons ou m√™me des dessins.</p></li><li><p>Maintenant, dans le monde de l&#8217;informatique, un conteneur Docker est un peu comme cette bo√Æte magique.</p></li><li><p>Mais au lieu de jouets ou de bonbons, un conteneur Docker peut contenir des programmes et toutes les choses dont ces programmes ont besoin pour fonctionner.</p></li><li><p>Par exemple, il peut contenir un site Web, une application ou m√™me une partie d&#8217;un jeu vid√©o.</p></li><li><p>Ce qui est vraiment cool avec les conteneurs Docker, c&#8217;est qu&#8217;ils sont tr√®s sp√©ciaux.</p></li><li><p>Chaque conteneur est comme une petite bo√Æte magique qui garde tout bien organis√© √† l&#8217;int√©rieur.</p></li><li><p>Et tu peux facilement prendre cette bo√Æte magique et la mettre sur n&#8217;importe quel ordinateur, qu&#8217;il soit grand ou petit, comme si tu transportais tes jouets pr√©f√©r√©s chez un ami.</p></li><li><p>Cela signifie que les conteneurs Docker aident les d√©veloppeurs √† s&#8217;assurer que leurs programmes fonctionnent de la m√™me mani√®re partout o√π ils les utilisent. C&#8217;est comme si tu pouvais t&#8217;amuser avec tes jouets pr√©f√©r√©s chez toi, chez un ami, ou m√™me √† l&#8217;√©cole, et tout fonctionnerait toujours comme pr√©vu.</p></li><li><p>En r√©sum√©, un conteneur Docker est comme une bo√Æte magique pour les programmes informatiques.</p></li><li><p>Il garde tout bien organis√© √† l&#8217;int√©rieur et peut √™tre d√©plac√© facilement d&#8217;un ordinateur √† un autre, comme si tu emportais tes jouets pr√©f√©r√©s partout o√π tu vas. C&#8217;est super pratique pour les personnes qui cr√©ent des choses sur l&#8217;ordinateur !</p></li></ul></div></aside></div></section><section id="docker_est_vieux" data-background-color="rgb(248, 228, 130)" data-state="invert" data-auto-animate><h2>Docker est vieux</h2><div class="slide-content"><div class="paragraph"><p>10 ans d√©j√†&#8230;&#8203;</p></div>
<div class="imageblock"><img src="media/containerconteneuraccidenteavariejpg_5e8b87ccc8c27.jpg" alt="containerconteneuraccidenteavariejpg 5e8b87ccc8c27"></div>
<aside class="notes"><div class="ulist"><ul><li><p>The story of Docker starts in Paris with a startup called DotCloud, founded by Solomon Hykes, Kamel Founadi,
and Sebastien Pahl in 2008 to provide cloud hosting services for software developers.</p></li><li><p>It was first released as an open source project by DotCloud in March 2013.</p></li><li><p>The project quickly became popular, leading to DotCloud rebranded as Docker Inc</p></li></ul></div></aside></div></section><section id="docker_est_vieux_2" data-background-color="rgb(248, 228, 130)" data-state="invert" data-auto-animate><h2>Docker est vieux</h2><div class="slide-content"><div class="paragraph"><p>Mais moi aussi&#8230;&#8203;</p></div>
<div class="imageblock"><img src="media/piWorkshop.png" alt="piWorkshop"></div>
<aside class="notes"><div class="ulist"><ul><li><p>parler de mes d√©buts en 2015/2016</p><div class="ulist"><ul><li><p>Reprendre la d√©claration du d√©but: j&#8217;ai toujours √©t√© brouillon, devops avant que le mot n&#8217;existe, trifouillant 1000 projets √† la fois, et donc la matrix from hell, c&#8217;√©tait mon quotidien</p></li><li><p>Machine Linux non officielle, non autoris√©e, docker impossible sur nos machines de d√©v, oblig√© de passer par une VM</p></li><li><p>Docker int√©ressant, mais interdit en prod, impossible en d√©v&#8230;&#8203;</p></li><li><p>L√† dessus arrive Damien, qui nous fait un workshop Docker sur Raspberry, et l√† je craque</p></li><li><p>J&#8217;ai besoin d&#8217;un laboratoire √† distance de terminaux Android, et Docker sur Raspberry Pi pourrait √™tre la solution</p></li></ul></div></li></ul></div></aside></div></section><section id="docker_on_arm" data-background-color="rgb(248, 228, 130)" data-state="invert" data-auto-animate><h2>Docker on arm</h2><div class="slide-content"><div class="paragraph"><p>Aucune raison que √ßa soit r√©serv√© aux puissants! La r√©volution vaincra!</p></div>
<div class="imageblock"><img src="media/resin-ports-docker-to-arm.png" alt="resin ports docker to arm"></div>
<aside class="notes"><div class="ulist"><ul><li><p>Parler de balena</p></li></ul></div></aside></div></section><section id="docker_on" data-background-color="rgb(248, 228, 130)" data-state="invert" data-auto-animate><h2>Docker on *</h2><div class="slide-content"><div class="paragraph"><p>Linux everywhere&#8230;&#8203; And then Docker to follow.</p></div>
<div class="imageblock"><img src="media/buildx_multi_arch.png" alt="buildx multi arch"></div>
<aside class="notes"><div class="ulist"><ul><li><p>Parler de riscv, de buildx qui permet de builder pour riscv alors que docker pour riscv n&#8217;est pas encore support√©</p></li><li><p>Finir par sortir la Radxa Zero, la brancher, s&#8217;y connecter et faire le docker container run hello world</p></li></ul></div></aside></div></section><section id="on_navait_pas_parl√©_dun_probl√®me" data-auto-animate><h2>On n&#8217;avait pas parl√© d&#8217;un probl√®me?</h2><div class="slide-content"><div class="imageblock"><img src="media/base_du_probl√®me_sans_dev.png" alt="base du probl√®me sans dev"></div></div></section><section id="on_navait_pas_parl√©_dun_probl√®me_2" data-auto-animate><h2>On n&#8217;avait pas parl√© d&#8217;un probl√®me?</h2><div class="slide-content"><div class="imageblock"><img src="media/base_du_probl√®me_sans_dev_et_ops.png" alt="base du probl√®me sans dev et ops"></div></div></section><section id="on_navait_pas_parl√©_dun_probl√®me_3" data-auto-animate><h2>On n&#8217;avait pas parl√© d&#8217;un probl√®me?</h2><div class="slide-content"><div class="imageblock"><img src="media/base_du_probl√®me_sans_stabilit√©.png" alt="base du probl√®me sans stabilit√©"></div></div></section><section id="on_navait_pas_parl√©_dun_probl√®me_4" data-auto-animate><h2>On n&#8217;avait pas parl√© d&#8217;un probl√®me?</h2><div class="slide-content"><div class="imageblock"><img src="media/base_du_probl√®me_sans_fronti√®rel.png" alt="base du probl√®me sans fronti√®rel"></div></div></section><section id="on_navait_pas_parl√©_dun_probl√®me_5" data-auto-animate><h2>On n&#8217;avait pas parl√© d&#8217;un probl√®me?</h2><div class="slide-content"><div class="imageblock"><img src="media/base_du_probl√®me_final.png" alt="base du probl√®me final"></div></div></section><section id="on_navait_pas_parl√©_dun_probl√®me_6" data-auto-animate><h2>On n&#8217;avait pas parl√© d&#8217;un probl√®me?</h2><div class="slide-content"><div class="paragraph"><p>Histoire vraie.</p></div>
<table class="tableblock frame-none grid-none" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><tbody><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><code>Hey salut  !</code></p></td><td class="tableblock halign-left valign-top"></td></tr></table></div></section><section id="on_navait_pas_parl√©_dun_probl√®me_7" data-auto-animate><h2>On n&#8217;avait pas parl√© d&#8217;un probl√®me?</h2><div class="slide-content"><div class="paragraph"><p>Histoire vraie.</p></div>
<table class="tableblock frame-none grid-none" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><tbody><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><code>Hey salut  !</code></p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-center valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>cc</em></p></td></tr></table></div></section><section id="on_navait_pas_parl√©_dun_probl√®me_8" data-auto-animate><h2>On n&#8217;avait pas parl√© d&#8217;un probl√®me?</h2><div class="slide-content"><div class="paragraph"><p>Histoire vraie.</p></div>
<table class="tableblock frame-none grid-none" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><tbody><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><code>Hey salut  !</code></p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-center valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>cc</em></p></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><code>Tu peux mettre √† jour les packages syst√®me steup ? j&#8217;ai un truc √† tester.</code></p></td><td class="tableblock halign-left valign-top"></td></tr></table></div></section><section id="on_navait_pas_parl√©_dun_probl√®me_9" data-auto-animate><h2>On n&#8217;avait pas parl√© d&#8217;un probl√®me?</h2><div class="slide-content"><div class="paragraph"><p>Histoire vraie.</p></div>
<table class="tableblock frame-none grid-none" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><tbody><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><code>Hey salut  !</code></p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-center valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>cc</em></p></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><code>Tu peux mettre √† jour les packages syst√®me steup ? j&#8217;ai un truc √† tester.</code></p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-center valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>nan</em></p></td></tr></table></div></section><section id="on_navait_pas_parl√©_dun_probl√®me_10" data-auto-animate><h2>On n&#8217;avait pas parl√© d&#8217;un probl√®me?</h2><div class="slide-content"><div class="paragraph"><p>Histoire vraie.</p></div>
<table class="tableblock frame-none grid-none" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><tbody><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><code>Hey salut  !</code></p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-center valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>cc</em></p></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><code>Tu peux mettre √† jour les packages syst√®me steup ? j&#8217;ai un truc √† tester.</code></p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-center valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>nan</em></p></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><code>???</code></p></td><td class="tableblock halign-left valign-top"></td></tr></table></div></section><section id="on_navait_pas_parl√©_dun_probl√®me_11" data-auto-animate><h2>On n&#8217;avait pas parl√© d&#8217;un probl√®me?</h2><div class="slide-content"><div class="paragraph"><p>Histoire vraie.</p></div>
<table class="tableblock frame-none grid-none" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><tbody><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><code>Hey salut  !</code></p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-center valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>cc</em></p></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><code>Tu peux mettre √† jour les packages syst√®me steup ? j&#8217;ai un truc √† tester.</code></p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-center valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>nan</em></p></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><code>???</code></p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-center valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>pas standard dsl</em></p></td></tr></table></div></section><section id="on_navait_pas_parl√©_dun_probl√®me_12" data-auto-animate><h2>On n&#8217;avait pas parl√© d&#8217;un probl√®me?</h2><div class="slide-content"><div class="paragraph"><p>Histoire vraie.</p></div>
<table class="tableblock frame-none grid-none" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><tbody><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><code>Hey salut  !</code></p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-center valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>cc</em></p></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><code>Tu peux mettre √† jour les packages syst√®me steup ? j&#8217;ai un truc √† tester.</code></p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-center valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>nan</em></p></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><code>???</code></p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-center valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>pas standard dsl</em></p></td></tr></table>
<div class="imageblock"><img src="media/1072129428-image16.png" alt="1072129428 image16"></div></div></section><section id="on_navait_pas_parl√©_dun_probl√®me_13"><h2>On n&#8217;avait pas parl√© d&#8217;un probl√®me?</h2><div class="slide-content"><div class="imageblock"><img src="media/matrixfromhell.jpg" alt="matrixfromhell"></div>
<div class="paragraph"><p>Probl√®me de temps <strong>exponentiel</strong></p></div>
<aside class="notes"><div class="ulist"><ul><li><p>Le "probl√®me de la matrice de l&#8217;enfer" (ou "matrix from hell" en anglais) est une expression qui fait r√©f√©rence √† la complexit√© croissante des configurations logicielles dans le monde de l&#8217;informatique.</p></li><li><p>Avant l&#8217;arriv√©e de Docker, il √©tait souvent difficile de g√©rer toutes les d√©pendances et les param√®tres n√©cessaires pour ex√©cuter des applications sur diff√©rents ordinateurs.</p></li><li><p>Docker tente de r√©soudre ce probl√®me en introduisant la notion de conteneurs.</p></li><li><p>Les conteneurs Docker sont des environnements autonomes qui contiennent une application et toutes ses d√©pendances, y compris les biblioth√®ques et les param√®tres. Cela signifie que les d√©veloppeurs peuvent cr√©er un conteneur qui fonctionne parfaitement sur leur propre ordinateur, puis le partager avec d&#8217;autres sans se soucier des diff√©rences entre les environnements.</p></li><li><p>En r√©sum√©, Docker r√©sout le "probl√®me de la matrice de l&#8217;enfer" en permettant aux d√©veloppeurs de cr√©er des conteneurs contenant leurs applications, ce qui garantit que celles-ci fonctionneront de la m√™me mani√®re partout, √©vitant ainsi les tracas li√©s aux configurations complexes.</p></li></ul></div></aside></div></section><section id="d√©j√†_vu"><h2>D√©j√† vu ?</h2><div class="slide-content"><div class="paragraph"><p>L&#8217;IT n&#8217;est pas la seule industrie √† r√©soudre des probl√®mes&#8230;&#8203;</p></div>
<div class="imageblock"><img src="media/also-a-matrix-from-hell.png" alt="also a matrix from hell"></div></div></section><section id="solution_le_conteneur_intermodal"><h2>Solution: Le conteneur intermodal</h2><div class="slide-content"><div class="paragraph"><p>"Separation of Concerns"</p></div>
<div class="imageblock"><img src="media/blue-shipping-container.png" alt="blue shipping container"></div>
<aside class="notes"><div class="paragraph"><p>Faire le parall√®le avec les containers marchands contenant des jouets, de l&#8217;√©lectronique, de la nourriture, le tout connect√© au m√™me bateau, sans pour autant √™tre interd√©pendants.
Docker apporte une s√©paration claire des pr√©occupations gr√¢ce √† ses conteneurs. Cette s√©paration des pr√©occupations signifie que chaque composant d&#8217;une application est isol√© dans son propre conteneur. Voici comment cela fonctionne :</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Isolation des Composants : Avec Docker, chaque composant d&#8217;une application (comme une base de donn√©es, un serveur web, etc.) est emball√© dans un conteneur distinct. Ces conteneurs fonctionnent de mani√®re ind√©pendante les uns des autres, ce qui signifie que si un composant rencontre un probl√®me ou n√©cessite une mise √† jour, cela n&#8217;affecte pas les autres composants.</p></li><li><p>Portabilit√© : Les conteneurs Docker encapsulent non seulement l&#8217;application, mais aussi toutes ses d√©pendances. Cela garantit que l&#8217;application fonctionnera de la m√™me mani√®re quel que soit l&#8217;endroit o√π vous l&#8217;ex√©cutez, que ce soit sur votre ordinateur local, un serveur en nuage ou ailleurs. Cela simplifie la gestion de l&#8217;application √† l&#8217;√©chelle.</p></li><li><p>Facilit√© de D√©ploiement : En raison de cette s√©paration, le d√©ploiement d&#8217;applications devient plus simple. Vous pouvez g√©rer chaque conteneur individuellement, les mettre √† jour sans perturber le reste de l&#8217;application, et m√™me les r√©pliquer pour mettre en place des configurations complexes.</p></li><li><p>Gestion des Ressources : Docker permet √©galement de g√©rer efficacement les ressources de l&#8217;ordinateur h√¥te. Chaque conteneur a sa propre allocation de ressources, ce qui emp√™che un conteneur de monopoliser toute la puissance de calcul, garantissant ainsi des performances stables pour toutes les parties de l&#8217;application.</p></li></ol></div>
<div class="paragraph"><p>En r√©sum√©, Docker apporte une s√©paration des pr√©occupations claire en isolant chaque composant d&#8217;une application dans son propre conteneur. Cela facilite le d√©ploiement, la gestion et la maintenance des applications, tout en garantissant la portabilit√© et la stabilit√© des performances.</p></div></aside></div></section><section id="comment_√ßa_marche" data-auto-animate><h2>Comment √ßa marche ?</h2><div class="slide-content"><div class="paragraph"><p>"Virtualisation <strong>L√©g√®re</strong>"</p></div>
<div class="imageblock"><img src="media/container_vs_vm.jpg" alt="container vs vm"></div>
<aside class="notes"><div class="paragraph"><p>La virtualisation l√©g√®re, dans le contexte des conteneurs Docker, est une m√©thode de virtualisation qui permet d&#8217;ex√©cuter plusieurs environnements isol√©s (conteneurs) sur un seul syst√®me d&#8217;exploitation (h√¥te). Contrairement √† la virtualisation traditionnelle, o√π chaque machine virtuelle (VM) n√©cessite son propre syst√®me d&#8217;exploitation, les conteneurs partagent le m√™me noyau du syst√®me d&#8217;exploitation de l&#8217;h√¥te.</p></div>
<div class="paragraph"><p>Les principales caract√©ristiques de la virtualisation l√©g√®re sont les suivantes :</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Isolation : Chaque conteneur est isol√© des autres, ce qui signifie qu&#8217;ils ne peuvent pas interf√©rer les uns avec les autres. Cela permet d&#8217;ex√©cuter diff√©rentes applications avec leurs propres d√©pendances sans conflits.</p></li><li><p>Efficacit√© des ressources : √âtant donn√© que les conteneurs partagent le m√™me noyau du syst√®me d&#8217;exploitation, ils sont beaucoup plus l√©gers en termes de ressources que les machines virtuelles. Cela permet d&#8217;ex√©cuter de nombreux conteneurs sur une seule machine physique, ce qui est efficace en termes d&#8217;utilisation des ressources.</p></li><li><p>D√©marrage rapide : Les conteneurs se lancent rapidement, en quelques secondes, car ils n&#8217;ont pas besoin de d√©marrer un syst√®me d&#8217;exploitation complet. Cela permet une mise √† l&#8217;√©chelle rapide des applications.</p></li><li><p>Portabilit√© : Les conteneurs sont portables, ce qui signifie qu&#8217;ils fonctionnent de la m√™me mani√®re sur n&#8217;importe quel syst√®me qui prend en charge Docker. Cela simplifie le d√©ploiement et la gestion des applications.</p></li></ol></div>
<div class="paragraph"><p>En r√©sum√©, la virtualisation l√©g√®re des conteneurs Docker permet d&#8217;ex√©cuter efficacement plusieurs environnements isol√©s sur un m√™me syst√®me d&#8217;exploitation, offrant ainsi une isolation, une efficacit√© des ressources, un d√©marrage rapide et une portabilit√© des applications.</p></div></aside></div></section><section id="comment_√ßa_marche_2" data-auto-animate><h2>Comment √ßa marche ?</h2><div class="slide-content"><div class="paragraph"><p>Virtualisation</p></div>
<div class="imageblock"><img src="media/types_of_hypervisors.png" alt="https://medium.com/teamresellerclub/type-1-and-type-2-hypervisors-what-makes-them-different-6a1755d6ae2c"></div>
<aside class="notes"><div class="paragraph"><p>Un hyperviseur est un logiciel sp√©cialis√© qui permet d&#8217;ex√©cuter plusieurs syst√®mes d&#8217;exploitation (comme Windows, Linux, etc.) sur un seul mat√©riel physique (comme un serveur). Il agit comme une couche d&#8217;abstraction entre le mat√©riel et les syst√®mes d&#8217;exploitation invit√©s.</p></div>
<div class="paragraph"><p>Il existe deux types d&#8217;hyperviseurs :</p></div>
<div class="paragraph"><p>Hyperviseurs de type 1 (ou bare-metal) : Ils s&#8217;installent directement sur le mat√©riel physique et n&#8217;ont pas besoin d&#8217;un syst√®me d&#8217;exploitation h√¥te. Ils sont tr√®s efficaces et sont g√©n√©ralement utilis√©s dans les centres de donn√©es pour ex√©cuter plusieurs VM de mani√®re isol√©e.</p></div>
<div class="paragraph"><p>Hyperviseurs de type 2 (ou hosted) : Ils s&#8217;ex√©cutent sur un syst√®me d&#8217;exploitation existant, comme une application. Ils sont g√©n√©ralement utilis√©s pour la virtualisation de bureau ou le d√©veloppement, mais sont moins efficaces que les hyperviseurs de type 1.</p></div>
<div class="paragraph"><p>En r√©sum√©, un hyperviseur vous permet d&#8217;ex√©cuter plusieurs syst√®mes d&#8217;exploitation sur un seul serveur physique, ce qui vous permet de maximiser l&#8217;utilisation des ressources mat√©rielles et de simplifier la gestion des environnements informatiques.</p></div></aside></div></section><section id="comment_√ßa_marche_3" class="columns" data-auto-animate><h2>Comment √ßa marche ?</h2><div class="slide-content"><div class="paragraph column"><p>Virtualisation</p></div>
<hr>
<div class="imageblock"><img src="media/type-1-hypervisor-examples.png" alt="https://www.ubackup.com/enterprise-backup/type-1-hypervisor-vs-type-2.html"></div>
<hr>
<hr>
<div class="imageblock"><img src="media/type-2-hypervisor-examples.png" alt="https://www.ubackup.com/enterprise-backup/type-1-hypervisor-vs-type-2.html"></div>
<hr></div></section><section id="comment_√ßa_marche_4" data-auto-animate><h2>Comment √ßa marche ?</h2><div class="slide-content"><div class="paragraph"><p>"Virtualisation <strong>L√©g√®re</strong>"</p></div>
<div class="imageblock"><img src="media/container_vs_vm.jpg" alt="container vs vm"></div>
<div class="ulist"><ul><li><p>L√©g√®re, vraiment?</p></li></ul></div></div></section><section id="l√©g√®re_vraiment" data-background-image="media/RPiDockerConChallenge.png" data-background-size="contain" data-background-position="left" data-auto-animate><h2>L√©g√®re, vraiment!</h2><div class="slide-content">
<div class="paragraph small"><small><a href="http://web.archive.org/web/20200810061020/https://www.docker.com/blog/raspberry-pi-dockercon-challenge-winner/" class="bare">http://web.archive.org/web/20200810061020/https://www.docker.com/blog/raspberry-pi-dockercon-challenge-winner/</a></small></div></div></section><section id="l√©g√®re_vraiment_2" data-background-image="media/esxpi.png" data-background-size="contain" data-background-position="left" data-auto-animate><h2>L√©g√®re, vraiment!</h2><div class="slide-content">
<div class="paragraph small"><small><a href="https://www.architecting.it/blog/esxi-on-raspberry-pi/" class="bare">https://www.architecting.it/blog/esxi-on-raspberry-pi/</a></small></div></div></section><section id="conteneur_vm" data-auto-animate><h2>Conteneur != VM</h2><div class="slide-content"><div class="imageblock"><img src="media/docker-n-est-pas-VM.png" alt="docker n est pas VM"></div>
<div class="ulist"><ul><li><p>Id√©e erron√©e mais cit√©e trop fr√©quemment !</p></li></ul></div></div></section><section id="conteneur_vm_2" data-auto-animate><h2>Conteneur != VM</h2><div class="slide-content"><div class="imageblock"><img src="media/not-a-vm-9.png" alt="not a vm 9"></div></div></section><section id="conteneur_vm_3" data-auto-animate><h2>Conteneur != VM</h2><div class="slide-content"><div class="imageblock"><img src="media/not-a-vm-8.png" alt="not a vm 8"></div></div></section><section id="conteneur_vm_4" data-auto-animate><h2>Conteneur != VM</h2><div class="slide-content"><div class="imageblock"><img src="media/not-a-vm-7.png" alt="not a vm 7"></div></div></section><section id="conteneur_vm_5" data-auto-animate><h2>Conteneur != VM</h2><div class="slide-content"><div class="imageblock"><img src="media/not-a-vm-6.png" alt="not a vm 6"></div></div></section><section id="conteneur_vm_6" data-auto-animate><h2>Conteneur != VM</h2><div class="slide-content"><div class="imageblock"><img src="media/not-a-vm-5.png" alt="not a vm 5"></div></div></section><section id="conteneur_vm_7" data-auto-animate><h2>Conteneur != VM</h2><div class="slide-content"><div class="imageblock"><img src="media/not-a-vm-4.png" alt="not a vm 4"></div></div></section><section id="conteneur_vm_8" data-auto-animate><h2>Conteneur != VM</h2><div class="slide-content"><div class="imageblock"><img src="media/not-a-vm-3.png" alt="not a vm 3"></div></div></section><section id="conteneur_vm_9" data-auto-animate><h2>Conteneur != VM</h2><div class="slide-content"><div class="imageblock"><img src="media/not-a-vm-2.png" alt="not a vm 2"></div></div></section><section id="conteneur_vm_10" data-auto-animate><h2>Conteneur != VM</h2><div class="slide-content"><div class="imageblock"><img src="media/not-a-vm-1.png" alt="not a vm 1"></div></div></section><section id="conteneur_vm_11" data-auto-animate><h2>Conteneur != VM</h2><div class="slide-content"><div class="imageblock"><img src="media/not-a-vm.png" alt="not a vm"></div></div></section><section id="conteneur_vm_12" data-auto-animate><h2>Conteneur != VM</h2><div class="slide-content"><div class="paragraph"><p>"Separation of concerns": 1 "t√¢che" par conteneur</p></div>
<div class="imageblock"><img src="media/vm-and-container.png" alt="vm and container"></div>
<aside class="notes"><div class="paragraph"><p>Les hyperviseurs et les machines virtuelles (VM) sont comme des maisons enti√®rement meubl√©es o√π chaque invit√© a sa propre maison s√©par√©e.</p></div>
<div class="ulist"><ul><li><p>Chaque maison est une VM, avec son propre syst√®me d&#8217;exploitation et ses ressources, et elles peuvent fonctionner sur le m√™me serveur physique.</p></li><li><p>En revanche, les conteneurs sont comme des appartements dans un m√™me immeuble. Ils partagent la m√™me infrastructure, comme les escaliers et les couloirs (le noyau du syst√®me d&#8217;exploitation), mais chaque appartement (conteneur) est s√©par√© et poss√®de son propre espace priv√©. Les conteneurs partagent efficacement les ressources du serveur, car ils √©vitent de dupliquer tout le syst√®me d&#8217;exploitation, ce qui les rend plus l√©gers et plus rapides que les VM.</p></li></ul></div>
<div class="paragraph"><p>En r√©sum√©, les VM sont comme des maisons s√©par√©es, tandis que les conteneurs sont comme des appartements dans le m√™me b√¢timent, partageant certaines parties communes mais offrant toujours une s√©paration.</p></div></aside></div></section><section id="vms_conteneurs"><h2>VMs &amp; Conteneurs</h2><div class="slide-content"><div class="paragraph"><p>Non exclusifs mutuellement</p></div>
<div class="imageblock"><img src="media/containers-and-vms-together.png" alt="containers and vms together"></div>
<aside class="notes"><div class="paragraph"><p>Les machines virtuelles (VM) et les conteneurs peuvent √™tre utilis√©s ensemble pour obtenir les avantages des deux mondes.</p></div>
<div class="ulist"><ul><li><p>Les VMs offrent une isolation plus forte en ex√©cutant des syst√®mes d&#8217;exploitation virtuels complets, ce qui les rend id√©ales pour des charges de travail n√©cessitant une s√©curit√© et une isolation √©lev√©es.
Les conteneurs, en revanche, sont l√©gers et rapides, ce qui les rend parfaits pour ex√©cuter de nombreuses applications sur un seul serveur.</p></li><li><p>En combinant les deux, vous pouvez ex√©cuter des VMs pour isoler et prot√©ger des charges de travail sensibles, tout en utilisant des conteneurs pour ex√©cuter des applications l√©g√®res et faciles √† g√©rer.
Cela permet une flexibilit√© accrue dans la gestion des ressources et des charges de travail sur votre infrastructure informatique.</p></li></ul></div></aside></div></section><section id="docker_cest_pas_un_peu_une_vm_quand_m√™me"><h2>ü§° Docker, c&#8217;est pas un peu une VM quand m√™me?</h2><div class="slide-content"><div class="imageblock"><img src="media/mobyvm.png" alt="mobyvm" height="1000"></div></div></section><section id="docker_cest_pas_un_peu_une_vm_quand_m√™me_2"><h2>ü§° Docker, c&#8217;est pas un peu une VM quand m√™me?</h2><div class="slide-content"><div class="ulist"><ul><li><p>Docker sur Windows pour ex√©cuter des conteneurs Linux :</p><div class="ulist"><ul><li class="fragment"><p>Hyper-V : Sous Windows, Docker utilise souvent Hyper-V pour ex√©cuter des machines virtuelles l√©g√®res (VM) Linux.</p></li><li class="fragment"><p>Performance : Docker sur Windows pour les conteneurs Linux peut √™tre l√©g√®rement moins performant que Docker sur Linux natif.</p></li><li class="fragment"><p>Isolation : Isolation diff√©rente de celle des conteneurs Linux natifs.</p></li></ul></div></li><li><p>Docker sur Linux pour ex√©cuter des conteneurs Linux :</p><div class="ulist"><ul><li class="fragment"><p>Native : Docker fonctionne nativement car il partage le m√™me noyau Linux.</p></li><li class="fragment"><p>Efficacit√© : Il  est tr√®s efficace en termes de consommation de ressources.</p></li><li class="fragment"><p>Isolation : Isolation bas√©e sur les cgroups et les namespaces du noyau Linux.</p></li></ul></div></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>Docker sur Linux pour ex√©cuter des conteneurs Linux :</p><div class="ulist"><ul><li><p>Native : Sur un syst√®me Linux, Docker fonctionne nativement car il partage le m√™me noyau Linux. Il offre donc une performance optimale et une int√©gration transparente avec le syst√®me h√¥te.</p></li><li><p>Efficacit√© : Comme Docker sur Linux partage le noyau du syst√®me h√¥te, il est tr√®s efficace en termes de consommation de ressources. Les conteneurs Linux sont l√©gers et se lancent rapidement.</p></li><li><p>Isolation : Les conteneurs Linux sur Docker offrent une isolation bas√©e sur les cgroups et les namespaces du noyau Linux. Cela permet d&#8217;isoler efficacement les applications et de garantir qu&#8217;elles n&#8217;interf√®rent pas les unes avec les autres.</p></li><li><p>Images Linux : Docker sur Linux est optimis√© pour les images de conteneurs Linux. Vous utiliserez principalement des images Linux pour vos conteneurs.</p></li></ul></div></li><li><p>Docker sur Windows pour ex√©cuter des conteneurs Linux :</p><div class="ulist"><ul><li><p>Hyper-V : Sur un syst√®me Windows, Docker utilise souvent Hyper-V pour ex√©cuter des machines virtuelles l√©g√®res (VM) Linux. Cela signifie que vous ex√©cutez un hyperviseur (Hyper-V) pour ex√©cuter Linux, ce qui ajoute une couche de virtualisation.</p></li><li><p>Performance : En raison de la virtualisation, Docker sur Windows pour les conteneurs Linux peut √™tre l√©g√®rement moins performant que Docker sur Linux natif. Il existe une surcharge en raison de la virtualisation.</p></li><li><p>Isolation : Les conteneurs Linux s&#8217;ex√©cutent dans des VM l√©g√®res, ce qui ajoute une isolation, mais elle est diff√©rente de celle des conteneurs Linux natifs. Les conteneurs Linux s&#8217;ex√©cutent toujours sur le m√™me noyau, mais ils sont isol√©s au niveau du syst√®me de fichiers.</p></li><li><p>Images Linux : Vous utilisez √©galement des images Linux pour les conteneurs Linux ex√©cut√©s sous Docker sur Windows.</p></li></ul></div></li></ul></div>
<div class="paragraph"><p>En r√©sum√©, Docker sur Linux est la meilleure option pour ex√©cuter des conteneurs Linux, car il offre une int√©gration transparente et des performances optimales. Docker sur Windows utilise Hyper-V pour ex√©cuter des conteneurs Linux, ce qui ajoute une couche de virtualisation et peut entra√Æner une l√©g√®re perte de performances. Cependant, cela fonctionne bien lorsque vous avez besoin d&#8217;ex√©cuter des conteneurs Linux sur une machine Windows.</p></div></aside></div></section><section id="cas_dusage" data-auto-animate><h2>Cas d&#8217;usage</h2><div class="slide-content"><div class="paragraph"><p>Le bac √† sable</p></div>
<div class="imageblock"><img src="media/bac_√†_sable.png" alt="bac √† sable"></div></div></section><section id="cas_dusage_2" data-auto-animate><h2>Cas d&#8217;usage</h2><div class="slide-content"><div class="paragraph"><p>Le bac √† sable</p></div>
<div class="imageblock"><img src="media/bac_√†_sable.png" alt="bac √† sable"></div>
<div class="ulist"><ul><li><p>Un environnement tout propre tout neuf !</p></li></ul></div></div></section><section id="cas_dusage_3" data-auto-animate><h2>Cas d&#8217;usage</h2><div class="slide-content"><div class="paragraph"><p>Le bac √† sable</p></div>
<div class="imageblock"><img src="media/bac_√†_sable.png" alt="bac √† sable"></div>
<div class="ulist"><ul><li><p>Un environnement tout propre tout neuf !</p></li><li><p>Le poste de travail n&#8217;est pas impact√©</p></li></ul></div></div></section><section id="cas_dusage_4" data-auto-animate><h2>Cas d&#8217;usage</h2><div class="slide-content"><div class="paragraph"><p>Le bac √† sable</p></div>
<div class="imageblock"><img src="media/bac_√†_sable.png" alt="bac √† sable"></div>
<div class="ulist"><ul><li><p>Un environnement tout propre tout neuf !</p></li><li><p>Le poste de travail n&#8217;est pas impact√©</p></li><li><p>La configuration reste √©galement isol√©e sans effet sur le poste de travail</p></li></ul></div></div></section><section id="cas_dusage_5" data-auto-animate><h2>Cas d&#8217;usage</h2><div class="slide-content"><div class="paragraph"><p>La machine de d√©v</p></div>
<div class="imageblock"><img src="media/dis-le-encore-une-fois.png" alt="dis le encore une fois"></div></div></section><section id="cas_dusage_6" data-auto-animate><h2>Cas d&#8217;usage</h2><div class="slide-content"><div class="paragraph"><p>La machine de d√©v</p></div>
<div class="imageblock"><img src="media/dis-le-encore-une-fois.png" alt="dis le encore une fois"></div>
<div class="ulist"><ul><li><p>Avoir un environnement reproductible pour rendre homog√®ne le d√©veloppement et les tests.</p></li></ul></div></div></section><section id="cas_dusage_7" data-auto-animate><h2>Cas d&#8217;usage</h2><div class="slide-content"><div class="paragraph"><p>La machine de d√©v</p></div>
<div class="imageblock"><img src="media/docker-birth.png" alt="docker birth"></div></div></section><section id="cas_dusage_8" data-auto-animate><h2>Cas d&#8217;usage</h2><div class="slide-content"><div class="paragraph"><p>La machine de d√©v</p></div>
<div class="imageblock"><img src="media/give-computer-client.png" alt="give computer client"></div></div></section><section id="cas_dusage_9" data-auto-animate><h2>Cas d&#8217;usage</h2><div class="slide-content"><div class="paragraph"><p>D√©ploiement en production</p></div>
<div class="imageblock"><img src="media/prod-probleme.png" alt="prod probleme"></div></div></section><section id="cas_dusage_10" data-auto-animate><h2>Cas d&#8217;usage</h2><div class="slide-content"><div class="paragraph"><p>D√©ploiement en production</p></div>
<div class="imageblock"><img src="media/prod-probleme.png" alt="prod probleme"></div>
<div class="ulist"><ul><li><p>Avec un container, si ca fonctionne en local, ca fonctionne en prod !</p></li></ul></div></div></section><section id="cas_dusage_11" data-auto-animate><h2>Cas d&#8217;usage</h2><div class="slide-content"><div class="paragraph"><p>Outillage jetable</p></div>
<div class="imageblock"><img src="media/outillage-jetable.png" alt="outillage jetable"></div></div></section><section id="cas_dusage_12" data-auto-animate><h2>Cas d&#8217;usage</h2><div class="slide-content"><div class="paragraph"><p>Outillage jetable</p></div>
<div class="imageblock"><img src="media/outillage-jetable.png" alt="outillage jetable"></div>
<div class="ulist"><ul><li><p>On instancie des applications sans les installer</p></li></ul></div></div></section><section id="cas_dusage_13" data-auto-animate><h2>Cas d&#8217;usage</h2><div class="slide-content"><div class="paragraph"><p>Outillage jetable</p></div>
<div class="imageblock"><img src="media/outillage-jetable.png" alt="outillage jetable"></div>
<div class="ulist"><ul><li><p>On instancie des applications sans les installer</p></li><li><p>On cr√©e le container, on l&#8217;utilise puis on le jette</p></li></ul></div></div></section><section id="beau_boulot" class="columns" data-auto-animate><h2>Beau boulot! ü§ó</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="imageblock"><img src="media/bitmoji-well%20done.png" alt="bitmoji well done"></div></div></div>
<div class="openblock column"><div class="content"><div class="paragraph"><p>On a la base, remplissons l√† maintenant de containers!</p></div>
<div class="paragraph small"><small>La suite: vers la droite ‚û°Ô∏è</small></div></div></div>
<div class="openblock column"><div class="content"><div class="imageblock"><img src="media/empty_ship.png" alt="empty ship" height="720"></div></div></div></div></section></section>
<section><section id="pr√©parer_votre_environnement_de_travail" data-background-color="rgb(248, 228, 130)" data-state="invert"><h2>Pr√©parer votre environnement de travail</h2></section><section id="outils_n√©cessaires"><h2>Outils N√©cessaires üõ†</h2><div class="slide-content"><div class="ulist"><ul><li><p>Un navigateur web r√©cent (et d√©cent)</p></li><li><p>Un compte sur <a href="https://github.com" target="_blank"><span class="icon"><i class="fab fa-github"></i></span> GitHub</a></p></li></ul></div></div></section><section id="gitpod"><h2>GitPod</h2><div class="slide-content"><div class="paragraph"><p><a href="https://gitpod.io" target="_blank">GitPod.io</a> : Environnement de d√©veloppement dans le ‚òÅÔ∏è "nuage"</p></div>
<div class="ulist"><ul><li><p><strong>But:</strong> reproductible</p></li><li><p>Puissance de calcul sur un serveur distant</p></li><li><p>√âditeur de code VSCode dans le navigateur</p></li></ul></div>
<div class="admonitionblock warning fragment"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content">Gratuit pour 50h par mois (‚ö†Ô∏è)</td></tr></table></div>
<div class="admonitionblock warning fragment"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content">√áa, c&#8217;√©tait avant (‚ö†Ô∏è)</td></tr></table></div>
<div class="admonitionblock warning fragment"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content">Gratuit pour 10h par mois (‚ö†Ô∏è)</td></tr></table></div>
<div class="admonitionblock warning fragment"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content">Gratuit pour 50h par mois si compte <span class="icon"><i class="fab fa-linkedin"></i></span> li√© (‚ö†Ô∏è)</td></tr></table></div></div></section><section id="d√©marrer_avec_gitpod"><h2>D√©marrer avec GitPod üöÄ</h2><div class="slide-content"><div class="ulist"><ul><li><p>Rendez vous sur <a href="https://gitpod.io" class="bare" target="_blank">https://gitpod.io</a></p></li><li><p>Authentifiez vous en utilisant votre compte GitHub:</p><div class="ulist"><ul><li><p>Bouton "Login" en haut √† droite</p></li><li><p>Puis choisissez le lien "<span class="icon"><i class="fab fa-github"></i></span> Continue with GitHub"</p></li></ul></div></li></ul></div>
<div class="paragraph small"><small>‚ö†Ô∏è Pour les "autorisations", passez sur la slide suivante</small></div></div></section><section id="autorisations_demand√©es_par_gitpod"><h2>Autorisations demand√©es par GitPod üîì</h2><div class="slide-content"><div class="paragraph"><p>Lors de votre premi√®re connexion, GitPod va vous demander l&#8217;acc√®s (√† accepter) √† votre email public configur√© dans GitHub :</p></div>
<div class="imageblock"><img src="media/gitpod-github-permissions.png" alt="gitpod github permissions" width="400"></div>
<div class="paragraph small"><small>‚ö†Ô∏è Passez √† la slide suivante avant d&#8217;aller plus loin</small></div></div></section><section id="validation_du_compte_gitpod"><h2>Validation du Compte GitPod üì±</h2><div class="slide-content"><div class="paragraph"><p>GitPod vous demande votre num√©ro de t√©l√©phone mobile afin d&#8217;√©viter les abus (service gratuit).
Saisissez un num√©ro de t√©l√©phone valide pour recevoir par SMS un code de d√©blocage :</p></div>
<div class="imageblock"><img src="media/gitpod-phone-validation.png" alt="gitpod phone validation" width="400"></div>
<div class="paragraph small"><small>‚ö†Ô∏è Passez √† la slide suivante avant d&#8217;aller plus loin</small></div></div></section><section id="choix_de_l√©diteur_de_code"><h2>Choix de l&#8217;√âditeur de Code ‚úé</h2><div class="slide-content"><div class="paragraph"><p>Choisissez l&#8217;√©diteur "VSCode Browser" (la premi√®re tuile) :</p></div>
<div class="imageblock"><img src="media/gitpod-select-editor.png" alt="gitpod select editor" width="600"></div>
<div class="paragraph small"><small>‚ö†Ô∏è Passez √† la slide suivante avant d&#8217;aller plus loin</small></div></div></section><section id="workspaces_gitpod"><h2>Workspaces GitPod üóÇ</h2><div class="slide-content"><div class="ulist"><ul><li><p>Vous arrivez sur la <a href="https://gitpod.io/workspaces" target="_blank">page listant les "workspaces" GitPod</a> :</p></li><li><p>Un workspace est une instance d&#8217;un environnement de travail virtuel (C&#8217;est un ordinateur distant)</p></li><li><p>‚ö†  Faites attention √† r√©utiliser le m√™me workspace tout au long de ce cours ‚ö†</p></li></ul></div>
<div class="imageblock"><img src="media/gitpod-workspaces.png" alt="gitpod workspaces" width="600"></div></div></section><section id="permissions_gitpod_github"><h2>Permissions GitPod &lt;&#8594; GitHub üîê</h2><div class="slide-content"><div class="ulist"><ul><li><p>Pour les besoins de ce cours, vous devez autoriser GitPod √† pouvoir effectuer certaines modification dans vos d√©p√¥ts GitHub</p></li><li><p>Rendez-vous sur <a href="https://gitpod.io/user/integrations" target="_blank">la page des int√©grations avec GitPod</a></p></li><li><p>√âditez les permissions de la ligne "GitHub" (les 3 petits points √† droits) et s√©lectionnez uniquement :</p><div class="ulist"><ul><li><p><code>user:email</code></p></li><li><p><code>public_repo</code></p></li><li><p><code>workflow</code></p></li></ul></div></li></ul></div></div></section><section id="d√©marrer_lenvironnement_gitpod"><h2>D√©marrer l&#8217;environnement GitPod</h2><div class="slide-content"><div class="paragraph"><p>Cliquez sur le bouton ci-dessous pour d√©marrer un environnement GitPod personnalis√©:</p></div>
<div class="imageblock"><a class="image" href="https://gitpod.io#https://github.com/gounthar/cours-devops-docker" target="_blank" rel="noopener"><img src="https://gitpod.io/button/open-in-gitpod.svg" alt="open in gitpod"></a></div>
<div class="paragraph"><p>Apr√®s quelques secondes (minutes?), vous avez acc√®s √† l&#8217;environnement:</p></div>
<div class="ulist"><ul><li><p>Gauche: navigateur de fichiers ("Workspace")</p></li><li><p>Haut: √©diteur de texte ("Get Started")</p></li><li><p>Bas: Terminal interactif</p></li><li><p>√Ä droite en bas: plein de popups √† ignorer (ou pas?)</p></li></ul></div>
<div class="paragraph small"><small>Source disponible dans : <a href="https://github.com/gounthar/cours-devops-docker" target="_blank"><span class="icon"><i class="fab fa-github"></i></span> https://github.com/gounthar/cours-devops-docker</a></small></div></div></section><section id="checkpoint"><h2>Checkpoint üéØ</h2><div class="slide-content"><div class="ulist"><ul><li><p>Vous devriez pouvoir taper la commande <code>whoami</code> dans le terminal de GitPod:</p><div class="ulist"><ul><li><p>Retour attendu: <code>gitpod</code></p></li></ul></div></li><li><p>Vous devriez pouvoir fermer le fichier "Get Started"&#8230;&#8203;</p><div class="ulist"><ul><li><p>&#8230;&#8203; et ouvrir n&#8217;importe quel autre fichier&#8230;&#8203;</p></li></ul></div></li></ul></div>
<div class="paragraph"><p>Bien, on peut maintenant fermer ce workspace, il ne s&#8217;agirait pas de gaspiller vos 50 heures.</p></div></div></section><section id="et_gitlab"><h2>üìö Et Gitlab?</h2><div class="slide-content"><div class="paragraph"><p>GitPod fonctionne aussi avec gitlab.com, mais pour les instances on premise, il faut l&#8217;installer, l&#8217;instancier, avoir un "inner cloud"</p></div>
<div class="paragraph fragment"><p>Bref, on ne l&#8217;a pas ici. <code>¬Ø_(„ÉÑ)_/¬Ø</code></p></div>
<div class="paragraph small"><small>On peut commencer !</small></div></div></section></section>
<section><section id="ligne_de_commande" data-background-color="rgb(248, 228, 130)" data-state="invert"><h2>Ligne de commande</h2><div class="slide-content"><div class="paragraph"><p>Guide de survie</p></div></div></section><section id="probl√©matique"><h2>ü§î Probl√©matique</h2><div class="slide-content"><div class="ulist"><ul><li><p>Communication Humain &lt;&#8594; Machine</p></li><li><p>Base commune de TOUS les outils</p></li></ul></div></div></section><section id="cli" data-background-color="rgb(248, 228, 130)" data-state="invert"><h2>CLI</h2><div class="slide-content"><div class="ulist"><ul><li><p>üá¨üáß CLI == "Command Line Interface"</p></li><li><p>üá´üá∑ "Interface de Ligne de Commande"</p></li></ul></div></div></section><section id="repl"><h2>REPL</h2><div class="slide-content"><div class="paragraph"><p>Pour les th√©oriciens et curieux :</p></div>
<div class="ulist"><ul><li><p>üá¨üáß REPL == "Read‚Äìeval‚Äìprint loop"</p></li></ul></div>
<div class="paragraph"><p><a href="https://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop" class="bare">https://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop</a></p></div></div></section><section id="anatomie_dune_commande"><h2>Anatomie d&#8217;une commande</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">ls --color=always -l /bin</code></pre></div></div>
<div class="ulist"><ul><li><p>S√©parateur : l&#8217;espace</p></li><li><p>Premier √©l√©ment (<code>ls</code>) : c&#8217;est la commande</p></li><li><p>Les √©l√©ments commen√ßant par un tiret <code>-</code> sont des "options" et/ou drapeaux ("flags")</p><div class="ulist"><ul><li><p>"Option" == "Optionnel"</p></li></ul></div></li><li><p>Les autres √©l√©ments sont des arguments  (<code>/bin</code>)</p><div class="ulist"><ul><li><p>N√©cessaire (par opposition)</p></li></ul></div></li></ul></div></div></section><section id="manuel_des_commande"><h2>Manuel des commande</h2><div class="slide-content"><div class="ulist"><ul><li><p>Afficher le manuel de <code>&lt;commande&gt;</code> :</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Commande 'man' avec comme argument le nom de ladite commande
man &lt;commande&gt;</code></pre></div></div>
<div class="ulist"><ul><li><p>Navigation avec les fl√®ches haut et bas</p><div class="ulist"><ul><li><p>Tapez <code>/</code> puis une cha√Æne de texte pour chercher</p></li><li><p>Touche <code>n</code> pour sauter d‚Äôoccurrence en occurrence</p></li></ul></div></li><li><p>Touche <code>q</code> pour quitter</p></li></ul></div></li></ul></div>
<div class="paragraph"><p>üéì Essayez avec <code>ls</code>, chercher le mot <code>color</code></p></div>
<div class="ulist small"><ul><li><p>üí° La majorit√© des commandes fournit √©galement une option (<code>--help</code>), un flag (<code>-h</code>)  ou un argument (<code>help</code>)</p></li><li><p>Google c&#8217;est pratique aussi hein !</p></li></ul></div></div></section><section id="raccourcis"><h2>Raccourcis</h2><div class="slide-content"><div class="paragraph"><p>Dans un terminal Unix/Linux/WSL :</p></div>
<div class="ulist"><ul><li><p><code>CTRL + C</code> : Annuler le process ou prompt en cours</p></li><li><p><code>CTRL + L</code> : Nettoyer le terminal</p></li><li><p><code>CTRL + A</code> : Positionner le curseur au d√©but de la ligne</p></li><li><p><code>CTRL + E</code> : Positionner le curseur √† la fin de la ligne</p></li><li><p><code>CTRL + R</code> : Rechercher dans l&#8217;historique de commandes</p></li></ul></div>
<div class="paragraph small"><small>üéì Essayez-les !</small></div></div></section><section id="commandes_de_base_12"><h2>Commandes de base 1/2</h2><div class="slide-content"><div class="ulist"><ul><li><p><code>pwd</code> : Afficher le r√©pertoire courant</p><div class="ulist"><ul><li><p>üéì Option <code>-P</code> ?</p></li></ul></div></li><li><p><code>ls</code> : Lister le contenu du r√©pertoire courant</p><div class="ulist"><ul><li><p>üéì Options <code>-a</code> et <code>-l</code> ?</p></li></ul></div></li><li><p><code>cd</code> : Changer de r√©pertoire</p><div class="ulist"><ul><li><p>üéì Sans argument : que se passe t&#8217;il ?</p></li></ul></div></li><li><p><code>cat</code> : Afficher le contenu d&#8217;un fichier</p><div class="ulist"><ul><li><p>üéì Essayez avec plusieurs arguments</p></li></ul></div></li><li><p><code>mkdir</code> : cr√©er un r√©pertoire</p><div class="ulist"><ul><li><p>üéì Option <code>-p</code> ?</p></li></ul></div></li></ul></div></div></section><section id="commandes_de_base_22"><h2>Commandes de base 2/2</h2><div class="slide-content"><div class="ulist"><ul><li><p><code>echo</code> : Afficher un (des) message(s)</p></li><li><p><code>rm</code> : Supprimer un fichier ou dossier</p></li><li><p><code>touch</code> : Cr√©er un fichier</p></li><li><p><code>grep</code> : Chercher un motif de texte</p></li></ul></div></div></section><section id="arborescence_de_fichiers_12"><h2>Arborescence de fichiers 1/2</h2><div class="slide-content"><div class="ulist"><ul><li><p>Le syst√®me de fichier a une structure d&#8217;arbre</p><div class="ulist"><ul><li><p>La racine du disque dur c&#8217;est <code>/</code> : üéì <code>ls -l /</code></p></li><li><p>Le s√©parateur c&#8217;est √©galement <code>/</code> : üéì <code>ls -l /usr/bin</code></p></li></ul></div></li><li><p>Deux types de chemins :</p><div class="ulist"><ul><li><p>Absolu (depuis la racine): Commence par <code>/</code> (Ex. <code>/usr/bin</code>)</p></li><li><p>Sinon c&#8217;est relatif (e.g. depuis le dossier courant) (Ex <code>./bin</code> ou <code>local/bin/</code>)</p></li></ul></div></li></ul></div>
<div class="imageblock"><img src="media/linux-directory-structure.png" alt="linux directory structure" width="400"></div>
<div class="paragraph small"><small><a href="https://linuxhandbook.com/linux-directory-structure/" target="_blank">Source</a></small></div></div></section><section id="arborescence_de_fichiers_22"><h2>Arborescence de fichiers 2/2</h2><div class="slide-content"><div class="ulist"><ul><li><p>Le dossier "courant" c&#8217;est <code>.</code> : üéì <code>ls -l ./bin # Dans le dossier /usr</code></p></li><li><p>Le dossier "parent" c&#8217;est <code>..</code> : üéì <code>ls -l ../ # Dans le dossier /usr</code></p></li><li><p><code>~</code> (tilde) c&#8217;est un raccourci vers le dossier de l&#8217;utilisateur courant : üéì <code>ls -l ~</code></p></li><li><p>Sensible √† la casse (majuscules/minuscules) et aux espaces :
üéì</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">ls -l /bin
ls -l /Bin
mkdir ~/"Accent tu√©"
ls -d ~/Accent\ tu√©</code></pre></div></div></li></ul></div></div></section><section id="un_language"><h2>Un language (?)</h2><div class="slide-content"><div class="ulist"><ul><li><p>Variables interpol√©es avec le caract√®re "dollar" <code>$</code> :</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">echo $MA_VARIABLE
echo "$MA_VARIABLE"
echo ${MA_VARIABLE}

# Recommendation
echo "${MA_VARIABLE}"

MA_VARIABLE="Salut tout le monde"

echo "${MA_VARIABLE}"</code></pre></div></div></li><li><p>Sous commandes avec <code>$(&lt;command&gt;)</code>:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">echo "&gt;&gt; Contenu de /tmp :\n$(ls /tmp)"</code></pre></div></div>
<div class="ulist"><ul><li><p>Des <code>if</code>, des <code>for</code> et plein d&#8217;autres trucs (<a href="https://tldp.org/LDP/abs/html/" class="bare" target="_blank">https://tldp.org/LDP/abs/html/</a>)</p></li></ul></div></div></section><section id="codes_de_sortie"><h2>Codes de sortie</h2><div class="slide-content"><div class="ulist"><ul><li><p>Chaque ex√©cution de commande renvoie un code de retour (üá¨üáß "exit code")</p><div class="ulist"><ul><li><p>Nombre entier entre 0 et 255 (en <a href="https://en.wikipedia.org/wiki/POSIX" target="_blank">POSIX</a>)</p></li></ul></div></li><li><p>Code accessible dans la variable <strong>√©ph√©m√®re</strong> <code>$?</code> :</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">ls /tmp
echo $?

ls /do_not_exist
echo $?

# Une seconde fois. Que se passe-t'il ?
echo $?</code></pre></div></div></div></section><section id="entr√©e_sortie_standard_et_derreur"><h2>Entr√©e, sortie standard et d&#8217;erreur</h2><div class="slide-content"><div class="paragraph"><p><span class="image"><img src="media/cli-ios.png" alt="cli ios"></span></p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">ls -l /tmp
echo "Hello" &gt; /tmp/hello.txt
ls -l /tmp
ls -l /tmp &gt;/dev/null
ls -l /tmp 1&gt;/dev/null

ls -l /do_not_exist
ls -l /do_not_exist 1&gt;/dev/null
ls -l /do_not_exist 2&gt;/dev/null

ls -l /tmp /do_not_exist
ls -l /tmp /do_not_exist 1&gt;/dev/null 2&gt;&amp;1</code></pre></div></div></div></section><section id="pipelines"><h2>Pipelines</h2><div class="slide-content"><div class="ulist"><ul><li><p>Le caract√®re "pipe" <code>|</code> permet de cha√Æner des commandes</p><div class="ulist"><ul><li><p>Le "stdout" de la premi√®re commande est branch√©e sur le "stdin" de la seconde</p></li></ul></div></li><li><p>Exemple : Afficher les fichiers/dossiers contenant le lettre <code>d</code> dans le dossier <code>/bin</code> :</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">ls -l /bin

ls -l /bin | grep "d" --color=auto</code></pre></div></div></div></section><section id="ex√©cution_12"><h2>Ex√©cution 1/2</h2><div class="slide-content"><div class="ulist"><ul><li><p>Les commandes sont des fichier binaires ex√©cutables sur le syst√®me :</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">command -v cat # √©quivalent de "which cat"

ls -l "$(command -v cat)"</code></pre></div></div></li><li><p>La variable d&#8217;environnement <code>$PATH</code> liste les dossiers dans lesquels chercher les binaires</p><div class="ulist"><ul><li><p>üí° Utiliser cette variable quand une commande fra√Æchement install√©e n&#8217;est pas trouv√©e</p></li></ul></div></li></ul></div></div></section><section id="ex√©cution_22"><h2>Ex√©cution 2/2</h2><div class="slide-content"><div class="ulist"><ul><li><p>Ex√©cution de scripts :</p><div class="ulist"><ul><li><p>Soit appel direct avec l&#8217;interpr√©tateur : <code>sh ~/monscript.txt</code></p></li><li><p>Soit droit d&#8217;ex√©cution avec un "shebang" (e.g. <code>#!/bin/bash</code>)</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ chmod +x ./monscript.sh

$ head -n1 ./monscript.sh
#!/bin/bash

$ ./monscript.sh
# Ex√©cution</code></pre></div></div></li></ul></div></li></ul></div></div></section></section>
<section><section id="git" data-background-color="rgb(248, 228, 130)" data-state="invert"><h2>Git</h2><div class="slide-content"><div class="paragraph"><p>Guide de survie</p></div></div></section><section id="probl√©matique_2"><h2>ü§î Probl√©matique</h2><div class="slide-content"><div class="ulist"><ul><li><p>Support de communication</p><div class="ulist"><ul><li><p>Humain &#8594; Machine</p></li><li><p>Humain &lt;&#8594; Humain</p></li></ul></div></li><li><p>Besoins de tra√ßabilit√©, de d√©finition explicite et de gestion de conflits</p><div class="ulist"><ul><li><p>Collaboration requise pour chaque changement (revue, responsabilit√©s)</p></li></ul></div></li></ul></div></div></section><section id="tracer_le_changement_dans_le_code"><h2>Tracer le changement dans le code</h2><div class="slide-content"><div class="paragraph"><p>avec un <strong>VCS</strong> : üá¨üáß Version Control System</p></div>
<div class="paragraph small"><small>√©galement connu sous le nom de SCM (üá¨üáß Source Code Management)</small></div></div></section><section id="pourquoi_un_vcs"><h2>Pourquoi un VCS ?</h2><div class="slide-content"><div class="ulist"><ul><li><p>Pour conserver une trace de <strong>tous</strong> les changements dans un historique</p><div class="ulist"><ul><li><p>"Source unique de v√©rit√©" (üá¨üáß <em>Single Source of Truth</em>)</p></li></ul></div></li><li><p>Pour <strong>collaborer</strong> efficacement sur un m√™me r√©f√©rentiel</p></li></ul></div></div></section><section id="concepts_des_vcs"><h2>Concepts des VCS</h2><div class="slide-content"><div class="imageblock"><img src="media/scm-local.png" alt="scm local" width="300"></div>
<div class="imageblock"><img src="media/scm-distributed.png" alt="scm distributed" width="300"></div>
<div class="paragraph small"><small>Source : <a href="https://git-scm.com/book/en/v2/Getting-Started-About-Version-Control" class="bare">https://git-scm.com/book/en/v2/Getting-Started-About-Version-Control</a></small></div></div></section><section id="quel_vcs_utiliser"><h2>Quel VCS utiliser ?</h2><div class="slide-content"><div class="imageblock"><img src="media/cloudwords-vcs.png" alt="cloudwords vcs" width="500"></div>
<div class="paragraph"><p>Nous allons utiliser <strong>Git</strong></p></div></div></section><section id="git_2"><h2>Git</h2><div class="slide-content"><div class="quoteblock"><blockquote><div class="paragraph"><p>Git is a free and open source distributed version control system designed to handle everything from small to very large projects with speed and efficiency.</p></div></blockquote></div>
<div class="paragraph"><p><a href="https://git-scm.com/" class="bare">https://git-scm.com/</a></p></div>
<div class="imageblock"><img src="media/git-logo.png" alt="git logo"></div></div></section><section id="les_3_√©tats_avec_git"><h2>Les 3 √©tats avec Git</h2><div class="slide-content"><div class="ulist"><ul><li><p>L&#8217;historique ("Version Database") : dossier <code>.git</code></p></li><li><p>Dossier de votre projet ("Working Directory") - Commande</p></li><li><p>La zone d&#8217;index ("Staging Area")</p></li></ul></div>
<div class="imageblock"><img src="media/git-3-etats.png" alt="git 3 etats" width="300"></div>
<div class="paragraph small"><small>Source : <a href="https://git-scm.com/book/fr/v2/D%C3%A9marrage-rapide-Rudiments-de-Git#" class="bare">https://git-scm.com/book/fr/v2/D%C3%A9marrage-rapide-Rudiments-de-Git#</a><em>les_trois</em>%C3%A9tats</small></div></div></section><section id="exercice_avec_git_1_1"><h2>üéì Exercice avec Git - 1.1</h2><div class="slide-content"><div class="ulist"><ul><li><p>Dans le terminal de votre environnement GitPod:</p><div class="ulist"><ul><li><p>Cr√©ez un dossier vide nomm√© <code>projet-vcs-1</code> dans le r√©pertoire <code>/workspace</code>, puis positionnez-vous dans ce dossier</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">mkdir -p /workspace/projet-vcs-1/
cd /workspace/projet-vcs-1/</code></pre></div></div></li><li><p>Est-ce qu&#8217;il y a un dossier <code>.git/</code> ?</p></li><li><p>Essayez la commande <code>git status</code> ?</p></li></ul></div></li><li><p>Initialisez le d√©p√¥t git avec <code>git init</code></p><div class="ulist"><ul><li><p>Est-ce qu&#8217;il y a un dossier <code>.git/</code> ?</p></li><li><p>Essayez la commande <code>git status</code> ?</p></li></ul></div></li></ul></div></div></section><section id="solution_de_lexercice_avec_git_1_1"><h2>‚úÖ Solution de l&#8217;exercice avec Git - 1.1</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">mkdir -p /workspace/projet-vcs-1/
cd /workspace/projet-vcs-1/
ls -la # Pas de dossier .git
git status # Erreur "fatal: not a git repository"
git init ./
ls -la # On a un dossier .git
git status # Succ√®s avec un message "On branch main No commits yet"</code></pre></div></div></div></section><section id="exercice_avec_git_1_2"><h2>üéì Exercice avec Git - 1.2</h2><div class="slide-content"><div class="ulist"><ul><li><p>Cr√©ez un fichier <code>README.md</code> dedans avec un titre et vos nom et pr√©noms</p><div class="ulist"><ul><li><p>Essayez la commande <code>git status</code> ?</p></li></ul></div></li><li><p>Ajoutez le fichier √† la zone d&#8217;indexation √† l&#8217;aide de la commande <code>git add (&#8230;&#8203;)</code></p><div class="ulist"><ul><li><p>Essayez la commande <code>git status</code> ?</p></li></ul></div></li><li><p>Cr√©ez un commit qui ajoute le fichier <code>README.md</code> avec un message,
√† l&#8217;aide de la commande <code>git commit -m &lt;message&gt;</code></p><div class="ulist"><ul><li><p>Essayez la commande <code>git status</code> ?</p></li></ul></div></li></ul></div></div></section><section id="solution_de_lexercice_avec_git_1_2"><h2>‚úÖ Solution de l&#8217;exercice avec Git - 1.2</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">echo "# Read Me\n\nObi Wan" &gt; ./README.md
git status # Message "Untracked file"

git add ./README.md
git status # Message "Changes to be committed"
git commit -m "Ajout du README au projet"
git status  # Message "nothing to commit, working tree clean"</code></pre></div></div></div></section><section id="terminologie_de_git_diff_et_changeset"><h2>Terminologie de Git - Diff et changeset</h2><div class="slide-content"><div class="paragraph"><p><strong>diff:</strong> un ensemble de lignes "chang√©es" sur un fichier donn√©</p></div>
<div class="imageblock"><img src="media/diff.png" alt="diff" width="600"></div>
<div class="paragraph"><p><strong>changeset:</strong> un ensemble de "diff" (donc peut couvrir plusieurs fichiers)</p></div>
<div class="imageblock"><img src="media/changeset.png" alt="changeset" height="200"></div></div></section><section id="terminologie_de_git_commit"><h2>Terminologie de Git - Commit</h2><div class="slide-content"><div class="paragraph"><p><strong>commit:</strong> un changeset qui poss√®de un (commit) parent, associ√© √† un message</p></div>
<div class="imageblock"><img src="media/commit.png" alt="commit" height="150"></div>
<div class="paragraph"><p><em>"HEAD"</em>: C&#8217;est le dernier commit dans l&#8217;historique</p></div>
<div class="imageblock"><img src="media/scm-basics-legend.png" alt="scm basics legend"></div>
<div class="imageblock"><img src="media/scm-basics-history.png" alt="scm basics history"></div></div></section><section id="exercice_avec_git_2"><h2>üéì Exercice avec Git - 2</h2><div class="slide-content"><div class="ulist"><ul><li><p>Afficher la liste des commits</p></li><li><p>Afficher le changeset associ√© √† un commit</p></li><li><p>Modifier du contenu dans <code>README.md</code> et afficher le diff</p></li><li><p>Annulez ce changement sur <code>README.md</code></p></li></ul></div></div></section><section id="solution_de_lexercice_avec_git_2"><h2>‚úÖ Solution de l&#8217;exercice avec Git - 2</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">git log

git show # Show the "HEAD" commit
echo "# Read Me\n\nObi Wan Kenobi" &gt; ./README.md

git diff
git status

git checkout -- README.md
git status</code></pre></div></div></div></section><section id="terminologie_de_git_branche"><h2>Terminologie de Git - Branche</h2><div class="slide-content"><div class="ulist"><ul><li><p>Abstraction d&#8217;une version "isol√©e" du code</p></li><li><p>Concr√®tement, une <strong>branche</strong> est un alias pointant vers un "commit"</p></li></ul></div>
<div class="imageblock"><img src="media/scm-branches.png" alt="scm branches"></div></div></section><section id="exercice_avec_git_3"><h2>üéì Exercice avec Git - 3</h2><div class="slide-content"><div class="ulist"><ul><li><p>Cr√©er une branche nomm√©e <code>feature/html</code></p></li><li><p>Ajouter un nouveau commit contenant un nouveau fichier <code>index.html</code> sur cette branche</p></li><li><p>Afficher le graphe correspondant √† cette branche avec <code>git log --graph</code></p></li></ul></div></div></section><section id="solution_de_lexercice_avec_git_3"><h2>‚úÖ Solution de l&#8217;exercice avec Git - 3</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">git switch --create feature/html
# Ou alors: git branch feature/html &amp;&amp; git switch feature/html
echo '&lt;h1&gt;Hello&lt;/h1&gt;' &gt; ./index.html
git add ./index.html &amp;&amp; git commit --message="Ajout d'une page HTML par d√©faut" # -m / --message

git log
git log --graph
git lg # cat ~/.gitconfig =&gt; regardez la section section [alias], cette commande est d√©j√† d√©finie!</code></pre></div></div></div></section><section id="terminologie_de_git_merge"><h2>Terminologie de Git - Merge</h2><div class="slide-content"><div class="ulist"><ul><li><p>On int√®gre une branche dans une autre en effectuant un <strong>merge</strong></p><div class="ulist"><ul><li><p>Un nouveau commit est cr√©√©, fruit de la combinaison de 2 autres commits</p></li></ul></div></li></ul></div>
<div class="imageblock"><img src="media/scm-merge.png" alt="scm merge"></div></div></section><section id="exercice_avec_git_4"><h2>üéì Exercice avec Git - 4</h2><div class="slide-content"><div class="ulist"><ul><li><p>Merger la branche <code>feature/html</code> dans la branche principale</p><div class="ulist"><ul><li><p>‚ö†Ô∏è Pensez √† utiliser l&#8217;option <code>--no-ff</code></p></li></ul></div></li><li><p>Afficher le graphe correspondant √† cette branche avec <code>git log --graph</code></p></li></ul></div></div></section><section id="solution_de_lexercice_avec_git_4"><h2>‚úÖ Solution de l&#8217;exercice avec Git - 4</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">git switch main
git merge --no-ff feature/html # Enregistrer puis fermer le fichier 'MERGE_MSG' qui a √©t√© ouvert
git log --graph

# git lg</code></pre></div></div></div></section><section id="feature_branch_flow"><h2>Feature Branch Flow</h2><div class="slide-content"><div class="ulist"><ul><li><p><strong>Une seule</strong> branche <strong>par</strong> fonctionnalit√©</p></li></ul></div>
<div class="imageblock"><a class="image" href="https://twitter.com/jay_gee/status/702638177471873024"><img src="media/scm-feature-branch-workflow.png" alt="scm feature branch workflow"></a></div></div></section><section id="exemple_dusages_de_vcs"><h2>Exemple d&#8217;usages de VCS</h2><div class="slide-content"><div class="ulist"><ul><li><p>"Infrastructure as Code" :</p><div class="ulist"><ul><li><p>Besoins de tra√ßabilit√©, de d√©finition explicite et de gestion de conflits</p></li><li><p>Collaboration requise pour chaque changement (revue, responsabilit√©s)</p></li></ul></div></li><li><p>Code Civil:</p><div class="ulist"><ul><li><p><a href="https://github.com/steeve/france.code-civil" class="bare">https://github.com/steeve/france.code-civil</a></p></li><li><p><a href="https://github.com/steeve/france.code-civil/pull/40" class="bare">https://github.com/steeve/france.code-civil/pull/40</a></p></li><li><p><a href="https://github.com/steeve/france.code-civil/commit/b805ecf05a86162d149d3d182e04074ecf72c066" class="bare">https://github.com/steeve/france.code-civil/commit/b805ecf05a86162d149d3d182e04074ecf72c066</a></p></li></ul></div></li></ul></div></div></section><section id="checkpoint_2"><h2>Checkpoint üéØ</h2><div class="slide-content"><div class="ulist"><ul><li><p><code>git</code> est un des (plus populaires) de syst√®me de contr√¥le de versions</p></li><li><p>Cet outil vous permet:</p><div class="ulist"><ul><li><p>D&#8217;avoir un historique auditable de votre code source</p></li><li><p>De collaborer efficacement sur le code source (conflit <code>git</code> == "PARLEZ-VOUS")</p></li></ul></div></li></ul></div>
<div class="paragraph"><p>&#8658; C&#8217;est une ligne de commande (trop?) compl√®te qui n√©cessite de pratiquer</p></div></div></section></section>
<section><section id="containers" data-background-image="media/blue-shipping-container.png" data-background-size="contain" data-background-position="left"><h2>Containers</h2><div class="slide-content"></div></section><section id="exercice_votre_premier_conteneur"><h2>üéì Exercice : Votre premier conteneur</h2><div class="slide-content"><div class="paragraph"><p>C&#8217;est √† vous (ouf) !</p></div>
<div class="ulist"><ul><li><p>Allez dans Gitpod</p></li><li><p>Dans un terminal, tapez la commande suivante :</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run hello-world
# Equivalent de l'ancienne commande 'docker run'</code></pre></div></div></div></section><section id="anatomie" data-auto-animate><h2>ü©ª Anatomie</h2><div class="slide-content"><div class="ulist"><ul><li><p>Un service "Docker Engine" tourne en t√¢che de fond et publie une API REST</p></li><li><p>La commande <code>docker container run &#8230;&#8203;</code> a lanc√© un client docker qui a envoy√© une requ√™te <code>POST</code> au service docker</p></li><li><p>Le service a t√©l√©charg√© une <strong>Image</strong> Docker depuis le registre <strong>DockerHub</strong>,</p></li><li><p>Puis a ex√©cut√© un <strong>conteneur</strong> bas√© sur cette image</p></li></ul></div></div></section><section id="anatomie_2" data-auto-animate><h2>ü©ª Anatomie</h2><div class="slide-content"><div class="imageblock"><img src="media/output3_with_transparency.png" alt="output3 with transparency"></div></div></section><section id="anatomie_3" data-auto-animate><h2>ü©ª Anatomie</h2><div class="slide-content"><div class="imageblock"><img src="media/output4_with_transparency.png" alt="output4 with transparency"></div></div></section><section id="anatomie_4" data-auto-animate><h2>ü©ª Anatomie</h2><div class="slide-content"><div class="imageblock"><img src="media/output5_with_transparency.png" alt="output5 with transparency"></div></div></section><section id="anatomie_5" data-auto-animate><h2>ü©ª Anatomie</h2><div class="slide-content"><div class="imageblock"><img src="media/output6_with_transparency.png" alt="output6 with transparency"></div></div></section><section id="anatomie_6" data-auto-animate><h2>ü©ª Anatomie</h2><div class="slide-content"><div class="imageblock"><img src="media/output7_with_transparency.png" alt="output7 with transparency"></div></div></section><section id="anatomie_7" data-auto-animate><h2>ü©ª Anatomie</h2><div class="slide-content"><div class="imageblock"><img src="media/output8_with_transparency.png" alt="output8 with transparency"></div></div></section><section id="anatomie_8" data-auto-animate><h2>ü©ª Anatomie</h2><div class="slide-content"><div class="imageblock"><img src="media/output9_with_transparency.png" alt="output9 with transparency"></div></div></section><section id="anatomie_9" data-auto-animate><h2>ü©ª Anatomie</h2><div class="slide-content"><div class="imageblock"><img src="media/output10_with_transparency.png" alt="output10 with transparency"></div></div></section><section id="anatomie_10" data-auto-animate><h2>ü©ª Anatomie</h2><div class="slide-content"><div class="imageblock"><img src="media/dollar_date.png" alt="dollar date"></div></div></section><section id="anatomie_11" data-auto-animate><h2>ü©ª Anatomie</h2><div class="slide-content"><div class="imageblock"><img src="media/shell_dans_shell_pour_date.png" alt="shell dans shell pour date"></div></div></section><section id="exercice_o√π_est_mon_conteneur"><h2>üéì Exercice : O√π est mon conteneur ?</h2><div class="slide-content"><div class="paragraph"><p>C&#8217;est √† vous !</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container ls --help
# ...
docker container ls
# ...
docker container ls --all</code></pre></div></div>
<div class="paragraph"><p>&#8658; ü§î comment comprenez vous les r√©sultats des 2 derni√®res commandes ?</p></div></div></section><section id="solution_o√π_est_mon_conteneur"><h2>‚úÖ Solution : O√π est mon conteneur ?</h2><div class="slide-content"><div class="paragraph"><p>Le conteneur est toujours pr√©sent dans le "Docker Engine" m√™me en √©tant arr√™t√©</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">CONTAINER ID   IMAGE         COMMAND    CREATED          STATUS                      PORTS     NAMES
109a9cdd3ec8   hello-world   "/hello"   33 seconds ago   Exited (0) 17 seconds ago             festive_faraday</code></pre></div></div>
<div class="ulist"><ul><li><p>Un conteneur == une commande "conteneuris√©e"</p><div class="ulist"><ul><li><p>cf. colonne "<strong>COMMAND</strong>"</p></li></ul></div></li><li><p>Quand la commande s&#8217;arr√™te : le conteneur s&#8217;arr√™te</p><div class="ulist"><ul><li><p>cf. code de sortie dans la colonne "<strong>STATUS</strong>"</p></li></ul></div></li></ul></div></div></section><section id="rappels_danatomie" data-auto-animate><h2>ü´Å Rappels d&#8217;anatomie</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ docker container run busybox echo hello world</code></pre></div></div></div></section><section id="rappels_danatomie_2" data-auto-animate><h2>ü´Å Rappels d&#8217;anatomie</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ docker container run busybox echo hello world</code></pre></div></div>
<div class="ulist"><ul><li><p>Le moteur Docker cr√©e un container √† partir de l&#8217;image "busybox".</p></li></ul></div></div></section><section id="rappels_danatomie_3" data-auto-animate><h2>ü´Å Rappels d&#8217;anatomie</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ docker container run busybox echo hello world</code></pre></div></div>
<div class="ulist"><ul><li><p>Le moteur Docker cr√©e un container √† partir de l&#8217;image "busybox".</p></li><li><p>Le moteur Docker d√©marre le container cr√©√©.</p></li></ul></div></div></section><section id="rappels_danatomie_4" data-auto-animate><h2>ü´Å Rappels d&#8217;anatomie</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ docker container run busybox echo hello world</code></pre></div></div>
<div class="ulist"><ul><li><p>Le moteur Docker cr√©e un container √† partir de l&#8217;image "busybox".</p></li><li><p>Le moteur Docker d√©marre le container cr√©√©.</p></li><li><p>La commande "echo hello world" est ex√©cut√©e √† l&#8217;int√©rieur du container.</p></li></ul></div></div></section><section id="rappels_danatomie_5" data-auto-animate><h2>ü´Å Rappels d&#8217;anatomie</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ docker container run busybox echo hello world</code></pre></div></div>
<div class="ulist"><ul><li><p>Le moteur Docker cr√©e un container √† partir de l&#8217;image "busybox".</p></li><li><p>Le moteur Docker d√©marre le container cr√©√©.</p></li><li><p>La commande "echo hello world" est ex√©cut√©e √† l&#8217;int√©rieur du container.</p></li><li><p>On obtient le r√©sultat dans la sortie standard de la machine h√¥te.</p></li></ul></div></div></section><section id="rappels_danatomie_6" data-auto-animate><h2>ü´Å Rappels d&#8217;anatomie</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ docker container run busybox echo hello world</code></pre></div></div>
<div class="ulist"><ul><li><p>Le moteur Docker cr√©e un container √† partir de l&#8217;image "busybox".</p></li><li><p>Le moteur Docker d√©marre le container cr√©√©.</p></li><li><p>La commande "echo hello world" est ex√©cut√©e √† l&#8217;int√©rieur du container.</p></li><li><p>On obtient le r√©sultat dans la sortie standard de la machine h√¥te.</p></li><li><p>Le container est stopp√©.</p></li></ul></div></div></section><section id="cas_dusage_14" data-auto-animate><h2>üçΩÔ∏è Cas d&#8217;usage</h2><div class="slide-content"><div class="paragraph"><p>Outillage jetable</p></div>
<div class="imageblock"><img src="media/outillage-jetable.png" alt="outillage jetable"></div>
<div class="ulist"><ul><li><p>Tester une version de Maven, de JDK, de NPM, ‚Ä¶</p></li></ul></div></div></section><section id="exercice_cycle_de_vie_dun_conteneur_simple"><h2>üéì Exercice : Cycle de vie d&#8217;un conteneur simple</h2><div class="slide-content"><div class="ulist"><ul><li><p>Lancez un nouveau conteneur nomm√© <code>bonjour</code></p><div class="ulist"><ul><li><p>üí° <code>docker container run --help</code> ou <a href="https://docs.docker.com/engine/reference/commandline/container_run/" target="_blank">Documentation en ligne</a></p></li></ul></div></li><li><p>Affichez les "logs" du conteneur (==traces d&#8217;ex√©cution √©crites sur le stdout + stderr de la commande conteneuris√©e)</p><div class="ulist"><ul><li><p>üí° <code>docker container logs  --help</code> ou <a href="https://docs.docker.com/engine/reference/commandline/container_logs/" target="_blank">Documentation en ligne</a></p></li></ul></div></li><li><p>Lancez le conteneur avec la commande <a href="https://docs.docker.com/engine/reference/commandline/container_start/" target="_blank"><code>docker container start</code></a></p><div class="ulist"><ul><li><p>Regardez le r√©sultat dans les logs</p></li></ul></div></li><li><p>Supprimez le container avec la commande <a href="https://docs.docker.com/engine/reference/commandline/container_rm/" target="_blank"><code>docker container rm</code></a></p></li></ul></div></div></section><section id="solution_cycle_de_vie_dun_conteneur_simple"><h2>‚úÖ Solution : Cycle de vie d&#8217;un conteneur simple</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run --name=bonjour hello-world
# Affiche le texte habituel

docker container logs bonjour
# Affiche le m√™me texte : pratique si on a ferm√© le terminal

docker container start bonjour
# N'affiche pas le texte mais l'identifiant unique du conteneur 'bonjour'

docker container logs bonjour
# Le texte est affich√© 2 fois !

docker container ls --all
# Le conteneur est pr√©sent
docker container rm bonjour
docker container ls --all
# Le conteneur n'est plus l√† : il a √©t√© supprim√© ainsi que ses logs

docker container logs bonjour
# Error: No such container: bonjour</code></pre></div></div></div></section><section id="que_contient_hello_world"><h2>ü§î Que contient "hello-world" ?</h2><div class="slide-content"><div class="ulist"><ul><li><p>C&#8217;est une "image" de conteneur, c&#8217;est √† dire un mod√®le (template)
repr√©sentant une application auto-suffisante.</p><div class="ulist"><ul><li><p>On peut voir √ßa comme un "paquetage" autonome</p></li></ul></div></li><li><p>C&#8217;est un syst√®me de fichier complet:</p><div class="ulist"><ul><li><p>Il y a au moins une racine <code>/</code></p></li><li><p>Ne contient que ce qui est cens√© √™tre n√©cessaire (d√©pendances, librairies, binaires, etc.)</p></li></ul></div></li></ul></div></div></section><section id="docker_hub"><h2>Docker Hub</h2><div class="slide-content"><div class="ulist"><ul><li><p><a href="https://hub.docker.com/" class="bare">https://hub.docker.com/</a> : C&#8217;est le registre d&#8217;images "par d√©faut"</p><div class="ulist"><ul><li><p>Exemple : Image officielle de <a href="https://hub.docker.com/_/ubuntu">conteneur "Ubuntu"</a></p></li></ul></div></li><li><p>üéì Cherchez l&#8217;image <code>hello-world</code> pour en voir la page de documentation</p><div class="ulist"><ul><li><p>üí° pas besoin de cr√©er de compte pour √ßa</p></li></ul></div></li><li><p>Il existe d&#8217;autre "registres" en fonction des besoins (GitHub GHCR, Google GCR, etc.)</p></li></ul></div></div></section><section id="lancer_un_container_interactif" data-auto-animate><h2>üèì Lancer un container interactif</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run  --interactive --tty alpine</code></pre></div></div></div></section><section id="lancer_un_container_interactif_2" data-auto-animate><h2>üèì Lancer un container interactif</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run  --interactive --tty alpine
/ $</code></pre></div></div></div></section><section id="lancer_un_container_interactif_3" data-auto-animate><h2>üèì Lancer un container interactif</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run  --interactive --tty alpine
/ $</code></pre></div></div>
<div class="ulist"><ul><li><p>On lance un container √† partir de l&#8217;image "alpine"</p></li></ul></div></div></section><section id="lancer_un_container_interactif_4" data-auto-animate><h2>üèì Lancer un container interactif</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run  --interactive --tty alpine
/ $</code></pre></div></div>
<div class="ulist"><ul><li><p>On lance un container √† partir de l&#8217;image "alpine"</p></li><li><p>On lance un <code>sh</code> dans ce container</p></li></ul></div></div></section><section id="lancer_un_container_interactif_5" data-auto-animate><h2>üèì Lancer un container interactif</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run  --interactive --tty alpine
/ $</code></pre></div></div>
<div class="ulist"><ul><li><p>On lance un container √† partir de l&#8217;image "alpine"</p></li><li><p>On lance un <code>sh</code>  dans ce container</p></li><li><p>On redirige l&#8217;entr√©e standard avec -i</p></li></ul></div></div></section><section id="lancer_un_container_interactif_6" data-auto-animate><h2>üèì Lancer un container interactif</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run  --interactive --tty alpine
/ $</code></pre></div></div>
<div class="ulist"><ul><li><p>On lance un container √† partir de l&#8217;image "alpine"</p></li><li><p>On lance un <code>sh</code>  dans ce container</p></li><li><p>On redirige l&#8217;entr√©e standard avec -i</p></li><li><p>On d√©clare un pseudo-terminal avec -t</p></li></ul></div></div></section><section id="exercice_conteneur_interactif"><h2>üéì Exercice : conteneur interactif</h2><div class="slide-content"><div class="ulist"><ul><li><p>Quelle distribution Linux est utilis√©e dans le terminal Gitpod ?</p><div class="ulist"><ul><li><p>üí° Regardez le fichier <code>/etc/os-release</code></p></li></ul></div></li><li><p>Ex√©cutez un conteneur interactif bas√© sur <code>alpine:3.18.3</code> (une distribution Linux ultra-l√©g√®re) et regardez le contenu du fichier au m√™me emplacement</p><div class="ulist"><ul><li><p>üí° <code>docker container run --help</code></p></li><li><p>üí° Demandez un <a href="https://en.wikipedia.org/wiki/TTY"><code>tty</code></a> √† Docker</p></li><li><p>üí° Activez le mode interactif</p></li></ul></div></li><li><p>Ex√©cutez la m√™me commande dans un conteneur bas√© sur la m√™me image mais en <strong>NON</strong> interactif</p><div class="ulist"><ul><li><p>üí° Comment surcharger la commande par d√©faut ?</p></li></ul></div></li></ul></div></div></section><section id="solution_conteneur_interactif"><h2>‚úÖ Solution : conteneur interactif</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ cat /etc/os-release
# ... Ubuntu ....

$ docker container run --tty --interactive alpine:3.18.3
/ $ cat /etc/os-release
# ... Alpine ...
# Notez que le "prompt" du terminal est diff√©rent DANS le conteneur
/ $ exit
$ docker container ls --all

$ docker container run alpine:3.18.3 cat /etc/os-release
# ... Alpine ...</code></pre></div></div></div></section><section id="utiliser_un_container_interactif" data-auto-animate><h2>üèì Utiliser un container interactif</h2><div class="slide-content"><div class="paragraph"><p>Revenons dans notre container interactif de tout √† l&#8217;heure&#8230;&#8203;</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">/ $ curl google.fr</code></pre></div></div></div></section><section id="utiliser_un_container_interactif_2" data-auto-animate><h2>üèì Utiliser un container interactif</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">/ $ curl google.fr
/bin/sh: curl: not found</code></pre></div></div></div></section><section id="utiliser_un_container_interactif_3" data-auto-animate><h2>üèì Utiliser un container interactif</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">/ $ curl google.fr
/bin/sh: curl: not found</code></pre></div></div>
<div class="paragraph"><p><code>cURL</code> n&#8217;est pas disponible par d√©faut sur Alpine. Il faut l&#8217;installer au pr√©alable</p></div></div></section><section id="utiliser_un_container_interactif_4" data-auto-animate><h2>üèì Utiliser un container interactif</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">/ $ curl google.fr
/bin/sh: curl: not found</code></pre></div></div>
<div class="paragraph"><p><code>cURL</code> n&#8217;est pas disponible par d√©faut sur Alpine. Il faut l&#8217;installer au pr√©alable</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">/ $ apk update &amp;&amp; apk add curl</code></pre></div></div></div></section><section id="utiliser_un_container_interactif_5" data-auto-animate><h2>üèì Utiliser un container interactif</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">/ $ curl google.fr
/bin/sh: curl: not found</code></pre></div></div>
<div class="paragraph"><p><code>cURL</code> n&#8217;est pas disponible par d√©faut sur Alpine. Il faut l&#8217;installer au pr√©alable</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">/ $ apk update &amp;&amp; apk add curl
fetch https://dl-cdn.alpinelinux.org/alpine/v3.18/main/x86_64/APKINDEX.tar.gz
fetch https://dl-cdn.alpinelinux.org/alpine/v3.18/community/x86_64/APKINDEX.tar.gz
v3.18.3-169-gd5adf7d7d28 [https://dl-cdn.alpinelinux.org/alpine/v3.18/main]
v3.18.3-171-g503977088b4 [https://dl-cdn.alpinelinux.org/alpine/v3.18/community]
OK: 20063 distinct packages available
(1/7) Installing ca-certificates (20230506-r0)
(2/7) Installing brotli-libs (1.0.9-r14)
(3/7) Installing libunistring (1.1-r1)
(4/7) Installing libidn2 (2.3.4-r1)
(5/7) Installing nghttp2-libs (1.55.1-r0)
(6/7) Installing libcurl (8.2.1-r0)
(7/7) Installing curl (8.2.1-r0)
Executing busybox-1.36.1-r2.trigger
Executing ca-certificates-20230506-r0.trigger
OK: 12 MiB in 22 packages</code></pre></div></div></div></section><section id="utiliser_un_container_interactif_6" data-auto-animate><h2>üèì Utiliser un container interactif</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">/ $ curl google.fr
&lt;HTML&gt;&lt;HEAD&gt;&lt;meta http-equiv="content-type" content="text/html;charset=utf-8"&gt;
&lt;TITLE&gt;301 Moved&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;
&lt;H1&gt;301 Moved&lt;/H1&gt;
The document has moved
&lt;A HREF="http://www.google.fr/"&gt;here&lt;/A&gt;.
&lt;/BODY&gt;&lt;/HTML&gt;</code></pre></div></div>
<div class="paragraph"><p>C&#8217;est bon, on a <code>cURL</code> ü¶±</p></div></div></section><section id="utiliser_un_container_interactif_7" data-auto-animate><h2>üèì Utiliser un container interactif</h2><div class="slide-content"><div class="paragraph"><p>On peut quitter <code>sh</code> et revenir √† la machine h√¥te !</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">/ $ exit</code></pre></div></div></div></section><section id="utiliser_un_container_interactif_8" data-auto-animate><h2>üèì Utiliser un container interactif</h2><div class="slide-content"><div class="paragraph"><p>On peut quitter <code>sh</code> et revenir √† la machine h√¥te !</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">/ $ exit</code></pre></div></div>
<div class="paragraph"><p>Si on veut r√©utiliser <code>cURL</code> sur Alpine, c&#8217;est simple, on relance le shell, non? ü§î</p></div></div></section><section id="utiliser_un_container_interactif_9" data-auto-animate><h2>üèì Utiliser un container interactif</h2><div class="slide-content"><div class="paragraph"><p>On peut quitter <code>sh</code> et revenir √† la machine h√¥te !</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">/ $ exit</code></pre></div></div>
<div class="paragraph"><p>Si on veut r√©utiliser <code>cURL</code> sur Alpine, c&#8217;est simple, on relance le shell, non? ü§î</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run  --interactive --tty alpine</code></pre></div></div></div></section><section id="utiliser_un_container_interactif_10" data-auto-animate><h2>üèì Utiliser un container interactif</h2><div class="slide-content"><div class="paragraph"><p>On peut quitter <code>sh</code> et revenir √† la machine h√¥te !</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">/ $ exit</code></pre></div></div>
<div class="paragraph"><p>Si on veut r√©utiliser <code>cURL</code> sur Alpine, c&#8217;est simple, on relance le shell, non? ü§î</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run  --interactive --tty alpine</code></pre></div></div>
<div class="paragraph"><p>On relance <code>cURL</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">/ $ curl google.fr</code></pre></div></div></div></section><section id="utiliser_un_container_interactif_11" data-auto-animate><h2>üèì Utiliser un container interactif</h2><div class="slide-content"><div class="paragraph"><p>On peut quitter <code>sh</code> et revenir √† la machine h√¥te !</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">/ $ exit</code></pre></div></div>
<div class="paragraph"><p>Si on veut r√©utiliser <code>cURL</code> sur Alpine, c&#8217;est simple, on relance le shell, non? ü§î</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run  --interactive --tty alpine</code></pre></div></div>
<div class="paragraph"><p>On relance <code>cURL</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">/ $ curl google.fr
/bin/sh: curl: not found</code></pre></div></div>
<div class="videoblock"><video src="media/surprise_blanker.mp4" width="600" height="100%" data-autoplay>Your browser does not support the video tag.</video></div></div></section><section id="utiliser_un_container_interactif_12" data-auto-animate><h2>üèì Utiliser un container interactif</h2><div class="slide-content"><div class="paragraph"><p>En fait, c&#8217;est logique !</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run</code></pre></div></div>
<div class="ulist"><ul><li><p>Cette commande instancie un "nouveau container √† chaque fois" !</p></li></ul></div></div></section><section id="utiliser_un_container_interactif_13" data-auto-animate><h2>üèì Utiliser un container interactif</h2><div class="slide-content"><div class="paragraph"><p>En fait, c&#8217;est logique !</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run</code></pre></div></div>
<div class="ulist"><ul><li><p>Cette commande instancie un "nouveau container √† chaque fois" !</p></li><li><p>Chaque container est diff√©rent.</p></li></ul></div></div></section><section id="utiliser_un_container_interactif_14" data-auto-animate><h2>üèì Utiliser un container interactif</h2><div class="slide-content"><div class="paragraph"><p>En fait, c&#8217;est logique !</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run</code></pre></div></div>
<div class="ulist"><ul><li><p>Cette commande instancie un "nouveau container √† chaque fois" !</p></li><li><p>Chaque container est diff√©rent.</p></li><li><p>Aucun partage entre les containers √† part le contenu de base de l&#8217;image.</p></li></ul></div></div></section><section id="utiliser_un_container_interactif_15" data-auto-animate><h2>üèì Utiliser un container interactif</h2><div class="slide-content"><div class="imageblock"><img src="media/1460541815-image8.png" alt="1460541815 image8"></div>
<div class="paragraph"><p><em>" On m&#8217;a vendu un truc qui permet de lancer des tonnes de </em><em>microservices</em><em>‚Ä¶ mais l√†, on t√©l√©charge </em><em>nimps</em><em> et s&#8217;amuse √† le perdre‚Ä¶"</em></p></div></div></section><section id="conteneur_en_t√¢che_de_fond" data-auto-animate><h2>‚õÖ Conteneur en t√¢che de fond</h2><div class="slide-content"><div class="paragraph"><p>Lan√ßons un container bien particulier‚Ä¶</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run  --interactive --tty jpetazzo/clock</code></pre></div></div></div></section><section id="conteneur_en_t√¢che_de_fond_2" data-auto-animate><h2>‚õÖ Conteneur en t√¢che de fond</h2><div class="slide-content"><div class="paragraph"><p>Lan√ßons un container bien particulier‚Ä¶</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run  --interactive --tty jpetazzo/clock
Mon Sep 25 10:33:51 UTC 2023
Mon Sep 25 10:33:52 UTC 2023
Mon Sep 25 10:33:53 UTC 2023
Mon Sep 25 10:33:54 UTC 2023
Mon Sep 25 10:33:55 UTC 2023
Mon Sep 25 10:33:56 UTC 2023
...</code></pre></div></div></div></section><section id="conteneur_en_t√¢che_de_fond_3" data-auto-animate><h2>‚õÖ Conteneur en t√¢che de fond</h2><div class="slide-content"><div class="paragraph"><p>Lan√ßons un container bien particulier‚Ä¶</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run  --interactive --tty jpetazzo/clock
Mon Sep 25 10:33:51 UTC 2023
Mon Sep 25 10:33:52 UTC 2023
Mon Sep 25 10:33:53 UTC 2023
Mon Sep 25 10:33:54 UTC 2023
Mon Sep 25 10:33:55 UTC 2023
Mon Sep 25 10:33:56 UTC 2023
...</code></pre></div></div>
<div class="paragraph"><p>Ce container va tourner ind√©finiment sauf si on le stoppe avec ‚å®Ô∏è <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>C</kbd></span>‚Ä¶</p></div></div></section><section id="conteneur_en_t√¢che_de_fond_4" data-auto-animate><h2>‚õÖ Conteneur en t√¢che de fond</h2><div class="slide-content"><div class="paragraph"><p>Lan√ßons un container bien particulier‚Ä¶</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run  --interactive --tty jpetazzo/clock
Mon Sep 25 10:33:51 UTC 2023
Mon Sep 25 10:33:52 UTC 2023
Mon Sep 25 10:33:53 UTC 2023
Mon Sep 25 10:33:54 UTC 2023
Mon Sep 25 10:33:55 UTC 2023
Mon Sep 25 10:33:56 UTC 2023
...</code></pre></div></div>
<div class="paragraph"><p>Ce container va tourner ind√©finiment sauf si on le stoppe avec ‚å®Ô∏è <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>C</kbd></span>‚Ä¶</p></div>
<div class="paragraph"><p>‚Ä¶ mais ca va stopper le container !</p></div>
<div class="imageblock"><img src="media/lapalissade.jpg" alt="lapalissade"></div></div></section><section id="conteneur_en_t√¢che_de_fond_5" data-auto-animate><h2>‚õÖ Conteneur en t√¢che de fond</h2><div class="slide-content"><div class="paragraph"><p>Lan√ßons un container bien particulier‚Ä¶</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run  --interactive --tty jpetazzo/clock
Mon Sep 25 10:33:51 UTC 2023
Mon Sep 25 10:33:52 UTC 2023
Mon Sep 25 10:33:53 UTC 2023
Mon Sep 25 10:33:54 UTC 2023
Mon Sep 25 10:33:55 UTC 2023
Mon Sep 25 10:33:56 UTC 2023
...</code></pre></div></div>
<div class="paragraph"><p>Ce container va tourner ind√©finiment sauf si on le stoppe avec ‚å®Ô∏è <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>C</kbd></span>‚Ä¶</p></div>
<div class="paragraph"><p>‚Ä¶ mais ca va stopper le container !</p></div>
<div class="paragraph"><p>Oui car quand on stoppe le processus principal d&#8217;un container, ce dernier n&#8217;a plus de raison d&#8217;exister et s&#8217;arr√™te naturellement.</p></div></div></section><section id="conteneur_en_t√¢che_de_fond_6" data-auto-animate><h2>‚õÖ Conteneur en t√¢che de fond</h2><div class="slide-content"><div class="paragraph"><p>La solution : le flag  <code>--detach</code></p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run --detach jpetazzo/clock</code></pre></div></div></div></section><section id="conteneur_en_t√¢che_de_fond_7" data-auto-animate><h2>‚õÖ Conteneur en t√¢che de fond</h2><div class="slide-content"><div class="paragraph"><p>La solution : le flag  <code>--detach</code></p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run --detach jpetazzo/clock
399f3b23bc0585991afa80dfee854cf0a953d782b99153b4e2cbc74ab6b07770</code></pre></div></div>
<div class="paragraph"><p>Le retour de cette commande correspond √† l&#8217;identifiant unique du container.</p></div>
<div class="paragraph"><p>Cette fois-ci, le container tourne, mais  en arri√®re plan !</p></div></div></section><section id="conteneur_en_t√¢che_de_fond_8" data-auto-animate><h2>‚õÖ Conteneur en t√¢che de fond</h2><div class="slide-content"><div class="imageblock"><img src="media/1460541815-image8.png" alt="1460541815 image8"></div>
<div class="paragraph"><p><em>" </em><em>Okay</em><em>, maintenant il n&#8217;√©crit la date nulle part‚Ä¶ mais toutes les secondes‚Ä¶ √† l&#8217;aide ! "</em></p></div></div></section><section id="conteneur_en_t√¢che_de_fond_9" data-auto-animate><h2>‚õÖ Conteneur en t√¢che de fond</h2><div class="slide-content"><div class="paragraph"><p>Le processus principal de ce container √©crit dans la sortie standard‚Ä¶ du container !</p></div>
<div class="paragraph"><p>Comment retrouver le contenu de la sortie standard du container ?</p></div></div></section><section id="conteneur_en_t√¢che_de_fond_10" data-auto-animate><h2>‚õÖ Conteneur en t√¢che de fond</h2><div class="slide-content"><div class="paragraph"><p>Le processus principal de ce container √©crit dans la sortie standard‚Ä¶ du container !</p></div>
<div class="paragraph"><p>Comment retrouver le contenu de la sortie standard du container ?</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker logs 399f3</code></pre></div></div></div></section><section id="conteneur_en_t√¢che_de_fond_11" data-auto-animate><h2>‚õÖ Conteneur en t√¢che de fond</h2><div class="slide-content"><div class="paragraph"><p>Le processus principal de ce container √©crit dans la sortie standard‚Ä¶ du container !</p></div>
<div class="paragraph"><p>Comment retrouver le contenu de la sortie standard du container ?</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker logs 399f3
Tue Sep 12 12:37:01 UTC 2023
Tue Sep 12 12:37:02 UTC 2023
Tue Sep 12 12:37:03 UTC 2023
Tue Sep 12 12:37:04 UTC 2023
Tue Sep 12 12:37:05 UTC 2023
Tue Sep 12 12:37:06 UTC 2023
Tue Sep 12 12:37:07 UTC 2023
Tue Sep 12 12:37:08 UTC 2023
Tue Sep 12 12:37:09 UTC 2023
Tue Sep 12 12:37:10 UTC 2023
Tue Sep 12 12:37:11 UTC 2023</code></pre></div></div></div></section><section id="conteneur_en_t√¢che_de_fond_12" data-auto-animate><h2>‚õÖ Conteneur en t√¢che de fond</h2><div class="slide-content"><div class="paragraph"><p>Le processus principal de ce container √©crit dans la sortie standard‚Ä¶ du container !</p></div>
<div class="paragraph"><p>Comment retrouver le contenu de la sortie standard du container ?</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker logs 399f3
Tue Sep 12 12:37:01 UTC 2023
Tue Sep 12 12:37:02 UTC 2023
Tue Sep 12 12:37:03 UTC 2023
Tue Sep 12 12:37:04 UTC 2023
Tue Sep 12 12:37:05 UTC 2023
Tue Sep 12 12:37:06 UTC 2023
Tue Sep 12 12:37:07 UTC 2023
Tue Sep 12 12:37:08 UTC 2023
Tue Sep 12 12:37:09 UTC 2023
Tue Sep 12 12:37:10 UTC 2023
Tue Sep 12 12:37:11 UTC 2023</code></pre></div></div>
<div class="paragraph"><p>Ouf ! On n&#8217;est pas oblig√© de saisir l&#8217;identifiant complet ! Il suffit de fournir le nombre suffisant de caract√®res pour que ce soit discriminant.</p></div></div></section><section id="lister_les_containers" data-auto-animate><h2>üìñ Lister les containers</h2><div class="slide-content"><div class="paragraph"><p>Comment savoir si j&#8217;ai des containers en cours d&#8217;ex√©cution ?</p></div>
<div class="paragraph"><p>üí° Commande vue un peu plus t√¥t&#8230;&#8203;</p></div></div></section><section id="lister_les_containers_2" data-auto-animate><h2>üìñ Lister les containers</h2><div class="slide-content"><div class="paragraph"><p>Comment savoir si j&#8217;ai des containers en cours d&#8217;ex√©cution ?</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container ls</code></pre></div></div></div></section><section id="lister_les_containers_3" data-auto-animate><h2>üìñ Lister les containers</h2><div class="slide-content"><div class="paragraph"><p>Comment savoir si j&#8217;ai des containers en cours d&#8217;ex√©cution ?</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container ls
CONTAINER ID   IMAGE                           COMMAND                  CREATED        STATUS       PORTS                    NAMES
02cbf2fb3721   cours-devops-docker-serve       "/sbin/tini -g gulp ‚Ä¶"   3 hours ago    Up 3 hours   0.0.0.0:8000-&gt;8000/tcp   cours-devops-docker-serve-1
ebfbe695b2ec   moby/buildkit:buildx-stable-1   "buildkitd"              2 months ago   Up 3 hours                            buildx_buildkit_exciting_williams0</code></pre></div></div></div></section><section id="lister_les_containers_4" data-auto-animate><h2>üìñ Lister les containers</h2><div class="slide-content"><div class="paragraph"><p>Comment savoir si j&#8217;ai des containers en cours d&#8217;ex√©cution ?</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container ls
CONTAINER ID   IMAGE                           COMMAND                  CREATED        STATUS       PORTS                    NAMES
02cbf2fb3721   cours-devops-docker-serve       "/sbin/tini -g gulp ‚Ä¶"   3 hours ago    Up 3 hours   0.0.0.0:8000-&gt;8000/tcp   cours-devops-docker-serve-1
ebfbe695b2ec   moby/buildkit:buildx-stable-1   "buildkitd"              2 months ago   Up 3 hours                            buildx_buildkit_exciting_williams0</code></pre></div></div>
<div class="paragraph"><p>On obtient un tableau de tous les containers en cours d&#8217;ex√©cution.</p></div></div></section><section id="stop_start" data-auto-animate><h2>üõë üèÅ Stop / Start</h2><div class="slide-content"><div class="paragraph"><p>Il est possible de stopper un container.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container stop 399f3</code></pre></div></div></div></section><section id="stop_start_2" data-auto-animate><h2>üõë üèÅ Stop / Start</h2><div class="slide-content"><div class="paragraph"><p>Il est possible de stopper un container.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container stop 399f3</code></pre></div></div>
<div class="paragraph"><p>Pour red√©marrer un container :</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container start 399f3</code></pre></div></div></div></section><section id="lister_tous_les_containers" data-auto-animate><h2>üìñ Lister tous les containers</h2><div class="slide-content"><div class="paragraph"><p>M√™me les üíÄ.</p></div></div></section><section id="lister_tous_les_containers_2" data-auto-animate><h2>üìñ Lister tous les containers</h2><div class="slide-content"><div class="paragraph"><p>Comment savoir si j&#8217;ai des containers stopp√©s ?</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container ls --all</code></pre></div></div></div></section><section id="lister_tous_les_containers_3" data-auto-animate><h2>üìñ Lister tous les containers</h2><div class="slide-content"><div class="paragraph"><p>Comment savoir si j&#8217;ai des containers stopp√©s ?</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container ls --all
CONTAINER ID   IMAGE                           COMMAND                  CREATED          STATUS                        PORTS                    NAMES
90725f661d4e   hello-world                     "/hello"                 13 seconds ago   Exited (0) 12 seconds ago                              hardcore_wescoff
9d0a6586b9e1   busybox                         "echo hello world"       22 seconds ago   Exited (0) 21 seconds ago                              gracious_moser
368ed08a35e3   jpetazzo/clock                  "/bin/sh -c 'while d‚Ä¶"   6 minutes ago    Up 5 minutes                                           sweet_clarke
c036e57bbf05   jpetazzo/clock                  "/bin/sh -c 'while d‚Ä¶"   17 minutes ago   Exited (130) 17 minutes ago                            cool_euclid
02cbf2fb3721   cours-devops-docker-serve       "/sbin/tini -g gulp ‚Ä¶"   3 hours ago      Up 3 hours                    0.0.0.0:8000-&gt;8000/tcp   cours-devops-docker-serve-1
ebfbe695b2ec   moby/buildkit:buildx-stable-1   "buildkitd"              2 months ago     Up 4 hours                                             buildx_buildkit_exciting_williams0</code></pre></div></div></div></section><section id="lister_tous_les_containers_4" data-auto-animate><h2>üìñ Lister tous les containers</h2><div class="slide-content"><div class="paragraph"><p>Comment savoir si j&#8217;ai des containers stopp√©s ?</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell"> docker container ls --all
CONTAINER ID   IMAGE                           COMMAND                  CREATED          STATUS                        PORTS                    NAMES
90725f661d4e   hello-world                     "/hello"                 13 seconds ago   Exited (0) 12 seconds ago                              hardcore_wescoff
9d0a6586b9e1   busybox                         "echo hello world"       22 seconds ago   Exited (0) 21 seconds ago                              gracious_moser
368ed08a35e3   jpetazzo/clock                  "/bin/sh -c 'while d‚Ä¶"   6 minutes ago    Up 5 minutes                                           sweet_clarke
c036e57bbf05   jpetazzo/clock                  "/bin/sh -c 'while d‚Ä¶"   17 minutes ago   Exited (130) 17 minutes ago                            cool_euclid
02cbf2fb3721   cours-devops-docker-serve       "/sbin/tini -g gulp ‚Ä¶"   3 hours ago      Up 3 hours                    0.0.0.0:8000-&gt;8000/tcp   cours-devops-docker-serve-1
ebfbe695b2ec   moby/buildkit:buildx-stable-1   "buildkitd"              2 months ago     Up 4 hours                                             buildx_buildkit_exciting_williams0</code></pre></div></div>
<div class="paragraph"><p>Avec le flag  <code>--all</code> , on obtient un tableau de tous les containers quel que soit leur √©tat.</p></div></div></section><section id="nettoyage" data-auto-animate><h2>üßΩ Nettoyage</h2><div class="slide-content"><div class="paragraph"><p>Tout container stopp√© peut √™tre supprim√©.</p></div></div></section><section id="nettoyage_2" data-auto-animate><h2>üßΩ Nettoyage</h2><div class="slide-content"><div class="paragraph"><p>Tout container stopp√© peut √™tre supprim√©.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container rm 90725f661d4e</code></pre></div></div></div></section><section id="nettoyage_3" data-auto-animate><h2>üßΩ Nettoyage</h2><div class="slide-content"><div class="paragraph"><p>Tout container stopp√© peut √™tre supprim√©.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container rm 90725f661d4e
90725f661d4e</code></pre></div></div></div></section><section id="nettoyage_4" data-auto-animate><h2>üßΩ Nettoyage</h2><div class="slide-content"><div class="paragraph"><p>Tout container stopp√© peut √™tre supprim√©.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container rm 90725f661d4e
90725f661d4e</code></pre></div></div>
<div class="paragraph"><p>Container "auto-nettoyant" üóëÔ∏è</p></div></div></section><section id="nettoyage_5" data-auto-animate><h2>üßΩ Nettoyage</h2><div class="slide-content"><div class="paragraph"><p>Tout container stopp√© peut √™tre supprim√©.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container rm 90725f661d4e
90725f661d4e</code></pre></div></div>
<div class="paragraph"><p>Container "auto-nettoyant" üóëÔ∏è</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run  --interactive --tty --rm jpetazzo/clock</code></pre></div></div>
<div class="paragraph small"><small>Aussit√¥t stopp√©, aussit√¥t supprim√© !</small></div></div></section><section id="rappel_cycle_de_vie_dun_container" data-auto-animate><h2>‚è∞ Rappel: cycle de vie d&#8217;un container</h2><div class="slide-content"><div class="imageblock"><img src="media/output68_with_transparency.png" alt="output68 with transparency"></div></div></section><section id="rappel_cycle_de_vie_dun_container_2" data-auto-animate><h2>‚è∞ Rappel: cycle de vie d&#8217;un container</h2><div class="slide-content"><div class="imageblock"><img src="media/output69_with_transparency.png" alt="output69 with transparency"></div></div></section><section id="rappel_cycle_de_vie_dun_container_3" data-auto-animate><h2>‚è∞ Rappel: cycle de vie d&#8217;un container</h2><div class="slide-content"><div class="imageblock"><img src="media/output70_with_transparency.png" alt="output70 with transparency"></div></div></section><section id="rappel_cycle_de_vie_dun_container_4" data-auto-animate><h2>‚è∞ Rappel: cycle de vie d&#8217;un container</h2><div class="slide-content"><div class="imageblock"><img src="media/output71_with_transparency.png" alt="output71 with transparency"></div></div></section><section id="rappel_cycle_de_vie_dun_container_5" data-auto-animate><h2>‚è∞ Rappel: cycle de vie d&#8217;un container</h2><div class="slide-content"><div class="imageblock"><img src="media/output72_with_transparency.png" alt="output72 with transparency"></div>
<aside class="notes"><div class="paragraph"><p><code>docker container create</code> is used to create a new container but without starting it immediately.
When you run docker create, Docker creates a container based on the specified image and prepares it to run, but it remains in a stopped state.
You can then start the container using the <code>docker container start</code> command.</p></div>
<div class="paragraph"><p>Here&#8217;s the basic syntax of the docker create command:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container create [OPTIONS] IMAGE [COMMAND] [ARG...]</code></pre></div></div>
<div class="ulist"><ul><li><p><code>OPTIONS</code> are various flags and settings you can apply to the container creation.</p></li><li><p><code>IMAGE</code> is the name or ID of the Docker image to use for creating the container.</p></li><li><p><code>COMMAND</code> (optional) specifies the command to run when the container starts.</p></li><li><p><code>ARG</code> (optional) provides arguments to pass to the command.</p></li></ul></div>
<div class="paragraph"><p>For example, to create a new container from an image called <code>myapp-image</code> without starting it immediately, you would use:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container create --name myapp-container myapp-image</code></pre></div></div>
<div class="paragraph"><p>After creating the container, you can start it with:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container start myapp-container</code></pre></div></div>
<div class="paragraph"><p>This separation of creation and starting allows you to configure the container further or set up networking and volumes before actually running the container.</p></div></aside></div></section><section id="reprendre_le_contr√¥le" data-auto-animate><h2>üîÑ Reprendre le contr√¥le</h2><div class="slide-content"><div class="paragraph"><p>Sur un container en arri√®re-plan</p></div></div></section><section id="reprendre_le_contr√¥le_2" data-auto-animate><h2>üîÑ Reprendre le contr√¥le</h2><div class="slide-content"><div class="paragraph"><p>Sur un container en arri√®re-plan</p></div>
<div class="paragraph"><p>Il est possible d&#8217;interagir avec un container en arri√®re-plan en cours d&#8217;ex√©cution.</p></div></div></section><section id="reprendre_le_contr√¥le_3" data-auto-animate><h2>üîÑ Reprendre le contr√¥le</h2><div class="slide-content"><div class="paragraph"><p>Sur un container en arri√®re-plan</p></div>
<div class="paragraph"><p>Il est possible d&#8217;interagir avec un container en arri√®re-plan en cours d&#8217;ex√©cution.</p></div>
<div class="paragraph"><p>La commande suivante permet de lancer une commande √† l&#8217;int√©rieur d&#8217;un container.</p></div></div></section><section id="reprendre_le_contr√¥le_4" data-auto-animate><h2>üîÑ Reprendre le contr√¥le</h2><div class="slide-content"><div class="paragraph"><p>Sur un container en arri√®re-plan</p></div>
<div class="paragraph"><p>Il est possible d&#8217;interagir avec un container en arri√®re-plan en cours d&#8217;ex√©cution.</p></div>
<div class="paragraph"><p>La commande suivante permet de lancer une commande √† l&#8217;int√©rieur d&#8217;un container.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container exec &lt;containerID&gt; echo "hello"</code></pre></div></div></div></section><section id="reprendre_le_contr√¥le_5" data-auto-animate><h2>üîÑ Reprendre le contr√¥le</h2><div class="slide-content"><div class="paragraph"><p>Sur un container en arri√®re-plan</p></div>
<div class="paragraph"><p>Il est possible d&#8217;interagir avec un container en arri√®re-plan en cours d&#8217;ex√©cution.</p></div>
<div class="paragraph"><p>La commande suivante permet de lancer une commande √† l&#8217;int√©rieur d&#8217;un container.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container ls</code></pre></div></div></div></section><section id="reprendre_le_contr√¥le_6" data-auto-animate><h2>üîÑ Reprendre le contr√¥le</h2><div class="slide-content"><div class="paragraph"><p>Sur un container en arri√®re-plan</p></div>
<div class="paragraph"><p>Il est possible d&#8217;interagir avec un container en arri√®re-plan en cours d&#8217;ex√©cution.</p></div>
<div class="paragraph"><p>La commande suivante permet de lancer une commande √† l&#8217;int√©rieur d&#8217;un container.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container ls
CONTAINER ID   IMAGE                           COMMAND                  CREATED        STATUS       PORTS                    NAMES
368ed08a35e3   jpetazzo/clock                  "/bin/sh -c 'while d‚Ä¶"   4 hours ago    Up 4 hours                            sweet_clarke
02cbf2fb3721   cours-devops-docker-serve       "/sbin/tini -g gulp ‚Ä¶"   7 hours ago    Up 7 hours   0.0.0.0:8000-&gt;8000/tcp   cours-devops-docker-serve-1
ebfbe695b2ec   moby/buildkit:buildx-stable-1   "buildkitd"              2 months ago   Up 7 hours                            buildx_buildkit_exciting_williams0</code></pre></div></div></div></section><section id="reprendre_le_contr√¥le_7" data-auto-animate><h2>üîÑ Reprendre le contr√¥le</h2><div class="slide-content"><div class="paragraph"><p>Sur un container en arri√®re-plan</p></div>
<div class="paragraph"><p>Il est possible d&#8217;interagir avec un container en arri√®re-plan en cours d&#8217;ex√©cution.</p></div>
<div class="paragraph"><p>La commande suivante permet de lancer une commande √† l&#8217;int√©rieur d&#8217;un container.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container ls
CONTAINER ID   IMAGE                           COMMAND                  CREATED        STATUS       PORTS                    NAMES
368ed08a35e3   jpetazzo/clock                  "/bin/sh -c 'while d‚Ä¶"   4 hours ago    Up 4 hours                            sweet_clarke
02cbf2fb3721   cours-devops-docker-serve       "/sbin/tini -g gulp ‚Ä¶"   7 hours ago    Up 7 hours   0.0.0.0:8000-&gt;8000/tcp   cours-devops-docker-serve-1
ebfbe695b2ec   moby/buildkit:buildx-stable-1   "buildkitd"              2 months ago   Up 7 hours                            buildx_buildkit_exciting_williams0

docker container exec 368ed08a35e3 echo hello
hello</code></pre></div></div></div></section><section id="reprendre_le_contr√¥le_8" data-auto-animate><h2>üîÑ Reprendre le contr√¥le</h2><div class="slide-content"><div class="paragraph"><p>Sur un container en arri√®re-plan</p></div>
<div class="imageblock"><img src="media/1107521466-image9.png" alt="1107521466 image9"></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container exec --interactive --tty &lt;containerID&gt; bash</code></pre></div></div>
<div class="paragraph"><p>Ca fonctionne aussi en interactif !</p></div></div></section><section id="exercice_conteneur_en_t√¢che_de_fond"><h2>üéì Exercice : conteneur en t√¢che de fond</h2><div class="slide-content"><div class="paragraph"><p>√âtapes</p></div>
<div class="ulist"><ul><li><p>Lancer un container "daemon" <code>jpetazzo/clock</code></p></li><li><p>Utiliser l&#8217;√©quivalent de <code>tail ‚Äìf</code> pour lire la sortie standard du container üí°</p></li><li><p>Lancer un second container "daemon" üëπ</p></li><li><p>Stocker l&#8217;identifiant de ce container dans une variable du shell, en une seule commande et en jouant avec <code>docker container ls</code></p></li><li><p>Stopper le container avec cet identifiant</p></li><li><p>Afficher les containers lanc√©s üèÉüì¶</p></li><li><p>Afficher les containers arr√™t√©s üõëüì¶</p></li></ul></div></div></section><section id="solution_conteneur_en_t√¢che_de_fond"><h2>‚úÖ Solution : conteneur en t√¢che de fond</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Lancer un container "daemon" `jpetazzo/clock`
docker container run --detach --name first-clock jpetazzo/clock

# Utiliser l'√©quivalent de `tail ‚Äìf` pour lire la sortie standard du container üí°
docker container logs -f first-clock

# * Lancer un second container "daemon" üëπ
docker container run --detach --name second-clock jpetazzo/clock

# Stocker l'identifiant de ce container dans une variable du shell, en une seule commande et en jouant avec `docker container ls`
# --filter "name=second-clock" filters the list of containers to include only those with the name "second-clock."
container_id=$(docker container ls -q --filter "name=second-clock")

# Stopper le container avec cet identifiant
docker container stop "$container_id"

# Afficher les containers lanc√©s  üèÉüì¶
docker container ls

# Afficher les containers arr√™t√©s üõëüì¶
docker container ls --filter "status=exited"</code></pre></div></div></div></section><section id="exercice_conteneur_en_t√¢che_de_fond_2"><h2>üéì Exercice : conteneur en t√¢che de fond</h2><div class="slide-content"><div class="ulist"><ul><li><p>Relancer un des containers arr√™t√©s.</p></li><li><p>Ex√©cuter un `ps ‚Äìef `dans ce container</p></li><li><p>Quel est le PID du process principal ?</p></li><li><p>V√©rifier que le container "tourne" toujours</p></li><li><p>Supprimer l&#8217;image (tip : <code>docker rmi</code>)</p></li><li><p>Supprimer les containers</p></li><li><p>Supprimer l&#8217;image (pour de vrai cette fois)</p></li></ul></div></div></section><section id="solution_conteneur_en_t√¢che_de_fond_2"><h2>‚úÖ Solution : conteneur en t√¢che de fond</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Relancer un des containers arr√™t√©s.
docker container start second-clock

# Ex√©cuter un `ps ‚Äìef `dans ce container
docker container exec second-clock ps -ef
PID   USER     TIME  COMMAND
    1 root      0:00 /bin/sh -c while date; do sleep 1; done
   56 root      0:00 sleep 1
   57 root      0:00 ps -ef

# Quel est le PID du process principal ?
# 1

# V√©rifier que le container "tourne" toujours
docker container ls
CONTAINER ID   IMAGE                           COMMAND                  CREATED         STATUS              PORTS                    NAMES
7d7085809ad2   cours-devops-docker-serve       "/sbin/tini -g gulp ‚Ä¶"   6 minutes ago   Up 5 minutes        0.0.0.0:8000-&gt;8000/tcp   cours-devops-docker-serve-1
edea0c46c6d8   jpetazzo/clock                  "/bin/sh -c 'while d‚Ä¶"   9 minutes ago   Up About a minute                            second-clock
ebfbe695b2ec   moby/buildkit:buildx-stable-1   "buildkitd"              2 months ago    Up 11 hours                                  buildx_buildkit_exciting_williams0

# Supprimer l'image (tip : `docker rmi`)
docker rmi jpetazzo/clock
Error response from daemon: conflict: unable to remove repository reference "jpetazzo/clock" (must force) - container edea0c46c6d8 is using its referenced image 7a8965d6553e

# Supprimer les containers
docker stop second-clock
second-clock

docker rm second-clockl
second-clock
# Supprimer l'image (pour de vrai cette fois)
docker rmi jpetazzo/clock

Untagged: jpetazzo/clock:latest
Untagged: jpetazzo/clock@sha256:dc06bbc3744f7200404bff0bbb2516925e7adea115e07de9da8b36bf15fe3dd3
Deleted: sha256:7a8965d6553ea2289485744ef20521e0dd0d12ab51773f271882913b79813750
Deleted: sha256:67f770da229bf16d0c280f232629b0c1f1243a884df09f6b940a1c7288535a6d</code></pre></div></div>
<aside class="notes"><div class="paragraph"><p>Dans Docker, le PID (Process ID) principal est toujours 1, car c&#8217;est une convention sp√©cifique √† Docker.
Cette convention facilite la gestion des processus dans les conteneurs en isolant chaque processus du conteneur du syst√®me h√¥te.
En assignant toujours le PID 1 au processus principal du conteneur, Docker peut surveiller ce processus pour s&#8217;assurer qu&#8217;il est en cours d&#8217;ex√©cution.
Cela permet √©galement d&#8217;√©viter des conflits potentiels avec les processus du syst√®me h√¥te, car les PID sont sp√©cifiques √† chaque espace de conteneur.
En r√©sum√©, cette convention est une pratique standard qui contribue √† l&#8217;isolation et √† la gestion efficace des processus dans les conteneurs Docker.</p></div></aside></div></section><section id="exercice_conteneur_en_t√¢che_de_fond_3"><h2>üéì Exercice : conteneur en t√¢che de fond</h2><div class="slide-content"><div class="ulist"><ul><li><p>Ex√©cutez un conteneur, bas√© sur l&#8217;image <code>nginx</code> en t√¢che de fond ("Background"), nomm√© <code>webserver-1</code></p><div class="ulist"><ul><li><p>üí° On parle de processus "d√©tach√©" (ou bien "d√©monis√©") üëπ</p></li><li><p>‚ö†Ô∏è Pensez bien √† <code>docker container ls</code></p></li></ul></div></li><li><p>Regardez le contenu du fichier <code>/etc/os-release</code> dans ce conteneur</p><div class="ulist"><ul><li><p>üí° <code>docker container exec</code></p></li></ul></div></li><li><p>Essayez d&#8217;arr√™ter, d√©marrer puis red√©marrer le conteneur</p><div class="ulist"><ul><li><p>‚ö†Ô∏è Pensez bien √† <code>docker container ls</code> √† chaque fois</p></li><li><p>üí° <code>stop</code>, <code>start</code>, <code>restart</code></p></li></ul></div></li></ul></div></div></section><section id="solution_conteneur_en_t√¢che_de_fond_3"><h2>‚úÖ Solution : conteneur en t√¢che de fond</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run --detach --name=webserver-1 nginx
# &lt;ID du conteneur&gt;

docker container ls
docker container ls --all

docker container exec webserver-1 cat /etc/os-release
# ... Debian ...

docker container stop webserver-1
docker container ls
docker container ls --all

docker container start webserver-1
docker container ls
docker container ls --all

docker container start webserver-1
docker container ls</code></pre></div></div></div></section><section id="checkpoint_3" class="columns"><h2>Checkpoint üéØ</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="paragraph"><p>Vous savez d√©sormais:</p></div>
<div class="ulist"><ul><li><p>Ma√Ætriser le cycle de vie des containers</p></li><li><p>Interagir avec les containers existants</p></li></ul></div>
<div class="imageblock"><img src="media/1706694417-image2.png" alt="1706694417 image2"></div></div></div>
<div class="openblock column"><div class="content"><div class="imageblock"><img src="media/1497094497-image10.gif" alt="1497094497 image10"></div></div></div></div></section><section id="checkpoint_4"><h2>Checkpoint üéØ</h2><div class="slide-content"><div class="ulist"><ul><li><p>Docker essaye de r√©soudre le probl√®me de l&#8217;empaquetage le plus "portable" possible</p><div class="ulist"><ul><li><p>On n&#8217;en a pas encore vu les effets, √ßa arrive !</p></li></ul></div></li><li><p>Vous avez vu qu&#8217;un containeur permet d&#8217;ex√©cuter une commande dans un environnement "pr√©par√©"</p><div class="ulist"><ul><li><p>Catalogue d&#8217;images Docker par d√©faut : Le <a href="https://hub.docker.com">Docker Hub</a></p></li></ul></div></li><li><p>Vous avez vu qu&#8217;on peut ex√©cuter des conteneurs selon 3 modes :</p><div class="ulist"><ul><li><p>"One shot"</p></li><li><p>Interactif</p></li><li><p>En t√¢che de fond</p></li></ul></div></li></ul></div>
<div class="paragraph"><p>&#8658; ü§î Mais comment ces images sont-elles fabriqu√©es ? Quelle confiance leur accorder ?</p></div></div></section></section>
<section><section id="docker_images" data-background-color="rgb(248, 228, 130)" data-state="invert"><h2>Docker Images</h2><div class="slide-content"><div class="imageblock"><img src="media/multi-layered-cake.jpeg" alt="multi layered cake" width="900"></div></div></section><section id="pourquoi_des_images"><h2>ü§î Pourquoi des images ?</h2><div class="slide-content"><div class="ulist"><ul><li><p>Un <strong>conteneur</strong> est toujours ex√©cut√© depuis une <strong>image</strong>.</p></li><li><p>Une <strong>image de conteneur</strong> (ou "Image Docker") est un  mod√®le ("template") d&#8217;application auto-suffisant.</p></li></ul></div>
<div class="paragraph"><p>&#8658; Permet de fournir un livrable portable (ou presque).</p></div></div></section><section id="cest_quoi_une_image" data-background-image="media/multi-layered-cake-removebg-preview.png" data-background-size="contain" data-background-position="left" data-auto-animate><h2>ü§î C&#8217;est quoi une image ?</h2><div class="slide-content">
<div class="paragraph"><p>C&#8217;est une collection de fichiers et de metadonn√©es.</p></div></div></section><section id="cest_quoi_une_image_2" data-background-image="media/multi-layered-cake-removebg-preview.png" data-background-size="contain" data-background-position="left"><h2>ü§î C&#8217;est quoi une image ?</h2><div class="slide-content">
<div class="paragraph"><p>C&#8217;est une collection de fichiers et de metadonn√©es.</p></div>
<div class="paragraph"><p>C&#8217;est une suite de couches superpos√©es.</p></div></div></section><section id="cest_quoi_une_image_3"><h2>ü§î C&#8217;est quoi une image ?</h2><div class="slide-content"><div class="paragraph"><p>C&#8217;est une collection de fichiers et de metadonn√©es.</p></div>
<div class="paragraph"><p>C&#8217;est une suite de couches superpos√©es.</p></div>
<div class="imageblock"><img src="media/images-output5_with_transparency.png" alt="images output5 with transparency"></div></div></section><section id="cest_quoi_une_image_4" data-auto-animate><h2>ü§î C&#8217;est quoi une image ?</h2><div class="slide-content"><div class="paragraph"><p>C&#8217;est une collection de fichiers et de metadonn√©es.</p></div>
<div class="paragraph"><p>C&#8217;est une suite de couches superpos√©es.</p></div>
<div class="imageblock"><img src="media/images-output6_with_transparency.png" alt="images output6 with transparency"></div></div></section><section id="d√©tail_des_couches" data-auto-animate><h2>üç∞ D√©tail des couches</h2><div class="slide-content"><div class="paragraph"><p>Exemple d&#8217;une image Apache HTTPd "custom"</p></div>
<div class="imageblock"><img src="media/images-output8_with_transparency.png" alt="images output8 with transparency"></div></div></section><section id="d√©tail_des_couches_2" data-auto-animate><h2>üç∞ D√©tail des couches</h2><div class="slide-content"><div class="paragraph"><p>Exemple d&#8217;une image Apache HTTPd "custom"</p></div>
<div class="imageblock"><img src="media/images-output9_with_transparency.png" alt="images output9 with transparency"></div></div></section><section id="d√©tail_des_couches_3" data-auto-animate><h2>üç∞ D√©tail des couches</h2><div class="slide-content"><div class="paragraph"><p>Exemple d&#8217;une image Apache HTTPd "custom"</p></div>
<div class="imageblock"><img src="media/images-output10_with_transparency.png" alt="images output10 with transparency"></div></div></section><section id="d√©tail_des_couches_4" data-auto-animate><h2>üç∞ D√©tail des couches</h2><div class="slide-content"><div class="paragraph"><p>Exemple d&#8217;une image Apache HTTPd "custom"</p></div>
<div class="imageblock"><img src="media/images-output11_with_transparency.png" alt="images output11 with transparency"></div></div></section><section id="d√©tail_des_couches_5" data-auto-animate><h2>üç∞ D√©tail des couches</h2><div class="slide-content"><div class="paragraph"><p>Exemple d&#8217;une image Apache HTTPd "custom"</p></div>
<div class="imageblock"><img src="media/images-output12_with_transparency.png" alt="images output12 with transparency"></div></div></section><section id="d√©tail_des_couches_6" data-auto-animate><h2>üç∞ D√©tail des couches</h2><div class="slide-content"><div class="paragraph"><p>Exemple d&#8217;une image Apache HTTPd "custom"</p></div>
<div class="imageblock"><img src="media/images-output13_with_transparency.png" alt="images output13 with transparency"></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {8..13}; do convert Diapositive${i}.PNG -crop 10221x4830+1556+2420 -transparent white -resize x1080 images-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="dicton_du_jour"><h2>Dicton du jour</h2><div class="slide-content"><div class="paragraph"><p><strong><em>"L&#8217;image est √† la classe ce que le container est √† l&#8217;objet"</em></strong></p></div>
<div class="imageblock"><img src="media/dicton-du-jour.png" alt="dicton du jour"></div></div></section><section><div class="slide-content"><div class="paragraph"><p>ü§î Application Auto-Suffisante ?</p></div>
<div class="imageblock"><img src="media/docker-app-self-sufficient.png" alt="docker app self sufficient" width="900"></div></div></section><section id="cest_quoi_le_principe"><h2>C&#8217;est quoi le principe ?</h2><div class="slide-content"><div class="imageblock"><img src="media/dockerfile-flow.png" alt="dockerfile flow"></div></div></section><section id="le_livre_de_recettes" data-auto-animate><h2>üêã üìñüç≥ Le livre de recettes</h2><div class="slide-content"><div class="imageblock"><img src="media/moby-kitchen.jpeg" alt="moby kitchen"></div>
<div class="imageblock"><img src="media/dockerfile.png" alt="dockerfile"></div></div></section><section id="le_livre_de_recettes_2" data-auto-animate><h2>üêã üìñüç≥ Le livre de recettes</h2><div class="slide-content"><div class="imageblock"><img src="media/dockerfile.png" alt="dockerfile"></div></div></section><section id="le_livre_de_recettes_3" data-auto-animate><h2>üêã üìñüç≥ Le livre de recettes</h2><div class="slide-content"><div class="imageblock"><img src="media/dockerfile.png" alt="dockerfile"></div>
<div class="paragraph"><p>Un simple fichier nomm√© "Dockerfile" (majuscule sur le D et pas d&#8217;extension).</p></div></div></section><section id="le_livre_de_recettes_4" data-auto-animate><h2>üêã üìñüç≥ Le livre de recettes</h2><div class="slide-content"><div class="imageblock"><img src="media/dockerfile.png" alt="dockerfile"></div>
<div class="paragraph"><p>Un simple fichier nomm√© "Dockerfile" (majuscule sur le D et pas d&#8217;extension).</p></div>
<div class="paragraph"><p>C&#8217;est du texte, tr√®s pratique √† stocker dans Git.</p></div></div></section><section id="le_livre_de_recettes_5" data-auto-animate><h2>üêã üìñüç≥ Le livre de recettes</h2><div class="slide-content"><div class="imageblock"><img src="media/dockerfile.png" alt="dockerfile"></div>
<div class="paragraph"><p>Un simple fichier nomm√© "Dockerfile" (majuscule sur le D et pas d&#8217;extension).</p></div>
<div class="paragraph"><p>C&#8217;est du texte, tr√®s pratique √† stocker dans Git.</p></div>
<div class="paragraph"><p>Une suite de clef-valeur.</p></div></div></section><section id="pourquoi_fabriquer_sa_propre_image"><h2>ü§î Pourquoi fabriquer sa propre image ?</h2><div class="slide-content"><div class="paragraph"><p>‚ùóÔ∏è Probl√®me :</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">cat /etc/os-release
# ...
git --version
# ...

# M√™me version de Linux que dans GitPod
docker container run --rm ubuntu:22.04 git --version
# docker: Error response from daemon: failed to create shim task: OCI runtime create failed: runc create failed: unable to start container process: exec: "git": executable file not found in $PATH: unknown.

# En interactif ?
docker container run --rm --tty --interactive ubuntu:22.04 git --version</code></pre></div></div></div></section><section id="fabriquer_sa_premi√®re_image"><h2>üéì Fabriquer sa premi√®re image</h2><div class="slide-content"><div class="ulist"><ul><li><p><strong>But :</strong> fabriquer une image Docker qui contient <code>git</code></p></li><li><p>Dans votre workspace Gitpod, cr√©ez un dossier nomm√© <code>docker-git/</code></p></li><li><p>Dans ce dossier, cr√©er un fichier <code>Dockerfile</code> avec le contenu ci-dessous :</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-Dockerfile hljs" data-noescape="true" data-lang="Dockerfile">FROM alpine:3.21.3

RUN apk update &amp;&amp; apk add --no-cache git</code></pre></div></div></li><li><p>Fabriquez votre image avec la commande <code>docker image build --tag=docker-git chemin/vers/docker-git/</code></p></li><li><p>Testez l&#8217;image fra√Æchement fabriqu√©e</p><div class="ulist"><ul><li><p>üí° <code>docker image ls</code></p></li></ul></div></li></ul></div></div></section><section id="fabriquer_sa_premi√®re_image_2"><h2>‚úÖ Fabriquer sa premi√®re image</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">cat &lt;&lt;EOF &gt;Dockerfile
FROM alpine:3.21.3

RUN apk update &amp;&amp; apk add --no-cache git
EOF

docker image build --tag=docker-git ./

docker image ls | grep docker-git

# Doit fonctionner
docker container run --rm docker-git:latest git --version</code></pre></div></div></div></section><section id="fabriquer_son_image" data-auto-animate><h2>üêã üìñüç≥ Fabriquer son image</h2><div class="slide-content"><div class="paragraph"><p>Un peu de cuisine&#8230;&#8203;</p></div>
<div class="imageblock"><img src="media/445636559-image7.gif" alt="445636559 image7"></div></div></section><section id="fabriquer_son_image_2" data-auto-animate><h2>üêã üìñüç≥ Fabriquer son image</h2><div class="slide-content"><div class="paragraph"><p><strong>üí™üèÅ D√âFI</strong></p></div>
<div class="paragraph"><p>Cr√©er une image alpine avec un JRE install√©.</p></div>
<div class="paragraph fragment"><p><strong>üìñüç≥ RECETTE</strong></p></div>
<div class="ulist"><ul><li class="fragment"><p>On part d&#8217;une image Alpine</p></li><li class="fragment"><p>On installe un JRE</p></li></ul></div></div></section><section data-background-image="media/images-output52_with_transparency.png" data-background-size="contain" data-auto-animate></section><section data-background-image="media/images-output53_with_transparency.png" data-background-size="contain" data-auto-animate></section><section data-background-image="media/images-output54_with_transparency.png" data-background-size="contain" data-auto-animate></section><section data-background-image="media/images-output56_with_transparency.png" data-background-size="contain" data-auto-animate><div class="slide-content">
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {52..56}; do convert Diapositive${i}.PNG -crop 9580x5224+1879+1795 -transparent white -resize x1080 images-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="fabriquer_son_image_3" class="columns" data-auto-animate><h2>üêã üìñüç≥ Fabriquer son image</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="imageblock"><img src="media/images-output56_with_transparency.png" alt="images output56 with transparency"></div></div></div>
<div class="openblock column"><div class="content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM alpine:3.21.3
LABEL maintainer="Tony Stark"

RUN apk update

RUN apk add --no-cache openjdk17-jre-headless</code></pre></div></div></div></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {52..56}; do convert Diapositive${i}.PNG -crop 9580x5224+1879+1795 -transparent white -resize x1080 images-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="cuistot_au_boulot" data-auto-animate><h2>üêã üìñüç≥ Cuistot, au boulot!</h2><div class="slide-content"><div class="imageblock"><img src="media/images-output57_with_transparency.png" alt="images output57 with transparency"></div></div></section><section id="cuistot_au_boulot_2" data-auto-animate><h2>üêã üìñüç≥ Cuistot, au boulot!</h2><div class="slide-content"><div class="imageblock"><img src="media/images-output58_with_transparency.png" alt="images output58 with transparency"></div></div></section><section id="cuistot_au_boulot_3" data-auto-animate><h2>üêã üìñüç≥ Cuistot, au boulot!</h2><div class="slide-content"><div class="imageblock"><img src="media/images-output59_with_transparency.png" alt="images output59 with transparency"></div></div></section><section id="cuistot_au_boulot_4" class="columns" data-auto-animate><h2>üêã üìñüç≥ Cuistot, au boulot!</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="imageblock"><img src="media/images-output59_with_transparency.png" alt="images output59 with transparency"></div></div></div>
<div class="openblock column"><div class="content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker image build -t myjava:1.42 .</code></pre></div></div></div></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker image build -t myjava:1.42 .</code></pre></div></div></aside></div></section><section id="√©tapes_de_construction" data-auto-animate><h2>ü™ú √âtapes de construction</h2><div class="slide-content"><div class="imageblock"><img src="media/images-output60_with_transparency.png" alt="images output60 with transparency"></div></div></section><section id="√©tapes_de_construction_2" data-auto-animate><h2>ü™ú √âtapes de construction</h2><div class="slide-content"><div class="imageblock"><img src="media/images-output61_with_transparency.png" alt="images output61 with transparency"></div></div></section><section id="√©tapes_de_construction_3" data-auto-animate><h2>ü™ú √âtapes de construction</h2><div class="slide-content"><div class="imageblock"><img src="media/images-output62_with_transparency.png" alt="images output62 with transparency"></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {60..62}; do convert Diapositive${i}.PNG -crop 9068x5265+1920+1827 -transparent white -resize x1080 images-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="et_apr√®s"><h2>Et apr√®s ?</h2><div class="slide-content"><div class="paragraph fragment"><p>Quand le build se termine, il se trouve dans le registre local.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker images
REPOSITORY       TAG                 IMAGE ID
myjava           1.42                d3017f59d5e2</code></pre></div></div></div></section><section id="limage_est_dispo"><h2>L&#8217;image est dispo !</h2><div class="slide-content"><div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run --interactive --tty myjava:1.42 sh
/ $</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/ $ java -version
openjdk version "17.0.8" 2023-07-18
OpenJDK Runtime Environment (build 17.0.8+7-alpine-r0)
OpenJDK 64-Bit Server VM (build 17.0.8+7-alpine-r0, mixed mode, sharing)</code></pre></div></div>
<div class="imageblock fragment"><img src="media/278458282-image10.gif" alt="278458282 image10"></div></div></section><section id="registre_local_mais_encore"><h2>Registre local, mais encore?</h2><div class="slide-content"><div class="paragraph"><p>On les trouve o√π, ces images ?</p></div>
<div class="paragraph fragment"><p>En local, on l&#8217;a vu.</p></div>
<div class="paragraph fragment"><p>Dans les registres Docker.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ docker images
REPOSITORY                                  TAG                             IMAGE ID       CREATED         SIZE
jenkinsciinfra/jenkins-agent-ubuntu-22.04   latest                          c87afa001ba1   25 hours ago    6.89GB
cours-devops-docker-serve                   latest                          6b7b6a3145fd   27 hours ago    427MB
cours-devops-docker-qrcode                  latest                          43f91abb9cfa   27 hours ago    427MB
jenkins/jenkins                             2.419-rhel-ubi8-jdk11           9e2076ee44fa   3 days ago      507MB
jenkins/jenkins                             2.419-slim                      b93a74bd73b4   3 days ago      394MB
jenkins/jenkins                             2.419                           2193a96f254a   3 days ago      478MB
jenkins/jenkins                             2.419-jdk11                     2193a96f254a   3 days ago      478MB
jenkins/jenkins                             2.419-alpine                    f700f6333bf2   3 days ago      249MB
jenkins/jenkins                             2.419-rhel-ubi9-jdk17           0dbee3b2c2fc   3 days ago      485MB
jenkins/jenkins                             2.419-slim-jdk17                d9a360e0a9bf   3 days ago      393MB
jenkins/jenkins                             2.419-jdk17                     1695080429f5   3 days ago      476MB
jenkins/jenkins                             2.419-alpine-jdk17              2ea0017744c8   3 days ago      249MB
jenkins/jenkins                             2.419-rhel-ubi9-jdk21-preview   66ee1f18309d   3 days ago      494MB
jenkins/jenkins                             2.419-slim-jdk21-preview        e31d85782d2b   3 days ago      414MB
jenkins/jenkins                             2.419-jdk21                     c1e6c123a3c7   3 days ago      485MB
jenkins/jenkins                             2.419-alpine-jdk21-preview      97764348fde6   3 days ago      261MB
jdk21                                       latest                          ba476a3f2cd9   5 days ago      218MB
mycurl                                      1.0                             292bf6b4a4df   6 days ago      13.3MB
myjava                                      1.42                            05b6d3da385e   6 days ago      198MB
&lt;none&gt;                                      &lt;none&gt;                          7bc71c53e776   7 days ago      427MB
&lt;none&gt;                                      &lt;none&gt;                          b45a84c7d06b   7 days ago      427MB
jenkins/jenkins                             latest-jdk21-preview            5b5828e392bf   8 days ago      485MB
moby/buildkit                               buildx-stable-1                 9291fad3b41c   4 weeks ago     172MB
alpine                                      latest                          7e01a0d0a1dc   6 weeks ago     7.34MB
busybox                                     latest                          a416a98b71e2   2 months ago    4.26MB
docker/volumes-backup-extension             1.1.4                           6872a696b721   3 months ago    119MB
portainer/portainer-docker-extension        2.18.3                          3d18fe6d6805   4 months ago    273MB
felipecruz/alpine-tar-zstd                  latest                          31988344315d   12 months ago   6.99MB
justincormack/nsenter1                      latest                          c81481184b1b   5 years ago     101kB</code></pre></div></div></div></section><section id="les_registres_docker"><h2>Les registres Docker</h2><div class="slide-content"><div class="paragraph"><p>Ce sont des plates-formes qui h√©bergent les images.</p></div>
<div class="paragraph"><p>Il est possible de cr√©er ses propres registres (ex : registre priv√© d&#8217;entreprise)</p></div></div></section><section data-background-image="media/node_Official_Image_Docker_Hub.png" data-background-size="cover" data-background-position="left"><div class="slide-content">
<aside class="notes"><div class="paragraph"><p><a href="https://hub.docker.com/" class="bare">https://hub.docker.com/</a></p></div></aside></div></section><section id="les_images"><h2>üñºÔ∏è Les images</h2><div class="slide-content"><div class="paragraph"><p>Avant d&#8217;instancier un container, il faut r√©cup√©rer l&#8217;image en local.</p></div>
<div class="paragraph fragment"><p>M√©thode explicite :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker image pull mysql</code></pre></div></div>
<div class="paragraph small fragment"><small>On rapatrie l&#8217;image en local mais on n&#8217;en fait rien.</small></div>
<div class="paragraph fragment"><p>M√©thode implicite :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run -d mysql</code></pre></div></div>
<div class="paragraph small fragment"><small>On rapatrie l&#8217;image et on d√©marre un container dans la foul√©e.</small></div></div></section><section id="un_t√©l√©chargement_par_couches"><h2>üç∞ Un t√©l√©chargement par couches</h2><div class="slide-content"><div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ docker image pull mysql
Using default tag: latest
latest: Pulling from library/mysql
5f70bf18a086: Pull complete
a734b0ff4ca6: Already exists
ec46eb0ce0a7: Pull complete
a74b383379bc: Pull complete
Digest: sha256:42dc1b67073f7ebab1...8c8d36c9031e408db0d
Status: Downloaded newer image for mysql:latest</code></pre></div></div>
<div class="paragraph fragment"><p>Les couches d√©j√† pr√©sentes en local ne sont pas t√©l√©charg√©es de nouveau !</p></div></div></section><section id="conventions_de_nommage_des_images" data-auto-animate><h2>üñºüè∑Ô∏è Conventions de nommage des images</h2><div class="slide-content"><div class="imageblock"><img src="media/images-output26_with_transparency.png" alt="images output26 with transparency"></div></div></section><section id="conventions_de_nommage_des_images_2" data-auto-animate><h2>üñºüè∑Ô∏è Conventions de nommage des images</h2><div class="slide-content"><div class="imageblock"><img src="media/images-output27_with_transparency.png" alt="images output27 with transparency"></div></div></section><section id="conventions_de_nommage_des_images_3" data-auto-animate><h2>üñºüè∑Ô∏è Conventions de nommage des images</h2><div class="slide-content"><div class="imageblock"><img src="media/images-output28_with_transparency.png" alt="images output28 with transparency"></div></div></section><section id="conventions_de_nommage_des_images_4" data-auto-animate><h2>üñºüè∑Ô∏è Conventions de nommage des images</h2><div class="slide-content"><div class="imageblock"><img src="media/images-output29_with_transparency.png" alt="images output29 with transparency"></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {26..29}; do convert Diapositive${i}.PNG -crop 8962x4645+2183+2192 -transparent white -resize x1080 images-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section data-background-image="media/images-output31_with_transparency.png" data-background-size="contain" data-auto-animate></section><section data-background-image="media/images-output32_with_transparency.png" data-background-size="contain" data-auto-animate></section><section data-background-image="media/images-output33_with_transparency.png" data-background-size="contain" data-auto-animate></section><section data-background-image="media/images-output34_with_transparency.png" data-background-size="contain" data-auto-animate><div class="slide-content">
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {31..34}; do convert Diapositive${i}.PNG -crop 8904x5130+2256+2006 -transparent white -resize x1080 images-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="conventions_de_nommage_des_images_5"><h2>üì∑üè∑Ô∏è Conventions de nommage des images</h2><div class="slide-content"><div class="paragraph fragment"><p>Une m√™me image peut avoir plusieurs noms et tags !</p></div>
<div class="paragraph fragment"><p>Le tag "latest" est r√©guli√®rement r√©affect√© sur les registres distants.</p></div>
<div class="paragraph fragment"><p><strong>Plusieurs noms pour une signature</strong></p></div></div></section><section data-background-image="media/different_labels_same_checksum.png" data-background-size="contain"></section><section id="conventions_de_nommage_des_images_6"><h2>üì∑üè∑Ô∏è Conventions de nommage des images</h2><div class="slide-content"><div class="paragraph"><p>Une m√™me image peut avoir plusieurs noms et tags !</p></div>
<div class="paragraph"><p>Le tag "latest" est r√©guli√®rement r√©affect√© sur les registres distants.</p></div>
<div class="paragraph"><p><strong>Plusieurs noms pour une signature</strong></p></div>
<div class="paragraph"><p><strong>Tags disponibles pour MySQL</strong></p></div>
<div class="imageblock"><img src="media/mysql_tags.png" alt="mysql tags" width="1900"></div></div></section><section id="conventions_de_nommage_des_images_7"><h2>üì∑üè∑Ô∏è Conventions de nommage des images</h2><div class="slide-content"><div class="paragraph"><p>Pour r√©sumer&#8230;&#8203;</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-plaintext hljs" data-noescape="true" data-lang="plaintext">[REGISTRY/][NAMESPACE/]NAME[:TAG|@DIGEST]</code></pre></div></div>
<div class="ulist"><ul><li class="fragment"><p>Pas de Registre ? D√©faut: <code>registry.docker.com</code></p></li><li class="fragment"><p>Pas de Namespace ? D√©faut: <code>library</code></p></li><li class="fragment"><p>Pas de tag ? Valeur par d√©faut: <code>latest</code></p><div class="ulist"><ul><li class="fragment"><p>‚ö†Ô∏è Friends don&#8217;t let friends use <code>latest</code> üë´</p></li></ul></div></li><li class="fragment"><p>Digest: signature unique bas√©e sur le contenu</p></li></ul></div></div></section><section id="conventions_de_nommage_exemples"><h2>üì∑üè∑Ô∏è Conventions de nommage : Exemples</h2><div class="slide-content"><div class="ulist"><ul><li><p><code>ubuntu:22.04</code> &#8658; <code>registry.docker.com/library/ubuntu:22.04</code></p></li><li><p><code>dduportal/docker-asciidoctor</code> &#8658; <code>registry.docker.com/dduportal/docker-asciidoctor:latest</code></p></li><li><p><code>ghcr.io/dduportal/docker-asciidoctor:1.3.2@sha256:xxxx</code></p></li></ul></div></div></section><section id="utilisons_les_tags"><h2>üéì Utilisons les tags</h2><div class="slide-content"><div class="ulist"><ul><li><p>Rappel : ‚ö†Ô∏è Friends don&#8217;t let friends use <code>latest</code> üë´</p></li><li><p>Il est temps de "taguer" votre premi√®re image !</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker image tag docker-git:latest docker-git:1.0.0</code></pre></div></div></li><li><p>Testez le fonctionnement avec le nouveau tag</p></li><li><p>Comparez les 2 images dans la sortie de <code>docker image ls</code></p></li></ul></div></div></section><section id="utilisons_les_tags_2"><h2>‚úÖ Utilisons les tags</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker image tag docker-git:latest docker-git:1.0.0

# 2 lignes
docker image ls | grep docker-git
# 1 ligne
docker image ls | grep docker-git | grep latest
# 1 ligne
docker image ls | grep docker-git | grep '1.0.0'

# Doit fonctionner
docker container run --rm docker-git:1.0.0 git --version</code></pre></div></div></div></section><section id="mettre_√†_jour_votre_image_1_1_0"><h2>üéì Mettre √† jour votre image (1.1.0)</h2><div class="slide-content"><div class="ulist"><ul><li><p>Mettez √† jour votre image en version <code>1.1.0</code> avec les changements suivants :</p><div class="ulist"><ul><li><p>Ajoutez un <a href="https://docs.docker.com/engine/reference/builder/#label" target="_blank"><code>LABEL</code></a> dont la clef est <code>description</code> (et la valeur de votre choix)</p></li><li><p>Configurez <code>git</code> pour utiliser une branche <code>main</code> par d√©faut au lieu de <code>master</code> (commande <code>git config --global init.defaultBranch main</code>)</p></li></ul></div></li><li><p>Indices :</p><div class="ulist"><ul><li><p>üí° Commande <code>docker image inspect &lt;image name&gt;</code></p></li><li><p>üí° Commande <code>git config --get init.defaultBranch</code> (dans le conteneur)</p></li><li><p>üí° Ajoutez des lignes <strong>√† la fin</strong> du <code>Dockerfile</code></p></li><li><p>üí° <a href="https://docs.docker.com/engine/reference/builder/" target="_blank">Documentation de r√©f√©rence des <code>Dockerfile</code></a></p></li></ul></div></li></ul></div></div></section><section id="mettre_√†_jour_votre_image_1_1_0_2"><h2>‚úÖ Mettre √† jour votre image (1.1.0)</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">cat ./Dockerfile
FROM ubuntu:22.04
RUN apt-get update &amp;&amp; apt-get install --yes --no-install-recommends git
LABEL description="Une image contenant git pr√©configur√©"
RUN git config --global init.defaultBranch main

docker image build -t docker-git:1.1.0 ./docker-git/
# Sending build context to Docker daemon  2.048kB
# Step 1/4 : FROM ubuntu:22.04
#  ---&gt; e40cf56b4be3
# Step 2/4 : RUN apt-get update &amp;&amp; apt-get install --yes --no-install-recommends git
#  ---&gt; Using cache
#  ---&gt; 926b8d87f128
# Step 3/4 : LABEL description="Une image contenant git pr√©configur√©"
#  ---&gt; Running in 0695fc62ecc8
# Removing intermediate container 0695fc62ecc8
#  ---&gt; 68c7d4fb8c88
# Step 4/4 : RUN git config --global init.defaultBranch main
#  ---&gt; Running in 7fb54ecf4070
# Removing intermediate container 7fb54ecf4070
#  ---&gt; 2858ff394edb
Successfully built 2858ff394edb
Successfully tagged docker-git:1.1.0

docker container run --rm docker-git:1.0.0 git config --get init.defaultBranch
docker container run --rm docker-git:1.1.0 git config --get init.defaultBranch
# main</code></pre></div></div></div></section><section id="cache_dimages_layers"><h2>Cache d&#8217;images &amp; Layers</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-plaintext hljs" data-noescape="true" data-lang="plaintext">Step 2/4 : RUN apt-get update &amp;&amp; apt-get install --yes --no-install-recommends git
  ---&gt; Using cache</code></pre></div></div>
<div class="paragraph"><p>ü§î En fait, Docker n&#8217;a PAS ex√©cut√© cette commande la seconde fois &#8658; √ßa va beaucoup plus vite !</p></div>
<div class="imageblock"><img src="media/docker-layers.jpg" alt="docker layers" width="400"></div>
<div class="paragraph"><p>üéì Essayez de voir les layers avec (dans Gitpod) <a href="https://github.com/wagoodman/dive" target="_blank"><code>dive &lt;image&gt;:&lt;tag&gt;</code></a></p></div></div></section><section id="cache_dimages_layers_2"><h2>üéì Cache d&#8217;images &amp; Layers</h2><div class="slide-content"><div class="ulist"><ul><li><p><strong>But :</strong> manipuler le cache d&#8217;images</p></li><li><p>Commencez par v√©rifier que le cache est utilis√© : relancez la derni√®re commande <code>docker image build</code> (plusieurs fois s&#8217;il le faut)</p></li><li><p>Invalidez le cache en ajoutant le paquet APT <code>make</code> √† installer en m√™me temps que <code>git</code></p><div class="ulist"><ul><li><p>‚ö†Ô∏è Tag <code>1.2.0</code></p></li></ul></div></li><li><p>V√©rifiez que le cache est bien pr√©sent de nouveau</p></li></ul></div></div></section><section id="cache_dimages_layers_3"><h2>‚úÖ Cache d&#8217;images &amp; Layers</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Build one time
docker image build -t docker-git:1.1.0 ./docker-git/
# Second time is fully cached
docker image build -t docker-git:1.1.0 ./docker-git/

cat Dockerfile
# FROM ubuntu:22.04
# RUN apt-get update &amp;&amp; apt-get install --yes --no-install-recommends git make
# LABEL description="Une image contenant git pr√©configur√©"
# RUN git config --global init.defaultBranch main

# Build one time
docker image build -t docker-git:1.2.0 ./docker-git/
# Second time is fully cached
docker image build -t docker-git:1.2.0 ./docker-git/

## V√©rification
# Renvoie une erreur
docker run --rm docker-git:1.1.0 make --version
# Doit fonctionner
docker run --rm docker-git:1.2.0 make --version</code></pre></div></div></div></section><section id="comportement_par_d√©faut_des_containers" data-auto-animate><h2>Comportement par d√©faut des containers</h2><div class="slide-content"><div class="paragraph"><p>Deux instructions permettent de d√©finir la commande √† lancer au d√©marrage du container.</p></div>
<div class="imageblock fragment"><img src="media/cmd.png" alt="cmd"></div></div></section><section id="comportement_par_d√©faut_des_containers_2" data-auto-animate><h2>Comportement par d√©faut des containers</h2><div class="slide-content"><div class="paragraph"><p>Deux instructions permettent de d√©finir la commande √† lancer au d√©marrage du container.</p></div>
<div class="imageblock"><img src="media/cmd-entrypoint.png" alt="cmd entrypoint"></div>
<div class="paragraph fragment"><p>Laquelle choisir ???</p></div></div></section><section id="cmd_vs_entrypoint" data-auto-animate><h2>CMD vs ENTRYPOINT</h2><div class="slide-content"><div class="paragraph"><p>Cas d&#8217;usage : √©nonc√© du besoin.</p></div>
<div class="paragraph fragment"><p>Besoin : je veux utiliser <code>cURL</code> mais il n&#8217;est pas pr√©sent sur la machine h√¥te.</p></div>
<div class="paragraph fragment"><p><strong>Facile !</strong></p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run --rm curlimages/curl curl -x http://prx:3128 -L --connect-timeout 60  "http://google.com"</code></pre></div></div>
<div class="imageblock fragment"><img src="media/1956754704-image11.jpeg" alt="1956754704 image11"></div>
<aside class="notes"><div class="paragraph"><p>Pour ceux qui n&#8217;auraient pas de proxy parce que vous n&#8217;utilisez pas le r√©seau de la fac&#8230;&#8203; On peut en lancer un avec Docker.
Tout d&#8217;abord, cr√©er un fichier <code>squid.conf</code> avec comme contenu:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-apache hljs" data-noescape="true" data-lang="apache">http_port 3128
acl all src all
http_access allow all</code></pre></div></div>
<div class="paragraph"><p>On peut ensuite lancer le proxy:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker run --name squid -d --restart=always --publish 3128:3128 -v $(pwd)/squid.conf:/etc/squid/squid.conf sameersbn/squid:3.5.27-2</code></pre></div></div>
<div class="paragraph"><p>Puis changer la commande en:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run --rm curlimages/curl curl -x http://host.docker.internal:3128 -L --connect-timeout 60  "http://google.com"</code></pre></div></div></aside></div></section><section id="cmd_vs_entrypoint_2" class="columns" data-auto-animate><h2>CMD vs ENTRYPOINT</h2><div class="slide-content"><div class="openblock column is-one-fifth"><div class="content"><div class="paragraph"><p>Cas d&#8217;usage.
On va s&#8217;outiller!</p></div></div></div>
<div class="openblock column is-half"><div class="content"><div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM alpine:3.21
LABEL maintainer="John Doe"
RUN apk update &amp;&amp; apk add curl
# Si vous utilisez le proxy de l'Universit√©
CMD ["curl","-x", "http://prx:3128", "-L", "--connect-timeout", "60", "http://google.com"]
# Si vous utilisez votre propre proxy docker
# CMD ["curl","-x", "http://host.docker.internal:3128", "-L", "--connect-timeout", "60", "http://google.com"]</code></pre></div></div></div></div>
<div class="openblock column fragment"><div class="content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker image build -t my-curl:1.0 .</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run --rm my-curl:1.0
&lt;!doctype html&gt;&lt;html [...]
google blahblahblah [...]
&lt;/html&gt;</code></pre></div></div>
<div class="imageblock fragment"><img src="media/my-girl.gif" alt="my girl"></div></div></div></div></section><section id="cmd_vs_entrypoint_3" data-auto-animate><h2>CMD vs ENTRYPOINT</h2><div class="slide-content"><div class="paragraph"><p>Cas d&#8217;usage.</p></div>
<div class="imageblock fragment"><img src="media/images-output84_with_transparency.png" alt="%auto-animate"></div></div></section><section id="cmd_vs_entrypoint_4"><h2>CMD vs ENTRYPOINT</h2><div class="slide-content"><div class="paragraph"><p>Cas d&#8217;usage.</p></div>
<div class="imageblock"><img src="media/images-output85_with_transparency.png" alt="%auto-animate"></div>
<div class="imageblock fragment"><img src="media/1602759072-image12.gif" alt="1602759072 image12"></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {84..85}; do convert Diapositive${i}.PNG -crop 9670x2727+1832+2166 -transparent white -resize x1080 images-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="cmd_vs_entrypoint_5"><h2>CMD vs ENTRYPOINT</h2><div class="slide-content"><div class="paragraph"><p>Cas d&#8217;usage: un cran plus loin.</p></div>
<div class="paragraph"><p>L&#8217;image actuelle, c&#8217;est bien mais pas hyper flexible !</p></div>
<div class="paragraph fragment"><p>Et si on la rendait param√©trable ?</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run --rm my-curl:2.0 http://google.com
docker container run --rm my-curl:2.0 http://facebook.com
docker container run --rm my-curl:2.0 http://twitter.com</code></pre></div></div></div></section><section id="cmd_vs_entrypoint_6" class="columns" data-auto-animate><h2>CMD vs ENTRYPOINT</h2><div class="slide-content"><div class="openblock column is-one-fifth"><div class="content"><div class="paragraph"><p>Cas d&#8217;usage, un cran plus loin</p></div>
<div class="paragraph"><p>Param√©trable, et hop!</p></div></div></div>
<div class="openblock column is-half"><div class="content"><div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM alpine:3.21
LABEL maintainer="John Doe"
RUN apk update &amp;&amp; apk add curl
# Si vous utilisez le proxy de l'Universit√©
ENTRYPOINT ["curl","-x", "http://prx:3128", "-L", "--connect-timeout", "60"]
# Si vous utilisez votre propre proxy docker
# CMD ["curl","-x", "http://host.docker.internal:3128", "-L", "--connect-timeout", "60"]</code></pre></div></div></div></div>
<div class="openblock column fragment"><div class="content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker image build -t my-curl:2.0 .</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run --rm my-curl:2.0 http://google.com
&lt;!doctype html&gt;&lt;html [...]
google blahblahblah [...]
&lt;/html&gt;</code></pre></div></div></div></div></div></section><section id="cmd_vs_entrypoint_7" class="columns" data-auto-animate><h2>CMD vs ENTRYPOINT</h2><div class="slide-content"><div class="openblock column is-one-fifth"><div class="content"><div class="paragraph"><p>Cas d&#8217;usage, un cran plus loin</p></div>
<div class="paragraph"><p>Param√©trable, et hop!</p></div></div></div>
<div class="openblock column is-half"><div class="content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM alpine:3.21
LABEL maintainer="John Doe"
RUN apk update &amp;&amp; apk add curl
# Si vous utilisez le proxy de l'Universit√©
ENTRYPOINT ["curl","-x", "http://prx:3128", "-L", "--connect-timeout", "60"]
# Si vous utilisez votre propre proxy docker
# CMD ["curl","-x", "http://host.docker.internal:3128", "-L", "--connect-timeout", "60"]</code></pre></div></div>
<div class="imageblock"><img src="media/override.png" alt="override"></div></div></div>
<div class="openblock column"><div class="content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker image build -t my-curl:2.0 .</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run --rm my-curl:2.0 http://google.com
&lt;!doctype html&gt;&lt;html [...]
google blahblahblah [...]
&lt;/html&gt;</code></pre></div></div></div></div></div></section><section id="checkpoint_5"><h2>Checkpoint üéØ</h2><div class="slide-content"><div class="ulist"><ul><li><p>Une image Docker fournit un environnement de syst√®me de fichier auto-suffisant (application, d√©pendances, binaries, etc.) comme mod√®le de base d&#8217;un conteneur</p></li><li><p>Les images Docker ont une convention de nommage permettant d&#8217;identifier les images tr√®s pr√©cis√©ment</p></li><li><p>On peut sp√©cifier une recette de fabrication d&#8217;image √† l&#8217;aide d&#8217;un <code>Dockerfile</code> et de la commande <code>docker image build</code></p></li></ul></div>
<div class="paragraph"><p>&#8658; ü§î et si on utilisait Docker pour nous aider dans l&#8217;int√©gration continue ?</p></div></div></section></section>
<section><section id="nos_fichiers_dans_les_images" data-background-image="media/fichiers.png" data-background-size="cover" data-background-position="left"><h2>üìÅ Nos fichiers dans les images</h2><div class="slide-content"></div></section><section id="le_r√©pertoire_de_travail"><h2>üìÇ Le r√©pertoire de travail</h2><div class="slide-content"><div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run --interactive --tty httpd pwd /usr/local/apache2</code></pre></div></div>
<div class="paragraph fragment"><p>Comment param√©trer le r√©pertoire de travail de tous nos containers ?</p></div></div></section><section id="workdir" data-auto-animate><h2>üìÇ WORKDIR</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM alpine:3.21
WORKDIR /repertoire/travail
RUN echo hello &gt; ./world.txt</code></pre></div></div></div></section><section id="workdir_2" data-auto-animate><h2>üìÇ WORKDIR</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM alpine:3.21
WORKDIR /repertoire/travail
RUN echo hello &gt; ./world.txt</code></pre></div></div>
<div class="imageblock"><img src="media/fichiers-output5_with_transparency.png" alt="fichiers output5 with transparency"></div></div></section><section id="workdir_3" data-auto-animate><h2>üìÇ WORKDIR</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM alpine:3.21
WORKDIR /repertoire/travail
RUN echo hello &gt; ./world.txt</code></pre></div></div>
<div class="imageblock"><img src="media/fichiers-output6_with_transparency.png" alt="fichiers output6 with transparency"></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {5..6}; do convert Diapositive${i}.PNG -crop 9667x3750+1833+3333 -transparent white -resize x1080 fichiers-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="workdir_4" data-auto-animate><h2>üìÇ WORKDIR</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM alpine:3.21
WORKDIR /repertoire/travail
RUN echo hello &gt; ./world.txt</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker image build --tag mon-img .
...</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ docker container run mon-img cat /repertoire/travail/world.txt
hello</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ docker container run mon-img pwd
/repertoire/travail</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ docker container run --workdir /home mon-img pwd
/home</code></pre></div></div></div></section><section id="embarquer_des_fichiers" data-auto-animate><h2>üìÅ Embarquer des fichiers</h2><div class="slide-content"><div class="paragraph"><p>Cas d&#8217;usage.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">ls
app.js</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ docker container run --workdir /customdir node app.js
&lt;error : app.js not found&gt;</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ docker container run --workdir /customdir --entrypoint ls node
&lt;0 fichiers pr√©sents !&gt;</code></pre></div></div>
<div class="paragraph fragment"><p>Comment fournir des fichiers √† mes containers ?</p></div></div></section><section id="embarquer_des_fichiers_2" data-auto-animate><h2>üìÅ Embarquer des fichiers</h2><div class="slide-content"><div class="paragraph"><p>Copie de fichiers.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM node:22.2.0-alpine3.18
WORKDIR /app
COPY ./* /app</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker image build --tag mon-node .
...</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ docker container run --workdir /app --entrypoint ls mon-node
app.js</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ docker container run mon-node app.js
Hello Mad Javascript World!</code></pre></div></div></div></section><section id="embarquer_des_fichiers_3" data-auto-animate><h2>üìÅ Embarquer des fichiers</h2><div class="slide-content"><div class="paragraph"><p>Le mot cl√© <code>ADD</code>.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM image
ADD https://mon-nexus/foo/bar/1.0/package.tar /uncompressed/</code></pre></div></div>
<div class="paragraph fragment"><p>Il permet d&#8217;ajouter des fichiers aux images, tout comme <code>COPY</code>.</p></div>
<div class="paragraph fragment"><p>Il est capable de t√©l√©charger directement d&#8217;une URL</p></div>
<div class="paragraph fragment"><p>Il est capable de "untar" automatiquement.</p></div>
<div class="paragraph fragment"><p>On le retrouve dans d&#8217;anciens Dockerfile mais il tend √† dispara√Ætre.</p></div></div></section><section id="embarquer_des_fichiers_4" data-auto-animate><h2>üìÅ Embarquer des fichiers</h2><div class="slide-content"><div class="paragraph"><p>Le mot cl√© <code>ADD</code></p></div>
<div class="paragraph small"><small>source : <a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#add-or-copy" class="bare">https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#add-or-copy</a></small></div>
<div class="imageblock"><img src="media/1108215415-image2.png" alt="1108215415 image2"></div></div></section><section id="embarquer_des_fichiers_5" data-auto-animate><h2>üìÅ Embarquer des fichiers</h2><div class="slide-content"><div class="paragraph"><p>Le mot cl√© <code>ADD</code>.</p></div>
<div class="paragraph small"><small>source : <a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#add-or-copy" class="bare">https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#add-or-copy</a></small></div>
<div class="imageblock"><img src="media/add-stabylo.png" alt="add stabylo"></div></div></section><section id="embarquer_des_fichiers_6" data-auto-animate><h2>üìÅ Embarquer des fichiers</h2><div class="slide-content"><div class="paragraph"><p>Oui, mais pas la terre enti√®re !</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker image build --tag myjava:1.42 ./
Sending build context to Docker daemon  172.8MB</code></pre></div></div></div></section><section id="embarquer_des_fichiers_7" data-auto-animate><h2>üìÅ Embarquer des fichiers</h2><div class="slide-content"><div class="paragraph"><p>Oui, mais pas la terre enti√®re !</p></div>
<div class="imageblock"><img src="media/fichiers-output19_with_transparency.png" alt="fichiers output19 with transparency"></div></div></section><section id="embarquer_des_fichiers_8" data-auto-animate><h2>üìÅ Embarquer des fichiers</h2><div class="slide-content"><div class="paragraph"><p>Oui, mais pas la terre enti√®re !</p></div>
<div class="imageblock"><img src="media/fichiers-output20_with_transparency.png" alt="fichiers output20 with transparency"></div></div></section><section id="embarquer_des_fichiers_9" data-auto-animate><h2>üìÅ Embarquer des fichiers</h2><div class="slide-content"><div class="paragraph"><p>Oui, mais pas la terre enti√®re !</p></div>
<div class="imageblock"><img src="media/fichiers-output21_with_transparency.png" alt="fichiers output21 with transparency"></div>
<div class="paragraph"><p>Si un gros fichier tra√Æne dans le dossier alors qu&#8217;il n&#8217;est m√™me pas utilis√© ni r√©f√©renc√© dans le Dockerfile, il sera tout de m√™me envoy√© au Docker daemon.</p></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {19..21}; do convert Diapositive${i}.PNG -crop 9250x2932+2097+1750 -transparent white -resize x1080 fichiers-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="embarquer_des_fichiers_10"><h2>üìÅ Embarquer des fichiers</h2><div class="slide-content"><div class="paragraph"><p>Oui, mais pas la terre enti√®re !</p></div>
<div class="paragraph fragment"><p><em>"M&#8217;en fous ! j&#8217;ai une machine de fou et un r√©seau de fou ! YOLO !"</em></p></div>
<div class="paragraph fragment"><p>Et si la CI fait plusieurs builds par minute ?</p></div>
<div class="paragraph fragment"><p>Et si un vieux Keystore tra√Æne dans les sources ?</p></div>
<div class="paragraph fragment"><p><code>.git/</code> ? <code>.idea/</code> ? vraiment ?</p></div>
<div class="paragraph fragment"><p>Attention √† l&#8217;invalidation de cache d&#8217;un step de build √† cause de l&#8217;ajout d&#8217;un fichier inutile !</p></div></div></section><section id="dockerignore"><h2>üôâ <code>.dockerignore</code></h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-.dockerignore hljs" data-noescape="true" data-lang=".dockerignore"># ignore les dossiers .git et .cache
.git
.cache</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-.dockerignore hljs" data-noescape="true" data-lang=".dockerignore"># ignore tous les fichiers *.class dans tous les dossiers
**/*.class</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-.dockerignore hljs" data-noescape="true" data-lang=".dockerignore"># ignore les markdown sauf les README*.md (README-secret.md sera tout de m√™me ignor√© par contre)
*.md
!README*.md
README-secret.md</code></pre></div></div></div></section><section data-background-image="media/docker-commands-table.png" data-background-size="contain" data-background-position="center"></section><section id="renommage_des_images" data-auto-animate><h2>üìù Renommage des images</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output25_with_transparency.png" alt="fichiers output25 with transparency"></div></div></section><section id="renommage_des_images_2" data-auto-animate><h2>üìù Renommage des images</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output26_with_transparency.png" alt="fichiers output26 with transparency"></div></div></section><section id="renommage_des_images_3" data-auto-animate><h2>üìù Renommage des images</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output27_with_transparency.png" alt="fichiers output27 with transparency"></div></div></section><section id="renommage_des_images_4" data-auto-animate><h2>üìù Renommage des images</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output28_with_transparency.png" alt="fichiers output28 with transparency"></div>
<div class="paragraph fragment"><p><code>httpd:latest</code> sera taggu√© en <code>fedora/httpd:version1.0</code></p></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"> for i in {25..28}; do convert Diapositive${i}.PNG -crop 9000x2684+2097+2083 -transparent white -resize x1080 fichiers-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="les_images_2" class="columns" data-auto-animate><h2>üñºÔ∏è LES IMAGES</h2><div class="slide-content"><div class="imageblock column"><img src="media/multi-layered-cake-removebg-preview.png" alt="multi layered cake removebg preview"></div>
<div class="openblock column"><div class="content"><div class="paragraph"><p>Le bilan</p></div>
<div class="paragraph"><p>Vous savez d√©sormais:</p></div>
<div class="ulist"><ul><li><p>R√©diger un Dockerfile</p></li><li><p>Nommer vos images</p></li><li><p>Cr√©er vos outils</p></li></ul></div></div></div></div></section><section id="les_images_3" class="columns" data-auto-animate><h2>üñºÔ∏è LES IMAGES</h2><div class="slide-content"><div class="imageblock column"><img src="media/384835330-image4.gif" alt="384835330 image4"></div>
<div class="openblock column"><div class="content"><div class="paragraph"><p>Le bilan</p></div>
<div class="paragraph"><p>Vous savez d√©sormais:</p></div>
<div class="ulist"><ul><li><p>R√©diger un Dockerfile</p></li><li><p>Nommer vos images</p></li><li><p>Cr√©er vos outils</p></li></ul></div></div></div></div></section><section id="les_registries"><h2>üóÇÔ∏è Les registries</h2><div class="slide-content"><div class="imageblock"><img src="media/104336496-image5.png" alt="104336496 image5"></div></div></section><section id="golden_rule"><h2>Golden Rule</h2><div class="slide-content"><div class="paragraph"><p><strong>La construction d&#8217;une image doit √™tre automatis√©e.</strong></p></div></div></section><section id="automatique_s√©curis√©"><h2>ü§ñ = üîí ? Automatique == s√©curis√©</h2><div class="slide-content"><div class="paragraph"><p>Le fait de d√©l√©guer la construction des images permet d&#8217;ajouter toute une cha√Æne de traitement, de contr√¥les des images pour s&#8217;assurer qu&#8217;elle respecte les r√®gles RSSI.</p></div>
<div class="ulist"><ul><li class="fragment"><p>patch management</p></li><li class="fragment"><p>droits sur le FS</p></li><li class="fragment"><p>user</p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>C&#8217;est quoi le RSSI ?
RSSI : d√©finition. Le responsable de la s√©curit√© des syst√®mes d&#8217;information (ou RSSI pour Responsable de la S√©curit√© des Syst√®mes d&#8217;Information) d√©finit et d√©veloppe la politique de s√©curit√© de l&#8217;information de son entreprise.</p></div></aside></div></section><section id="exemple_de_mise_en_place" data-auto-animate><h2>Exemple de mise en place</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output35_with_transparency.png" alt="fichiers output35 with transparency"></div></div></section><section id="exemple_de_mise_en_place_2" data-auto-animate><h2>Exemple de mise en place</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output36_with_transparency.png" alt="fichiers output36 with transparency"></div></div></section><section id="exemple_de_mise_en_place_3" data-auto-animate><h2>Exemple de mise en place</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output37_with_transparency.png" alt="fichiers output37 with transparency"></div></div></section><section id="exemple_de_mise_en_place_4" data-auto-animate><h2>Exemple de mise en place</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output38_with_transparency.png" alt="fichiers output38 with transparency"></div></div></section><section id="exemple_de_mise_en_place_5" data-auto-animate><h2>Exemple de mise en place</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output39_with_transparency.png" alt="fichiers output39 with transparency"></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {35..39}; do convert Diapositive${i}.PNG -crop 8803x3982+2273+2769 -transparent white -resize x1080 fichiers-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="exemple_continuous_build"><h2>‚û°Ô∏è Exemple : continuous build</h2><div class="slide-content"><div class="imageblock"><img src="media/107490784-image13.png" alt="107490784 image13"></div></div></section><section id="travaux_pratiques_5"><h2>üéì Travaux pratiques #5</h2><div class="slide-content"><div class="paragraph"><p><a href="https://gitlab.univ-artois.fr/bruno.verachten/devops-docker-tp05" class="bare">https://gitlab.univ-artois.fr/bruno.verachten/devops-docker-tp05</a></p></div>
<div class="imageblock"><img src="media/636764807-image14.png" alt="636764807 image14"></div>
<aside class="notes"><div class="paragraph"><p>Solution l√†: <a href="https://gitlab.univ-artois.fr/bruno.verachten/devops-docker-tp-05-solution" class="bare">https://gitlab.univ-artois.fr/bruno.verachten/devops-docker-tp-05-solution</a></p></div></aside></div></section><section id="solution_travaux_pratiques_5" data-auto-animate><h2>‚úÖ Solution Travaux pratiques #5</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-diff hljs" data-noescape="true" data-lang="diff">diff --git a/src/Dockerfile b/src/Dockerfile
index c92c67cd48121705628f67a2af14b2a65e54cdfd..77919a581fffde7c57f43c8b7cbee2a8d84b628b 100644
--- a/src/Dockerfile
+++ b/src/Dockerfile
@@ -9,6 +9,10 @@ COPY start.sh /bin/start.sh
 EXPOSE 4321
 # This line opens port 4321 on the container. It's like installing a door in your house.

+RUN adduser --disabled-password --gecos "" --home /home/www www
+USER www
+WORKDIR /home/www
+
 ENTRYPOINT ["/bin/start.sh"]
 # This line sets the command that will be run when the container starts. It's like setting the alarm clock in your house.</code></pre></div></div>
<aside class="notes"><div class="paragraph"><p>L&#8217;option <code>--gecos</code> dans la commande adduser est utilis√©e pour d√©finir le champ GECOS (General Electric Comprehensive Operating System) de l&#8217;entr√©e de l&#8217;utilisateur dans le fichier <code>/etc/passwd</code>.
Le champ GECOS contient traditionnellement des informations suppl√©mentaires sur l&#8217;utilisateur, telles que le nom complet de l&#8217;utilisateur, l&#8217;emplacement du bureau et le num√©ro de t√©l√©phone, bien que cela ne soit souvent pas utilis√© dans les syst√®mes modernes.</p></div>
<div class="paragraph"><p>Dans les Dockerfiles et les configurations syst√®me, il est courant de d√©finir le champ GECOS sur une cha√Æne vide ou une valeur de substitution comme "" pour indiquer que les informations ne sont pas n√©cessaires.
L&#8217;option --gecos "" d√©finit effectivement le champ GECOS comme une cha√Æne vide, ce qui signifie qu&#8217;aucune information suppl√©mentaire sur l&#8217;utilisateur n&#8217;est fournie.</p></div>
<div class="paragraph"><p>Pour les conteneurs Docker et les utilisateurs syst√®me cr√©√©s √† des fins sp√©cifiques (comme l&#8217;ex√©cution de services ou d&#8217;applications dans des conteneurs), il n&#8217;est souvent pas n√©cessaire de remplir le champ GECOS avec des informations d√©taill√©es, et l&#8217;utilisation de --gecos "" est une pratique courante pour maintenir une base d&#8217;utilisateurs propre et minimale dans le conteneur ou le syst√®me.
Cela contribue √† maintenir une base d&#8217;utilisateurs propre et minimale dans le conteneur ou le syst√®me.</p></div>
<div class="paragraph"><p>L&#8217;utilisation de l&#8217;UID (User ID) 1001 pour un utilisateur cr√©√© dans un conteneur Docker est une pratique courante, mais elle n&#8217;est pas n√©cessairement fixe.
Cela d√©pend des besoins sp√©cifiques de votre application et de la mani√®re dont vous g√©rez les utilisateurs dans vos conteneurs. Voici quelques raisons courantes d&#8217;utiliser l&#8217;UID 1001 :</p></div>
<div class="paragraph"><p>√âviter les conflits : L&#8217;UID 1001 est souvent choisi pour √©viter les conflits avec les utilisateurs syst√®me existants.
Dans de nombreuses distributions Linux, les utilisateurs syst√®me ont des UIDs inf√©rieurs √† 1000.
En utilisant l&#8217;UID 1001, vous minimisez le risque de conflits avec ces utilisateurs.</p></div>
<div class="paragraph"><p>S√©curit√© : Dans un environnement de conteneur, il est courant de limiter les privil√®ges des utilisateurs.
En utilisant un UID non r√©serv√©, vous r√©duisez le risque que l&#8217;utilisateur puisse acc√©der √† des ressources syst√®me critiques.</p></div>
<div class="paragraph"><p>Personnalisation : Vous pouvez choisir un UID personnalis√© en fonction de vos besoins.
Dans certains cas, l&#8217;UID 1001 est simplement choisi par convention. Si vous avez des exigences sp√©cifiques en mati√®re de num√©ros d&#8217;UID, vous pouvez les personnaliser en cons√©quence.</p></div>
<div class="paragraph"><p>Isolation : En attribuant des UIDs sp√©cifiques aux utilisateurs de vos conteneurs, vous pouvez mieux isoler ces utilisateurs des autres utilisateurs syst√®me ou des autres conteneurs.</p></div>
<div class="paragraph"><p>Il est important de noter que le choix de l&#8217;UID d√©pend de la mani√®re dont vous configurez vos conteneurs et de vos exigences en mati√®re de s√©curit√© et d&#8217;isolation.
L&#8217;UID 1001 est courant, mais il n&#8217;est pas la seule option, et vous pouvez choisir un UID qui convient le mieux √† votre cas d&#8217;utilisation particulier.</p></div></aside></div></section><section id="solution_travaux_pratiques_5_2" data-auto-animate><h2>‚úÖ Solution Travaux pratiques #5</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-diff hljs" data-noescape="true" data-lang="diff">diff --git a/src/start.sh b/src/start.sh
index 44006d6cd8414706a5fcf564dbfd1e9c38d4bc0b..a6ed60fdf88759d4962685e7ceb6cdbc21867448 100755
--- a/src/start.sh
+++ b/src/start.sh
@@ -4,7 +4,7 @@
 set -eux
 # These are shell options. 'e' exits on error, 'u' treats unset variables as an error, and 'x' prints each command to the terminal. It's like the script's personal assistant, making sure everything runs smoothly.

-touch /home/www/started.time
+touch /tmp/started.time
 # This creates a file named 'started.time' in the '/home/www' directory. It's like the script's way of marking its territory.

 if [ $? -ne 0 ]; then
@@ -12,7 +12,7 @@ if [ $? -ne 0 ]; then
 fi
 # This checks the exit status of the last command. If it's not zero, which means there was an error, it exits the script. It's like the script's way of saying, "If I can't do it right, I won't do it at all."

-date &gt; /home/www/started.time
+date &gt; /tmp/started.time
 # This writes the current date and time to the 'started.time' file. It's like the script's way of keeping a diary.

 exec "$@"</code></pre></div></div></div></section><section id="solution_travaux_pratiques_5_3" data-auto-animate><h2>‚úÖ Solution Travaux pratiques #5</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">stages:
  - "validator.sh"
  - "docker scout"

variables:
  PROXY: "http://cache-etu.univ-artois.fr:3128"
  IMAGE: "devops-docker-tp05:latest"

validator-job:
  image: cache-ili.univ-artois.fr/proxy_cache/library/docker
  stage: "validator.sh"
  before_script:
    - export HTTP_PROXY="$PROXY"
    - export HTTPS_PROXY="$PROXY"
    - apk add -U bash
  script:
    - errors=$(./validator.sh)
    - echo "$errors"
    - exit $([ -z "$errors" ] &amp;&amp; echo 0 || echo 1)
  tags:
    - docker2

# No login needed, using docker desktop with wsl
scout-job:
  stage: "docker scout"
  script:
    - cd ./src
    - docker build . -t "$IMAGE"
    - docker scout cves --format only-packages --only-vuln-packages "$IMAGE"
    - docker rmi "$IMAGE"
  tags:
    - myshell</code></pre></div></div></div></section><section id="solution_travaux_pratiques_5_4" data-auto-animate><h2>‚úÖ Solution Travaux pratiques #5</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">stages:
  - run_script
  - docker_scan

run_script:
  stage: run_script
  script:
    - chmod +x validator.sh src/start.sh &amp;&amp; ./validator.sh # Makes the scripts executable and runs validator.sh
    - |
        if [ $? -eq 0 ]; then
          echo "Script exited successfully."
        else
          echo "Script exited with an error."
          exit 1  # Mark the job as a failure
        fi

docker_scan:
  stage: docker_scan
  script:
    - IMG=$(echo img$$)
    - docker image build --tag $IMG ./src &gt; /dev/null
    - echo "Will scan $IMG"
    - echo $DOCKER_TOKEN | docker login -u $DOCKER_USERNAME --password-stdin
    - docker scout cves --format only-packages --only-vuln-packages $IMG # Runs docker scout to scan the image
    - docker scout recommendations $IMG # View base image update recommendations</code></pre></div></div></div></section><section id="inspection_et_nommage_des_containers"><h2>üîç Inspection et nommage des containers</h2><div class="slide-content"><div class="imageblock"><img src="media/1712651753-image15.png" alt="1712651753 image15"></div></div></section><section id="nommage_des_containers" data-auto-animate><h2>üìõ Nommage des containers</h2><div class="slide-content"><div class="imageblock"><img src="media/docker-container-logs.png" alt="docker container logs"></div>
<div class="paragraph fragment"><p>Ne peut-on pas trouver plus 'user-friendly'?</p></div></div></section><section id="nommage_des_containers_2" data-auto-animate><h2>üìõ Nommage des containers</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output47_with_transparency.png" alt="fichiers output47 with transparency"></div></div></section><section id="nommage_des_containers_3" data-auto-animate><h2>üìõ Nommage des containers</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output48_with_transparency.png" alt="fichiers output48 with transparency"></div></div></section><section id="nommage_des_containers_4" data-auto-animate><h2>üìõ Nommage des containers</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output49_with_transparency.png" alt="fichiers output49 with transparency"></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {46..49}; do convert Diapositive${i}.PNG -crop 13243x4424+61+2040 -transparent white -resize x1080 fichiers-output${i}_with_transparency.png; done</code></pre></div></div>
<div class="paragraph"><p>Jean-Claude Poitras est un cr√©ateur de mode, un designer multidisciplinaire, un chroniqueur, un conf√©rencier et un artiste n√© √† Montr√©al au Canada le 18 juin 1949.</p></div></aside></div></section><section id="nommage_des_containers_5"><h2>üìõ Nommage des containers</h2><div class="slide-content"><div class="paragraph"><p>Humour de g33k</p></div>
<div class="imageblock"><img src="media/1671853138-image16.png" alt="1671853138 image16"></div>
<div class="paragraph"><p>source : <a href="https://github.com/docker/engine/blob/master/pkg/namesgenerator/names-generator.go" class="bare">https://github.com/docker/engine/blob/master/pkg/namesgenerator/names-generator.go</a></p></div></div></section><section id="nommage_des_containers_6"><h2>üìõ Nommage des containers</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run --detach --name my-web httpd</code></pre></div></div>
<div class="paragraph fragment"><p>Nom du container explicite</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container logs my-web</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker exec --interactive --tty my-web sh</code></pre></div></div></div></section><section id="renommage_des_containers" class="columns" data-auto-animate><h2>ü¶∏‚Äç‚ôÇÔ∏è Renommage des containers</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="paragraph"><p>Attention, spoiler pour les n00bs de DC Comics</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container rename clark_kent superman</code></pre></div></div></div></div>
<div class="openblock column"><div class="content"><div class="imageblock fragment"><img src="media/kent_and_superman.jpeg" alt="kent and superman"></div></div></div></div></section><section id="renommage_des_containers_2" data-auto-animate><h2>ü¶∏‚Äç‚ôÇÔ∏è Renommage des containers</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output55_with_transparency.png" alt="fichiers output55 with transparency"></div></div></section><section id="renommage_des_containers_3" data-auto-animate><h2>ü¶∏‚Äç‚ôÇÔ∏è Renommage des containers</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output56_with_transparency.png" alt="fichiers output56 with transparency"></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"> for i in {55..56}; do convert Diapositive${i}.PNG -crop 8883x3982+2104+2080 -transparent white -resize x1080 fichiers-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="inspection_des_containers" class="columns"><h2>üîç Inspection des containers</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="imageblock"><img src="media/inspecting-containers.jpeg" alt="inspecting containers"></div></div></div>
<div class="openblock column"><div class="content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container inspect my-web
[
    {
        "Id": "0ac8cdf8d447c6d316a04bd1a7f74cd2677eea3478f11f0be5241c1bb2d4c7da",
        "Created": "2023-10-24T19:40:11.84788911Z",
        "Path": "httpd-foreground",
        "Args": [],
        "State": {
            "Status": "running",
            "Running": true,
            "Paused": false,
            "Restarting": false,
            "OOMKilled": false,
            "Dead": false,
            "Pid": 3275,
            "ExitCode": 0,
            "Error": "",
            "StartedAt": "2023-10-24T19:40:12.363841649Z",
            "FinishedAt": "0001-01-01T00:00:00Z"
        },
...
]</code></pre></div></div></div></div></div></section><section id="comment_exploiter_le_json"><h2>Comment exploiter le JSON ?</h2><div class="slide-content"><div class="paragraph"><p>JQ est le meilleur outil pour parser du JSON dans le shell</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container inspect my-web | jq .</code></pre></div></div>
<div class="paragraph fragment"><p>Les <a href="https://pkg.go.dev/text/template">templates de GO</a> peuvent √™tre utilis√©s directement</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container inspect --format '{{json .Created }}' my-web</code></pre></div></div></div></section><section id="travaux_pratiques_6"><h2>üéì Travaux pratiques #6</h2><div class="slide-content"><div class="paragraph"><p>√âtapes:</p></div>
<div class="ulist"><ul><li class="fragment"><p>Lancer un container HTTPd</p></li><li class="fragment"><p>Trouver la syntaxe permettant d&#8217;extraire le "CMD" qui a √©t√© pass√© au d√©marrage du container</p></li><li class="fragment"><p>Trouver une seconde m√©thode pour faire la m√™me chose</p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>On d√©marre un container nginx avec la commande</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Here we're using the 'docker container run' command to start a new Docker container.
# The '--detach' option tells Docker to run the container in the background and print the container ID.
# The '--name' option allows us to give our container a custom name, in this case 'my-web'.
# Finally, 'nginx' is the name of the Docker image we want to use to create the container.
# So, to sum up, this command will start a new Docker container in the background, using the 'nginx' image, and name it 'my-web'.
docker container run --detach --name my-web nginx</code></pre></div></div>
<div class="paragraph"><p>Une solution facile est de faire:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># In this command, we're using 'docker container inspect' to get detailed information about our 'my-web' container.
# The '--format' option allows us to specify the output format. Here, we're using the Go template '{{json .Config.Cmd }}' to get the command used to start the container in JSON format.
# We then pipe this JSON output to 'jq', a powerful command-line JSON processor.
# The '.' in 'jq .' tells 'jq' to take the input JSON and output it as is, effectively pretty-printing it.
# So, to sum up, this command will give us the command used to start the 'my-web' container, in a pretty-printed JSON format.
docker container inspect --format '{{json .Config.Cmd }}' my-web | jq .</code></pre></div></div>
<div class="paragraph"><p>√áa nous donne:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">[
  "nginx",
  "-g",
  "daemon off;"
]</code></pre></div></div>
<div class="paragraph"><p>Qu&#8217;on pourrait nettoyer pour avoir <code>nginx -g daemon off;</code> avec:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># This command is a symphony in three parts. First, we're using 'docker container inspect' to get detailed information about our 'my-web' container.
# The '--format' option allows us to specify the output format. Here, we're using the Go template '{{json .Config.Cmd }}' to get the command used to start the container in JSON format.
# We then pipe this JSON output to 'jq', a powerful command-line JSON processor. The '-r' option tells 'jq' to output raw strings instead of JSON-encoded strings, and '.[]' tells 'jq' to output the elements of the array.
# But we're not done yet. We then pipe this output to 'tr', which replaces the newlines with spaces, giving us a neat, single-line command.
# So, to sum up, this command will give us the command used to start the 'my-web' container, as a single line of text.
docker container inspect --format '{{json .Config.Cmd }}' my-web | jq -r '.[]' | tr '\n' ' '</code></pre></div></div>
<div class="paragraph"><p>qui donne <code>nginx -g daemon off;</code>.</p></div>
<div class="paragraph"><p>Une autre solution serait:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># This command is using 'docker container ls' to list our Docker containers. The '--filter' option allows us to only show containers with the name 'my-web', and '--no-trunc' prevents Docker from truncating the output.
# We then pipe this output to 'awk', a powerful text processing tool. 'NR==1 {cmd=index($0, "COMMAND"); created=index($0, "CREATED")}' tells 'awk' to find the positions of the 'COMMAND' and 'CREATED' headers in the first line of the output.
# 'NR&gt;1 {print substr($0, cmd, created-cmd)}' then tells 'awk' to print the substring from the start of the 'COMMAND' field to the start of the 'CREATED' field for the rest of the lines.
# So, to sum up, this command will give us the command used to start the 'my-web' container, extracted from the output of 'docker container ls'.
docker container ls --filter "name=my-web" --no-trunc | awk 'NR==1 {cmd=index($0, "COMMAND"); created=index($0, "CREATED")} NR&gt;1 {print substr($0, cmd, created-cmd)}'</code></pre></div></div>
<div class="paragraph"><p>qui donnerait <code>"/docker-entrypoint.sh nginx -g 'daemon off;'"</code>.</p></div></aside></div></section><section id="solution_travaux_pratiques_6" data-auto-animate><h2>‚úÖ Solution Travaux Pratiques #6</h2><div class="slide-content"><div class="paragraph"><p>On d√©marre un container nginx avec la commande</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Here we're using the 'docker container run' command to start a new Docker container.
# The '--detach' option tells Docker to run the container in the background and print the container ID.
# The '--name' option allows us to give our container a custom name, in this case 'my-web'.
# Finally, 'nginx' is the name of the Docker image we want to use to create the container.
# So, to sum up, this command will start a new Docker container in the background, using the 'nginx' image, and name it 'my-web'.
docker container run --detach --name my-web nginx</code></pre></div></div>
<div class="paragraph fragment"><p>Une solution facile est de faire:</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># In this command, we're using 'docker container inspect' to get detailed information about our 'my-web' container.
# The '--format' option allows us to specify the output format. Here, we're using the Go template '{{json .Config.Cmd }}' to get the command used to start the container in JSON format.
# We then pipe this JSON output to 'jq', a powerful command-line JSON processor.
# The '.' in 'jq .' tells 'jq' to take the input JSON and output it as is, effectively pretty-printing it.
# So, to sum up, this command will give us the command used to start the 'my-web' container, in a pretty-printed JSON format.
docker container inspect --format '{{json .Config.Cmd }}' my-web | jq .</code></pre></div></div>
<div class="paragraph fragment"><p>√áa nous donne:</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">[
  "nginx",
  "-g",
  "daemon off;"
]</code></pre></div></div></div></section><section id="solution_travaux_pratiques_6_2" data-auto-animate><h2>‚úÖ Solution Travaux Pratiques #6</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">[
  "nginx",
  "-g",
  "daemon off;"
]</code></pre></div></div>
<div class="paragraph"><p>Qu&#8217;on pourrait nettoyer pour avoir <code>nginx -g daemon off;</code> avec:</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># This command is a symphony in three parts. First, we're using 'docker container inspect' to get detailed information about our 'my-web' container.
# The '--format' option allows us to specify the output format. Here, we're using the Go template '{{json .Config.Cmd }}' to get the command used to start the container in JSON format.
# We then pipe this JSON output to 'jq', a powerful command-line JSON processor. The '-r' option tells 'jq' to output raw strings instead of JSON-encoded strings, and '.[]' tells 'jq' to output the elements of the array.
# But we're not done yet. We then pipe this output to 'tr', which replaces the newlines with spaces, giving us a neat, single-line command.
# So, to sum up, this command will give us the command used to start the 'my-web' container, as a single line of text.
docker container inspect --format '{{json .Config.Cmd }}' my-web | jq -r '.[]' | tr '\n' ' '</code></pre></div></div>
<div class="paragraph fragment"><p>qui donne <code>nginx -g daemon off;</code>.</p></div>
<div class="paragraph fragment"><p>Une autre solution serait:</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># This command is using 'docker container ls' to list our Docker containers. The '--filter' option allows us to only show containers with the name 'my-web', and '--no-trunc' prevents Docker from truncating the output.
# We then pipe this output to 'awk', a powerful text processing tool. 'NR==1 {cmd=index($0, "COMMAND"); created=index($0, "CREATED")}' tells 'awk' to find the positions of the 'COMMAND' and 'CREATED' headers in the first line of the output.
# 'NR&gt;1 {print substr($0, cmd, created-cmd)}' then tells 'awk' to print the substring from the start of the 'COMMAND' field to the start of the 'CREATED' field for the rest of the lines.
# So, to sum up, this command will give us the command used to start the 'my-web' container, extracted from the output of 'docker container ls'.
docker container ls --filter "name=my-web" --no-trunc | awk 'NR==1 {cmd=index($0, "COMMAND"); created=index($0, "CREATED")} NR&gt;1 {print substr($0, cmd, created-cmd)}'</code></pre></div></div></div></section><section id="solution_travaux_pratiques_6_3" data-auto-animate><h2>‚úÖ Solution Travaux Pratiques #6</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># This command is using 'docker container ls' to list our Docker containers. The '--filter' option allows us to only show containers with the name 'my-web', and '--no-trunc' prevents Docker from truncating the output.
# We then pipe this output to 'awk', a powerful text processing tool. 'NR==1 {cmd=index($0, "COMMAND"); created=index($0, "CREATED")}' tells 'awk' to find the positions of the 'COMMAND' and 'CREATED' headers in the first line of the output.
# 'NR&gt;1 {print substr($0, cmd, created-cmd)}' then tells 'awk' to print the substring from the start of the 'COMMAND' field to the start of the 'CREATED' field for the rest of the lines.
# So, to sum up, this command will give us the command used to start the 'my-web' container, extracted from the output of 'docker container ls'.
docker container ls --filter "name=my-web" --no-trunc | awk 'NR==1 {cmd=index($0, "COMMAND"); created=index($0, "CREATED")} NR&gt;1 {print substr($0, cmd, created-cmd)}'</code></pre></div></div>
<div class="paragraph fragment"><p>qui donnerait <code>"/docker-entrypoint.sh nginx -g 'daemon off;'"</code>.</p></div>
<aside class="notes"><div class="paragraph"><p>Dans le contexte de l&#8217;utilisation de la commande docker inspect ou docker ps, l&#8217;une des principales diff√©rences entre ENTRYPOINT et CMD r√©side dans leur r√¥le et leur impact sur la visibilit√© des informations.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p><strong>ENTRYPOINT</strong> :
Lorsque vous utilisez docker inspect ou docker ps pour examiner un conteneur qui utilise ENTRYPOINT, vous verrez que ENTRYPOINT appara√Æt en tant que commande principale du conteneur. Cela signifie que l&#8217;entr√©e principale de l&#8217;application, g√©n√©ralement un ex√©cutable ou un script, est affich√©e.
Les options et les arguments pass√©s en ligne de commande lors du lancement du conteneur sont ajout√©s apr√®s l&#8217;entr√©e principale, comme des arguments √† cette commande.
Si un ENTRYPOINT est d√©fini, la commande sp√©cifi√©e en utilisant docker run est ignor√©e.</p></li><li><p><strong>CMD</strong> :
Lorsque vous utilisez docker inspect ou docker ps pour examiner un conteneur qui utilise CMD, vous verrez que la commande CMD est r√©pertori√©e sous forme d&#8217;argument pour /bin/sh -c, ce qui signifie qu&#8217;elle est ex√©cut√©e par le shell par d√©faut du conteneur.
Les options et les arguments pass√©s en ligne de commande lors du lancement du conteneur remplacent la commande CMD.
Vous pouvez √©galement ajouter des arguments suppl√©mentaires √† la commande CMD en utilisant docker run.</p></li></ol></div>
<div class="paragraph"><p>En r√©sum√©, ENTRYPOINT est g√©n√©ralement utilis√© pour sp√©cifier la commande principale de l&#8217;application dans le conteneur, et les arguments fournis lors du lancement du conteneur sont trait√©s comme des arguments pour cette commande. En revanche, CMD est utilis√© pour sp√©cifier une commande par d√©faut qui peut √™tre √©cras√©e en passant d&#8217;autres commandes lors du lancement du conteneur. L&#8217;utilisation de l&#8217;un ou de l&#8217;autre d√©pend des besoins sp√©cifiques de votre application et de la mani√®re dont vous souhaitez g√©rer la personnalisation des commandes dans vos conteneurs.</p></div></aside></div></section><section id="trouver_son_container_en_r√©seau"><h2>üåê Trouver son container en r√©seau</h2><div class="slide-content"><div class="imageblock"><img src="media/1233103020-image17.jpeg" alt="1233103020 image17"></div></div></section><section id="le_container_en_r√©seau"><h2>üåê Le Container en r√©seau</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run --detach nginx
bd12c4d7110d17ce80...`</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container ls
CONTAINERID     IMAGE   COMMAND      CREATED    STATUS    PORTS
bd12c4d71       nginx   "nginx ‚Ä¶"    35 s. ago  Up 33 s.  80/tcp, 443/tcp</code></pre></div></div>
<div class="paragraph fragment"><p>Ok, mon container expose un service sur les ports <code>TCP 80</code> et <code>443</code> mais j&#8217;appelle comment mon Nginx ?</p></div></div></section><section id="que_nous_dit_docker_container_inspect" data-auto-animate><h2>üîç Que nous dit docker container inspect ?</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">"Networks": {
                "bridge": {
                    "IPAMConfig": null,
                    "Links": null,
                    "Aliases": null,
                    "NetworkID": "c0fcec43e3e8‚Ä¶eecd6558ac0870a468a3",
                    "EndpointID": "0ec8fb237a10e9227359b4‚Ä¶db23edc32",
                    "Gateway": "172.17.0.1",
                    "IPAddress": "172.17.0.2",
                    "IPPrefixLen": 16,
                    "IPv6Gateway": "",
                    "GlobalIPv6Address": "",
                    "GlobalIPv6PrefixLen": 0,
                    "MacAddress": "02:42:ac:11:00:02",
                    "DriverOpts": null
                }
            }</code></pre></div></div></div></section><section id="que_nous_dit_docker_container_inspect_2" data-auto-animate><h2>üîç Que nous dit docker container inspect ?</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output66_with_transparency.png" alt="fichiers output66 with transparency" height="500"></div></div></section><section id="que_nous_dit_docker_container_inspect_3" data-auto-animate><h2>üîç Que nous dit docker container inspect ?</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output67_with_transparency.png" alt="fichiers output67 with transparency" height="500"></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container inspect --format "{{.NetworkSettings.IPAddress}}" &lt;ContainerID&gt;</code></pre></div></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {66..67}; do convert Diapositive${i}.PNG -crop 9519x5022+1833+1472 -transparent white -resize x1080 fichiers-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="et_voil√†"><h2>Et voil√† !</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">curl -I --noproxy '*' http://172.17.0.2:80
HTTP/1.1 200 OK
....
`Server: nginx/1.25 ...
`</code></pre></div></div>
<div class="paragraph"><p>Il est maintenant facile d&#8217;interagir avec notre serveur web !</p></div></div></section><section id="mapping_de_port" data-auto-animate><h2>üó∫Ô∏è Mapping de Port</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output71_with_transparency.png" alt="fichiers output71 with transparency"></div></div></section><section id="mapping_de_port_2" data-auto-animate><h2>üó∫Ô∏è Mapping de Port</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output72_with_transparency.png" alt="fichiers output72 with transparency"></div></div></section><section id="mapping_de_port_3" data-auto-animate><h2>üó∫Ô∏è Mapping de Port</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output73_with_transparency.png" alt="fichiers output73 with transparency"></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">curl -I --noproxy '*' http://172.17.0.2:80</code></pre></div></div></div></section><section id="mapping_de_port_4" data-auto-animate><h2>üó∫Ô∏è Mapping de Port</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">curl -I --noproxy '*' http://172.17.0.2:80
HTTP/1.1 200 OK
Server: nginx/1.25.2
Date: Wed, 18 Oct 2023 11:54:49 GMT
Content-Type: text/html
Content-Length: 284237
Last-Modified: Tue, 10 Oct 2023 12:12:13 GMT
Connection: keep-alive
ETag: "65253f9d-4564d"
Accept-Ranges: bytes</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ curl -I --noproxy '*' http://localhost:8000`
HTTP/1.1 200 OK
Server: nginx/1.25.2
Date: Wed, 18 Oct 2023 11:57:25 GMT
Content-Type: text/html
Content-Length: 284237
Last-Modified: Tue, 10 Oct 2023 12:12:13 GMT
Connection: keep-alive
ETag: "65253f9d-4564d"
Accept-Ranges: bytes</code></pre></div></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {71..73}; do convert Diapositive${i}.PNG -crop 10146x4801+2250+1833 -transparent white -resize x1080 fichiers-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="travaux_pratiques_7"><h2>üéì Travaux pratiques #7</h2><div class="slide-content"><div class="paragraph"><p>√âtapes:</p></div>
<div class="ulist"><ul><li class="fragment"><p>Cr√©er un fichier HTML et le distribuer √† partir d&#8217;un container <code>nginx</code></p></li><li class="fragment"><p>R√©cup√©rer un war sur Gitlab et le d√©ployer dans un container <code>wildfly (<a href="https://gitlab.univ-artois.fr/bruno.verachten/devops-docker-tp07/-/raw/master/sample.war" class="bare">https://gitlab.univ-artois.fr/bruno.verachten/devops-docker-tp07/-/raw/master/sample.war</a>)</code></p></li><li class="fragment"><p>R√©cup√©rer le code sur <a href="https://spring.io/guides/gs/spring-boot/" class="bare">https://spring.io/guides/gs/spring-boot/</a> et faire tourner l&#8217;appli (sous r√©pertoire <code>complete</code>)</p></li></ul></div></div></section><section id="solution_travaux_pratiques_7" data-auto-animate><h2>‚úÖ Solution travaux pratiques #7</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-html hljs" data-noescape="true" data-lang="html">&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;header&gt;
&lt;title&gt;http://info.cern.ch&lt;/title&gt;
&lt;/header&gt;

&lt;h1&gt;http://info.cern.ch - home of the first website&lt;/h1&gt;
&lt;p&gt;From here you can:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://info.cern.ch/hypertext/WWW/TheProject.html"&gt;Browse the first website&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://line-mode.cern.ch/www/hypertext/WWW/TheProject.html"&gt;Browse the first website using the line-mode browser simulator&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://home.web.cern.ch/topics/birth-web"&gt;Learn about the birth of the web&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://home.web.cern.ch/about"&gt;Learn about CERN, the physics laboratory where the web was born&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/body&gt;&lt;/html&gt;</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker run --name my-nginx -v /fully/qualified/path/on/my/computer/:/usr/share/nginx/html:ro -d -p 8000:80 nginx</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">curl --noproxy '*' http://localhost:8000
&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;header&gt;
&lt;title&gt;http://info.cern.ch&lt;/title&gt;
&lt;/header&gt;

&lt;h1&gt;http://info.cern.ch - home of the first website&lt;/h1&gt;
&lt;p&gt;From here you can:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://info.cern.ch/hypertext/WWW/TheProject.html"&gt;Browse the first website&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://line-mode.cern.ch/www/hypertext/WWW/TheProject.html"&gt;Browse the first website using the line-mode browser simulator&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://home.web.cern.ch/topics/birth-web"&gt;Learn about the birth of the web&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://home.web.cern.ch/about"&gt;Learn about CERN, the physics laboratory where the web was born&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/body&gt;&lt;/html&gt;</code></pre></div></div></div></section><section id="solution_travaux_pratiques_7_2" data-auto-animate><h2>‚úÖ Solution travaux pratiques #7</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">wget https://gitlab.univ-artois.fr/bruno.verachten/devops-docker-tp07/-/raw/master/sample.war</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Used to run a Docker container with the name "wildfly-container" using the "jboss/wildfly" image. The container is
# configured to expose ports 8080 and 9990 on the host machine, which will be mapped to the corresponding ports inside
# the container. Additionally, a volume is mounted to the container, linking the
# "/fully/qualified/path/on/my/computer/sample.war" file to "/opt/jboss/wildfly/standalone/deployments/sample.war"
# path within the container. This allows the WildFly server running inside the container to access and deploy the
# "sample.war" file. The "-d" flag is used to run the container in detached mode, meaning it will run in the
# background.
docker run -d -p 8080:8080 -p 9990:9990 --name wildfly-container -v /fully/qualified/path/on/my/computer/sample.war:/opt/jboss/wildfly/standalone/deployments/sample.war jboss/wildfly</code></pre></div></div>
<div class="paragraph fragment"><p>Visitez avec votre navigateur <code><a href="http://localhost:8080/sample/" class="bare">http://localhost:8080/sample/</a></code>.</p></div></div></section><section id="solution_travaux_pratiques_7_3" data-auto-animate><h2>‚úÖ Solution travaux pratiques #7</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">git clone https://github.com/spring-guides/gs-spring-boot.git</code></pre></div></div>
<div class="paragraph"><p>C&#8217;est un d√©but&#8230;&#8203;</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">cd gs-spring-boot/complete</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">mvn package</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">java -jar target/spring-boot-complete-0.0.1-SNAPSHOT.jar</code></pre></div></div>
<div class="paragraph fragment"><p>Ok, il y a de l&#8217;id√©e&#8230;&#8203;</p></div></div></section><section id="solution_travaux_pratiques_7_4" data-auto-animate><h2>‚úÖ Solution travaux pratiques #7</h2><div class="slide-content"><div class="paragraph"><p>Assemblons tout √ßa dans un <code>Dockerfile</code>.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile"># Use a Maven image for building the application
FROM maven:3.9.8-eclipse-temurin-22-alpine
WORKDIR /app

# Clone the Spring Boot application repository
RUN apk add git &amp;&amp; git clone https://github.com/spring-guides/gs-spring-boot.git

# Change directory to the application's complete directory
WORKDIR /app/gs-spring-boot/complete

# Build the application using Maven
RUN mvn package

WORKDIR /app/gs-spring-boot/complete/target

# Command to run the Spring Boot application
CMD ["java", "-jar", "spring-boot-complete-0.0.1-SNAPSHOT.jar"]</code></pre></div></div>
<div class="paragraph fragment"><p>Spoiler alert: le nom de fichier donne une indication&#8230;&#8203;</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker build -t spring-boot-app --file Dockerfile.ugly .</code></pre></div></div>
<div class="paragraph fragment"><p>Et logiquement&#8230;&#8203;</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker run -d -p 8080:8080 --name spring-boot-container spring-boot-app</code></pre></div></div></div></section><section id="attends_un_peu"><h2>‚è≥ Attends un peu‚Ä¶</h2><div class="slide-content"><div class="imageblock"><img src="media/1779074283-image19.gif" alt="1779074283 image19"></div>
<div class="paragraph"><p><em>√áa fonctionne, mais c&#8217;est comme si  je laissais la grue dans la chambre une fois que j&#8217;avais fini de construire ma maison !</em></p></div></div></section><section id="solution_travaux_pratiques_7_5" data-auto-animate><h2>‚úÖ Solution travaux pratiques #7</h2><div class="slide-content"><div class="paragraph"><p>On essaye un <code>Dockerfile</code> moins BTP?</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile"># Use a Maven image for building the application
FROM maven:3.9.8-eclipse-temurin-22-alpine AS build
WORKDIR /app

# Clone the Spring Boot application repository
RUN apk add git &amp;&amp; git clone https://github.com/spring-guides/gs-spring-boot.git

# Change directory to the application's complete directory
WORKDIR /app/gs-spring-boot/complete

# Build the application using Maven
RUN mvn package

# Use a lightweight Java image for running the application
FROM eclipse-temurin:24_36-jre-alpine
WORKDIR /app

# Copy the built JAR file from the previous build stage
COPY --from=build /app/gs-spring-boot/complete/target/spring-boot-complete-0.0.1-SNAPSHOT.jar ./

# Command to run the Spring Boot application
CMD ["java", "-jar", "spring-boot-complete-0.0.1-SNAPSHOT.jar"]</code></pre></div></div>
<div class="paragraph fragment"><p>Le multistage, c&#8217;est la classe √† Arras.
On en reparle apr√®s.</p></div></div></section><section id="une_premi√®re_solution"><h2>üß© Une premi√®re solution</h2><div class="slide-content"><div class="paragraph"><p>Avec un autre exemple&#8230;&#8203;
Une image pour construire l&#8217;appli:</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM golang:1.24

WORKDIR /go/src/github.com/alexellis/href-counter/

COPY go.mod .
COPY go.sum .
COPY app.go	.


RUN CGO_ENABLED=0 GOOS=linux go build  -ldflags "-s -w" -o app .</code></pre></div></div>
<div class="paragraph fragment"><p>Une image pour faire tourner l&#8217;appli</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM alpine:3.21.3
RUN apk --no-cache add ca-certificates

WORKDIR /root/

COPY app    .

CMD ["./app"]</code></pre></div></div>
<aside class="notes"><div class="paragraph"><p>De base, j&#8217;avais plut√¥t</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">link:https://raw.githubusercontent.com/alexellis/href-counter/master/Dockerfile.build[role=include]</code></pre></div></div>
<div class="paragraph fragment"><p>Une image pour faire tourner l&#8217;appli</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">link:https://raw.githubusercontent.com/alexellis/href-counter/master/Dockerfile[role=include]</code></pre></div></div>
<div class="paragraph"><p>√Ä bosser pour pouvoir rester √† jour</p></div></aside></div></section><section id="une_premi√®re_solution_2" data-auto-animate><h2>üß© Une premi√®re solution</h2><div class="slide-content"><div class="paragraph"><p>Avec un autre exemple</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">#!/bin/sh
echo Building alexellis2/href-counter:build

docker image build --build-arg https_proxy=$https_proxy --build-arg http_proxy=$http_proxy \
    -t alexellis2/href-counter:build . -f Dockerfile.build
docker container create --name extract alexellis2/href-counter:build
docker container cp extract:/go/src/github.com/alexellis/href-counter/app ./app
docker container rm -f extract

echo Building alexellis2/href-counter:latest
docker image build --no-cache -t alexellis2/href-counter:latest .
rm ./app</code></pre></div></div></div></section><section id="une_premi√®re_solution_3" data-auto-animate><h2>üß© Une premi√®re solution</h2><div class="slide-content"><div class="paragraph"><p>Avec un autre exemple</p></div>
<div class="imageblock"><img src="media/fichiers-output81_with_transparency.png" alt="fichiers output81 with transparency" height="500"></div></div></section><section id="une_premi√®re_solution_4" data-auto-animate><h2>üß© Une premi√®re solution</h2><div class="slide-content"><div class="paragraph"><p>Avec un autre exemple</p></div>
<div class="imageblock"><img src="media/fichiers-output82_with_transparency.png" alt="fichiers output82 with transparency" height="500"></div></div></section><section id="une_premi√®re_solution_5" data-auto-animate><h2>üß© Une premi√®re solution</h2><div class="slide-content"><div class="paragraph"><p>Avec un autre exemple</p></div>
<div class="imageblock"><img src="media/fichiers-output83_with_transparency.png" alt="fichiers output83 with transparency" height="500"></div></div></section><section id="une_premi√®re_solution_6" class="columns" data-auto-animate><h2>üß© Une premi√®re solution</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="paragraph"><p>Avec un autre exemple</p></div>
<div class="imageblock"><img src="media/fichiers-output83_with_transparency.png" alt="fichiers output83 with transparency"></div></div></div>
<div class="openblock column"><div class="content"><div class="imageblock"><img src="media/1956754704-image20.jpeg" alt="1956754704 image20"></div></div></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {81..84}; do convert Diapositive${i}.PNG -crop 8940x4930+2182+1700 -transparent white -resize x1080 fichiers-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="multistage_build" data-auto-animate><h2>ü™ú Multistage build</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM golang:1.19

WORKDIR /go/src/github.com/alexellis/href-counter/

COPY go.mod .
COPY go.sum .
COPY app.go	.

RUN CGO_ENABLED=0 GOOS=linux go build  -ldflags "-s -w" -o app .

FROM alpine:3.17.1
RUN apk --no-cache add ca-certificates

WORKDIR /root/

COPY --from=0 /go/src/github.com/alexellis/href-counter/app    .

CMD ["./app"]</code></pre></div></div>
<aside class="notes"><div class="paragraph"><p>J&#8217;aurais pr√©f√©r√©:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">link:https://raw.githubusercontent.com/alexellis/href-counter/master/Dockerfile.multi[role=include]</code></pre></div></div></aside></div></section><section id="multistage_build_2" data-auto-animate><h2>ü™ú Multistage build</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM golang:1.19

WORKDIR /go/src/github.com/alexellis/href-counter/

COPY go.mod .
COPY go.sum .
COPY app.go	.

RUN CGO_ENABLED=0 GOOS=linux go build  -ldflags "-s -w" -o app .

FROM alpine:3.17.1
RUN apk --no-cache add ca-certificates

WORKDIR /root/

COPY --from=0 /go/src/github.com/alexellis/href-counter/app    .

CMD ["./app"]</code></pre></div></div>
<div class="paragraph"><p>On copie les fichiers depuis le premier stage</p></div></div></section><section id="les_containers" class="columns"><h2>üì¶ LES CONTAINERS</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="paragraph"><p>Le bilan : achievement unlocked</p></div>
<div class="paragraph"><p>Vous savez d√©sormais:</p></div>
<div class="ulist"><ul><li class="fragment"><p>Ma√Ætriser le cycle de vie des containers</p></li><li class="fragment"><p>Interagir avec les containers existants</p></li><li class="fragment"><p>Nommer les containers</p></li><li class="fragment"><p>Inspecter les containers</p></li><li class="fragment"><p>Appeler les containers</p></li><li class="fragment"><p>Obtenir des containers l√©gers</p></li></ul></div></div></div>
<div class="openblock column"><div class="content"><div class="imageblock"><img src="media/1706694417-image21.png" alt="1706694417 image21"></div></div></div></div></section></section>
<section><section id="les_volumes"><h2>Les volumes</h2><div class="slide-content"><div class="imageblock"><img src="media/1300236655-image2.jpeg" alt="1300236655 image2"></div></div></section><section id="3_types_de_gestion_de_donn√©es" data-auto-animate><h2>üî¥üîµüü¢ 3 types de gestion de donn√©es</h2><div class="slide-content"><div class="imageblock"><img src="media/3_types_gestions_donnees.png" alt="3 types gestions donnees" height="600"></div>
<aside class="notes"><div class="paragraph"><p>Vue d&#8217;ensemble des trois types de gestion des donn√©es couramment utilis√©s dans Docker :</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Mapping de Syst√®me de Fichiers (Filesystem Mapping) :
<strong>Description</strong> : Le mappage de syst√®me de fichiers consiste √† partager un r√©pertoire de votre syst√®me h√¥te avec un conteneur Docker.
Cela permet au conteneur d&#8217;acc√©der et de modifier des fichiers dans ce r√©pertoire.
<strong>Utilisation</strong> : Utile pour partager des fichiers ou des donn√©es de configuration avec un conteneur.
Les donn√©es sont stock√©es sur le syst√®me h√¥te, mais sont accessibles depuis le conteneur.
<strong>Exemple</strong> : <code>docker container run -v /chemin/du/systeme/hote:/chemin/dans/le/conteneur</code></p></li><li><p>Volumes :
<strong>Description</strong> : Les volumes sont un m√©canisme de stockage persistant qui permet de stocker des donn√©es en dehors du syst√®me de fichiers du conteneur.
Ils sont g√©r√©s par Docker et offrent une plus grande flexibilit√© que le simple mappage de syst√®me de fichiers.
<strong>Utilisation</strong> : Id√©aux pour stocker des donn√©es qui doivent survivre √† l&#8217;arr√™t ou √† la suppression d&#8217;un conteneur.
Les volumes sont ind√©pendants du cycle de vie du conteneur.
<strong>Exemple</strong> : <code>docker run -v nom_du_volume:/chemin/dans/le/conteneur</code></p></li><li><p>Syst√®me de Fichiers RAM (RAM Filesystem) :
<strong>Description</strong> : Il s&#8217;agit d&#8217;un syst√®me de fichiers temporaire stock√© en m√©moire RAM.
Les donn√©es sont stock√©es de mani√®re √©ph√©m√®re, ce qui signifie qu&#8217;elles sont perdues lorsque le conteneur est arr√™t√©.
<strong>Utilisation</strong> : Utile lorsque des donn√©es temporaires doivent √™tre stock√©es en m√©moire pour des performances √©lev√©es.
Les donn√©es n&#8217;existent que tant que le conteneur est en cours d&#8217;ex√©cution.
<strong>Exemple</strong> : <code>docker run --tmpfs /chemin/dans/le/conteneur</code></p></li></ol></div>
<div class="paragraph"><p>En r√©sum√©, ces trois m√©thodes de gestion des donn√©es en Docker offrent des avantages diff√©rents en fonction des besoins sp√©cifiques d&#8217;un conteneur. Le mappage de syst√®me de fichiers est utile pour partager des fichiers depuis le syst√®me h√¥te, les volumes sont id√©aux pour la persistance des donn√©es, tandis que les syst√®mes de fichiers RAM sont parfaits pour des donn√©es temporaires √† haute performance.</p></div></aside></div></section><section id="3_types_de_gestion_de_donn√©es_2" class="columns" data-auto-animate><h2>üî¥üîµüü¢ 3 types de gestion de donn√©es</h2><div class="slide-content"><div class="openblock column is-one-third"><div class="content"><div class="imageblock"><img src="media/mapping_fs.png" alt="mapping fs"></div></div></div>
<div class="openblock column"><div class="content"><div class="paragraph"><p>Partage d&#8217;un r√©pertoire de votre syst√®me h√¥te avec un conteneur Docker.</p></div>
<div class="ulist"><ul><li class="fragment"><p>Utile pour partager des fichiers ou des donn√©es de configuration avec un conteneur.</p></li><li class="fragment"><p>Donn√©es stock√©es sur le syst√®me h√¥te, mais accessibles depuis le conteneur.</p></li></ul></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run -v /chemin/du/systeme/hote:/chemin/dans/le/conteneur</code></pre></div></div></div></div>
<aside class="notes"><div class="olist arabic"><ol class="arabic"><li><p>Mapping de Syst√®me de Fichiers (Filesystem Mapping) :
<strong>Description</strong> : Le mappage de syst√®me de fichiers consiste √† partager un r√©pertoire de votre syst√®me h√¥te avec un conteneur Docker.
Cela permet au conteneur d&#8217;acc√©der et de modifier des fichiers dans ce r√©pertoire.
<strong>Utilisation</strong> : Utile pour partager des fichiers ou des donn√©es de configuration avec un conteneur.
Les donn√©es sont stock√©es sur le syst√®me h√¥te, mais sont accessibles depuis le conteneur.
<strong>Exemple</strong> : <code>docker container run -v /chemin/du/systeme/hote:/chemin/dans/le/conteneur</code></p></li></ol></div></aside></div></section><section id="3_types_de_gestion_de_donn√©es_3" class="columns" data-auto-animate><h2>üî¥üîµüü¢ 3 types de gestion de donn√©es</h2><div class="slide-content"><div class="openblock column is-one-third"><div class="content"><div class="imageblock"><img src="media/volumes.png" alt="volumes"></div></div></div>
<div class="openblock column"><div class="content"><div class="paragraph"><p>Stockage persistant &#8658; donn√©es en dehors du syst√®me de fichiers du conteneur.</p></div>
<div class="ulist"><ul><li class="fragment"><p>Utile pour stocker des donn√©es qui doivent survivre √† l&#8217;arr√™t ou √† la suppression d&#8217;un conteneur.</p></li><li class="fragment"><p>Volumes ind√©pendants du cycle de vie du conteneur.</p></li></ul></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run -v nom_du_volume:/chemin/dans/le/conteneur</code></pre></div></div></div></div>
<aside class="notes"><div class="paragraph"><p>Volumes :
<strong>Description</strong> : Les volumes sont un m√©canisme de stockage persistant qui permet de stocker des donn√©es en dehors du syst√®me de fichiers du conteneur.
Ils sont g√©r√©s par Docker et offrent une plus grande flexibilit√© que le simple mappage de syst√®me de fichiers.
<strong>Utilisation</strong> : Id√©aux pour stocker des donn√©es qui doivent survivre √† l&#8217;arr√™t ou √† la suppression d&#8217;un conteneur.
Les volumes sont ind√©pendants du cycle de vie du conteneur.
<strong>Exemple</strong> : <code>docker container run -v nom_du_volume:/chemin/dans/le/conteneur</code></p></div></aside></div></section><section id="3_types_de_gestion_de_donn√©es_4" class="columns" data-auto-animate><h2>üî¥üîµüü¢ 3 types de gestion de donn√©es</h2><div class="slide-content"><div class="openblock column is-one-third"><div class="content"><div class="imageblock"><img src="media/fs_ram.png" alt="fs ram"></div></div></div>
<div class="openblock column"><div class="content"><div class="paragraph"><p>Syst√®me de fichiers temporaire stock√© en RAM.</p></div>
<div class="ulist"><ul><li class="fragment"><p>Utile lorsque des donn√©es temporaires doivent √™tre stock√©es en m√©moire pour des performances √©lev√©es.</p></li><li class="fragment"><p>Les donn√©es n&#8217;existent que tant que le conteneur est en cours d&#8217;ex√©cution.</p></li></ul></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run --tmpfs /chemin/dans/le/conteneur</code></pre></div></div></div></div>
<aside class="notes"><div class="paragraph"><p>Syst√®me de Fichiers RAM (RAM Filesystem) :
<strong>Description</strong> : Il s&#8217;agit d&#8217;un syst√®me de fichiers temporaire stock√© en m√©moire RAM.
Les donn√©es sont stock√©es de mani√®re √©ph√©m√®re, ce qui signifie qu&#8217;elles sont perdues lorsque le conteneur est arr√™t√©.
<strong>Utilisation</strong> : Utile lorsque des donn√©es temporaires doivent √™tre stock√©es en m√©moire pour des performances √©lev√©es.
Les donn√©es n&#8217;existent que tant que le conteneur est en cours d&#8217;ex√©cution.
<strong>Exemple</strong> : <code>docker container run --tmpfs /chemin/dans/le/conteneur</code></p></div>
<div class="paragraph"><p>En r√©sum√©, ces trois m√©thodes de gestion des donn√©es en Docker offrent des avantages diff√©rents en fonction des besoins sp√©cifiques d&#8217;un conteneur. Le mappage de syst√®me de fichiers est utile pour partager des fichiers depuis le syst√®me h√¥te, les volumes sont id√©aux pour la persistance des donn√©es, tandis que les syst√®mes de fichiers RAM sont parfaits pour des donn√©es temporaires √† haute performance.</p></div></aside></div></section><section id="3_types_de_gestion_de_donn√©es_5" data-auto-animate><h2>üî¥üîµüü¢ 3 types de gestion de donn√©es</h2><div class="slide-content"><div class="imageblock"><img src="media/1329201553-image3.png" alt="1329201553 image3"></div></div></section><section id="mapping_de_filesystem"><h2>üó∫Ô∏èüìÇ Mapping de FileSystem</h2><div class="slide-content"><div class="imageblock"><img src="media/293990221-image4.png" alt="293990221 image4" height="600"></div></div></section><section id="mapping_de_filesystem_2"><h2>üó∫Ô∏èüìÇ Mapping de FileSystem</h2><div class="slide-content"><div class="paragraph"><p><strong><em>"Cr√©er une image avec les sources de mon application web juste pour distribuer des ressources statiques via Apache ! Merci Docker !"</em></strong></p></div>
<div class="paragraph"><p>Un √©tudiant exc√©d√©</p></div>
<div class="imageblock"><img src="media/1105931517-image5.png" alt="1105931517 image5"></div></div></section><section id="mapping_de_filesystem_3"><h2>üó∫Ô∏èüìÇ Mapping de FileSystem</h2><div class="slide-content"><div class="imageblock"><img src="media/1771886276-image6.png" alt="1771886276 image6" width="1000"></div>
<div class="paragraph small"><small>Source : <a href="https://hub.docker.com/_/nginx" class="bare">https://hub.docker.com/_/nginx</a></small></div>
<div class="imageblock fragment"><img src="media/383920810-image7.png" alt="383920810 image7"></div></div></section><section id="mapping_de_filesystem_4"><h2>üó∫Ô∏èüìÇ Mapping de FileSystem</h2><div class="slide-content"><div class="paragraph"><p>Partage de dossier</p></div>
<div class="imageblock fragment"><img src="media/partage_dossier.png" alt="partage dossier"></div>
<div class="paragraph fragment"><p>Partage de fichier</p></div>
<div class="imageblock fragment"><img src="media/partage_fichier.png" alt="partage fichier"></div>
<div class="admonitionblock caution fragment"><table><tr><td class="icon"><i class="fa fa-fire" title="Caution"></i></td><td class="content">Le chemin dans la machine h√¥te doit √™tre un chemin absolu !</td></tr></table></div>
<div class="admonitionblock warning fragment"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content">L&#8217;exemple ci-dessus ne peut donc pas fonctionner</td></tr></table></div></div></section><section id="les_volumes_2"><h2>üì¶üìÅ Les volumes</h2><div class="slide-content"><div class="imageblock"><img src="media/726805516-image8.png" alt="726805516 image8" height="600"></div></div></section><section id="les_volumes_3"><h2>üì¶üìÅ Les volumes</h2><div class="slide-content"><div class="paragraph"><p>Il est possible de cr√©er des "espaces m√©moire" que l&#8217;on peut mettre √† disposition des containers.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker volume create --name my-data</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker run -v my-data:/data busybox ls /data</code></pre></div></div>
<div class="admonitionblock caution fragment"><table><tr><td class="icon"><i class="fa fa-fire" title="Caution"></i></td><td class="content"><strong>my_data</strong> n&#8217;est plus un chemin absolu, mais juste le nom du volume</td></tr></table></div></div></section><section id="les_volumes_4"><h2>üì¶üìÅ Les volumes</h2><div class="slide-content"><div class="paragraph"><p>Lister tous les volumes</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker volume ls</code></pre></div></div>
<div class="paragraph fragment"><p>Supprimer un volume</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker volume rm my-data</code></pre></div></div>
<div class="paragraph fragment"><p>Inspecter un volume</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker volume inspect my-data</code></pre></div></div></div></section><section id="les_volumes_anonymes"><h2>üì¶üìÅüï∂Ô∏è Les volumes "anonymes"</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM alpine:3.21
WORKDIR /repertoire/travail
VOLUME ["/data"]
RUN echo hello &gt; ./world.txt</code></pre></div></div>
<div class="paragraph fragment"><p>Cr√©ation d&#8217;un volume anonyme mapp√© sur le r√©pertoire /data des containers bas√©s sur cette image</p></div></div></section><section id="filesystem_en_ram" data-auto-animate><h2>üíæüß† FileSystem en RAM</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run
  -d
  --read-only
  --tmpfs /run/httpd
  --tmpfs /tmp
  httpd</code></pre></div></div>
<div class="admonitionblock caution fragment"><table><tr><td class="icon"><i class="fa fa-fire" title="Caution"></i></td><td class="content">Les donn√©es sont perdues √† l&#8217;arr√™t du container.</td></tr></table></div></div></section><section id="filesystem_en_ram_2" data-auto-animate><h2>üíæüß† FileSystem en RAM</h2><div class="slide-content"><div class="imageblock"><img src="media/volumes-output21_with_transparency.png" alt="volumes output21 with transparency"></div>
<div class="admonitionblock caution"><table><tr><td class="icon"><i class="fa fa-fire" title="Caution"></i></td><td class="content">Les donn√©es sont perdues √† l&#8217;arr√™t du container.</td></tr></table></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {21..22}; do convert Diapositive${i}.PNG -crop 9342x3359+2250+1652 -transparent white -resize x1080 volumes-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="filesystem_en_ram_3" data-auto-animate><h2>üíæüß† FileSystem en RAM</h2><div class="slide-content"><div class="imageblock"><img src="media/volumes-output22_with_transparency.png" alt="volumes output22 with transparency"></div>
<div class="admonitionblock caution"><table><tr><td class="icon"><i class="fa fa-fire" title="Caution"></i></td><td class="content">Les donn√©es sont perdues √† l&#8217;arr√™t du container.</td></tr></table></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {21..22}; do convert Diapositive${i}.PNG -crop 9342x3359+2250+1652 -transparent white -resize x1080 volumes-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="bilan_de_comp√©tences" data-auto-animate><h2>üìäüìù Bilan de comp√©tences</h2><div class="slide-content"><div class="ulist"><ul><li><p>Cr√©ation d&#8217;images</p></li><li><p>Cr√©ation des containers</p><div class="ulist"><ul><li><p>cycle de vie</p></li><li><p>nommage</p></li><li><p>d√©bug</p></li><li><p>r√©seau</p></li><li><p>volumes</p></li></ul></div></li></ul></div></div></section><section id="bilan_de_comp√©tences_2" data-auto-animate><h2>üìäüìù Bilan de comp√©tences</h2><div class="slide-content"><div class="ulist"><ul><li><p>Cr√©ation d&#8217;images ‚úÖ</p></li><li><p>Cr√©ation des containers ‚úÖ</p><div class="ulist"><ul><li><p>cycle de vie ‚úÖ</p></li><li><p>nommage ‚úÖ</p></li><li><p>d√©bug ‚úÖ</p></li><li><p>r√©seau  ‚úÖ</p></li><li><p>volumes ‚úÖ</p></li></ul></div></li></ul></div></div></section><section id="travaux_pratiques_8" data-auto-animate><h2>üéì Travaux pratiques #8</h2><div class="slide-content"><div class="paragraph"><p>Lancer un container `nginx `et lui faire distribuer une page web externe au container.</p></div>
<div class="imageblock"><img src="media/1763880002-image10.png" alt="1763880002 image10"></div></div></section><section id="solution_travaux_pratiques_8" data-auto-animate><h2>‚úÖ Solution travaux pratiques #8</h2><div class="slide-content"><div class="paragraph title"><p>En utilisant un montage de r√©pertoire (Bind Mount) :</p></div>
<div class="paragraph fragment"><p>Utilisez un montage de r√©pertoire pour mapper un r√©pertoire de l&#8217;h√¥te vers le conteneur Nginx.</p></div>
<div class="paragraph fragment"><p>Placez vos fichiers HTML dans un r√©pertoire sur votre machine h√¥te, puis mappez ce r√©pertoire vers le conteneur Nginx.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run -d -p 80:80 --name mon-nginx -v /chemin/vers/la/page/web/sur/lhote:/usr/share/nginx/html nginx</code></pre></div></div>
<div class="paragraph fragment"><p>Remplacez <code>/chemin/vers/la/page/web/sur/lhote</code> par le chemin r√©el vers le r√©pertoire contenant vos fichiers de la page web sur l&#8217;h√¥te.</p></div></div></section><section id="solution_travaux_pratiques_8_2" data-auto-animate><h2>‚úÖ Solution travaux pratiques #8</h2><div class="slide-content"><div class="paragraph title"><p>En utilisant un volume nomm√© (Named Volume) :</p></div>
<div class="paragraph fragment"><p>Cr√©ez un volume nomm√© et copiez vos fichiers de la page web dedans.</p></div>
<div class="paragraph fragment"><p>Montez ce volume nomm√© dans le conteneur Nginx.</p></div>
<div class="paragraph fragment"><p>Tout d&#8217;abord, cr√©ez un volume nomm√© :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker volume create mon-nginx-html</code></pre></div></div>
<div class="paragraph fragment"><p>Copiez vos fichiers de la page web dans ce volume :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run --rm \
  --volume mon-nginx-html:/cible \   # Montez le volume nomm√© "mon-nginx-html" dans le conteneur sous le r√©pertoire "/cible".
  --volume /chemin/vers/la/page/web/sur/lhote:/html \ # Montez le r√©pertoire o√π se trouve le fichier html
  --workdir /cible \                # D√©finissez le r√©pertoire de travail √† "/cible" dans le conteneur.
  busybox cp -r /html .   # Copiez r√©cursivement le contenu depuis "/chemin/vers/la/page/web/sur/lhote" dans le r√©pertoire actuel du conteneur.</code></pre></div></div>
<div class="paragraph fragment"><p>Maintenant, lancez le conteneur Nginx et montez le volume nomm√© :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run -d -p 80:80 --name mon-nginx -v mon-nginx-html:/usr/share/nginx/html nginx</code></pre></div></div></div></section><section id="travaux_pratiques_9"><h2>üéì Travaux pratiques #9</h2><div class="slide-content"><div class="paragraph title"><p>√âtapes:</p></div>
<div class="ulist"><ul><li class="fragment"><p>Cr√©er un volume nomm√© "data"</p></li><li class="fragment"><p>D√©marrer un container attach√© √† ce volume</p></li><li class="fragment"><p>Lancer un processus qui √©crit un fichier dans le volume</p></li><li class="fragment"><p>D√©marrer un second container attach√© √† ce volume</p></li><li class="fragment"><p>Lire les donn√©es du volume depuis le second container</p></li><li class="fragment"><p>Supprimer le volume</p></li></ul></div></div></section><section id="solution_travaux_pratiques_9"><h2>‚úÖ Solution travaux pratiques #9</h2><div class="slide-content"><div class="paragraph"><p>Cr√©er un volume nomm√© "data" :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker volume create data</code></pre></div></div>
<div class="paragraph fragment"><p>D√©marrer un premier conteneur attach√© √† ce volume :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run -it --name premier-container -v data:/donnees busybox</code></pre></div></div>
<div class="paragraph fragment"><p>Dans le premier conteneur, lancez un processus qui √©crit un fichier dans le volume (par exemple, un fichier texte) :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">echo "Donn√©es du premier conteneur" &gt; /donnees/mon-fichier.txt</code></pre></div></div>
<div class="paragraph fragment"><p>Quittez le premier conteneur.</p></div>
<div class="paragraph fragment"><p>D√©marrer un second conteneur attach√© au m√™me volume :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run -it --name second-container -v data:/donnees busybox</code></pre></div></div></div></section><section id="solution_travaux_pratiques_9_2"><h2>‚úÖ Solution travaux pratiques #9</h2><div class="slide-content"><div class="paragraph"><p>D√©marrer un second conteneur attach√© au m√™me volume :</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run -it --name second-container -v data:/donnees busybox</code></pre></div></div>
<div class="paragraph"><p>Dans le second conteneur, lisez les donn√©es du volume (le fichier texte) :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">cat /donnees/mon-fichier.txt</code></pre></div></div>
<div class="paragraph fragment"><p>Vous devriez voir le contenu du fichier affich√© √† l&#8217;√©cran.</p></div>
<div class="paragraph fragment"><p>Quittez le second conteneur.</p></div>
<div class="paragraph fragment"><p>Vous pouvez maintenant supprimer le volume "data" car vous n&#8217;en avez plus besoin :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker volume rm data</code></pre></div></div></div></section><section id="travaux_pratiques_10"><h2>üéì  Travaux pratiques #10</h2><div class="slide-content"><div class="paragraph"><p>√âcrire un Dockerfile qui:</p></div>
<div class="ulist"><ul><li class="fragment"><p>Ajoute des fichiers dans un dossier</p></li><li class="fragment"><p>D√©clare ce dossier comme volume anonyme</p></li><li class="fragment"><p>Ajoute d&#8217;autres fichiers dans ce dossier</p></li></ul></div>
<div class="paragraph fragment"><p><strong>Que verra-ton dans ce dossier au sein de nos containers ?</strong></p></div></div></section><section id="solution_travaux_pratiques_10" data-auto-animate><h2>‚úÖ Solution travaux pratiques #10</h2><div class="slide-content"><div class="paragraph"><p>Tout d&#8217;abord, cr√©ez un r√©pertoire pour votre projet et placez-vous dedans.</p></div>
<div class="paragraph fragment"><p>Cr√©ez un Dockerfile avec le contenu suivant :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM alpine:3.21

# Ajoutez des fichiers dans un dossier
RUN mkdir /mon-dossier
RUN echo "Contenu du fichier 1" &gt; /mon-dossier/fichier1.txt
RUN echo "Contenu du fichier 2" &gt; /mon-dossier/fichier2.txt

# D√©clarez ce dossier comme un volume anonyme
VOLUME ["/mon-dossier"]

# Ajoutez d'autres fichiers dans ce dossier
RUN echo "Nouveau contenu du fichier 3" &gt; /mon-dossier/fichier3.txt</code></pre></div></div>
<div class="paragraph fragment"><p>Ensuite, vous pouvez cr√©er une image Docker √† partir de ce Dockerfile en ex√©cutant la commande suivante dans le m√™me r√©pertoire que le Dockerfile :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker image build -t mon-image .</code></pre></div></div></div></section><section id="solution_travaux_pratiques_10_2" data-auto-animate><h2>‚úÖ Solution travaux pratiques #10</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker image build -t mon-image .</code></pre></div></div>
<div class="paragraph"><p>Assurez-vous que "mon-image" est le nom que vous souhaitez donner √† votre image Docker.
Apr√®s avoir cr√©√© l&#8217;image, vous pouvez ex√©cuter un conteneur bas√© sur cette image :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run -it mon-image</code></pre></div></div>
<div class="paragraph fragment"><p>Lorsque vous √™tes dans le conteneur, acc√©dez au dossier /mon-dossier :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">cd /mon-dossier</code></pre></div></div>
<div class="paragraph fragment"><p>Vous verrez les fichiers "fichier1.txt", "fichier2.txt" et "fichier3.txt" dans ce dossier.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">ls</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">fichier1.txt  fichier2.txt  fichier3.txt</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">cat *</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">Contenu du fichier 1
Contenu du fichier 2
Nouveau contenu du fichier 3</code></pre></div></div></div></section><section id="solution_travaux_pratiques_10_3" data-auto-animate><h2>‚úÖ Solution travaux pratiques #10</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">cat *</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">Contenu du fichier 1
Contenu du fichier 2
Nouveau contenu du fichier 3</code></pre></div></div>
<div class="paragraph fragment"><p>Vous devriez voir la liste des fichiers et leurs contenus.</p></div>
<div class="paragraph fragment"><p>Cela montre que les fichiers que vous avez ajout√©s dans le dossier, m√™me apr√®s avoir d√©clar√© ce dossier comme un volume anonyme, restent accessibles dans le conteneur.</p></div>
<div class="paragraph fragment"><p>C&#8217;est ainsi que vous pouvez ajouter des fichiers dans un dossier, le d√©clarer comme un volume anonyme, puis ajouter d&#8217;autres fichiers dans ce dossier tout en y ayant acc√®s √† l&#8217;int√©rieur du conteneur.</p></div></div></section></section>
<section><section id="r√©seaux_et_docker"><h2>R√©seaux et Docker</h2><div class="slide-content"><div class="paragraph title"><p>Interagir avec le Docker ENGINE</p></div><div class="imageblock"><img src="media/2375.png" alt="2375"></div></div></section><section id="interagir_avec_le_docker_engine" data-auto-animate><h2>ü§ù Interagir avec le Docker Engine</h2><div class="slide-content"><div class="imageblock"><img src="media/reseaux-output2_with_transparency.png" alt="reseaux output2 with transparency" height="600"></div></div></section><section id="interagir_avec_le_docker_engine_2" data-auto-animate><h2>ü§ù Interagir avec le Docker Engine</h2><div class="slide-content"><div class="imageblock"><img src="media/reseaux-output3_with_transparency.png" alt="reseaux output3 with transparency" height="600"></div></div></section><section id="interagir_avec_le_docker_engine_3" data-auto-animate><h2>ü§ù Interagir avec le Docker Engine</h2><div class="slide-content"><div class="imageblock"><img src="media/reseaux-output4_with_transparency.png" alt="reseaux output4 with transparency" height="600"></div></div></section><section id="interagir_avec_le_docker_engine_4" data-auto-animate><h2>ü§ù Interagir avec le Docker Engine</h2><div class="slide-content"><div class="imageblock"><img src="media/reseaux-output5_with_transparency.png" alt="reseaux output5 with transparency" height="600"></div>
<aside class="notes"><div class="paragraph"><p>La communication d&#8217;un navigateur avec le moteur Docker sur le port 2375 peut se faire via l&#8217;API Docker expos√©e sur ce port. Voici comment cela fonctionne :</p></div>
<div class="paragraph"><p>Exposer l&#8217;API Docker sur le port 2375 : Tout d&#8217;abord, pour permettre la communication du navigateur avec le moteur Docker, vous devez vous assurer que l&#8217;API Docker est expos√©e sur le port 2375. Vous pouvez sp√©cifier cela lors de la configuration du moteur Docker. Par exemple, en utilisant l&#8217;option -H :</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">dockerd -H tcp://0.0.0.0:2375</code></pre></div></div>
<div class="paragraph"><p>Cela signifie que le moteur Docker √©coutera les requ√™tes sur le port 2375.</p></div>
<div class="paragraph"><p>Utilisation de l&#8217;API Docker : Une fois que l&#8217;API Docker est expos√©e, vous pouvez effectuer des op√©rations Docker en utilisant des requ√™tes HTTP. Le navigateur peut envoyer des requ√™tes HTTP directement √† l&#8217;adresse IP du serveur Docker et au port 2375.</p></div>
<div class="paragraph"><p>Par exemple, pour lister les conteneurs en cours d&#8217;ex√©cution, vous pouvez utiliser une requ√™te HTTP GET :</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http hljs" data-noescape="true" data-lang="http">GET http://adresse_ip_du_serveur_docker:2375/containers/json</code></pre></div></div>
<div class="paragraph"><p>Le serveur Docker r√©pondra avec les d√©tails des conteneurs en cours d&#8217;ex√©cution au format JSON.</p></div>
<div class="paragraph"><p>S√©curit√© : Il est important de noter que l&#8217;exposition de l&#8217;API Docker sur un port non s√©curis√© peut pr√©senter des risques de s√©curit√©, car n&#8217;importe qui avec acc√®s au port 2375 peut potentiellement contr√¥ler le moteur Docker. Pour des raisons de s√©curit√©, il est recommand√© de limiter l&#8217;acc√®s √† l&#8217;API Docker en utilisant des m√©canismes d&#8217;authentification, d&#8217;autorisation et de chiffrement.</p></div>
<div class="paragraph"><p>Outils tiers : En pratique, les navigateurs ne sont pas souvent utilis√©s pour interagir directement avec l&#8217;API Docker. Au lieu de cela, des outils tiers, des biblioth√®ques ou des clients Docker sont souvent utilis√©s pour simplifier les op√©rations Docker et fournir une couche de s√©curit√© suppl√©mentaire.</p></div></aside></div></section><section id="interagir_avec_le_docker_engine_5" data-auto-animate><h2>ü§ù Interagir avec le Docker Engine</h2><div class="slide-content"><div class="imageblock"><img src="media/reseaux-output6_with_transparency.png" alt="reseaux output6 with transparency" height="600"></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {2..6}; do convert Diapositive${i}.PNG -crop 9004x5341+1968+1654 -transparent white -resize x1080 reseaux-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="ex_int√©gration_intellij" class="intellij background" data-background-image="media/intellij-docker.png" data-background-size="cover" data-background-position="left"><h2>Ex : int√©gration IntelliJ</h2></section><section id="les_r√©seaux_de_containers"><h2>Les r√©seaux de containers</h2><div class="slide-content"><div class="imageblock"><img src="media/1435904594-image8.png" alt="1435904594 image8"></div></div></section><section id="mapping_de_port_rappel" data-auto-animate><h2>üó∫Ô∏èüîÄ Mapping de Port : Rappel</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run ‚Äìd -p 8000:80 nginx</code></pre></div></div></div></section><section id="mapping_de_port_rappel_2" data-auto-animate><h2>üó∫Ô∏èüîÄ Mapping de Port : Rappel</h2><div class="slide-content"><div class="imageblock"><img src="media/reseaux-output11_with_transparency.png" alt="reseaux output11 with transparency"></div></div></section><section id="mapping_de_port_rappel_3" data-auto-animate><h2>üó∫Ô∏èüîÄ Mapping de Port : Rappel</h2><div class="slide-content"><div class="imageblock"><img src="media/reseaux-output12_with_transparency.png" alt="reseaux output12 with transparency"></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">curl -I --noproxy '*' http://172.17.0.2:80
It works!</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">curl -I --noproxy '*' http://localhost:8000
It works too!</code></pre></div></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {11..12}; do convert Diapositive${i}.PNG -crop 8833x2599+2250+1833 -transparent white -resize x1080 reseaux-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="les_r√©seaux" data-auto-animate><h2>üåê Les r√©seaux</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker network ls</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">NETWORK ID     NAME                                                             DRIVER    SCOPE
11b7af7b16e4   bridge                                                           bridge    local
1112832d205b   cours-devops-docker_default                                      bridge    local
7ab15cc28199   docker_volumes-backup-extension-desktop-extension_default        bridge    local
34caf4674478   host                                                             host      local
2a179c7be3b3   none                                                             null      local
0c577a792771   portainer_portainer-docker-extension-desktop-extension_default   bridge    local</code></pre></div></div>
<div class="imageblock fragment"><img src="media/les_r√©seaux.png" alt="les r√©seaux"></div>
<aside class="notes"><div class="paragraph"><p>Dans le contexte de la commande "docker network ls", la colonne "DRIVER" (pilote) fait r√©f√©rence au pilote r√©seau utilis√© pour cr√©er le r√©seau Docker. Voici quelques explications concernant les valeurs possibles de cette colonne :</p></div>
<div class="olist arabic"><ol class="arabic"><li><p><strong>Local (bridge)</strong> : Un r√©seau avec une port√©e "local" est g√©n√©ralement un r√©seau de pont (bridge).
Il n&#8217;est accessible qu&#8217;√† l&#8217;int√©rieur de l&#8217;h√¥te Docker o√π il a √©t√© cr√©√©.
Les conteneurs connect√©s au m√™me r√©seau local peuvent communiquer entre eux, mais ce r√©seau est isol√© des autres h√¥tes Docker ou r√©seaux externes.</p></li><li><p><strong>Host (h√¥te)</strong> : Un r√©seau avec une port√©e "host" n&#8217;offre aucune isolation r√©seau, ce qui signifie qu&#8217;il est accessible depuis l&#8217;h√¥te o√π Docker est en cours d&#8217;ex√©cution.
Les conteneurs sur ce r√©seau partagent la pile r√©seau de l&#8217;h√¥te et peuvent acc√©der directement aux ressources de l&#8217;h√¥te.</p></li><li><p><strong>Null (null)</strong> : Un r√©seau avec une port√©e "null" est un type de r√©seau qui ne fournit aucune connectivit√©.
C&#8217;est essentiellement un r√©seau sans port√©e, et il est utilis√© pour les conteneurs qui n&#8217;ont pas besoin d&#8217;un acc√®s r√©seau.</p></li></ol></div>
<div class="paragraph"><p>D&#8217;autres pilotes de r√©seau peuvent √©galement √™tre disponibles, en fonction de la configuration de Docker et des plugins install√©s.
Chaque pilote offre des fonctionnalit√©s et des options de configuration sp√©cifiques pour r√©pondre aux besoins de divers cas d&#8217;utilisation.</p></div>
<div class="paragraph"><p>La colonne "DRIVER" vous permet de comprendre quel pilote r√©seau est associ√© √† chaque r√©seau Docker et comment il fonctionne.
Elle joue un r√¥le essentiel dans la d√©finition de la mani√®re dont les conteneurs communiquent entre eux et avec le r√©seau externe.</p></div></aside></div></section><section id="les_r√©seaux_2" data-auto-animate><h2>üåê Les r√©seaux</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker network ls</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">NETWORK ID     NAME                                                             DRIVER    SCOPE
11b7af7b16e4   bridge                                                           bridge    local
1112832d205b   cours-devops-docker_default                                      bridge    local
7ab15cc28199   docker_volumes-backup-extension-desktop-extension_default        bridge    local
34caf4674478   host                                                             host      local
2a179c7be3b3   none                                                             null      local
0c577a792771   portainer_portainer-docker-extension-desktop-extension_default   bridge    local</code></pre></div></div>
<div class="imageblock"><img src="media/les_r√©seaux.png" alt="les r√©seaux"></div>
<aside class="notes"><div class="paragraph"><p>Le terme "SCOPE" dans le contexte de "docker network ls" se r√©f√®re au domaine de validit√© du r√©seau Docker. Voici une explication en fran√ßais :</p></div>
<div class="olist arabic"><ol class="arabic"><li><p><strong>Local</strong> : Lorsque vous voyez "local" dans la colonne "SCOPE", cela signifie que le r√©seau Docker a une port√©e locale.
Les r√©seaux ayant une port√©e locale sont accessibles uniquement sur l&#8217;h√¥te o√π ils ont √©t√© cr√©√©s.
Les conteneurs sur cet h√¥te peuvent se connecter au r√©seau, mais ils ne peuvent pas le faire depuis d&#8217;autres h√¥tes.</p></li><li><p><strong>Global</strong> : En revanche, si vous voyez "global" dans la colonne "SCOPE", cela signifie que le r√©seau Docker a une port√©e globale.
Cela permet aux conteneurs de se connecter √† ce r√©seau depuis d&#8217;autres h√¥tes de votre environnement Docker.</p></li></ol></div>
<div class="paragraph"><p>Ainsi, la valeur "SCOPE" vous indique si un r√©seau Docker est limit√© √† un seul h√¥te (port√©e locale) ou s&#8217;il est accessible depuis d&#8217;autres h√¥tes (port√©e globale).
La port√©e d√©termine la mani√®re dont les conteneurs peuvent communiquer avec ce r√©seau, en fonction de la configuration de Docker.</p></div></aside></div></section><section id="les_r√©seaux_inspection"><h2>üîçüåê Les r√©seaux : inspection</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker network inspect bridge</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">[
    {
        "Name": "bridge",
        "Id": "11b7af7b16e4cf9fe42733aa1b6900ed876407e3b55e692c9dfe03505e2af19f",
        "Created": "2023-10-31T15:08:44.054140179Z",
        "Scope": "local",
        "Driver": "bridge",
        "EnableIPv6": false,
        "IPAM": {
            "Driver": "default",
            "Options": null,
            "Config": [
                {
                    "Subnet": "172.17.0.0/16",
                    "Gateway": "172.17.0.1"
                }
            ]
        },
        ...</code></pre></div></div>
<aside class="notes"><div class="paragraph"><p>Lorsque vous ex√©cutez la commande "docker network inspect bridge," vous obtenez des informations sur le r√©seau "bridge" dans Docker.</p></div>
<div class="paragraph"><p>Voici ce que chaque √©l√©ment signifie :</p></div>
<div class="olist arabic"><ol class="arabic"><li><p><strong>Name (Nom)</strong> : C&#8217;est le nom du r√©seau, dans ce cas, "bridge." Docker attribue un nom par d√©faut √† ce r√©seau, qui est utilis√© par les conteneurs pour communiquer entre eux.</p></li><li><p><strong>Id (Identifiant)</strong> : C&#8217;est un identifiant unique attribu√© au r√©seau Docker, utilis√© en interne par Docker pour le g√©rer. Il est g√©n√©r√© automatiquement.</p></li><li><p><strong>Created (Cr√©√©)</strong> : Cette date indique quand le r√©seau a √©t√© cr√©√©. Cela peut √™tre utile pour suivre l&#8217;historique des op√©rations Docker.</p></li><li><p><strong>Scope (Port√©e)</strong> : Dans cet exemple, la port√©e est "local," ce qui signifie que le r√©seau "bridge" est uniquement accessible localement sur l&#8217;h√¥te Docker. Les conteneurs sur cet h√¥te peuvent se connecter au r√©seau "bridge," mais les conteneurs sur d&#8217;autres h√¥tes Docker ne le peuvent pas.</p></li><li><p><strong>Driver (Pilote)</strong> : Le pilote du r√©seau "bridge" est "bridge." C&#8217;est le pilote par d√©faut utilis√© pour connecter les conteneurs sur un m√™me h√¥te.</p></li><li><p><strong>EnableIPv6 (Activer IPv6)</strong> : Dans cet exemple, la valeur est "false," ce qui signifie que l&#8217;IPv6 n&#8217;est pas activ√© sur ce r√©seau. Docker prend en charge √† la fois l&#8217;IPv4 et l&#8217;IPv6.</p></li><li><p><strong>IPAM (IP Address Management - Gestion des adresses IP)</strong> : C&#8217;est la section qui g√®re les adresses IP pour le r√©seau. Dans cet exemple, le pilote est "default," ce qui signifie que Docker utilise ses param√®tres par d√©faut pour g√©rer les adresses IP.</p></li><li><p><strong>Subnet (Sous-r√©seau)</strong> : C&#8217;est l&#8217;intervalle d&#8217;adresses IP utilis√© par les conteneurs connect√©s √† ce r√©seau. Dans cet exemple, le sous-r√©seau est "172.17.0.0/16," ce qui signifie que les adresses IP de ce r√©seau sont comprises entre 172.17.0.1 et 172.17.255.254.</p></li><li><p><strong>Gateway (Passerelle)</strong> : Il s&#8217;agit de l&#8217;adresse IP de la passerelle utilis√©e par les conteneurs pour acc√©der √† d&#8217;autres r√©seaux ou √† Internet. Dans ce cas, la passerelle est "172.17.0.1."</p></li></ol></div>
<div class="paragraph"><p>Ces informations fournissent un aper√ßu de la configuration du r√©seau "bridge" dans Docker.</p></div></aside></div></section><section id="les_r√©seaux_cr√©ation"><h2>üåê‚ú® Les r√©seaux : cr√©ation</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker network create mon-reseau</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker network ls</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">NETWORK ID     NAME                                                             DRIVER    SCOPE
11b7af7b16e4   bridge                                                           bridge    local
1112832d205b   cours-devops-docker_default                                      bridge    local
7ab15cc28199   docker_volumes-backup-extension-desktop-extension_default        bridge    local
34caf4674478   host                                                             host      local
46953dc9b3d5   mon-reseau                                                       bridge    local
2a179c7be3b3   none                                                             null      local
0c577a792771   portainer_portainer-docker-extension-desktop-extension_default   bridge    local</code></pre></div></div>
<aside class="notes"><div class="paragraph"><p>Lorsque vous ex√©cutez la commande "docker network create mon-reseau," vous cr√©ez un nouveau r√©seau Docker avec le nom "mon-reseau." Voici ce que chaque √©l√©ment signifie :</p></div>
<div class="olist arabic"><ol class="arabic"><li><p><strong>NETWORK ID (Identifiant du r√©seau)</strong> : C&#8217;est un identifiant unique attribu√© au r√©seau que Docker utilise en interne pour le g√©rer. Il est g√©n√©r√© automatiquement.</p></li><li><p><strong>NAME (Nom)</strong> : Il s&#8217;agit du nom que vous avez choisi pour votre r√©seau, dans ce cas, "mon-reseau."</p></li><li><p><strong>DRIVER (Pilote)</strong> : Le pilote de ce r√©seau est "bridge." Le pilote "bridge" est utilis√© pour connecter des conteneurs sur le m√™me h√¥te.</p></li><li><p><strong>SCOPE (Port√©e)</strong> : Dans cet exemple, la port√©e est "local," ce qui signifie que le r√©seau "mon-reseau" est uniquement accessible localement sur l&#8217;h√¥te Docker. Les conteneurs sur cet h√¥te peuvent se connecter √† "mon-reseau," mais les conteneurs sur d&#8217;autres h√¥tes Docker ne le peuvent pas.</p></li></ol></div>
<div class="paragraph"><p>Ensuite, lorsque vous ex√©cutez "docker network ls," vous obtenez une liste de tous les r√©seaux Docker existants, y compris celui que vous venez de cr√©er ("mon-reseau").
Vous pouvez voir les d√©tails de ce r√©seau dans le tableau, y compris son identifiant, son nom, son pilote, et sa port√©e.</p></div>
<div class="paragraph"><p>En r√©sum√©, avec ces commandes, vous avez cr√©√© un nouveau r√©seau Docker nomm√© "mon-reseau" qui peut √™tre utilis√© pour connecter des conteneurs sur le m√™me h√¥te.</p></div></aside></div></section><section id="attacher_un_container_√†_un_r√©seau_particulier"><h2>üê≥üîó Attacher un container √† un r√©seau particulier</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker run ‚Äìd --net=mon-reseau --name=app img</code></pre></div></div>
<div class="paragraph fragment"><p>Il est opportun de nommer un container quand on l&#8217;attache √† un r√©seau.</p></div>
<div class="paragraph fragment"><p>Docker fournit un DNS interne dans les r√©seaux custom. Les containers d&#8217;un m√™me r√©seau peuvent se "voir" et "s&#8217;appeler" par leur noms.</p></div></div></section><section id="microdns" data-auto-animate><h2>üñ•Ô∏èüîç MicroDNS</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker network create mynet</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run -d --name web --net mynet nginx</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run --net mynet alpine ping web</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">PING web (172.21.0.2): 56 data bytes
64 bytes from 172.21.0.2: seq=0 ttl=64 time=0.442 ms
64 bytes from 172.21.0.2: seq=1 ttl=64 time=0.105 ms
64 bytes from 172.21.0.2: seq=2 ttl=64 time=0.099 ms
64 bytes from 172.21.0.2: seq=3 ttl=64 time=0.150 ms
64 bytes from 172.21.0.2: seq=4 ttl=64 time=0.114 ms
64 bytes from 172.21.0.2: seq=5 ttl=64 time=0.098 ms
64 bytes from 172.21.0.2: seq=6 ttl=64 time=0.099 ms
64 bytes from 172.21.0.2: seq=7 ttl=64 time=0.100 ms
64 bytes from 172.21.0.2: seq=8 ttl=64 time=0.114 ms
64 bytes from 172.21.0.2: seq=9 ttl=64 time=0.097 ms
^C
--- web ping statistics ---
10 packets transmitted, 10 packets received, 0% packet loss
round-trip min/avg/max = 0.097/0.141/0.442 ms</code></pre></div></div></div></section><section id="microdns_2" data-auto-animate><h2>üñ•Ô∏èüîç MicroDNS</h2><div class="slide-content"><div class="imageblock"><img src="media/appeler_son_voisin.png" alt="appeler son voisin" height="600"></div></div></section><section id="se_connecter_√†_un_r√©seau"><h2>üì∂üîå Se connecter √† un r√©seau</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker network connect mynet myapp</code></pre></div></div>
<div class="paragraph fragment"><p>Cette commande permet d&#8217;attacher un container √† un r√©seau apr√®s sa cr√©ation.</p></div></div></section><section id="travaux_pratiques_11"><h2>üéì Travaux pratiques #11</h2><div class="slide-content"><div class="paragraph"><p>√âtapes:</p></div>
<div class="ulist"><ul><li class="fragment"><p>Lister et inspecter les r√©seaux existants</p></li><li class="fragment"><p>Lancer un container `nginx `nomm√© "web1"</p></li><li class="fragment"><p>A quel r√©seau est-il attach√© ?</p></li><li class="fragment"><p>Cr√©er un r√©seau de type bridge et l&#8217;inspecter</p></li><li class="fragment"><p>Lancer un container <code>nginx</code> nomm√© "web2" et l&#8217;attacher au r√©seau cr√©√©</p></li><li class="fragment"><p>L&#8217;inspection confirme-t-elle l&#8217;attachement ?</p></li><li class="fragment"><p>Lancer un bash dans le container "web1"</p></li><li class="fragment"><p>Est-ce que "web1" peut voir "web2" ?</p></li><li class="fragment"><p>Corriger pour que ce soit le cas</p></li></ul></div></div></section><section id="solution_travaux_pratiques_11" data-auto-animate><h2>‚úÖ Solution travaux pratiques #11</h2><div class="slide-content"><div class="paragraph"><p>√âtape 1 : Lister et inspecter les r√©seaux existants</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Liste tous les r√©seaux Docker existants
docker network ls

# Inspecte un r√©seau sp√©cifique (par exemple, le r√©seau bridge, d'autres r√©seaux peuvent √™tre inspect√©s)
docker network inspect bridge</code></pre></div></div>
<div class="paragraph fragment"><p>√âtape 2 : Lancer un container "nginx" nomm√© "web1"</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Lance un conteneur "nginx" nomm√© "web1"
docker container run --name web1 -d nginx</code></pre></div></div>
<div class="paragraph fragment"><p>√âtape 3 : V√©rifier le r√©seau auquel "web1" est attach√©</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># R√©cup√®re l'identifiant de r√©seau complet pour le container "web1"
network_id=$(docker container inspect -f '{{.NetworkSettings.Networks.bridge.NetworkID}}' web1)

# Raccourcit l'identifiant du r√©seau aux premiers 12 caract√®res
shortened_network_id=$(echo $network_id | cut -c 1-12)

# Liste tous les r√©seaux docker, en filtrant par l'identifiant du r√©seau
docker network ls --format "table {{.ID}}\t{{.Name}}" | awk -v network_id="$shortened_network_id" '$1 == network_id {print $2}'</code></pre></div></div></div></section><section id="solution_travaux_pratiques_11_2" data-auto-animate><h2>‚úÖ Solution travaux pratiques #11</h2><div class="slide-content"><div class="paragraph"><p>√âtape 3 : V√©rifier le r√©seau auquel "web1" est attach√©</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># R√©cup√®re l'identifiant de r√©seau complet pour le container "web1"
network_id=$(docker container inspect -f '{{.NetworkSettings.Networks.bridge.NetworkID}}' web1)

# Raccourcit l'identifiant du r√©seau aux premiers 12 caract√®res
shortened_network_id=$(echo $network_id | cut -c 1-12)

# Liste tous les r√©seaux docker, en filtrant par l'identifiant du r√©seau
docker network ls --format "table {{.ID}}\t{{.Name}}" | awk -v network_id="$shortened_network_id" '$1 == network_id {print $2}'</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">bridge</code></pre></div></div>
<div class="paragraph fragment"><p>√âtape 4 : Cr√©er un r√©seau de type bridge et l&#8217;inspecter</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Cr√©e un r√©seau Docker de type bridge nomm√© "mon-reseau"
docker network create mon-reseau

# Inspecte le r√©seau "mon-reseau"
docker network inspect mon-reseau</code></pre></div></div>
<div class="paragraph fragment"><p>√âtape 5 : Lancer un container "nginx" nomm√© "web2" et l&#8217;attacher au r√©seau cr√©√©</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Lance un conteneur "nginx" nomm√© "web2" et l'attache au r√©seau "mon-reseau"
docker container run --name web2 -d --network mon-reseau nginx</code></pre></div></div></div></section><section id="solution_travaux_pratiques_11_3" data-auto-animate><h2>‚úÖ Solution travaux pratiques #11</h2><div class="slide-content"><div class="paragraph"><p>√âtape 5 : Lancer un container "nginx" nomm√© "web2" et l&#8217;attacher au r√©seau cr√©√©</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Lance un conteneur "nginx" nomm√© "web2" et l'attache au r√©seau "mon-reseau"
docker container run --name web2 -d --network mon-reseau nginx</code></pre></div></div>
<div class="paragraph"><p>√âtape 6 : V√©rifier l&#8217;attachement du container "web2" au r√©seau</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Inspecte le conteneur "web2" pour v√©rifier le r√©seau auquel il est attach√©
docker container inspect web2 | grep NetworkMode</code></pre></div></div>
<div class="paragraph fragment"><p>√âtape 7 : Lancer un bash dans le container "web1"</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Lance un shell interactif dans le conteneur "web1"
docker container exec -it web1 bash</code></pre></div></div>
<div class="paragraph fragment"><p>√âtape 8 : V√©rifier si "web1" peut voir "web2"</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># √Ä l'int√©rieur du conteneur "web1," essayez de faire une requ√™te HTTP vers "web2"
curl web2</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">curl: (6) Could not resolve host: web2</code></pre></div></div></div></section><section id="solution_travaux_pratiques_11_4" data-auto-animate><h2>‚úÖ Solution travaux pratiques #11</h2><div class="slide-content"><div class="paragraph"><p>√âtape 9 : Corriger pour permettre la communication entre "web1" et "web2"</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Sortez du shell du conteneur "web1" en tapant "exit"

# Attachez "web1" au m√™me r√©seau "mon-reseau"
docker network connect mon-reseau web1</code></pre></div></div>
<div class="paragraph fragment"><p>Apr√®s avoir suivi ces √©tapes, les conteneurs "web1" et "web2" devraient √™tre attach√©s au m√™me r√©seau "mon-reseau" et √™tre capables de communiquer entre eux.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Lance un shell interactif dans le conteneur "web1"
docker container exec -it web1 bash</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># √Ä l'int√©rieur du conteneur "web1," essayez de faire une requ√™te HTTP vers "web2"
curl web2</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-html hljs" data-noescape="true" data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Welcome to nginx!&lt;/title&gt;
&lt;style&gt;
[...]</code></pre></div></div></div></section></section>
<section><section id="docker_compose"><h2>üêãüêô Docker compose</h2><div class="slide-content"><div class="imageblock"><img src="media/2073552164-image2.png" alt="2073552164 image2" height="550px"></div></div></section><section id="un_cas_de_la_vraie_vie"><h2>üåêüè° Un cas de la vraie vie</h2><div class="slide-content"><div class="paragraph"><p>Une application riche repose souvent sur plusieurs √©l√©ments techniques √† coordonner ensemble.</p></div>
<div class="paragraph"><p>(Apache, Tomcat, Node, MongoDB, ElasticSearch, Logstash, etc.)</p></div>
<div class="paragraph"><p>Comment automatiser ces d√©ploiements ?</p></div></div></section><section id="on_pourrait_tout_scripter"><h2>üìúüíª On pourrait tout scripter‚Ä¶</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">#!/bin/sh
docker network create my-net
docker container run ‚Äìd --net=my-net ‚Äìp 3306:3306 mysql
docker container run ‚Äìd --net=my-net ‚Äìv /docs:/docs --name col1 httpd:2.4.58-bookworm
docker container run ‚Äìd --net=my-net ‚Äìv /docs:/docs --name col2 httpd:2.4.58-bookworm</code></pre></div></div></div></section><section id="tout_scripter"><h2>üìúüíª Tout scripter</h2><div class="slide-content"><div class="imageblock"><img src="media/351794078-image3.gif" alt="351794078 image3"></div>
<div class="ulist"><ul><li class="fragment"><p>Et tout lancer ind√©pendamment ?</p></li><li class="fragment"><p>Et tout monitorer un par un ?</p></li><li class="fragment"><p>Peut mieux faire, non ?</p></li></ul></div></div></section><section id="docker_compose_yml"><h2>üêãüêô docker compose.yml</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:</code></pre></div></div></div></section><section id="docker_compose_yml_2"><h2>üêãüêô docker compose.yml</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  apache:







  middle:



  db:</code></pre></div></div></div></section><section id="docker_compose_yml_3"><h2>üêãüêô docker compose.yml</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  apache:
    image: "my-httpd:2.4"






  middle:



  db:</code></pre></div></div></div></section><section id="docker_compose_yml_4"><h2>üêãüêô docker compose.yml</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  apache:
    image: "my-httpd:2.4"
    ports:
      - "80:80"




  middle:



  db:</code></pre></div></div></div></section><section id="docker_compose_yml_5"><h2>üêãüêô docker compose.yml</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  apache:
    image: "my-httpd:2.4"
    ports:
      - "80:80"
    environment:
      - MIDDLE_HOST_1=middle


  middle:



  db:</code></pre></div></div></div></section><section id="docker_compose_yml_6"><h2>üêãüêô docker compose.yml</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  apache:
    image: "my-httpd:2.4"
    ports:
      - "80:80"
    environment:
      - MIDDLE_HOST_1=middle
    volumes:
      - ./etc/httpd/workers.properties:/etc/httpd/conf/workers.properties
  middle:



  db:</code></pre></div></div></div></section><section id="docker_compose_yml_7"><h2>üêãüêô docker compose.yml</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  apache:
    image: "my-httpd:2.4"
    ports:
      - "80:80"
    environment:
      - MIDDLE_HOST_1=middle
    volumes:
      - ./etc/httpd/workers.properties:/etc/httpd/conf/workers.properties
  middle:
    build: .


  db:</code></pre></div></div></div></section><section id="docker_compose_yml_8"><h2>üêãüêô docker compose.yml</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  apache:
    image: "my-httpd:2.4"
    ports:
      - "80:80"
    environment:
      - MIDDLE_HOST_1=middle
    volumes:
      - ./etc/httpd/workers.properties:/etc/httpd/conf/workers.properties
  middle:
    build: .
    environment:
      - DB_HOST=db
  db:</code></pre></div></div></div></section><section id="docker_compose_yml_9"><h2>üêãüêô docker compose.yml</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  apache:
    image: "my-httpd:2.4"
    ports:
      - "80:80"
    environment:
      - MIDDLE_HOST_1=middle
    volumes:
      - ./etc/httpd/workers.properties:/etc/httpd/conf/workers.properties
  middle:
    build: .
    environment:
      - DB_HOST=db
  db:
    image: "mysql:5.6"</code></pre></div></div></div></section><section id="docker_compose_yml_10"><h2>üêãüêô docker compose.yml</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  apache:
    image: "my-httpd:2.4"
    ports:
      - "80:80"
    environment:
      - MIDDLE_HOST_1=middle
    volumes:
      - ./etc/httpd/workers.properties:/etc/httpd/conf/workers.properties
  middle:
    build: .
    environment:
      - DB_HOST=db
  db:
    image: "mysql:5.6"
    ports:
      - "3306:3306"</code></pre></div></div></div></section><section id="et_apr√®s_2" data-auto-animate><h2>ü§î‚û°Ô∏è Et apr√®s ?</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker compose up -d
docker compose build
docker compose logs
docker compose stop
docker compose restart
docker compose down</code></pre></div></div></div></section><section id="ordre_de_d√©marrage" data-auto-animate><h2>üèÅüî¢ Ordre de d√©marrage</h2><div class="slide-content"><div class="paragraph"><p>L&#8217;ordre de d√©marrage fait r√©f√©rence √† la s√©quence dans laquelle les services d√©finis dans un fichier Docker Compose sont lanc√©s.</p></div></div></section><section id="ordre_de_d√©marrage_2" data-auto-animate><h2>üèÅüî¢ Ordre de d√©marrage</h2><div class="slide-content"><div class="paragraph title"><p>Pourquoi est-ce important ?</p></div>
<div class="paragraph fragment"><p>Certains services peuvent d√©pendre d&#8217;autres services pour fonctionner correctement.</p></div>
<div class="paragraph fragment"><p>Par exemple, une application web peut avoir besoin qu&#8217;une base de donn√©es soit op√©rationnelle avant de pouvoir d√©marrer.</p></div></div></section><section id="ordre_de_d√©marrage_3" data-auto-animate><h2>üèÅüî¢ Ordre de d√©marrage</h2><div class="slide-content"><div class="paragraph title"><p>Comment Docker Compose g√®re-t-il l&#8217;ordre de d√©marrage ?</p></div>
<div class="paragraph fragment"><p>Par d√©faut, Docker Compose d√©marre les services dans l&#8217;ordre dans lequel ils sont d√©finis dans le fichier Docker Compose.</p></div>
<div class="paragraph fragment"><p>Cependant, cela ne garantit pas que les services d√©pendants seront pr√™ts √† √™tre utilis√©s lorsque les services qui en d√©pendent seront lanc√©s.</p></div></div></section><section id="ordre_de_d√©marrage_4" data-auto-animate><h2>üèÅüî¢ Ordre de d√©marrage</h2><div class="slide-content"><div class="paragraph title"><p>Comment g√©rer les d√©pendances entre services ?</p></div>
<div class="paragraph fragment"><p>Docker Compose offre deux directives pour g√©rer les d√©pendances entre services : <code>depends_on</code> et <code>healthcheck</code>.</p></div>
<div class="ulist"><ul><li class="fragment"><p><code>depends_on</code> : Cette directive peut √™tre utilis√©e pour indiquer qu&#8217;un service d√©pend d&#8217;un autre service.
Cependant, cela ne garantit pas que le service d√©pendant sera pr√™t √† √™tre utilis√© lorsque le service qui en d√©pend sera lanc√©.</p></li><li class="fragment"><p><code>healthcheck</code> : Cette directive peut √™tre utilis√©e pour v√©rifier l&#8217;√©tat de sant√© d&#8217;un service.
En combinaison avec <code>depends_on</code>, elle peut aider √† s&#8217;assurer qu&#8217;un service est pr√™t √† √™tre utilis√© avant de lancer les services qui en d√©pendent.</p></li></ul></div></div></section><section id="ordre_de_d√©marrage_5" data-auto-animate><h2>üèÅüî¢ Ordre de d√©marrage</h2><div class="slide-content"><div class="paragraph title"><p>Exemple
Voici un exemple de fichier Docker Compose qui utilise <code>depends_on</code> et <code>healthcheck</code> pour g√©rer l&#8217;ordre de d√©marrage des services :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">version: '3'
services:
  web:
    build: .
    depends_on:
      db:
        condition: service_healthy
  db:
    image: postgres
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 30s
      timeout: 30s
      retries: 3</code></pre></div></div>
<div class="paragraph fragment"><p>Dans cet exemple, le service web d√©pend du service db.
Le service db est v√©rifi√© toutes les 30 secondes pour s&#8217;assurer qu&#8217;il est pr√™t √† √™tre utilis√©.
Le service web ne sera lanc√© que lorsque le service db sera en bonne sant√©.</p></div></div></section><section id="ordre_de_d√©marrage_conditions" data-auto-animate><h2>üèÅüî¢ Ordre de d√©marrage‚ùìü§î Conditions.</h2><div class="slide-content"><div class="admonitionblock warning"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content">Rappel:
La directive <code>depends_on</code> dans un fichier Docker Compose est utilis√©e pour indiquer qu&#8217;un service d√©pend d&#8217;un autre service.
Cela signifie que le service d√©pendant ne sera pas d√©marr√© tant que les services dont il d√©pend n&#8217;auront pas √©t√© d√©marr√©s.</td></tr></table></div></div></section><section id="ordre_de_d√©marrage_autres_conditions" data-auto-animate><h2>üèÅüî¢ Ordre de d√©marrage‚ùìü§î Autres conditions.</h2><div class="slide-content"><div class="paragraph"><p>En plus de la condition service_healthy, il existe d&#8217;autres conditions que vous pouvez utiliser avec <code>depends_on</code>:</p></div>
<div class="paragraph fragment"><p><code>service_started</code> : Cette condition signifie que le service d√©pendant ne sera pas d√©marr√© tant que le service dont il d√©pend n&#8217;aura pas √©t√© d√©marr√©.</p></div>
<div class="paragraph fragment"><p><code>service_completed_successfully</code>: Cette condition indique qu&#8217;un service d√©pendant ne doit pas d√©marrer avant qu&#8217;un autre service ait termin√© avec succ√®s. Cela peut √™tre utile dans des sc√©narios o√π un service doit effectuer une t√¢che unique qui doit √™tre termin√©e avant que d&#8217;autres services puissent d√©buter.</p></div>
<div class="paragraph fragment"><p>Cependant, cela ne garantit pas que le service dont il d√©pend est pr√™t √† √™tre utilis√©.</p></div></div></section><section id="ordre_de_d√©marrage_autre_condition" data-auto-animate><h2>üèÅüî¢ Ordre de d√©marrage‚ùìü§î Autre condition.</h2><div class="slide-content"><div class="paragraph"><p>Voici un exemple de comment vous pourriez utiliser <code>service_started</code> dans un fichier Docker Compose :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">version: '3'
services:
  web:
    build: .
    depends_on:
      db:
        condition: service_started
  db:
    image: postgres</code></pre></div></div>
<div class="paragraph fragment"><p>Dans cet exemple, le service <code>web</code> ne sera d√©marr√© que lorsque le service <code>db</code> aura √©t√© d√©marr√©.</p></div></div></section><section id="ordre_de_d√©marrage_healthcheck" data-auto-animate><h2>üèÅüî¢ Ordre de d√©marrage &amp; ü©∫‚úÖ healthcheck</h2><div class="slide-content"><div class="admonitionblock warning"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content">Rappel
<code>healthcheck</code> est une instruction dans un <code>Dockerfile</code> qui permet de v√©rifier l&#8217;√©tat de sant√© d&#8217;un service.
Il peut √™tre utilis√© pour d√©terminer si un service est pr√™t √† √™tre utilis√© ou non.</td></tr></table></div>
<div class="paragraph fragment"><p>Voici un exemple de <code>healthcheck</code> dans un <code>Dockerfile</code> :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM postgres
HEALTHCHECK --interval=5m --timeout=3s \
  CMD pg_isready -U postgres || exit 1</code></pre></div></div>
<div class="paragraph fragment"><p>Dans cet exemple, <code>pg_isready -U postgres</code> est la commande utilis√©e pour v√©rifier l&#8217;√©tat de sant√© du service.
Si cette commande r√©ussit, le service est consid√©r√© comme sain.
Sinon, il est consid√©r√© comme malsain.</p></div></div></section><section id="ordre_de_d√©marrage_healthcheck_2" data-auto-animate><h2>üèÅüî¢ Ordre de d√©marrage &amp; ü©∫‚úÖ healthcheck</h2><div class="slide-content"><div class="admonitionblock warning"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content">Rappel
<code>depends_on</code> est une directive dans un fichier Docker Compose qui indique qu&#8217;un service d√©pend d&#8217;un autre service.
Il peut √™tre utilis√© pour contr√¥ler l&#8217;ordre de d√©marrage des services.</td></tr></table></div>
<div class="paragraph fragment"><p>Voici un exemple de depends_on dans un fichier Docker Compose :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">version: '3'
services:
  web:
    build: .
    depends_on:
      db:
        condition: service_healthy
  db:
    image: postgres</code></pre></div></div>
<div class="paragraph fragment"><p>Dans cet exemple, le service <code>web</code> d√©pend du service <code>db</code>.
Le service web ne sera d√©marr√© que lorsque le service db sera en bonne sant√©.</p></div></div></section><section id="comment_healthcheck_et_depends_on_travaillent_ensemble" data-auto-animate><h2>üèÅüî¢ ü©∫‚úÖ Comment healthcheck et depends_on travaillent ensemble ?</h2><div class="slide-content"><div class="paragraph title"><p>En combinant <code>healthcheck</code> et <code>depends_on</code>, vous pouvez contr√¥ler l&#8217;ordre de d√©marrage des services en fonction de leur √©tat de sant√©.
Par exemple, vous pouvez vous assurer qu&#8217;un service de base de donn√©es est pr√™t √† √™tre utilis√© avant de d√©marrer une application web qui en d√©pend.</p></div></div></section><section id="ordre_de_d√©marrage_pour_r√©sumer" data-auto-animate><h2>üèÅüî¢ Ordre de d√©marrage üìäüìù Pour r√©sumer</h2><div class="slide-content"><div class="paragraph"><p>L&#8217;ordre de d√©marrage fait r√©f√©rence √† la s√©quence dans laquelle les services d√©finis dans un fichier Docker Compose sont lanc√©s.
Par d√©faut, Docker Compose d√©marre les services dans l&#8217;ordre dans lequel ils sont d√©finis dans le fichier Docker Compose.</p></div>
<div class="paragraph fragment"><p>Docker Compose offre deux directives pour g√©rer les d√©pendances entre services : <code>depends_on</code> et <code>healthcheck</code>.</p></div></div></section><section id="ordre_de_d√©marrage_pour_r√©sumer_2" data-auto-animate><h2>üèÅüî¢ Ordre de d√©marrage üìäüìù Pour r√©sumer</h2><div class="slide-content"><div class="ulist"><ul><li><p><code>depends_on</code> : Cette directive peut √™tre utilis√©e pour indiquer qu&#8217;un service d√©pend d&#8217;un autre service. Elle peut √™tre utilis√©e avec deux conditions : <code>service_started</code> et <code>service_healthy</code>.</p></li><li><p><code>service_started</code> : Cette condition signifie que le service d√©pendant ne sera pas d√©marr√© tant que le service dont il d√©pend n&#8217;aura pas √©t√© d√©marr√©. Cependant, cela ne garantit pas que le service dont il d√©pend est pr√™t √† √™tre utilis√©.</p></li><li><p><code>service_healthy</code> : Cette condition est utilis√©e avec la directive healthcheck dans un Dockerfile pour v√©rifier l&#8217;√©tat de sant√© d&#8217;un service. Si la commande healthcheck r√©ussit, Docker consid√®re le service comme sain. Sinon, il est consid√©r√© comme malsain.</p></li></ul></div></div></section><section id="ordre_de_d√©marrage_pour_r√©sumer_3" data-auto-animate><h2>üèÅüî¢ Ordre de d√©marrage üìäüìù Pour r√©sumer</h2><div class="slide-content"><div class="paragraph title"><p>Exemple
Voici un exemple de fichier Docker Compose qui utilise depends_on et healthcheck pour g√©rer l&#8217;ordre de d√©marrage des services :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">version: '3'
services:
  web:
    build: .
    depends_on:
      db:
        condition: service_healthy
  db:
    image: postgres
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 30s
      timeout: 30s
      retries: 3</code></pre></div></div></div></section><section id="√©tude_de_cas" data-auto-animate><h2>üèÅüî¢ √âtude de cas üìöüîç</h2><div class="slide-content"><div class="paragraph"><p>Un exemple de fichier docker-compose.yml utilis√© dans Jenkins:</p></div>
<div class="paragraph"><p><a href="https://raw.githubusercontent.com/jenkins-docs/quickstart-tutorials/refs/heads/main/docker-compose.yaml" class="bare">https://raw.githubusercontent.com/jenkins-docs/quickstart-tutorials/refs/heads/main/docker-compose.yaml</a></p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">sidekick_service:
    # Configuration for the sidekick service
    image: ${DOCKERHUB_USERNAME}/jenkinsci-tutorials:sidekick_
    stdin_open: true
    tty: true
    entrypoint: sh -c "/usr/local/bin/keygen.sh /ssh-dir"  # Runs the keygen.sh script and specifies the output directory
    volumes:
      - agent-ssh-dir:/ssh-dir  # Mounts the agent-ssh-dir volume to the /ssh-dir path inside the container
    healthcheck:
      test: [ "CMD-SHELL", "[ -f /ssh-dir/conductor_ok ] || exit 1" ]  # Checks if the conductor_ok file exists in the /ssh-dir path
      interval: 5s
      timeout: 10s
      retries: 5</code></pre></div></div>
<div class="paragraph fragment"><p>Les options <code>stdin_open: true</code> et <code>tty: true</code> sont utilis√©es pour garder l&#8217;entr√©e standard du conteneur ouverte et pour allouer un pseudo-TTY au conteneur, respectivement.
C&#8217;est g√©n√©ralement fait lorsque vous voulez interagir avec le service en cours d&#8217;ex√©cution.</p></div></div></section><section id="√©tude_de_cas_2" data-auto-animate><h2>üèÅüî¢ √âtude de cas üìöüîç</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">sidekick_service:
    # Configuration for the sidekick service
    image: ${DOCKERHUB_USERNAME}/jenkinsci-tutorials:sidekick_
    stdin_open: true
    tty: true
    entrypoint: sh -c "/usr/local/bin/keygen.sh /ssh-dir"  # Runs the keygen.sh script and specifies the output directory
    volumes:
      - agent-ssh-dir:/ssh-dir  # Mounts the agent-ssh-dir volume to the /ssh-dir path inside the container
    healthcheck:
      test: [ "CMD-SHELL", "[ -f /ssh-dir/conductor_ok ] || exit 1" ]  # Checks if the conductor_ok file exists in the /ssh-dir path
      interval: 5s
      timeout: 10s
      retries: 5</code></pre></div></div>
<div class="ulist"><ul><li><p>La directive <code>entrypoint</code> est utilis√©e pour sp√©cifier la commande qui sera ex√©cut√©e lorsque le conteneur d√©marre.</p></li><li><p>Dans ce cas, elle ex√©cute une commande shell qui ex√©cute un script nomm√© <code>keygen.sh</code> situ√© √† <code>/usr/local/bin/keygen.sh</code>.</p></li><li><p>Le script re√ßoit un argument <code>/ssh-dir</code>, qui est le r√©pertoire o√π le script effectuera ses op√©rations.</p></li></ul></div></div></section><section id="√©tude_de_cas_3" data-auto-animate><h2>üèÅüî¢ √âtude de cas üìöüîç</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">sidekick_service:
    # Configuration for the sidekick service
    image: ${DOCKERHUB_USERNAME}/jenkinsci-tutorials:sidekick_
    stdin_open: true
    tty: true
    entrypoint: sh -c "/usr/local/bin/keygen.sh /ssh-dir"  # Runs the keygen.sh script and specifies the output directory
    volumes:
      - agent-ssh-dir:/ssh-dir  # Mounts the agent-ssh-dir volume to the /ssh-dir path inside the container
    healthcheck:
      test: [ "CMD-SHELL", "[ -f /ssh-dir/conductor_ok ] || exit 1" ]  # Checks if the conductor_ok file exists in the /ssh-dir path
      interval: 5s
      timeout: 10s
      retries: 5</code></pre></div></div>
<div class="ulist"><ul><li class="fragment"><p>La directive volumes est utilis√©e pour monter un volume nomm√© <code>agent-ssh-dir</code> sur le chemin <code>/ssh-dir</code> √† l&#8217;int√©rieur du conteneur.</p></li><li class="fragment"><p>Cela permet de conserver les donn√©es entre les red√©marrages du conteneur et peut √©galement √™tre utilis√© pour partager des donn√©es entre les conteneurs.</p></li></ul></div></div></section><section id="√©tude_de_cas_4" data-auto-animate><h2>üèÅüî¢ √âtude de cas üìöüîç</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">sidekick_service:
    # Configuration for the sidekick service
    image: ${DOCKERHUB_USERNAME}/jenkinsci-tutorials:sidekick_
    stdin_open: true
    tty: true
    entrypoint: sh -c "/usr/local/bin/keygen.sh /ssh-dir"  # Runs the keygen.sh script and specifies the output directory
    volumes:
      - agent-ssh-dir:/ssh-dir  # Mounts the agent-ssh-dir volume to the /ssh-dir path inside the container
    healthcheck:
      test: [ "CMD-SHELL", "[ -f /ssh-dir/conductor_ok ] || exit 1" ]  # Checks if the conductor_ok file exists in the /ssh-dir path
      interval: 5s
      timeout: 10s
      retries: 5</code></pre></div></div>
<div class="ulist"><ul><li class="fragment"><p>Enfin, un healthcheck est d√©fini pour le service. Il s&#8217;agit d&#8217;une commande que Docker ex√©cutera √† l&#8217;int√©rieur du conteneur pour v√©rifier sa sant√©.</p></li><li class="fragment"><p>Dans ce cas, la commande v√©rifie si un fichier nomm√© <code>conductor_ok</code> existe dans le r√©pertoire <code>/ssh-dir</code>.</p></li><li class="fragment"><p>Si le fichier existe, la commande r√©ussit et Docker consid√®re le service comme sain.</p></li><li class="fragment"><p>Si le fichier n&#8217;existe pas, la commande √©choue et Docker consid√®re le service comme malsain.</p></li><li class="fragment"><p>Docker ex√©cutera cette v√©rification de sant√© toutes les 5 secondes (<code>interval: 5s</code>), et si elle ne r√©pond pas dans les 10 secondes (<code>timeout: 10s</code>), Docker la consid√©rera comme un √©chec. Docker r√©essaiera une v√©rification de sant√© √©chou√©e 5 fois (<code>retries: 5</code>) avant de consid√©rer le service comme malsain.</p></li></ul></div></div></section><section id="√©tude_de_cas_5" class="columns" data-auto-animate><h2>üèÅüî¢ √âtude de cas üìöüîç</h2><div class="slide-content"><div class="openblock column is-two-thirds"><div class="content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  sidekick_service: [...]

  jenkins_controller: [...]
    depends_on:
      sidekick_service:
        condition: service_completed_successfully  # Depends on the successful completion of the sidekick_service
    healthcheck:
      test: [ "CMD-SHELL", "[ -f /ssh-dir/conductor_ok ] || exit 1" ]  # Checks if the conductor_ok file exists in the /ssh-dir path
      interval: 5s
      timeout: 10s
      retries: 5

  default_agent: [...]
    depends_on:
      sidekick_service:
        condition: service_completed_successfully  # Depends on the successful completion of the sidekick_service
      jenkins_controller:
        condition: service_started
    healthcheck:
      test: [ "CMD-SHELL", "[ -f /home/jenkins/.ssh/authorized_keys ] || exit 1" ]  # Checks if the authorized_keys file exists in the /home/jenkins/.ssh path
      interval: 5s
      timeout: 10s
      retries: 5
    volumes:
      - agent-ssh-dir:/home/jenkins/.ssh:ro  # Mounts the agent-ssh-dir volume to the /home/jenkins/.ssh path inside the container as read-only</code></pre></div></div></div></div>
<div class="openblock column"><div class="content"><div class="ulist"><ul><li><p>Service jenkins_controller</p><div class="ulist"><ul><li class="fragment"><p>Ce service d√©pend du <code>sidekick_service</code>.</p></li><li class="fragment"><p>Il ne d√©marrera que lorsque le <code>sidekick_service</code> aura termin√© avec succ√®s.</p></li><li class="fragment"><p>C&#8217;est ce que signifie la condition <code>service_completed_successfully</code>.</p></li></ul></div></li></ul></div></div></div></div></section><section id="√©tude_de_cas_6" class="columns" data-auto-animate><h2>üèÅüî¢ √âtude de cas üìöüîç</h2><div class="slide-content"><div class="openblock column is-two-thirds"><div class="content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  sidekick_service: [...]

  jenkins_controller: [...]
    depends_on:
      sidekick_service:
        condition: service_completed_successfully  # Depends on the successful completion of the sidekick_service
    healthcheck:
      test: [ "CMD-SHELL", "[ -f /ssh-dir/conductor_ok ] || exit 1" ]  # Checks if the conductor_ok file exists in the /ssh-dir path
      interval: 5s
      timeout: 10s
      retries: 5

  default_agent: [...]
    depends_on:
      sidekick_service:
        condition: service_completed_successfully  # Depends on the successful completion of the sidekick_service
      jenkins_controller:
        condition: service_started
    healthcheck:
      test: [ "CMD-SHELL", "[ -f /home/jenkins/.ssh/authorized_keys ] || exit 1" ]  # Checks if the authorized_keys file exists in the /home/jenkins/.ssh path
      interval: 5s
      timeout: 10s
      retries: 5
    volumes:
      - agent-ssh-dir:/home/jenkins/.ssh:ro  # Mounts the agent-ssh-dir volume to the /home/jenkins/.ssh path inside the container as read-only</code></pre></div></div></div></div>
<div class="openblock column"><div class="content"><div class="paragraph"><p>Un <code>healthcheck</code> est √©galement d√©fini pour ce service.</p></div>
<div class="ulist"><ul><li class="fragment"><p>Docker v√©rifie si un fichier nomm√© <code>conductor_ok</code> existe dans le chemin <code>/ssh-dir</code>.</p></li><li class="fragment"><p>Si le fichier existe, Docker consid√®re le service comme sain.</p></li><li class="fragment"><p>Sinon, il est consid√©r√© comme malsain.</p></li></ul></div></div></div></div></section><section id="√©tude_de_cas_7" class="columns" data-auto-animate><h2>üèÅüî¢ √âtude de cas üìöüîç</h2><div class="slide-content"><div class="openblock column is-two-thirds"><div class="content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  sidekick_service: [...]

  jenkins_controller: [...]
    depends_on:
      sidekick_service:
        condition: service_completed_successfully  # Depends on the successful completion of the sidekick_service
    healthcheck:
      test: [ "CMD-SHELL", "[ -f /ssh-dir/conductor_ok ] || exit 1" ]  # Checks if the conductor_ok file exists in the /ssh-dir path
      interval: 5s
      timeout: 10s
      retries: 5

  default_agent: [...]
    depends_on:
      sidekick_service:
        condition: service_completed_successfully  # Depends on the successful completion of the sidekick_service
      jenkins_controller:
        condition: service_started
    healthcheck:
      test: [ "CMD-SHELL", "[ -f /home/jenkins/.ssh/authorized_keys ] || exit 1" ]  # Checks if the authorized_keys file exists in the /home/jenkins/.ssh path
      interval: 5s
      timeout: 10s
      retries: 5
    volumes:
      - agent-ssh-dir:/home/jenkins/.ssh:ro  # Mounts the agent-ssh-dir volume to the /home/jenkins/.ssh path inside the container as read-only</code></pre></div></div></div></div>
<div class="openblock column"><div class="content"><div class="paragraph"><p>Service <code>default_agent</code></p></div>
<div class="ulist"><ul><li class="fragment"><p>Ce service d√©pend √©galement du <code>sidekick_service</code> et du <code>jenkins_controller</code>.</p></li><li class="fragment"><p>Il ne d√©marrera que lorsque le <code>sidekick_service</code> aura termin√© avec succ√®s et que le <code>jenkins_controller</code> aura d√©marr√©.</p></li><li class="fragment"><p>C&#8217;est ce que signifient les conditions <code>service_completed_successfully</code> et <code>service_started</code>.</p></li></ul></div></div></div></div></section><section id="√©tude_de_cas_8" class="columns" data-auto-animate><h2>üèÅüî¢ √âtude de cas üìöüîç</h2><div class="slide-content"><div class="openblock column is-two-thirds"><div class="content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  sidekick_service: [...]

  jenkins_controller: [...]
    depends_on:
      sidekick_service:
        condition: service_completed_successfully  # Depends on the successful completion of the sidekick_service
    healthcheck:
      test: [ "CMD-SHELL", "[ -f /ssh-dir/conductor_ok ] || exit 1" ]  # Checks if the conductor_ok file exists in the /ssh-dir path
      interval: 5s
      timeout: 10s
      retries: 5

  default_agent: [...]
    depends_on:
      sidekick_service:
        condition: service_completed_successfully  # Depends on the successful completion of the sidekick_service
      jenkins_controller:
        condition: service_started
    healthcheck:
      test: [ "CMD-SHELL", "[ -f /home/jenkins/.ssh/authorized_keys ] || exit 1" ]  # Checks if the authorized_keys file exists in the /home/jenkins/.ssh path
      interval: 5s
      timeout: 10s
      retries: 5
    volumes:
      - agent-ssh-dir:/home/jenkins/.ssh:ro  # Mounts the agent-ssh-dir volume to the /home/jenkins/.ssh path inside the container as read-only</code></pre></div></div></div></div>
<div class="openblock column"><div class="content"><div class="paragraph"><p>Un <code>healthcheck</code> est √©galement d√©fini pour ce service.</p></div>
<div class="ulist"><ul><li class="fragment"><p>Docker v√©rifie si un fichier nomm√© <code>authorized_keys</code> existe dans le chemin <code>/home/jenkins/.ssh</code>.</p></li><li class="fragment"><p>Si le fichier existe, Docker consid√®re le service comme sain.</p></li><li class="fragment"><p>Sinon, il est consid√©r√© comme malsain.</p></li></ul></div></div></div></div></section><section id="√©tude_de_cas_9" class="columns" data-auto-animate><h2>üèÅüî¢ √âtude de cas üìöüîç</h2><div class="slide-content"><div class="openblock column is-two-thirds"><div class="content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  sidekick_service: [...]

  jenkins_controller: [...]
    depends_on:
      sidekick_service:
        condition: service_completed_successfully  # Depends on the successful completion of the sidekick_service
    healthcheck:
      test: [ "CMD-SHELL", "[ -f /ssh-dir/conductor_ok ] || exit 1" ]  # Checks if the conductor_ok file exists in the /ssh-dir path
      interval: 5s
      timeout: 10s
      retries: 5

  default_agent: [...]
    depends_on:
      sidekick_service:
        condition: service_completed_successfully  # Depends on the successful completion of the sidekick_service
      jenkins_controller:
        condition: service_started
    healthcheck:
      test: [ "CMD-SHELL", "[ -f /home/jenkins/.ssh/authorized_keys ] || exit 1" ]  # Checks if the authorized_keys file exists in the /home/jenkins/.ssh path
      interval: 5s
      timeout: 10s
      retries: 5
    volumes:
      - agent-ssh-dir:/home/jenkins/.ssh:ro  # Mounts the agent-ssh-dir volume to the /home/jenkins/.ssh path inside the container as read-only</code></pre></div></div></div></div>
<div class="openblock column"><div class="content"><div class="paragraph"><p>Enfin, un volume nomm√© <code>agent-ssh-dir</code> est mont√© sur le chemin <code>/home/jenkins/.ssh</code> √† l&#8217;int√©rieur du conteneur en lecture seule.</p></div></div></div></div></section><section id="√©tude_de_cas_10" data-auto-animate><h2>üèÅüî¢ √âtude de cas üìöüîç</h2><div class="slide-content"><div class="paragraph"><p>√Ä √©tudier au calme chez vous:</p></div>
<div class="paragraph"><p><a href="https://raw.githubusercontent.com/gounthar/MyFirstAndroidAppBuiltByJenkins/stf/jenkins/docker-compose.yml" class="bare">https://raw.githubusercontent.com/gounthar/MyFirstAndroidAppBuiltByJenkins/stf/jenkins/docker-compose.yml</a></p></div>
<div class="imageblock"><img src="media/47642838-image4.png" alt="47642838 image4"></div>
<aside class="notes"><div class="paragraph"><p>Dans le temps, on recommandait de faire un script qui attendait que le service soit d√©marr√© avant de continuer.
<a href="https://github.com/vishnubob/wait-for-it" class="bare">https://github.com/vishnubob/wait-for-it</a></p></div></aside></div></section><section id="transformer_son_application_en_docker_compose"><h2>Transformer son application en docker compose</h2><div class="slide-content"><div class="paragraph"><p>Deux approches diff√©rentes et compl√©mentaires¬†:</p></div>
<div class="ulist"><ul><li class="fragment"><p><a href="https://www.composerize.com/" class="bare">https://www.composerize.com/</a></p></li><li class="fragment"><p><a href="https://github.com/jwilder/dockerize" class="bare">https://github.com/jwilder/dockerize</a></p></li></ul></div></div></section><section id="travaux_pratiques_12"><h2>üéì Travaux pratiques #12</h2><div class="slide-content"><div class="imageblock"><img src="media/497269344-image5.png" alt="497269344 image5"></div>
<div class="paragraph"><p><a href="https://gitlab.univ-artois.fr/bruno.verachten/devops-docker-tp12.git" class="bare">https://gitlab.univ-artois.fr/bruno.verachten/devops-docker-tp12.git</a></p></div></div></section><section id="travaux_pratiques_12_bis" data-auto-animate><h2>üéì Travaux pratiques #12-BIS üî®üî•</h2><div class="slide-content"><div class="paragraph"><p>√áa vous dirait d&#8217;avoir votre propre forge Gitlab ?</p></div>
<div class="paragraph fragment"><p>üòè Non, et bien c&#8217;est parti quand m√™me.</p></div>
<div class="ulist"><ul><li class="fragment"><p>Cr√©ez un nouveau fichier appel√© <code>docker-compose.yml</code>.</p></li><li class="fragment"><p>Dans ce fichier, d√©finissez trois services : <code>gitlab</code>, <code>gitlab-runner-1</code> et <code>gitlab-runner-2</code>.</p></li><li class="fragment"><p>Pour le service <code>gitlab</code>:</p><div class="ulist"><ul><li><p>utilisez l&#8217;image <code>gitlab/gitlab-ce:latest</code> (pr√©fix√©e par le cache sp√©cifique ILI)</p></li><li><p>red√©marrez toujours le conteneur s&#8217;il s&#8217;arr√™te,</p></li><li><p>d√©finissez le nom d&#8217;h√¥te sur <code>localhost</code>,</p></li><li><p>d√©finissez l&#8217;URL externe sur <code><a href="http://localhost" class="bare">http://localhost</a></code> et exposez les ports <code>80</code>, <code>443</code> et <code>22</code>.</p></li></ul></div></li></ul></div></div></section><section id="travaux_pratiques_12_bis_2" data-auto-animate><h2>üéì Travaux pratiques #12-BIS</h2><div class="slide-content"><div class="ulist"><ul><li class="fragment"><p>Pour les services gitlab-runner-1 et gitlab-runner-2:</p><div class="ulist"><ul><li class="fragment"><p>utilisez l&#8217;image <code>gitlab/gitlab-runner:latest</code> (pr√©fix√©e par le cache sp√©cifique ILI),</p></li><li class="fragment"><p>red√©marrez toujours le conteneur s&#8217;il s&#8217;arr√™te,</p></li><li class="fragment"><p>d√©pendez du service gitlab et montez le socket Docker et le fichier de configuration de GitLab Runner.</p></li></ul></div></li><li class="fragment"><p>Cr√©ez des volumes pour:</p><div class="ulist"><ul><li class="fragment"><p>les fichiers de configuration,</p></li><li class="fragment"><p>les fichiers journaux</p></li><li class="fragment"><p>et les fichiers de donn√©es de GitLab,</p></li><li class="fragment"><p>ainsi que pour les fichiers de configuration de GitLab Runner.</p></li></ul></div></li></ul></div></div></section><section id="travaux_pratiques_12_bis_3" data-auto-animate><h2>üéì Travaux pratiques #12-BIS üî®üî•</h2><div class="slide-content"><div class="paragraph"><p>Pas assez d√©taill√©? üò®</p></div>
<div class="ulist"><ul><li class="fragment"><p>Ouvrez votre √©diteur de texte pr√©f√©r√© et cr√©ez un nouveau fichier.</p></li><li class="fragment"><p>Nommez ce fichier <code>docker-compose.yml</code>.</p></li><li class="fragment"><p>Commencez le fichier avec la ligne <code>services:</code> pour commencer √† d√©finir les services de votre application.</p></li><li class="fragment"><p>Commencez √† d√©finir votre premier service en tapant <code>gitlab:</code> sur une nouvelle ligne. Ce sera le service pour votre serveur GitLab.</p></li><li class="fragment"><p>Sous <code>gitlab:</code>, ajoutez les d√©tails de votre service.</p><div class="ulist"><ul><li class="fragment"><p>Par exemple, <code>image: 'gitlab/gitlab-ce:latest'</code> pour sp√©cifier l&#8217;image Docker √† utiliser pour ce service.</p></li></ul></div></li></ul></div></div></section><section id="travaux_pratiques_12_bis_4" data-auto-animate><h2>üéì Travaux pratiques #12-BIS üî®üî•</h2><div class="slide-content"><div class="ulist"><ul><li><p>Sous <code>gitlab:</code>, ajoutez les d√©tails de votre service.</p><div class="ulist"><ul><li><p>Par exemple, <code>image: 'gitlab/gitlab-ce:latest'</code> pour sp√©cifier l&#8217;image Docker √† utiliser pour ce service.</p></li><li><p>Continuez √† ajouter des d√©tails pour le service gitlab, comme <code>restart: always</code> pour toujours red√©marrer le conteneur s&#8217;il s&#8217;arr√™te, et <code>hostname: 'localhost'</code> pour d√©finir le nom d&#8217;h√¥te du serveur GitLab.</p></li></ul></div></li><li><p>D√©finissez l&#8217;URL externe de votre serveur GitLab en ajoutant <code>environment:</code> et <code>GITLAB_OMNIBUS_CONFIG: |</code> sur de nouvelles lignes,</p></li><li><p>puis <code>external_url 'http://localhost'</code> sur la ligne suivante.</p></li><li><p>Exposez les ports n√©cessaires en ajoutant <code>ports:</code> sur une nouvelle ligne,</p></li><li><p>puis <code>- '80:80'</code>, <code>- '443:443'</code> et <code>- '22:22'</code> sur les lignes suivantes.</p></li></ul></div></div></section><section id="travaux_pratiques_12_bis_5" data-auto-animate><h2>üéì Travaux pratiques #12-BIS üî®üî•</h2><div class="slide-content"><div class="ulist"><ul><li class="fragment"><p>Montez les volumes n√©cessaires en ajoutant <code>volumes:</code> sur une nouvelle ligne,</p><div class="ulist"><ul><li class="fragment"><p>puis <code>- 'gitlab_config:/etc/gitlab'</code>,</p></li><li class="fragment"><p><code>- 'gitlab_logs:/var/log/gitlab'</code></p></li><li class="fragment"><p>et <code>- 'gitlab_data:/var/opt/gitlab'</code> sur les lignes suivantes.</p></li></ul></div></li><li class="fragment"><p>R√©p√©tez ces √©tapes pour les services gitlab-runner-1 et gitlab-runner-2, en rempla√ßant <code>gitlab</code> par <code>gitlab-runner-1</code> et <code>gitlab-runner-2</code> respectivement.</p></li></ul></div></div></section><section id="travaux_pratiques_12_bis_6" data-auto-animate><h2>üéì Travaux pratiques #12-BIS üî®üî•</h2><div class="slide-content"><div class="ulist"><ul><li class="fragment"><p>Pour les services <code>gitlab-runner-1</code> et <code>gitlab-runner-2</code>, remplacez l&#8217;URL externe par une d√©pendance au service gitlab en ajoutant <code>depends_on:</code> sur une nouvelle ligne, puis <code>- gitlab</code> sur la ligne suivante.</p></li><li class="fragment"><p>Montez le socket Docker et le fichier de configuration de GitLab Runner</p><div class="ulist"><ul><li class="fragment"><p>en ajoutant <code>- '/var/run/docker.sock:/var/run/docker.sock'</code></p></li><li class="fragment"><p>et <code>- 'gitlab-runner-1-config:/etc/gitlab-runner'</code> (ou <code>- 'gitlab-runner-2-config:/etc/gitlab-runner'</code> pour <code>gitlab-runner-2</code>) sous <code>volumes:</code>.</p></li></ul></div></li></ul></div></div></section><section id="travaux_pratiques_12_bis_7" data-auto-animate><h2>üéì Travaux pratiques #12-BIS üî®üî•</h2><div class="slide-content"><div class="paragraph fragment"><p>Enfin, d√©finissez les volumes pour votre application en ajoutant <code>volumes:</code> sur une nouvelle ligne √† la fin de votre fichier, puis</p></div>
<div class="ulist"><ul><li class="fragment"><p><code>- gitlab_config:</code>,</p></li><li class="fragment"><p><code>- gitlab_logs:</code>,</p></li><li class="fragment"><p><code>- gitlab_data:</code>,</p></li><li class="fragment"><p><code>- gitlab-runner-1-config:</code></p></li><li class="fragment"><p>et <code>- gitlab-runner-2-config:</code> sur les lignes suivantes.</p></li></ul></div></div></section><section id="solution_travaux_pratiques_12_bis"><h2>‚úÖ Solution Travaux pratiques #12-BIS üî®üî•</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml"># This is a Docker Compose file for setting up a GitLab server and two GitLab runners.

services:
  # The GitLab server service
  gitlab:
    # The Docker image to use for the GitLab server
    image: 'gitlab/gitlab-ce:16.6.0-ce.0'
    # Always restart the container if it stops
    restart: always
    # The hostname for the GitLab server
    hostname: 'localhost'
    # Environment variables for the GitLab server
    environment:
      # Configuration for the GitLab Omnibus package
      GITLAB_OMNIBUS_CONFIG: |
        # The external URL for the GitLab server
        external_url 'http://localhost'
    # The ports to expose from the GitLab server
    ports:
      - '80:80'   # HTTP
      - '443:443' # HTTPS
      - '22:22'   # SSH
    # The volumes to mount for the GitLab server
    volumes:
      - 'gitlab_config:/etc/gitlab'       # Configuration files
      - 'gitlab_logs:/var/log/gitlab'     # Log files
      - 'gitlab_data:/var/opt/gitlab'     # Data files

  # The first GitLab runner service
  gitlab-runner-1:
    # The Docker image to use for the GitLab runner
    image: 'gitlab/gitlab-runner:alpine3.16-v16.6.0'
    # Always restart the container if it stops
    restart: always
    # The services this service depends on
    depends_on:
      - gitlab # Depends on the GitLab server
    # The volumes to mount for the GitLab runner
    volumes:
      - '/var/run/docker.sock:/var/run/docker.sock' # Docker socket for running Docker commands
      - 'gitlab-runner-1-config:/etc/gitlab-runner' # Configuration files

  # The second GitLab runner service
  gitlab-runner-2:
    # The Docker image to use for the GitLab runner
    image: 'gitlab/gitlab-runner:alpine3.16-v16.6.0'
    # Always restart the container if it stops
    restart: always
    # The services this service depends on
    depends_on:
      - gitlab # Depends on the GitLab server
    # The volumes to mount for the GitLab runner
    volumes:
      - '/var/run/docker.sock:/var/run/docker.sock' # Docker socket for running Docker commands
      - 'gitlab-runner-2-config:/etc/gitlab-runner' # Configuration files

# The volumes to create for the services
volumes:
  gitlab_config:         # Volume for GitLab server configuration files
  gitlab_logs:           # Volume for GitLab server log files
  gitlab_data:           # Volume for GitLab server data files
  gitlab-runner-1-config: # Volume for GitLab runner 1 configuration files
    name: gitlab-runner-1-config
  gitlab-runner-2-config: # Volume for GitLab runner 2 configuration files
    name: gitlab-runner-2-config</code></pre></div></div></div></section><section id="jai_ma_forge_bon_et_maintenant" class="columns" data-auto-animate><h2>üî®üî• J&#8217;ai ma forge! Bon, et maintenant? üòê</h2><div class="slide-content"><div class="imageblock column"><img src="media/when.png" alt="when" height="500px"></div>
<div class="videoblock column"><video src="media/gitlab-logs.speed.very.small.mp4" width="100%" height="loop" data-autoplay controls>Your browser does not support the video tag.</video></div></div></section><section id="jai_ma_forge_bon_et_maintenant_2" class="intellij background" data-background-video="media/2000_years_later.mp4" data-background-video-loop data-background-video-muted data-auto-animate><h2>üî®üî• J&#8217;ai ma forge! Bon, et maintenant? üòê</h2><div class="slide-content"><div class="paragraph"><p>Il va falloir se logguer, lier les runners au serveur, cr√©er un projet, etc&#8230;&#8203;</p></div></div></section><section id="jai_ma_forge_bon_et_maintenant_3" class="columns" data-auto-animate><h2>üî®üî• J&#8217;ai ma forge! Bon, et maintenant? üòê</h2><div class="slide-content"><div class="imageblock column"><img src="media/gitlab-login.png" alt="gitlab login" height="500px"></div>
<div class="openblock column"><div class="content"><div class="paragraph"><p>Pour trouver le mot de passe, il va falloir le demander gentiment √† Gitlab:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker compose -f tp12-bis.yml exec -it gitlab grep 'Password:' /etc/gitlab/initial_root_password
Password: qaPxXU+RqioolV3bAljvs2VYnyYa4jO/UYcis/UXLAk=</code></pre></div></div>
<div class="paragraph fragment"><p>Ensuite, il va falloir restreindre l&#8217;acc√®s:</p></div>
<div class="imageblock fragment"><img src="media/sign-up-restrictions.png" alt="sign up restrictions"></div></div></div></div></section><section id="jai_ma_forge_bon_et_maintenant_4" data-auto-animate><h2>üî®üî• J&#8217;ai ma forge! Bon, et maintenant? üòê</h2><div class="slide-content"><div class="paragraph"><p>Pour utiliser le runner GitLab dans GitLab, vous devez le configurer.</p></div>
<div class="ulist"><ul><li class="fragment"><p>Pour une configuration correcte, nous aurons besoin d&#8217;un jeton copi√© depuis le portail.</p></li><li class="fragment"><p>Pire que √ßa, pas un jeton, mais carr√©ment une commande √† adapter √† <code>docker compose</code>.</p></li><li class="fragment"><p>Pour ce faire, allez √† l&#8217;adresse : <a href="http://localhost/admin/runners" class="bare">http://localhost/admin/runners</a> et cliquez sur le bouton "New instance runner".</p></li><li class="fragment"><p>Choisissez "Linux".</p></li><li class="fragment"><p>"Run untagged jobs"</p></li><li class="fragment"><p>Donnez une description au runner.</p></li><li class="fragment"><p>Cliquez sur le bouton "Create runner"</p></li><li class="fragment"><p>Vous avez ensuite une commande √† copier et modifier pour <code>docker compose</code>.</p></li></ul></div></div></section><section id="jai_ma_forge_bon_et_maintenant_5" data-background-iframe="https://www.youtube.com/embed/S-npLuur6KM?rel=0&start=0&enablejsapi=1&autoplay=1&loop=1&controls=1&modestbranding=1" data-auto-animate><div class="slide-content"><aside class="notes"><div class="paragraph"><p><a href="https://youtu.be/S-npLuur6KM" class="bare">https://youtu.be/S-npLuur6KM</a></p></div></aside></div></section><section id="jai_ma_forge_bon_et_maintenant_6" data-auto-animate><h2>üî®üî• J&#8217;ai ma forge! Bon, et maintenant? üòê</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker compose -f tp12-bis.yml exec gitlab-runner-1 gitlab-runner register --url http://gitlab  --token glrt-PF5rLbUKzku5g8BL2y7J
Runtime platform                                    arch=amd64 os=linux pid=103 revision=853330f9 version=16.5.0
Running in system-mode.

Enter the GitLab instance URL (for example, https://gitlab.com/):
[http://gitlab]:
Verifying runner... is valid                        runner=PF5rLbUKz
Enter a name for the runner. This is stored only in the local config.toml file:
[3c2ee0d97d2b]: runner 1
Enter an executor: parallels, docker-autoscaler, docker+machine, custom, docker, docker-windows, shell, ssh, virtualbox, instance, kubernetes:
shell
Runner registered successfully. Feel free to start it, but if it's running already the config should be automatically reloaded!

Configuration (with the authentication token) was saved in "/etc/gitlab-runner/config.toml"</code></pre></div></div></div></section><section data-background-image="media/gitlab-runners-compose.png" data-background-size="cover" data-auto-animate></section><section id="profils_dans_docker_compose" data-auto-animate><h2>üë§ Profils dans Docker Compose üêô</h2><div class="slide-content"><div class="paragraph"><p>On a vu d√©j√† l&#8217;instruction <code>depends_on</code> dans un fichier Docker Compose.</p></div>
<div class="ulist"><ul><li class="fragment"><p>Elle permet de d√©finir des d√©pendances entre les services.</p></li><li class="fragment"><p>Mais que faire si on veut d√©finir un lot de services qui fonctionnent ensemble, sans pour autant √™tre en interd√©pendance‚ÄØ?</p></li><li class="fragment"><p>Les profils dans Docker Compose permettent de d√©finir des groupes de services qui peuvent √™tre activ√©s ou d√©sactiv√©s ensemble.</p></li><li class="fragment"><p>Cela peut √™tre utile pour g√©rer des environnements de d√©veloppement, de test et de production diff√©rents dans le m√™me fichier Docker Compose.</p></li><li class="fragment"><p>Pour d√©finir un profil pour un service, vous pouvez ajouter la cl√© <code>profiles</code> √† la d√©finition du service dans votre fichier Docker Compose.</p></li></ul></div></div></section><section id="profils_dans_docker_compose_2" data-auto-animate><h2>üë§ Profils dans Docker Compose üêô</h2><div class="slide-content"><div class="paragraph"><p>Par exemple :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  mon_service:
    image: mon_image
    profiles:
      - dev</code></pre></div></div>
<div class="paragraph fragment"><p>Dans cet exemple, le service mon_service appartient au profil dev.</p></div></div></section><section id="profils_dans_docker_compose_3" data-auto-animate><h2>üë§ Profils dans Docker Compose üêô</h2><div class="slide-content"><div class="ulist"><ul><li class="fragment"><p>Pour d√©marrer seulement les services qui appartiennent √† un certain profil, vous pouvez utiliser l&#8217;option <code>--profile</code> avec la commande <code>docker compose up</code>.</p></li><li class="fragment"><p>Par exemple :</p></li></ul></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker compose up --profile dev</code></pre></div></div>
<div class="paragraph fragment"><p>Cette commande d√©marrera seulement les services qui appartiennent au profil <code>dev</code>.</p></div></div></section><section id="profils_dans_docker_compose_4" data-auto-animate><h2>üë§ Profils dans Docker Compose üêô</h2><div class="slide-content"><div class="ulist"><ul><li class="fragment"><p>Les profils peuvent rendre votre fichier Docker Compose plus organis√© et flexible.</p></li><li class="fragment"><p>Ils vous permettent de d√©finir diff√©rents environnements dans le m√™me fichier et de choisir facilement quels services d√©marrer en fonction de vos besoins.</p></li><li class="fragment"><p>Jetons un coup d&#8217;≈ìil √† un exemple de fichier Docker Compose avec des profils :</p></li></ul></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  service_dev:
    image: mon_image_dev
    profiles:
      - dev
  service_prod:
    image: mon_image_prod
    profiles:
      - prod</code></pre></div></div>
<div class="ulist"><ul><li class="fragment"><p>Dans cet exemple, nous avons deux services : <code>service_dev</code> et <code>service_prod</code>.</p></li><li class="fragment"><p>Chacun appartient √† un profil diff√©rent.</p></li></ul></div></div></section><section id="profils_dans_docker_compose_5" data-auto-animate><h2>üë§ Profils dans Docker Compose üêô</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  service_dev:
    image: mon_image_dev
    profiles:
      - dev
  service_prod:
    image: mon_image_prod
    profiles:
      - prod</code></pre></div></div>
<div class="ulist"><ul><li class="fragment"><p>Nous pouvons choisir de d√©marrer seulement les services de d√©veloppement avec <code>docker compose up --profile dev</code>, ou uniquement les services de production avec <code>docker compose up --profile prod</code>.</p></li><li class="fragment"><p>Les profils dans Docker Compose sont un outil puissant pour g√©rer diff√©rents environnements dans le m√™me fichier Docker Compose.</p></li><li class="fragment"><p>Ils peuvent rendre votre d√©veloppement et vos tests plus efficaces et organis√©s.</p></li></ul></div></div></section><section id="une_autre_forge_√ßa_vous_dit"><h2>üî®üî• Une autre forge, √ßa vous dit? üòê</h2><div class="slide-content"><div class="paragraph fragment"><p>üòè Non, et bien, c&#8217;est parti quand m√™me.</p></div>
<div class="paragraph fragment"><p><a href="https://raw.githubusercontent.com/jenkins-docs/quickstart-tutorials/refs/heads/main/docker-compose.yaml" class="bare">https://raw.githubusercontent.com/jenkins-docs/quickstart-tutorials/refs/heads/main/docker-compose.yaml</a></p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  # Le service sidekick est responsable de la g√©n√©ration des cl√©s SSH et de la v√©rification de leur existence.
  sidekick_service:
    build: dockerfiles/sidekick/.  # Le Dockerfile pour construire l'image du service sidekick.
    stdin_open: true  # Permet au service de garder STDIN ouvert m√™me s'il n'est pas attach√©.
    tty: true  # Alloue un pseudo-TTY pour le service.
    entrypoint: sh -c "/usr/local/bin/keygen.sh /ssh-dir"  # La commande que le service ex√©cute lorsqu'il d√©marre.
    volumes:
      - agent-ssh-dir:/ssh-dir  # Monte le volume agent-ssh-dir au chemin /ssh-dir √† l'int√©rieur du conteneur.
    healthcheck:  # La commande de v√©rification de sant√© pour le service.
      test: [ "CMD-SHELL", "[ -f /ssh-dir/conductor_ok ] || exit 1" ]  # V√©rifie si le fichier conductor_ok existe dans le chemin /ssh-dir.
      interval: 5s  # Le temps entre les v√©rifications de sant√©.
      timeout: 10s  # Le temps √† attendre avant de consid√©rer que la v√©rification a √©chou√©.
      retries: 5  # Le nombre d'√©checs cons√©cutifs n√©cessaires pour consid√©rer un service comme malsain.

  # Le service jenkins_controller est responsable de la gestion des jobs et des configurations Jenkins.
  jenkins_controller:
    build: dockerfiles/.  # Le Dockerfile pour construire l'image du service jenkins_controller.
    restart: on-failure  # Le service sera red√©marr√© s'il quitte en raison d'une erreur.
    ports:
      - "8080:8080"  # Expose le port 8080 du service √† l'h√¥te.
    volumes:
      - jenkins_home:/var/jenkins_home  # Monte le volume jenkins_home au chemin /var/jenkins_home √† l'int√©rieur du conteneur.
      - agent-ssh-dir:/ssh-dir  # Monte le volume agent-ssh-dir au chemin /ssh-dir √† l'int√©rieur du conteneur.
    depends_on:  # Les services dont ce service d√©pend.
      sidekick_service:
        condition: service_completed_successfully  # Le sidekick_service doit se terminer avec succ√®s avant que ce service ne d√©marre.
    healthcheck:  # La commande de v√©rification de sant√© pour le service.
      test: [ "CMD-SHELL", "[ -f /ssh-dir/conductor_ok ] || exit 1" ]  # V√©rifie si le fichier conductor_ok existe dans le chemin /ssh-dir.
      interval: 5s  # Le temps entre les v√©rifications de sant√©.
      timeout: 10s  # Le temps √† attendre avant de consid√©rer que la v√©rification a √©chou√©.
      retries: 5  # Le nombre d'√©checs cons√©cutifs n√©cessaires pour consid√©rer un service comme malsain.

  # Le service default_agent est un agent Jenkins avec un JDK install√©.
  default_agent:
    image: jenkins/ssh-agent:5.5.0-jdk17  # L'image Docker pour le service.
    container_name: desktop-jenkins_agent-1  # Le nom du conteneur.
    depends_on:  # Les services dont ce service d√©pend.
      sidekick_service:
        condition: service_completed_successfully  # Le sidekick_service doit se terminer avec succ√®s avant que ce service ne d√©marre.
      jenkins_controller:
        condition: service_started  # Le service jenkins_controller doit d√©marrer avant que ce service ne d√©marre.
    healthcheck:  # La commande de v√©rification de sant√© pour le service.
      test: [ "CMD-SHELL", "[ -f /home/jenkins/.ssh/authorized_keys ] || exit 1" ]  # V√©rifie si le fichier authorized_keys existe dans le chemin /home/jenkins/.ssh.
      interval: 5s  # Le temps entre les v√©rifications de sant√©.
      timeout: 10s  # Le temps √† attendre avant de consid√©rer que la v√©rification a √©chou√©.
      retries: 5  # Le nombre d'√©checs cons√©cutifs n√©cessaires pour consid√©rer un service comme malsain.
    volumes:
      - agent-ssh-dir:/home/jenkins/.ssh:ro  # Monte le volume agent-ssh-dir au chemin /home/jenkins/.ssh √† l'int√©rieur du conteneur en lecture seule.

  # Le service maven est un agent Jenkins avec Maven install√©.
  maven:
    build: dockerfiles/maven/.  # Le Dockerfile pour construire l'image du service Maven.
    container_name: desktop-jenkins_agent-1  # Le nom du conteneur.
    profiles:
      - maven  # Les profils √† appliquer au service. Cela permet de personnaliser le comportement du service en fonction des besoins sp√©cifiques.
    depends_on:  # Les services dont ce service d√©pend.
      sidekick_service:
        condition: service_completed_successfully  # Le sidekick_service doit se terminer avec succ√®s avant que ce service ne d√©marre.
      jenkins_controller:
        condition: service_started  # Le service jenkins_controller doit d√©marrer avant que ce service ne d√©marre.
    healthcheck:  # La commande de v√©rification de sant√© pour le service.
      test: [ "CMD-SHELL", "[ -f /home/jenkins/.ssh/authorized_keys ] || exit 1" ]  # V√©rifie si le fichier authorized_keys existe dans le chemin /home/jenkins/.ssh.
      interval: 5s  # Le temps entre les v√©rifications de sant√©.
      timeout: 10s  # Le temps √† attendre avant de consid√©rer que la v√©rification a √©chou√©.
      retries: 5  # Le nombre d'√©checs cons√©cutifs n√©cessaires pour consid√©rer un service comme malsain.
    volumes:
      - agent-ssh-dir:/home/jenkins/.ssh:ro  # Monte le volume agent-ssh-dir au chemin /home/jenkins/.ssh √† l'int√©rieur du conteneur en lecture seule.

  # Le service python est un agent Jenkins avec Python install√©.
  python:
    build: dockerfiles/python/.  # Le Dockerfile pour construire l'image du service Python.
    container_name: desktop-jenkins_agent-1  # Le nom du conteneur.
    profiles:
      - python  # Les profils √† appliquer au service. Cela permet de personnaliser le comportement du service en fonction des besoins sp√©cifiques.
    depends_on:  # Les services dont ce service d√©pend.
      sidekick_service:
        condition: service_completed_successfully  # Le sidekick_service doit se terminer avec succ√®s avant que ce service ne d√©marre.
      jenkins_controller:
        condition: service_started  # Le service jenkins_controller doit d√©marrer avant que ce service ne d√©marre.
    healthcheck:  # La commande de v√©rification de sant√© pour le service.
      test: [ "CMD-SHELL", "[ -f /home/jenkins/.ssh/authorized_keys ] || exit 1" ]  # V√©rifie si le fichier authorized_keys existe dans le chemin /home/jenkins/.ssh.
      interval: 5s  # Le temps entre les v√©rifications de sant√©.
      timeout: 10s  # Le temps √† attendre avant de consid√©rer que la v√©rification a √©chou√©.
      retries: 5  # Le nombre d'√©checs cons√©cutifs n√©cessaires pour consid√©rer un service comme malsain.
    volumes:
      - agent-ssh-dir:/home/jenkins/.ssh:ro  # Monte le volume agent-ssh-dir au chemin /home/jenkins/.ssh √† l'int√©rieur du conteneur en lecture seule.

  # Le service node est un agent Jenkins avec Node.js install√©.
  node:
    build: dockerfiles/node/.  # Le Dockerfile pour construire l'image du service Node.js.
    environment:
      - GITPOD_WORKSPACE_URL=${GITPOD_WORKSPACE_URL}  # Les variables d'environnement pour le service.
    container_name: desktop-jenkins_agent-1  # Le nom du conteneur.
    profiles:
      - node  # Les profils √† appliquer au service. Cela permet de personnaliser le comportement du service en fonction des besoins sp√©cifiques.
    depends_on:  # Les services dont ce service d√©pend.
      sidekick_service:
        condition: service_completed_successfully  # Le sidekick_service doit se terminer avec succ√®s avant que ce service ne d√©marre.
      jenkins_controller:
        condition: service_started  # Le service jenkins_controller doit d√©marrer avant que ce service ne d√©marre.
    ports:
      - "3000:3000"  # Expose le port 3000 du service √† l'h√¥te.
    healthcheck:  # La commande de v√©rification de sant√© pour le service.
      test: [ "CMD-SHELL", "[ -f /home/jenkins/.ssh/authorized_keys ] || exit 1" ]  # V√©rifie si le fichier authorized_keys existe dans le chemin /home/jenkins/.ssh.
      interval: 5s  # Le temps entre les v√©rifications de sant√©.
      timeout: 10s  # Le temps √† attendre avant de consid√©rer que la v√©rification a √©chou√©.
      retries: 5  # Le nombre d'√©checs cons√©cutifs n√©cessaires pour consid√©rer un service comme malsain.
    volumes:
      - agent-ssh-dir:/home/jenkins/.ssh:ro  # Monte le volume agent-ssh-dir au chemin /home/jenkins/.ssh √† l'int√©rieur du conteneur en lecture seule.

  # Le service multi_jenkins_controller est un contr√¥leur Jenkins pour g√©rer plusieurs jobs et configurations Jenkins.
  multi_jenkins_controller:
    build: 06_multibranch_pipeline/dockerfiles/.  # Le Dockerfile pour construire l'image du service multi Jenkins controller.
    restart: on-failure  # Le service sera red√©marr√© s'il quitte en raison d'une erreur.
    ports:
      - "8080:8080"  # Expose le port 8080 du service √† l'h√¥te.
    volumes:
      - jenkins_home:/var/jenkins_home  # Monte le volume jenkins_home au chemin /var/jenkins_home √† l'int√©rieur du conteneur.
      - agent-ssh-dir:/ssh-dir  # Monte le volume agent-ssh-dir au chemin /ssh-dir √† l'int√©rieur du conteneur.
    depends_on:  # Les services dont ce service d√©pend.
      sidekick_service:
        condition: service_completed_successfully  # Le sidekick_service doit se terminer avec succ√®s avant que ce service ne d√©marre.
    healthcheck:  # La commande de v√©rification de sant√© pour le service.
      test: [ "CMD-SHELL", "[ -f /ssh-dir/conductor_ok ] || exit 1" ]  # V√©rifie si le fichier conductor_ok existe dans le chemin /ssh-dir.
      interval: 5s  # Le temps entre les v√©rifications de sant√©.
      timeout: 10s  # Le temps √† attendre avant de consid√©rer que la v√©rification a √©chou√©.
      retries: 5  # Le nombre d'√©checs cons√©cutifs n√©cessaires pour consid√©rer un service comme malsain.

  # Le service multi est un agent Jenkins pour g√©rer plusieurs jobs et configurations Jenkins.
  multi:
    build: 06_multibranch_pipeline/dockerfiles/agent/.  # Le Dockerfile pour construire l'image du service multi Jenkins agent.
    environment:
      - GITPOD_WORKSPACE_URL=${GITPOD_WORKSPACE_URL}  # Les variables d'environnement pour le service.
    container_name: desktop-jenkins_agent-1  # Le nom du conteneur.
    profiles:
      - multi  # Les profils √† appliquer au service. Cela permet de personnaliser le comportement du service en fonction des besoins sp√©cifiques.
    depends_on:  # Les services dont ce service d√©pend.
      sidekick_service:
        condition: service_completed_successfully  # Le sidekick_service doit se terminer avec succ√®s avant que ce service ne d√©marre.
      multi_jenkins_controller:
        condition: service_started  # Le service multi_jenkins_controller doit d√©marrer avant que ce service ne d√©marre.
    ports:
      - "3000:3000"  # Expose le port 3000 du service √† l'h√¥te.
      - "5000:5000"  # Expose le port 5000 du service √† l'h√¥te.
    healthcheck:  # La commande de v√©rification de sant√© pour le service.
      test: [ "CMD-SHELL", "[ -f /home/jenkins/.ssh/authorized_keys ] || exit 1" ]  # V√©rifie si le fichier authorized_keys existe dans le chemin /home/jenkins/.ssh.
      interval: 5s  # Le temps entre les v√©rifications de sant√©.
      timeout: 10s  # Le temps √† attendre avant de consid√©rer que la v√©rification a √©chou√©.
      retries: 5  # Le nombre d'√©checs cons√©cutifs n√©cessaires pour consid√©rer un service comme malsain.
    volumes:
      - agent-ssh-dir:/home/jenkins/.ssh:ro  # Monte le volume agent-ssh-dir au chemin /home/jenkins/.ssh √† l'int√©rieur du conteneur en lecture seule.

# Les volumes utilis√©s par les services.
volumes:
  jenkins_home:  # Un volume pour stocker les donn√©es de Jenkins.
  agent-ssh-dir:  # Un volume pour stocker les cl√©s SSH.
    name: agent-ssh-dir  # Le nom du volume.</code></pre></div></div></div></section><section id="une_autre_forge_√ßa_vous_dit_2"><h2>üî®üî• Une autre forge, √ßa vous dit? üòê</h2><div class="slide-content"><div class="paragraph"><p>Indigeste? üò®</p></div>
<div class="paragraph fragment"><p>Ne relevons que les points importants:</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">  # Le service maven est un agent Jenkins avec Maven install√©.
  maven:
    build: dockerfiles/maven/.  # Le Dockerfile pour construire l'image du service Maven.
    container_name: desktop-jenkins_agent-1  # Le nom du conteneur.
    profiles:
      - maven  # Les profils √† appliquer au service. Cela permet de personnaliser le comportement du service en fonction des besoins sp√©cifiques.
    depends_on:  # Les services dont ce service d√©pend.
      sidekick_service:
        condition: service_completed_successfully  # Le sidekick_service doit se terminer avec succ√®s avant que ce service ne d√©marre.
      jenkins_controller:
        condition: service_started  # Le service jenkins_controller doit d√©marrer avant que ce service ne d√©marre.
    healthcheck:  # La commande de v√©rification de sant√© pour le service.
      test: [ "CMD-SHELL", "[ -f /home/jenkins/.ssh/authorized_keys ] || exit 1" ]  # V√©rifie si le fichier authorized_keys existe dans le chemin /home/jenkins/.ssh.
      interval: 5s  # Le temps entre les v√©rifications de sant√©.
      timeout: 10s  # Le temps √† attendre avant de consid√©rer que la v√©rification a √©chou√©.
      retries: 5  # Le nombre d'√©checs cons√©cutifs n√©cessaires pour consid√©rer un service comme malsain.
    volumes:
      - agent-ssh-dir:/home/jenkins/.ssh:ro  # Monte le volume agent-ssh-dir au chemin /home/jenkins/.ssh √† l'int√©rieur du conteneur en lecture seule.</code></pre></div></div></div></section><section id="une_autre_forge_√ßa_vous_dit_3" data-auto-animate><h2>üî®üî• Une autre forge, √ßa vous dit? üòê</h2><div class="slide-content"><div class="paragraph"><p>Maven</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM jenkins/ssh-agent:6.10.0-jdk17 as ssh-agent

# ca-certificates because curl will need it later on for the maven installation
RUN apt-get update &amp;&amp; apt-get install -y --no-install-recommends ca-certificates curl &amp;&amp; apt-get clean &amp;&amp; \
  rm -rf /var/lib/apt/lists/*

# Now time to install maven
ARG MAVEN_VERSION=3.9.2

# Set SHELL flags for RUN commands to allow -e and pipefail
# Rationale:https://github.com/hadolint/hadolint/wiki/DL4006
SHELL ["/bin/bash", "-eo", "pipefail", "-c"]

# Add a checksum for the maven binary
RUN curl -sS -L -O --output-dir /tmp/ --create-dirs  https://archive.apache.org/dist/maven/maven-3/${MAVEN_VERSION}/binaries/apache-maven-${MAVEN_VERSION}-bin.tar.gz \
    &amp;&amp; printf "%s" "$(sha512sum /tmp/apache-maven-${MAVEN_VERSION}-bin.tar.gz)" | sha512sum -c - \
    &amp;&amp; curl -sS -L -O --output-dir /tmp/ --create-dirs  https://downloads.apache.org/maven/maven-3/${MAVEN_VERSION}/binaries/apache-maven-${MAVEN_VERSION}-bin.tar.gz.sha512 \
    &amp;&amp; printf "%s /tmp/apache-maven-${MAVEN_VERSION}-bin.tar.gz" "$(cat /tmp/apache-maven-${MAVEN_VERSION}-bin.tar.gz.sha512)" | sha512sum --check --status - \
    &amp;&amp; tar xzf "/tmp/apache-maven-${MAVEN_VERSION}-bin.tar.gz" -C /opt/ \
    &amp;&amp; rm "/tmp/apache-maven-${MAVEN_VERSION}-bin.tar.gz" \
    &amp;&amp; ln -s /opt/apache-maven-${MAVEN_VERSION} /opt/maven \
    &amp;&amp; ln -s /opt/maven/bin/mvn /usr/bin/mvn \
    &amp;&amp; mkdir -p /etc/profile.d \
    &amp;&amp; echo "export JAVA_HOME=$JAVA_HOME \n \
             export M2_HOME=/opt/maven \n \
             export PATH=${M2_HOME}/bin:${PATH}" &gt; /etc/profile.d/maven.sh
ENV M2_HOME="/opt/maven"
ENV PATH="${M2_HOME}/bin/:${PATH}"
RUN echo "PATH=${PATH}" &gt;&gt; /etc/environment &amp;&amp; chown -R jenkins:jenkins "${JENKINS_AGENT_HOME}"</code></pre></div></div></div></section><section id="une_autre_forge_√ßa_vous_dit_4" data-auto-animate><h2>üî®üî• Une autre forge, √ßa vous dit? üòê</h2><div class="slide-content"><div class="paragraph"><p>Python</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">  # Le service python est un agent Jenkins avec Python install√©.
  python:
    build: dockerfiles/python/.  # Le Dockerfile pour construire l'image du service Python.
    container_name: desktop-jenkins_agent-1  # Le nom du conteneur.
    profiles:
      - python  # Les profils √† appliquer au service. Cela permet de personnaliser le comportement du service en fonction des besoins sp√©cifiques.
    depends_on:  # Les services dont ce service d√©pend.
      sidekick_service:
        condition: service_completed_successfully  # Le sidekick_service doit se terminer avec succ√®s avant que ce service ne d√©marre.
      jenkins_controller:
        condition: service_started  # Le service jenkins_controller doit d√©marrer avant que ce service ne d√©marre.
    healthcheck:  # La commande de v√©rification de sant√© pour le service.
      test: [ "CMD-SHELL", "[ -f /home/jenkins/.ssh/authorized_keys ] || exit 1" ]  # V√©rifie si le fichier authorized_keys existe dans le chemin /home/jenkins/.ssh.
      interval: 5s  # Le temps entre les v√©rifications de sant√©.
      timeout: 10s  # Le temps √† attendre avant de consid√©rer que la v√©rification a √©chou√©.
      retries: 5  # Le nombre d'√©checs cons√©cutifs n√©cessaires pour consid√©rer un service comme malsain.
    volumes:
      - agent-ssh-dir:/home/jenkins/.ssh:ro  # Monte le volume agent-ssh-dir au chemin /home/jenkins/.ssh √† l'int√©rieur du conteneur en lecture seule.</code></pre></div></div></div></section><section id="une_autre_forge_√ßa_vous_dit_5" data-auto-animate><h2>üî®üî• Une autre forge, √ßa vous dit? üòê</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile"># Use the base image
FROM jenkins/ssh-agent:5.12.0-jdk17 as ssh-agent

# Install necessary Dependencies
RUN apt-get update &amp;&amp; apt-get install -y --no-install-recommends \
    binutils ca-certificates curl git python3 python3-pip python3-setuptools python3-wheel python3-dev wget

# Create an alias for python3 as python
RUN ln -s /usr/bin/python3 /usr/bin/python

# Install required python packages
RUN pip install docker-py feedparser nosexcover prometheus_client pycobertura pylint pytest pytest-cov requests setuptools sphinx pyinstaller

# Add the Jenkins agent user to the environment
RUN echo "PATH=${PATH}" &gt;&gt; /etc/environment

# Set ownership for Jenkins agent home directory
RUN chown -R jenkins:jenkins "${JENKINS_AGENT_HOME}"</code></pre></div></div></div></section><section id="une_autre_forge_√ßa_vous_dit_6" data-auto-animate><h2>üî®üî• Une autre forge, √ßa vous dit? üòê</h2><div class="slide-content"><div class="paragraph"><p>√Ä vous maintenant!</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">git clone https://github.com/jenkins-docs/quickstart-tutorials.git</code></pre></div></div>
<div class="paragraph fragment"><p>√Ä vous de modifier les sources de fa√ßon √† passer par le cache ILI</p></div>
<div class="paragraph fragment"><p>Ensuite, ne restera qu&#8217;√† lancer la "forge":</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker compose up --build -d --force-recreate maven</code></pre></div></div>
<div class="paragraph fragment"><p>Ou encore si vous voulez tout construire localement:</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker compose -f build-docker-compose.yaml up --build -d --force-recreate maven</code></pre></div></div></div></section><section data-background-image="media/jenkins-compose.png" data-background-size="cover" data-auto-animate></section><section id="autre_√©tude_de_cas" data-auto-animate><h2>Autre √©tude de cas üìöüîç</h2><div class="slide-content"><div class="paragraph"><p>Et pourquoi pas s&#8217;attaquer au docker compose qui a g√©n√©r√© ce cours‚ÄØ?</p></div></div></section><section id="autre_√©tude_de_cas_2" data-auto-animate><h2>Autre √©tude de cas üìöüîç</h2><div class="slide-content"><div class="paragraph"><p>Et pourquoi pas s&#8217;attaquer au docker compose qui a g√©n√©r√© ce cours‚ÄØ?</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml"># Ceci est un fichier Docker Compose pour un projet qui comprend plusieurs services.

# 'x-slides-base' est une ancre YAML qui d√©finit une configuration commune pour plusieurs services.
x-slides-base: &amp;slides-base
  # La configuration de construction pour l'image Docker.
  build:
    # Le contexte de construction est le r√©pertoire courant.
    context: ./
    args:
      # Active la fonction de mise en cache en ligne de Docker BuildKit.
      BUILDKIT_INLINE_CACHE: 1
  # Variables d'environnement pour le conteneur Docker.
  environment:
    - PRESENTATION_URL=${PRESENTATION_URL}
    - REPOSITORY_URL=${REPOSITORY_URL}
  # L'ID utilisateur qui ex√©cute les commandes √† l'int√©rieur du conteneur.
  user: ${CURRENT_UID}
  # Un montage tmpfs pour des op√©rations d'E/S plus rapides.
  tmpfs:
    - ${BUILD_DIR}
  # Volumes pour le conteneur Docker.
  volumes:
    - ./content:/app/content
    - ./assets:/app/assets
    - ${DIST_DIR}:/app/dist
    - ./gulp/gulpfile.js:/app/gulpfile.js
    - ./gulp/tasks:/app/tasks
    - ./npm-packages:/app/npm-packages

# Les services qui composent l'application.
services:
  # Le service 'serve'.
  serve:
    # Utilise la configuration commune d√©finie par l'ancre 'x-slides-base'.
    &lt;&lt;: *slides-base
    # Expose le port 8000 du conteneur √† l'h√¥te.
    ports:
      - "8000:8000"

  # Le service 'build'.
  build:
    &lt;&lt;: *slides-base
    # Ce service d√©pend du service 'qrcode'.
    depends_on:
      qrcode:
        # Le service 'qrcode' doit se terminer avec succ√®s avant que ce service ne d√©marre.
        condition: service_completed_successfully
    # Le point d'entr√©e pour le conteneur Docker.
    entrypoint: &gt;
      sh -xc 'gulp build &amp;&amp; cp -r "${BUILD_DIR}"/* /app/dist/'

  # Le service 'qrcode'.
  qrcode:
    &lt;&lt;: *slides-base
    # Le point d'entr√©e pour le conteneur Docker.
    entrypoint: /app/node_modules/.bin/qrcode
    # La commande √† ex√©cuter dans le conteneur Docker.
    command: &gt;
      -t png -o /app/content/media/qrcode.png ${PRESENTATION_URL}

  # Le service 'pdf'.
  pdf:
    # L'image Docker pour ce service.
    image: ghcr.io/astefanutti/decktape:3.7.0
    # Ce service d√©pend du service 'build'.
    depends_on:
      build:
        # Le service 'build' doit se terminer avec succ√®s avant que ce service ne d√©marre.
        condition: service_completed_successfully
    # L'ID utilisateur qui ex√©cute les commandes √† l'int√©rieur du conteneur.
    user: ${CURRENT_UID}
    # Volumes pour le conteneur Docker.
    volumes:
      - ${DIST_DIR}:/slides
    # La commande √† ex√©cuter dans le conteneur Docker.
    command: &gt;
      /slides/index.html /slides/slides.pdf --size='1024x768' --pause 0</code></pre></div></div></div></section><section id="autre_√©tude_de_cas_3" data-auto-animate><h2>Autre √©tude de cas üìöüîç</h2><div class="slide-content"><div class="paragraph"><p>Et pourquoi pas s&#8217;attaquer au docker compose qui a g√©n√©r√© ce cours‚ÄØ?</p></div>
<div class="paragraph fragment"><p>Indigeste? üò®</p></div>
<div class="paragraph fragment"><p>Ne relevons que les points importants:</p></div>
<div class="paragraph fragment"><p>Les ancres&#8230;&#8203;</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml"># Ceci est un fichier Docker Compose pour un projet qui comprend plusieurs services.

# 'x-slides-base' est une ancre YAML qui d√©finit une configuration commune pour plusieurs services.
x-slides-base: &amp;slides-base
  # La configuration de construction pour l'image Docker.
  build:
    # Le contexte de construction est le r√©pertoire courant.
    context: ./
    args:
      # Active la fonction de mise en cache en ligne de Docker BuildKit.
      BUILDKIT_INLINE_CACHE: 1
  # Variables d'environnement pour le conteneur Docker.
  environment:
    - PRESENTATION_URL=${PRESENTATION_URL}
    - REPOSITORY_URL=${REPOSITORY_URL}
  # L'ID utilisateur qui ex√©cute les commandes √† l'int√©rieur du conteneur.
  user: ${CURRENT_UID}
  # Un montage tmpfs pour des op√©rations d'E/S plus rapides.
  tmpfs:
    - ${BUILD_DIR}
  # Volumes pour le conteneur Docker.
  volumes:
    - ./content:/app/content
    - ./assets:/app/assets
    - ${DIST_DIR}:/app/dist
    - ./gulp/gulpfile.js:/app/gulpfile.js
    - ./gulp/tasks:/app/tasks
    - ./npm-packages:/app/npm-packages</code></pre></div></div></div></section><section id="les_ancres_dans_docker_compose" data-auto-animate><h2>‚û°Ô∏èüîÑ Les ancres dans <code>docker compose</code> ‚öì</h2><div class="slide-content"><div class="paragraph"><p>Docker Compose permet de d√©finir et de g√©rer plusieurs services Docker dans un seul fichier YAML.</p></div>
<div class="ulist"><ul><li class="fragment"><p>Les ancres (<code>&amp;</code>) et les alias (<code>*</code>) sont des fonctionnalit√©s YAML qui peuvent √™tre utilis√©es dans Docker Compose pour r√©utiliser des configurations.</p></li><li class="fragment"><p>Une ancre est une r√©f√©rence √† un objet ou √† une valeur dans un fichier YAML.
Elle est d√©finie en utilisant l&#8217;op√©rateur <code>&amp;</code> suivi d&#8217;un nom unique.</p></li></ul></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">x-slides-base: &amp;slides-base
  build:
    context: ./</code></pre></div></div>
<div class="paragraph fragment"><p>Dans cet exemple, <code>x-slides-base</code> est une ancre qui repr√©sente un objet avec une cl√© <code>build</code>.</p></div></div></section><section id="les_ancres_dans_docker_compose_2" data-auto-animate><h2>‚û°Ô∏èüîÑ Les ancres dans <code>docker compose</code> ‚öì</h2><div class="slide-content"><div class="paragraph"><p>Les ancres peuvent √™tre r√©f√©renc√©es ailleurs dans le fichier YAML en utilisant l&#8217;op√©rateur <code>*</code>.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  serve:
    &lt;&lt;: *slides-base</code></pre></div></div>
<div class="ulist"><ul><li class="fragment"><p>Les ancres permettent de r√©utiliser des configurations, ce qui rend le fichier Docker Compose plus lisible et plus facile √† maintenir.</p></li><li class="fragment"><p>Si vous devez modifier une configuration qui est utilis√©e √† plusieurs endroits, vous pouvez simplement modifier l&#8217;ancre.</p></li><li class="fragment"><p>En conclusion, les ancres et les alias sont des outils puissants pour g√©rer des configurations complexes dans Docker Compose. Ils permettent de r√©duire la duplication et d&#8217;am√©liorer la lisibilit√© de votre fichier Docker Compose.</p></li></ul></div></div></section><section id="autre_√©tude_de_cas_4" data-auto-animate><h2>Autre √©tude de cas üìöüîç</h2><div class="slide-content"><div class="paragraph"><p>Le fameux qrcode&#8230;&#8203;</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">  # Le service 'qrcode'.
  qrcode:
    &lt;&lt;: *slides-base
    # Le point d'entr√©e pour le conteneur Docker.
    entrypoint: /app/node_modules/.bin/qrcode
    # La commande √† ex√©cuter dans le conteneur Docker.
    command: &gt;
      -t png -o /app/content/media/qrcode.png ${PRESENTATION_URL}</code></pre></div></div></div></section><section id="autre_√©tude_de_cas_5" data-auto-animate><h2>Autre √©tude de cas üìöüîç</h2><div class="slide-content"><div class="paragraph"><p>Le service qui construit les slides √† partir d'`asciidoc` avec <code>reveal.js</code>.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">  # Le service 'build'.
  build:
    &lt;&lt;: *slides-base
    # Ce service d√©pend du service 'qrcode'.
    depends_on:
      qrcode:
        # Le service 'qrcode' doit se terminer avec succ√®s avant que ce service ne d√©marre.
        condition: service_completed_successfully
    # Le point d'entr√©e pour le conteneur Docker.
    entrypoint: &gt;
      sh -xc 'gulp build &amp;&amp; cp -r "${BUILD_DIR}"/* /app/dist/'</code></pre></div></div></div></section><section id="autre_√©tude_de_cas_6" data-auto-animate><h2>Autre √©tude de cas üìöüîç</h2><div class="slide-content"><div class="paragraph"><p>Le service qui construit les slides √† partir d'`asciidoc` avec <code>reveal.js</code>.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">  # Le service 'serve'.
  serve:
    # Utilise la configuration commune d√©finie par l'ancre 'x-slides-base'.
    &lt;&lt;: *slides-base
    # Expose le port 8000 du conteneur √† l'h√¥te.
    ports:
      - "8000:8000"</code></pre></div></div></div></section><section id="autre_√©tude_de_cas_7" data-auto-animate><h2>Autre √©tude de cas üìöüîç</h2><div class="slide-content"><div class="paragraph"><p>Le service qui construit le pdf √† partir des slides.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">  # Le service 'pdf'.
  pdf:
    # L'image Docker pour ce service.
    image: ghcr.io/astefanutti/decktape:3.7.0
    # Ce service d√©pend du service 'build'.
    depends_on:
      build:
        # Le service 'build' doit se terminer avec succ√®s avant que ce service ne d√©marre.
        condition: service_completed_successfully
    # L'ID utilisateur qui ex√©cute les commandes √† l'int√©rieur du conteneur.
    user: ${CURRENT_UID}
    # Volumes pour le conteneur Docker.
    volumes:
      - ${DIST_DIR}:/slides
    # La commande √† ex√©cuter dans le conteneur Docker.
    command: &gt;
      /slides/index.html /slides/slides.pdf --size='1024x768' --pause 0</code></pre></div></div></div></section><section id="autre_√©tude_de_cas_8" data-auto-animate><h2>Autre √©tude de cas üìöüîç</h2><div class="slide-content"><div class="paragraph"><p>Pour rappel, l&#8217;ancre contenait¬†:</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml"># 'x-slides-base' est une ancre YAML qui d√©finit une configuration commune pour plusieurs services.
x-slides-base: &amp;slides-base
  # La configuration de construction pour l'image Docker.
  build:
    # Le contexte de construction est le r√©pertoire courant.
    context: ./
    args:
      # Active la fonction de mise en cache en ligne de Docker BuildKit.
      BUILDKIT_INLINE_CACHE: 1
  # Variables d'environnement pour le conteneur Docker.
  environment:
    - PRESENTATION_URL=${PRESENTATION_URL}
    - REPOSITORY_URL=${REPOSITORY_URL}
  # L'ID utilisateur qui ex√©cute les commandes √† l'int√©rieur du conteneur.
  user: ${CURRENT_UID}
  # Un montage tmpfs pour des op√©rations d'E/S plus rapides.
  tmpfs:
    - ${BUILD_DIR}
  # Volumes pour le conteneur Docker.
  volumes:
    - ./content:/app/content
    - ./assets:/app/assets
    - ${DIST_DIR}:/app/dist
    - ./gulp/gulpfile.js:/app/gulpfile.js
    - ./gulp/tasks:/app/tasks
    - ./npm-packages:/app/npm-packages</code></pre></div></div></div></section><section id="build_quoi" class="columns" data-auto-animate><h2>‚û°Ô∏èüîÑ Build quoi? üõ†Ô∏èüì¶</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="ulist"><ul><li class="fragment"><p>Docker BuildKit est un outil de construction de Docker qui apporte de nombreuses am√©liorations par rapport √† l&#8217;ancien syst√®me de construction.</p></li><li class="fragment"><p>L&#8217;une de ces am√©liorations est la mise en cache en ligne.</p></li><li class="fragment"><p>La mise en cache en ligne est une fonctionnalit√© de Docker BuildKit qui permet de r√©utiliser les couches de cache existantes lors de la construction d&#8217;une image Docker.</p></li></ul></div>
<div class="imageblock fragment"><img src="media/multi-layered-cake-removebg-preview.png" alt="multi layered cake removebg preview" height="100px"></div></div></div>
<div class="openblock column is-one-third"><div class="content"><div class="paragraph fragment"><p>Elle est activ√©e en d√©finissant l&#8217;argument <code>BUILDKIT_INLINE_CACHE</code> √† <code>1</code>.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">args:
  BUILDKIT_INLINE_CACHE: 1</code></pre></div></div></div></div></div></section><section id="environnement" class="columns" data-auto-animate><h2>‚û°Ô∏èüîÑ Environnement üåçüåø</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">  # Variables d'environnement pour le conteneur Docker.
  environment:
    - PRESENTATION_URL=${PRESENTATION_URL}
    - REPOSITORY_URL=${REPOSITORY_URL}</code></pre></div></div></div></div>
<div class="openblock column"><div class="content"><div class="paragraph"><p>Deux variables d&#8217;environnement sont d√©finies pour le conteneur Docker : <code>PRESENTATION_URL</code> et <code>REPOSITORY_URL</code>.</p></div>
<div class="paragraph fragment"><p>Ces variables sont d√©finies √† l&#8217;aide de la syntaxe <code>${VARIABLE_NAME}</code>, qui est une mani√®re standard d&#8217;acc√©der aux variables d&#8217;environnement dans les fichiers de configuration YAML.</p></div></div></div></div></section><section id="environnement_2" data-auto-animate><h2>‚û°Ô∏èüîÑ Environnement üåçüåø</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">  # Variables d'environnement pour le conteneur Docker.
  environment:
    - PRESENTATION_URL=${PRESENTATION_URL}
    - REPOSITORY_URL=${REPOSITORY_URL}</code></pre></div></div>
<div class="paragraph"><p>Lorsque Docker Compose rencontre cette syntaxe, il cherche la valeur de la variable d&#8217;environnement dans plusieurs endroits, en suivant un ordre sp√©cifique :</p></div>
<div class="ulist"><ul><li class="fragment"><p>Il v√©rifie d&#8217;abord si la variable est d√©finie dans le shell courant.</p></li><li class="fragment"><p>Si c&#8217;est le cas, il utilise cette valeur.</p></li><li class="fragment"><p>Si la variable n&#8217;est pas d√©finie dans le shell, Docker Compose cherche ensuite dans un fichier <code>.env</code> situ√© dans le m√™me r√©pertoire que le fichier <code>docker-compose.yml</code>.</p></li><li class="fragment"><p>Si la variable est d√©finie dans ce fichier, Docker Compose utilise cette valeur.</p></li></ul></div></div></section><section id="environnement_3" data-auto-animate><h2>‚û°Ô∏èüîÑ Environnement üåçüåø</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">  # Variables d'environnement pour le conteneur Docker.
  environment:
    - PRESENTATION_URL=${PRESENTATION_URL}
    - REPOSITORY_URL=${REPOSITORY_URL}</code></pre></div></div>
<div class="ulist"><ul><li><p>Si la variable n&#8217;est d√©finie ni dans le shell ni dans le fichier <code>.env</code>, Docker Compose utilise la valeur par d√©faut sp√©cifi√©e dans le fichier <code>docker-compose.yml</code> (s&#8217;il y en a une).</p></li><li><p>Dans notre cas, aucune valeur par d√©faut n&#8217;est sp√©cifi√©e, donc si la variable n&#8217;est d√©finie ni dans le shell ni dans le fichier <code>.env</code>, Docker Compose g√©n√©rera une erreur.</p></li></ul></div></div></section><section id="autre_√©tude_de_cas_9" data-auto-animate><h2>Autre √©tude de cas üìöüîç</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">  # L'ID utilisateur qui ex√©cute les commandes √† l'int√©rieur du conteneur.
  user: ${CURRENT_UID}</code></pre></div></div>
<div class="ulist"><ul><li class="fragment"><p>Dans Docker, chaque instruction dans le Dockerfile est ex√©cut√©e par un utilisateur particulier.</p></li><li class="fragment"><p>Par d√©faut, cet utilisateur est root, mais pour des raisons de s√©curit√©, il est souvent recommand√© d&#8217;ex√©cuter les processus en tant qu&#8217;utilisateur non root.</p></li><li class="fragment"><p>Cette ligne d√©finit l&#8217;ID de l&#8217;utilisateur qui ex√©cutera les commandes √† l&#8217;int√©rieur du conteneur Docker √† la valeur de la variable d&#8217;environnement <code>CURRENT_UID</code>.</p></li><li class="fragment"><p>La syntaxe <code>${CURRENT_UID}</code> est utilis√©e pour acc√©der √† la valeur d&#8217;une variable d&#8217;environnement.</p></li><li class="fragment"><p>Dans ce cas, Docker Compose recherchera une variable d&#8217;environnement nomm√©e <code>CURRENT_UID</code> et utilisera sa valeur.</p></li><li class="fragment"><p>Si <code>CURRENT_UID</code> n&#8217;est pas d√©fini dans l&#8217;environnement o√π Docker Compose est ex√©cut√©, Docker Compose renverra une erreur.</p></li></ul></div></div></section><section id="autre_√©tude_de_cas_10" data-auto-animate><h2>Autre √©tude de cas üìöüîç</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml"># Ce Dockerfile met en place un environnement Node.js avec des outils et d√©pendances suppl√©mentaires.
# Il est bas√© sur l'image Docker officielle de Node.js (version 22, variante Alpine).

FROM node:23-alpine

# Installer la derni√®re version des d√©pendances requises
# hadolint ignore=DL3018
RUN apk add --no-cache \
  curl \ # Outil pour transf√©rer des donn√©es avec des URLs
  git \ # Syst√®me de contr√¥le de version distribu√©
  tini \ # Un init minuscule mais valide pour les conteneurs
  unzip # Outil pour d√©compresser les fichiers zip

# Installer les d√©pendances NPM globalement (derni√®res versions)
# hadolint ignore=DL3016,DL3059
RUN npm install --global npm npm-check-updates # Mettre √† jour npm √† la derni√®re version et installer npm-check-updates

# Copier les d√©pendances NPM de l'application dans l'image Docker
COPY ./npm-packages /app/npm-packages
# Cr√©er des liens symboliques pour package.json et package-lock.json √† la racine de /app
# Cela permet d'ex√©cuter les op√©rations npm sans erreur ENOENT
RUN ln -s /app/npm-packages/package.json /app/package.json \
  &amp;&amp; ln -s /app/npm-packages/package-lock.json /app/package-lock.json

# D√©finir le r√©pertoire de travail dans l'image Docker √† /app
WORKDIR /app

# T√©l√©charger et installer une version sp√©cifique de FontAwesome
ARG FONTAWESOME_VERSION=6.4.0
RUN curl --silent --show-error --location --output /tmp/fontawesome.zip \
    "https://use.fontawesome.com/releases/v${FONTAWESOME_VERSION}/fontawesome-free-${FONTAWESOME_VERSION}-web.zip" \
  &amp;&amp; unzip -q /tmp/fontawesome.zip -d /tmp \
  &amp;&amp; mv /tmp/"fontawesome-free-${FONTAWESOME_VERSION}-web" /app/fontawesome \
  &amp;&amp; rm -rf /tmp/font*

# Installer les d√©pendances NPM en utilisant le package-lock.json
# Si l'installation √©choue, revenir √† une installation npm r√©guli√®re
RUN { npm install-clean &amp;&amp; npx update-browserslist-db@latest; } || npm install

# Lier la commande gulp pour qu'elle soit disponible dans le PATH
# hadolint ignore=DL3059
RUN npm link gulp

# Copier les t√¢ches gulp et la configuration dans l'image Docker
COPY ./gulp/tasks /app/tasks
COPY ./gulp/gulpfile.js /app/gulpfile.js

# D√©finir un volume pour le r√©pertoire /app
VOLUME ["/app"]

# Exposer le port 8000 pour HTTP
EXPOSE 8000

# Utiliser tini comme point d'entr√©e, et ex√©cuter gulp par d√©faut
ENTRYPOINT ["/sbin/tini","-g","gulp"]
CMD ["default"]</code></pre></div></div></div></section><section id="autre_√©tude_de_cas_11" data-auto-animate><h2>Autre √©tude de cas üìöüîç</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">RUN npm install --global npm npm-check-updates # Mettre √† jour npm √† la derni√®re version et installer npm-check-updates

# Copier les d√©pendances NPM de l'application dans l'image Docker
COPY ./npm-packages /app/npm-packages
# Cr√©er des liens symboliques pour package.json et package-lock.json √† la racine de /app
# Cela permet d'ex√©cuter les op√©rations npm sans erreur ENOENT
RUN ln -s /app/npm-packages/package.json /app/package.json \
  &amp;&amp; ln -s /app/npm-packages/package-lock.json /app/package-lock.json</code></pre></div></div>
<div class="ulist"><ul><li class="fragment"><p>Ce Dockerfile met en place un environnement <code>Node.js</code> avec des outils et d√©pendances suppl√©mentaires.</p></li><li class="fragment"><p>Il installe les derni√®res versions de <code>npm</code> et <code>npm-check-updates</code> globalement, copie les d√©pendances <code>npm</code> de l&#8217;application dans l&#8217;image Docker, et cr√©e des liens symboliques pour <code>package.json</code> et <code>package-lock.json</code> √† la racine de <code>/app</code>.</p></li></ul></div></div></section><section id="autre_√©tude_de_cas_12" data-auto-animate><h2>Autre √©tude de cas üìöüîç</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">ARG FONTAWESOME_VERSION=6.4.0
RUN curl --silent --show-error --location --output /tmp/fontawesome.zip \
    "https://use.fontawesome.com/releases/v${FONTAWESOME_VERSION}/fontawesome-free-${FONTAWESOME_VERSION}-web.zip" \
  &amp;&amp; unzip -q /tmp/fontawesome.zip -d /tmp \
  &amp;&amp; mv /tmp/"fontawesome-free-${FONTAWESOME_VERSION}-web" /app/fontawesome \
  &amp;&amp; rm -rf /tmp/font*</code></pre></div></div>
<div class="ulist"><ul><li class="fragment"><p>Il t√©l√©charge √©galement et installe une version sp√©cifique de <code>FontAwesome</code></p></li></ul></div></div></section><section id="autre_√©tude_de_cas_13" data-auto-animate><h2>Autre √©tude de cas üìöüîç</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile"># Installer les d√©pendances NPM en utilisant le package-lock.json
# Si l'installation √©choue, revenir √† une installation npm r√©guli√®re
RUN { npm install-clean &amp;&amp; npx update-browserslist-db@latest; } || npm install

# Lier la commande gulp pour qu'elle soit disponible dans le PATH
# hadolint ignore=DL3059
RUN npm link gulp</code></pre></div></div>
<div class="ulist"><ul><li class="fragment"><p>Il installe les d√©pendances <code>npm</code> en utilisant le <code>package-lock.json</code> (en revenant √† une installation <code>npm</code> r√©guli√®re si n√©cessaire), et lie la commande <code>gulp</code> pour qu&#8217;elle soit disponible dans le <code>PATH</code>.</p></li></ul></div></div></section><section id="autre_√©tude_de_cas_14" data-auto-animate><h2>Autre √©tude de cas üìöüîç</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile"># Copier les t√¢ches gulp et la configuration dans l'image Docker
COPY ./gulp/tasks /app/tasks
COPY ./gulp/gulpfile.js /app/gulpfile.js

# D√©finir un volume pour le r√©pertoire /app
VOLUME ["/app"]

# Exposer le port 8000 pour HTTP
EXPOSE 8000</code></pre></div></div>
<div class="ulist"><ul><li class="fragment"><p>Les t√¢ches <code>gulp</code> et la configuration sont copi√©es dans l&#8217;image Docker, un volume est d√©fini pour le r√©pertoire <code>/app</code>, et le port <code>8000</code> est expos√© pour <code>HTTP</code>.</p></li></ul></div></div></section><section id="autre_√©tude_de_cas_15" data-auto-animate><h2>Autre √©tude de cas üìöüîç</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile"># Utiliser tini comme point d'entr√©e, et ex√©cuter gulp par d√©faut
ENTRYPOINT ["/sbin/tini","-g","gulp"]
CMD ["default"]</code></pre></div></div>
<div class="ulist"><ul><li class="fragment"><p>Le point d&#8217;entr√©e est d√©fini sur <code>tini</code>, et <code>gulp</code> est ex√©cut√© par d√©faut.</p></li></ul></div></div></section><section id="tini_dans_docker"><h2>üêã Tini dans Docker</h2></section><section id="quest_ce_que_tini"><h2>ü§î Qu&#8217;est-ce que Tini ?</h2><div class="slide-content"><div class="paragraph"><p>Tini est un <code>init</code> minuscule mais valide pour les conteneurs. Il est con√ßu pour √™tre le syst√®me init le plus simple possible.</p></div></div></section><section id="que_fait_tini"><h2>üõ†Ô∏è Que fait Tini ?</h2><div class="slide-content"><div class="paragraph"><p>Tini fait deux choses :</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Il g√©n√®re votre processus en tant que son enfant (directement, pas en tant que petit-enfant, comme le ferait un shell).</p></li><li><p>Il attend ensuite les signaux et les transmet au processus enfant.</p></li></ol></div></div></section><section id="pourquoi_tini_est_il_utile_dans_docker"><h2>üéØ Pourquoi Tini est-il utile dans Docker ?</h2><div class="slide-content"><div class="olist arabic"><ol class="arabic"><li><p>Docker ex√©cute un seul processus dans un conteneur par d√©faut. Si ce processus g√©n√®re des processus enfants et ne les r√©colte pas correctement, ils deviennent des processus zombies.</p></li><li><p>Tini assure que ces processus zombies sont correctement r√©colt√©s, am√©liorant ainsi le comportement du conteneur et r√©duisant la probabilit√© de cas limites.</p></li></ol></div></div></section><section id="tini_dans_notre_dockerfile"><h2>üêã Tini dans notre Dockerfile</h2><div class="slide-content"><div class="paragraph"><p>Dans notre Dockerfile, nous utilisons Tini comme point d&#8217;entr√©e :</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">ENTRYPOINT ["/sbin/tini","-g","gulp"]</code></pre></div></div>
<div class="olist arabic"><ol class="arabic"><li><p>Cela signifie que Tini est le premier processus qui est lanc√© dans notre conteneur.</p></li><li><p>Il lancera ensuite <code>gulp</code> en tant que processus enfant.</p></li><li><p>Tout signal envoy√© au conteneur sera transmis par Tini √† <code>gulp</code>.</p></li><li><p>Si <code>gulp</code> g√©n√®re des processus enfants et ne les r√©colte pas, Tini le fera.</p></li></ol></div></div></section><section id="docker_peut_travailler_main_dans_la_main_avec_dautres_outils" data-auto-animate><h2>üêã Docker peut travailler main dans la main avec d&#8217;autres outils&#8230;&#8203; üë´ü§ù</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-makefile hljs" data-noescape="true" data-lang="makefile"># Ce Makefile est utilis√© pour g√©rer le projet Docker Compose.

# D√©finir les valeurs par d√©faut pour les variables DIST_DIR et REPOSITORY_URL.
DIST_DIR ?= $(CURDIR)/dist
REPOSITORY_URL ?= file://$(CURDIR)
export REPOSITORY_URL DIST_DIR

# Activer Docker BuildKit pour une construction plus rapide et la mise en cache des images.
DOCKER_BUILDKIT ?= 1
COMPOSE_DOCKER_CLI_BUILD ?= 1
export DOCKER_BUILDKIT COMPOSE_DOCKER_CLI_BUILD

# D√©finition des commandes shell r√©utilisables pour Docker Compose.

# compose_cmd est une fonction qui ex√©cute la commande 'docker compose' avec le fichier docker-compose.yml du r√©pertoire courant.
# Elle prend un argument $(1) qui repr√©sente les options suppl√©mentaires √† passer √† la commande 'docker compose'.
# $(CURDIR) est une variable d'environnement dans le Makefile qui repr√©sente le r√©pertoire courant dans lequel
# le Makefile est ex√©cut√©. C'est une fonctionnalit√© int√©gr√©e de GNU Make. Elle est souvent utilis√©e pour r√©f√©rencer
# des fichiers ou des r√©pertoires relatifs au r√©pertoire courant.
compose_cmd = docker compose --file=$(CURDIR)/docker-compose.yml $(1)

# compose_up est une fonction qui utilise compose_cmd pour ex√©cuter 'docker compose up'.
# Elle prend un argument $(1) qui repr√©sente les options suppl√©mentaires √† passer √† la commande 'docker compose up'.
# L'option '--build' est toujours incluse, ce qui signifie que Docker construira les images avant de d√©marrer les conteneurs.
compose_up = $(call compose_cmd, up --build $(1))

# compose_run est une fonction qui utilise compose_cmd pour ex√©cuter 'docker compose run'.
# Elle prend un argument $(1) qui repr√©sente les options suppl√©mentaires √† passer √† la commande 'docker compose run'.
# L'option '--user=0' est toujours incluse, ce qui signifie que les commandes seront ex√©cut√©es en tant que root √† l'int√©rieur du conteneur.
compose_run = $(call compose_cmd, run --user=0 $(1))

# La cible par d√©faut. Elle nettoie le projet, le construit et le v√©rifie.
all: clean build verify

# Construire le projet √† l'int√©rieur d'un conteneur Docker.
# Cette r√®gle Makefile utilise la fonction compose_up d√©finie pr√©c√©demment pour ex√©cuter 'docker compose up' avec l'option '--exit-code-from=build'.
# L'option '--exit-code-from=build' signifie que la commande 'docker compose up' renverra le code de sortie du service 'build'.
# Si le service 'build' se termine avec un code de sortie non nul (ce qui signifie qu'une erreur s'est produite), alors 'docker compose up' se terminera √©galement avec un code de sortie non nul.
# Cela permet √† Make de savoir si la construction du projet a r√©ussi ou non.
build:
 @$(call compose_up,--exit-code-from=build build)

# V√©rifier le projet. Actuellement d√©sactiv√©.
verify:
 @echo "V√©rification d√©sactiv√©e"

# D√©marrer les services 'serve' et 'qrcode'.
serve:
 @$(call compose_up, --force-recreate serve qrcode)

# D√©marrer un shell √† l'int√©rieur du conteneur du service 'serve'.
shell:
 @$(call compose_run,--entrypoint=sh --rm serve)

# Mettre √† jour le fichier de verrouillage pour les d√©pendances npm.
dependencies-lock-update:
 @$(call compose_run,--entrypoint=npm --rm serve install --package-lock)

# Mettre √† jour les d√©pendances npm et le fichier de verrouillage.
dependencies-update:
 @$(call compose_run,--entrypoint=ncu --workdir=/app/npm-packages --rm serve -u)
 @make -C $(CURDIR) dependencies-lock-update

# Construire une version PDF du projet.
pdf:
 @$(call compose_up, --exit-code-from=pdf pdf)

# Nettoyer le projet en arr√™tant et en supprimant les conteneurs Docker, les r√©seaux et les volumes.
clean:
 @$(call compose_cmd, down -v --remove-orphans)
 @rm -rf $(DIST_DIR)

# D√©marrer le service 'qrcode'.
qrcode:
 @$(call compose_up, qrcode)

# D√©clarer des cibles factices.
.PHONY: all build verify serve qrcode pdf dependencies-update dependencies-lock-update</code></pre></div></div></div></section><section id="docker_peut_travailler_main_dans_la_main_avec_dautres_outils_2" data-auto-animate><h2>üêã Docker peut travailler main dans la main avec d&#8217;autres outils&#8230;&#8203; üë´ü§ù</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-makefile hljs" data-noescape="true" data-lang="makefile"># Activer Docker BuildKit pour une construction plus rapide et la mise en cache des images.
DOCKER_BUILDKIT ?= 1
COMPOSE_DOCKER_CLI_BUILD ?= 1
export DOCKER_BUILDKIT COMPOSE_DOCKER_CLI_BUILD</code></pre></div></div>
<div class="paragraph"><p>Cette configuration de docker compose concerne Docker BuildKit, une fonctionnalit√© de Docker qui am√©liore les performances de construction des images Docker.</p></div>
<div class="ulist"><ul><li><p>La ligne <code>DOCKER_BUILDKIT ?= 1</code> v√©rifie si la variable d&#8217;environnement <code>DOCKER_BUILDKIT</code> est d√©j√† d√©finie.</p><div class="ulist"><ul><li><p>Si ce n&#8217;est pas le cas, elle lui attribue la valeur <code>1</code>, ce qui active Docker BuildKit.</p></li></ul></div></li><li><p>De m√™me, <code>COMPOSE_DOCKER_CLI_BUILD ?= 1</code> v√©rifie si la variable d&#8217;environnement <code>COMPOSE_DOCKER_CLI_BUILD</code> est d√©j√† d√©finie.</p><div class="ulist"><ul><li><p>Si ce n&#8217;est pas le cas, elle lui attribue la valeur <code>1</code>.</p></li><li><p>Cette variable d&#8217;environnement est utilis√©e pour activer l&#8217;utilisation de Docker CLI lors de l&#8217;utilisation de Docker Compose.</p></li><li><p>C&#8217;est n√©cessaire car Docker Compose ne supporte pas BuildKit par d√©faut, donc cette variable d&#8217;environnement est une solution de contournement pour l&#8217;activer.
En r√©sum√©, ces deux lignes de code activent Docker BuildKit pour am√©liorer les performances de construction des images Docker lors de l&#8217;utilisation de Docker Compose.</p></li></ul></div></li></ul></div></div></section><section id="docker_peut_travailler_main_dans_la_main_avec_dautres_outils_3" data-auto-animate><h2>üêã Docker peut travailler main dans la main avec d&#8217;autres outils&#8230;&#8203; üë´ü§ù</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-makefile hljs" data-noescape="true" data-lang="makefile"># D√©finition des commandes shell r√©utilisables pour Docker Compose.

# compose_cmd est une fonction qui ex√©cute la commande 'docker compose' avec le fichier docker-compose.yml du r√©pertoire courant.
# Elle prend un argument $(1) qui repr√©sente les options suppl√©mentaires √† passer √† la commande 'docker compose'.
# $(CURDIR) est une variable d'environnement dans le Makefile qui repr√©sente le r√©pertoire courant dans lequel
# le Makefile est ex√©cut√©. C'est une fonctionnalit√© int√©gr√©e de GNU Make. Elle est souvent utilis√©e pour r√©f√©rencer
# des fichiers ou des r√©pertoires relatifs au r√©pertoire courant.
compose_cmd = docker compose --file=$(CURDIR)/docker-compose.yml $(1)

# compose_up est une fonction qui utilise compose_cmd pour ex√©cuter 'docker compose up'.
# Elle prend un argument $(1) qui repr√©sente les options suppl√©mentaires √† passer √† la commande 'docker compose up'.
# L'option '--build' est toujours incluse, ce qui signifie que Docker construira les images avant de d√©marrer les conteneurs.
compose_up = $(call compose_cmd, up --build $(1))

# compose_run est une fonction qui utilise compose_cmd pour ex√©cuter 'docker compose run'.
# Elle prend un argument $(1) qui repr√©sente les options suppl√©mentaires √† passer √† la commande 'docker compose run'.
# L'option '--user=0' est toujours incluse, ce qui signifie que les commandes seront ex√©cut√©es en tant que root √† l'int√©rieur du conteneur.
compose_run = $(call compose_cmd, run --user=0 $(1))</code></pre></div></div></div></section><section id="docker_peut_travailler_main_dans_la_main_avec_dautres_outils_4" data-auto-animate><h2>üêã Docker peut travailler main dans la main avec d&#8217;autres outils&#8230;&#8203; üë´ü§ù</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-makefile hljs" data-noescape="true" data-lang="makefile"># Construire le projet √† l'int√©rieur d'un conteneur Docker.
# Cette r√®gle Makefile utilise la fonction compose_up d√©finie pr√©c√©demment pour ex√©cuter 'docker compose up' avec l'option '--exit-code-from=build'.
# L'option '--exit-code-from=build' signifie que la commande 'docker compose up' renverra le code de sortie du service 'build'.
# Si le service 'build' se termine avec un code de sortie non nul (ce qui signifie qu'une erreur s'est produite), alors 'docker compose up' se terminera √©galement avec un code de sortie non nul.
# Cela permet √† Make de savoir si la construction du projet a r√©ussi ou non.
build:
 @$(call compose_up,--exit-code-from=build build)</code></pre></div></div>
<div class="ulist"><ul><li class="fragment"><p>Cette r√®gle <code>Makefile</code> est utilis√©e pour construire le projet √† l&#8217;int√©rieur d&#8217;un conteneur Docker.</p></li><li class="fragment"><p>Elle utilise la fonction <code>compose_up</code> pour ex√©cuter la commande <code>docker compose up</code> avec l&#8217;option <code>--exit-code-from=build</code>.</p></li><li class="fragment"><p>Cette option permet √† la commande <code>docker compose up</code> de renvoyer le code de sortie du service <code>build</code>, ce qui permet √† Make de savoir si la construction du projet a r√©ussi ou non.</p></li></ul></div></div></section><section id="fin_du_chapitre_docker_compose"><h2>üìñüîö Fin du chapitre docker compose üêãüêô</h2><div class="slide-content"><div class="imageblock"><img src="media/bitmoji-whale%20friend.png" alt="bitmoji whale friend" height="500px"></div></div></section></section>
<section><section id="bonus"><h2>Bonus</h2></section><section id="les_petits_plus"><h2>Les petits plus</h2><div class="slide-content"><div class="imageblock"><img src="media/902050214-image2.png" alt="902050214 image2"></div>
<div class="imageblock"><img src="media/902050214-image2.png" alt="902050214 image2"></div>
<div class="imageblock"><img src="media/902050214-image2.png" alt="902050214 image2"></div>
<div class="imageblock"><img src="media/902050214-image2.png" alt="902050214 image2"></div>
<div class="imageblock"><img src="media/902050214-image2.png" alt="902050214 image2"></div>
<div class="imageblock"><img src="media/902050214-image2.png" alt="902050214 image2"></div></div></section><section id="il_en_remet_une_couche" data-auto-animate><h2>"Il en remet une couche"</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker history nginx
IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT
f35646e83998        4 weeks ago         /bin/sh -c #(nop)  CMD ["nginx" "-g" "daemon‚Ä¶   0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  STOPSIGNAL SIGTERM           0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  EXPOSE 80                    0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  ENTRYPOINT ["/docker-entr‚Ä¶   0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop) COPY file:0fd5fca330dcd6a7‚Ä¶   1.04kB
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop) COPY file:1d0a4127e78a26c1‚Ä¶   1.96kB
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop) COPY file:e7e183879c35719c‚Ä¶   1.2kB
&lt;missing&gt;           4 weeks ago         /bin/sh -c set -x     &amp;&amp; addgroup --system -‚Ä¶   63.6MB
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  ENV PKG_RELEASE=1~buster     0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  ENV NJS_VERSION=0.4.4        0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  ENV NGINX_VERSION=1.19.3     0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  LABEL maintainer=NGINX Do‚Ä¶   0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  CMD ["bash"]                 0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop) ADD file:0dc53e7886c35bc21‚Ä¶   69.2MB</code></pre></div></div></div></section><section id="il_en_remet_une_couche_2" data-auto-animate><h2>"Il en remet une couche"</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker history nginx
IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT
f35646e83998        4 weeks ago         /bin/sh -c #(nop)  CMD ["nginx" "-g" "daemon‚Ä¶   0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  STOPSIGNAL SIGTERM           0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  EXPOSE 80                    0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  ENTRYPOINT ["/docker-entr‚Ä¶   0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop) COPY file:0fd5fca330dcd6a7‚Ä¶   1.04kB
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop) COPY file:1d0a4127e78a26c1‚Ä¶   1.96kB
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop) COPY file:e7e183879c35719c‚Ä¶   1.2kB
&lt;missing&gt;           4 weeks ago         /bin/sh -c set -x     &amp;&amp; addgroup --system -‚Ä¶   63.6MB
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  ENV PKG_RELEASE=1~buster     0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  ENV NJS_VERSION=0.4.4        0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  ENV NGINX_VERSION=1.19.3     0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  LABEL maintainer=NGINX Do‚Ä¶   0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  CMD ["bash"]                 0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop) ADD file:0dc53e7886c35bc21‚Ä¶   69.2MB</code></pre></div></div>
<div class="paragraph"><p>Il est pr√©f√©rable de limiter le nombre de couches pour limiter la bande passante.</p></div></div></section><section id="il_en_remet_une_couche_3" data-auto-animate><h2>"Il en remet une couche"</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">RUN apk add \
     patch \
     tar \
     mercurial \
     git \
     ruby \
     ruby-devel \
     rubygem-bundler \
     make \
     gcc-c++ \
     zlib-devel \
     libxml2-devel \
     docker \
     nodejs \
     npm \
     sssd \
 &amp;&amp; mkdir -p /var/lib/docker-builder \
 &amp;&amp; mkdir -p /etc/docker-builder</code></pre></div></div></div></section><section id="ne_pas_charger_inutilement"><h2>Ne pas charger inutilement !</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"> &amp;&amp; apk remove make gcc maven ... \
 &amp;&amp; rm -f previously-downloaded.tar.gz \
 &amp;&amp; apk clean all \
 &amp;&amp; rm -rf /tmp/*</code></pre></div></div>
<div class="paragraph fragment"><p>Il est utile, pour des raisons d&#8217;espace, de nettoyer le filesystem de ses futurs containers, en donnant les bonnes instructions dans le Dockerfile.</p></div></div></section><section id="documentez"><h2>Documentez !</h2><div class="slide-content"><div class="paragraph"><p>Les mots cl√©s <code>EXPOSE</code> et <code>LABEL</code> peuvent fournir de pr√©cieuses informations aux utilisateurs de vos images !</p></div>
<div class="paragraph"><p>(les ports expos√©s par d√©faut, les auteurs de l&#8217;image, la version d&#8217;un middleware embarqu√©, ‚Ä¶)</p></div></div></section><section id="pr√©parez_vous_au_read_only"><h2>Pr√©parez-vous au read-only</h2><div class="slide-content"><div class="paragraph"><p>Il est possible de lister toutes les modifications qui ont √©t√© apport√©es au filesystem d&#8217;un container.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker diff 29f1c4
C /run
A /run/nginx.pid
C /var
C /var/lib
C /var/lib/nginx
C /var/lib/nginx/tmp
A /var/lib/nginx/tmp/client_body
A /var/lib/nginx/tmp/fastcgi
A /var/lib/nginx/tmp/proxy
A /var/lib/nginx/tmp/scgi
A /var/lib/nginx/tmp/uwsgi
C /var/log
C /var/log/nginx
A /var/log/nginx/access.log
A /var/log/nginx/error.log</code></pre></div></div>
<div class="paragraph fragment"><p>Une bonne piste pour savoir quels volumes d√©clarer !</p></div></div></section><section id="healthcheck"><h2>HealthCheck</h2><div class="slide-content"><div class="paragraph"><p>Savoir que mon PID 1 est toujours en cours d&#8217;ex√©cution n&#8217;est peut-√™tre pas la meilleure piste pour savoir si mon conteneur est en bonne sant√© !</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">FROM ghost:3
RUN apt update &amp;&amp; apt install curl -y \
        &amp;&amp; rm -rf /var/lib/apt/lists/*

HEALTHCHECK --interval=1m --timeout=30s --retries=3 CMD curl --fail http://localhost:2368 || exit 1</code></pre></div></div>
<div class="paragraph"><p>source : <a href="https://www.grottedubarbu.fr/docker-healthcheck/" class="bare">https://www.grottedubarbu.fr/docker-healthcheck/</a></p></div></div></section><section id="debugging"><h2>Debugging</h2><div class="slide-content"><div class="imageblock"><img src="media/1939424428-image3.gif" alt="1939424428 image3"></div></div></section><section id="une_tonne_doutils"><h2>Une tonne d&#8217;outils !</h2><div class="slide-content"><div class="paragraph"><p>Les logs</p></div>
<div class="ulist"><ul><li><p>des containers</p></li><li><p>du d√©mon Docker</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container exec
docker inspect
docker cp
docker history
docker stats</code></pre></div></div></div></section><section id="debugging_les_logs"><h2>Debugging : Les logs</h2><div class="slide-content"><div class="paragraph"><p>rappel : <code>docker container logs</code> permet de lister les logs des conteneurs.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container logs 47d6
Fri Nov 20 00:39:52 UTC 2023
Fri Nov 20 00:39:53 UTC 2023</code></pre></div></div></div></section><section id="concentrateur_de_logs"><h2>Concentrateur de logs</h2><div class="slide-content"><div class="paragraph"><p>Par d√©faut, les logs des conteneurs sont stock√©s dans des fichiers json. Mais comment faire pour les envoyer vers un concentrateur ?</p></div>
<div class="listingblock fragment"><div class="content"><pre>docker container run -d
--log-driver=gelf
--log-opt gelf-address=udp://localhost:12201
-p 88:80
nginx</pre></div></div>
<div class="paragraph fragment"><p>on sp√©cifie un driver</p></div>
<div class="paragraph fragment"><p>on configure le driver</p></div></div></section><section id="travaux_pratiques_13"><h2>Travaux pratiques #13</h2><div class="slide-content"><div class="paragraph"><p>√âtapes</p></div>
<div class="paragraph"><p>Lancer une stack ELK gr√¢ce aux fichiers fournis dans le repo <a href="https://gitlab.univ-artois.fr/bruno.verachten/devops-docker-tp13" class="bare">https://gitlab.univ-artois.fr/bruno.verachten/devops-docker-tp13</a></p></div>
<div class="paragraph"><p>Alimenter en logs avec la commande <code>docker container run --log-driver=gelf --log-opt gelf-address=udp://localhost:12201 alpine bash -c 'seq 1 100'</code></p></div>
<div class="paragraph"><p>Cr√©er un index "timestamp" sur Kibana puis aller √† l&#8217;√©cran "discover"</p></div>
<div class="paragraph"><p>Lancer un conteneur nginx et concentrez ses logs dans ELK</p></div></div></section><section id="gitlab_et_dependabot" class="columns"><h2>GitLab et Dependabot</h2><div class="slide-content"><div class="imageblock column"><img src="https://about.gitlab.com/images/press/press-kit-icon.svg" alt="press kit icon" height="200px"></div>
<div class="imageblock column"><img src="https://avatars.githubusercontent.com/u/27347476?s=200&v=4" alt="27347476?s=200&amp;v=4" height="200px"></div></div></section><section id="quest_ce_que_dependabot"><h2>ü§î Qu&#8217;est-ce que Dependabot ?</h2><div class="slide-content"><div class="paragraph"><p>Dependabot est un outil qui vous aide √† maintenir vos d√©pendances √† jour.</p></div>
<div class="imageblock"><img src="https://avatars.githubusercontent.com/u/27347476?s=200&v=4" alt="27347476?s=200&amp;v=4"></div>
<div class="paragraph fragment"><p>Il ouvre automatiquement des merge requests pour les mises √† jour de d√©pendances dans vos projets GitLab.</p></div></div></section><section id="comment_dependabot_fonctionne_t_il_avec_docker"><h2>üõ†Ô∏è Comment Dependabot fonctionne-t-il avec Docker ?</h2><div class="slide-content"><div class="paragraph"><p>Dependabot peut analyser vos <code>Dockerfiles</code> et vos fichiers <code>docker-compose</code> pour trouver les d√©pendances qui peuvent √™tre mises √† jour.</p></div>
<div class="paragraph fragment"><p>Il cr√©e ensuite des merge requests pour chaque mise √† jour de d√©pendance.</p></div></div></section><section id="pourquoi_utiliser_dependabot_avec_docker"><h2>üéØ Pourquoi utiliser Dependabot avec Docker ?</h2><div class="slide-content"><div class="olist arabic"><ol class="arabic"><li><p>Garder vos d√©pendances √† jour est crucial pour la s√©curit√© et la stabilit√© de vos applications.</p></li><li><p>Dependabot automatise ce processus, vous faisant gagner du temps et r√©duisant le risque d&#8217;oublier une mise √† jour importante.</p></li><li><p>Dependabot n&#8217;est pas magique, il faut que votre CI soit capable de construire votre application avec les nouvelles d√©pendances.</p></li><li><p>Ce qui n&#8217;est pas test√© ne fonctionne pas.</p></li></ol></div></div></section><section id="comment_configurer_dependabot_pour_gitlab" data-auto-animate><h2>üöÄ Comment configurer Dependabot pour GitLab ? ü¶äüõ†Ô∏è</h2><div class="slide-content"><div class="ulist"><ul><li><p>Malheureusement, il n&#8217;y a pas encore de support officiel pour GitLab dans Dependabot (et vice versa).</p></li><li><p>Notre forge Gitlab est d√©finie dans un fichier docker-compose.yml, et Dependabot aussi.</p></li><li><p>Dependabot doit avoir acc√®s √† notre forge GitLab pour pouvoir ouvrir des merge requests.</p></li><li><p>Suivons donc <a href="https://dependabot-gitlab.gitlab.io/dependabot/guide/getting-started.html#step-2-set-up-access-tokens">la documentation officielle</a>.</p></li></ul></div></div></section><section data-background-image="media/personal-access-token.png" data-background-size="cover" data-auto-animate></section><section data-background-image="media/personal-access-token-settings.png" data-background-size="cover" data-auto-animate></section><section id="comment_configurer_dependabot_pour_gitlab_2" data-auto-animate><h2>üöÄ Comment configurer Dependabot pour GitLab ? ü¶äüõ†Ô∏è</h2><div class="slide-content"><div class="admonitionblock warning"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content">Notez bien le token, vous ne le reverrez plus jamais.</td></tr></table></div>
<div class="paragraph"><p><a href="https://dependabot-gitlab.gitlab.io/dependabot/guide/getting-started.html#step-3-start-the-app">L&#8217;√©tape suivante</a>, c&#8217;est de positionner les valeurs de certaines variables d&#8217;environnement.
√áa peut √™tre dans un <code>.env</code>, ou dans les variables d&#8217;environnement de votre machine.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">export SETTINGS__GITLAB_URL=http://localhost
export SETTINGS__GITLAB_ACCESS_TOKEN=glpat-LXUfrxeFXuRJXNTNNifD</code></pre></div></div></div></section><section id="comment_configurer_dependabot_pour_gitlab_3" data-auto-animate><h2>üöÄ Comment configurer Dependabot pour GitLab ? ü¶äüõ†Ô∏è</h2><div class="slide-content"><div class="paragraph"><p>D√©marrez l&#8217;application avec <code>docker compose</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">curl -s https://gitlab.com/dependabot-gitlab/dependabot/-/raw/v3.8.0-alpha.1/docker-compose.yml | docker compose -f - up -d</code></pre></div></div>
<div class="imageblock fragment"><img src="media/dependabot-cant-see-gitlab.png" alt="dependabot cant see gitlab"></div>
<div class="paragraph fragment"><p>üò¢</p></div></div></section><section id="comment_configurer_dependabot_pour_gitlab_4" data-auto-animate><h2>üöÄ Comment configurer Dependabot pour GitLab ? ü¶äüõ†Ô∏è</h2><div class="slide-content"><div class="paragraph"><p>Vous vous souvenez du chapitre sur les r√©seaux Docker ?</p></div>
<div class="ulist"><ul><li class="fragment"><p>Dans Docker, chaque conteneur a son propre espace de nom r√©seau, ce qui signifie que localhost √† l&#8217;int√©rieur d&#8217;un conteneur fait r√©f√©rence au conteneur lui-m√™me, et non √† la machine h√¥te ou √† d&#8217;autres conteneurs.</p></li><li class="fragment"><p>Lorsque vous essayez de faire un <code>ping</code> sur <code>gitlab-instance-gitlab-1</code> depuis le conteneur web, il ne conna√Æt pas le nom d&#8217;h√¥te <code>gitlab-instance-gitlab-1</code> car il n&#8217;est pas dans le m√™me espace de nom r√©seau.</p></li><li class="fragment"><p>Pour permettre aux conteneurs de communiquer entre eux, ils doivent √™tre dans le m√™me r√©seau Docker.</p></li></ul></div></div></section><section id="comment_configurer_dependabot_pour_gitlab_5" data-auto-animate><h2>üöÄ Comment configurer Dependabot pour GitLab ? ü¶äüõ†Ô∏è</h2><div class="slide-content"><div class="ulist"><ul><li><p>Lorsque vous utilisez Docker Compose, il cr√©e automatiquement un r√©seau par d√©faut pour votre application et tout service d√©fini dans le <code>docker-compose.yml</code> peut atteindre les autres en utilisant le nom du service comme nom d&#8217;h√¥te.</p></li></ul></div>
<div class="ulist"><ul><li class="fragment"><p>Dans notre cas, le conteneur <code>web</code> et le conteneur <code>gitlab-instance-gitlab-1</code> ne sont pas dans le m√™me r√©seau Docker.</p></li><li class="fragment"><p>Vous pouvez v√©rifier cela en inspectant les r√©seaux de chaque conteneur √† l&#8217;aide de la commande <code>docker inspect</code>.</p></li><li class="fragment"><p>S&#8217;ils ne sont pas dans le m√™me r√©seau, nous pouvons cr√©er un r√©seau et ajouter les deux services √† celui-ci dans notre fichier <code>docker-compose.yml</code>.</p></li></ul></div></div></section><section id="comment_configurer_dependabot_pour_gitlab_6" data-auto-animate><h2>üöÄ Comment configurer Dependabot pour GitLab ? ü¶äüõ†Ô∏è</h2><div class="slide-content"><div class="ulist"><ul><li><p>Voici un exemple :</p></li></ul></div>
<div class="listingblock"><div class="content"><pre>version: '3'
services:
  web:
    image: web
    networks:
      - mynetwork
  gitlab-instance-gitlab-1:
    image: gitlab
    networks:
      - mynetwork
networks:
  mynetwork:</pre></div></div>
<div class="ulist"><ul><li class="fragment"><p>Apr√®s avoir mis √† jour votre fichier <code>docker-compose.yml</code>, vous devez recr√©er vos conteneurs pour que les modifications prennent effet.</p></li><li class="fragment"><p>Vous pouvez le faire avec la commande <code>docker compose up -d --force-recreate</code>.</p></li><li class="fragment"><p>Apr√®s cela, vous devriez pouvoir faire un <code>ping</code> sur <code>gitlab-instance-gitlab-1</code> depuis le conteneur web.</p></li></ul></div></div></section><section id="comment_configurer_dependabot_pour_gitlab_7" data-auto-animate><h2>üöÄ Comment configurer Dependabot pour GitLab ? ü¶äüõ†Ô∏è</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">  web:
    image: *base_image
    networks:
[...]
networks:
  mynetwork:</code></pre></div></div>
<div class="paragraph fragment"><p>Et&#8230;&#8203;</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">  gitlab:
    # The Docker image to use for the GitLab server
    image: 'gitlab/gitlab-ce:16.6.0-ce.0'
    networks:
      - mynetwork
[...]
networks:
  mynetwork:</code></pre></div></div></div></section><section id="comment_configurer_dependabot_pour_gitlab_8" data-auto-animate><h2>üöÄ Comment configurer Dependabot pour GitLab ? ü¶äüõ†Ô∏è</h2><div class="slide-content"><div class="paragraph"><p>Sauf que&#8230;&#8203;</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">root@95def7cb933d:/home/dependabot/app# nmap -sn 172.30.0.0/16
Starting Nmap 7.80 ( https://nmap.org ) at 2023-11-21 20:45 UTC
Nmap scan report for 172.30.0.1
Host is up (0.0000090s latency).
MAC Address: 02:42:50:A6:7C:5A (Unknown)
Nmap scan report for symbiosis-gitlab-1.symbiosis_mynetwork (172.30.0.2)
Host is up (0.000012s latency).
MAC Address: 02:42:AC:1E:00:02 (Unknown)
Nmap scan report for symbiosis-gitlab-runner-1-1.symbiosis_mynetwork (172.30.0.3)
Host is up (0.000015s latency).
MAC Address: 02:42:AC:1E:00:03 (Unknown)
Nmap scan report for symbiosis-gitlab-runner-2-1.symbiosis_mynetwork (172.30.0.4)
Host is up (0.000032s latency).
MAC Address: 02:42:AC:1E:00:04 (Unknown)
Nmap scan report for symbiosis-redis-1.symbiosis_mynetwork (172.30.0.5)
Host is up (0.0000070s latency).
MAC Address: 02:42:AC:1E:00:05 (Unknown)
Nmap scan report for symbiosis-mongodb-1.symbiosis_mynetwork (172.30.0.6)
Host is up (0.000016s latency).
MAC Address: 02:42:AC:1E:00:06 (Unknown)
Nmap scan report for symbiosis-docker-1.symbiosis_mynetwork (172.30.0.7)
Host is up (0.000021s latency).
MAC Address: 02:42:AC:1E:00:07 (Unknown)
Nmap scan report for symbiosis-worker-1.symbiosis_mynetwork (172.30.0.9)
Host is up (0.000024s latency).
MAC Address: 02:42:AC:1E:00:09 (Unknown)
Nmap scan report for 95def7cb933d (172.30.0.10)
Host is up.</code></pre></div></div></div></section><section id="comment_configurer_dependabot_pour_gitlab_9" data-auto-animate><h2>üöÄ Comment configurer Dependabot pour GitLab ? ü¶äüõ†Ô∏è</h2><div class="slide-content"><div class="paragraph"><p>Victoire?</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker compose -f docker-compose-dependabot.yml exec -it -u root web b
ash
root@95def7cb933d:/home/dependabot/app# ping symbiosis-gitlab-1.symbiosis_mynetwork
PING symbiosis-gitlab-1.symbiosis_mynetwork (172.30.0.2) 56(84) bytes of data.
64 bytes from symbiosis-gitlab-1.symbiosis_mynetwork (172.30.0.2): icmp_seq=1 ttl=64 time=0.165 ms
64 bytes from symbiosis-gitlab-1.symbiosis_mynetwork (172.30.0.2): icmp_seq=2 ttl=64 time=0.053 ms
64 bytes from symbiosis-gitlab-1.symbiosis_mynetwork (172.30.0.2): icmp_seq=3 ttl=64 time=0.039 ms
64 bytes from symbiosis-gitlab-1.symbiosis_mynetwork (172.30.0.2): icmp_seq=4 ttl=64 time=0.040 ms
64 bytes from symbiosis-gitlab-1.symbiosis_mynetwork (172.30.0.2): icmp_seq=5 ttl=64 time=0.056 ms
^C
--- symbiosis-gitlab-1.symbiosis_mynetwork ping statistics ---
5 packets transmitted, 5 received, 0% packet loss, time 4165ms
rtt min/avg/max/mdev = 0.039/0.070/0.165/0.047 ms</code></pre></div></div>
<div class="imageblock fragment"><img src="media/dependabot-404-gitlab.png" alt="dependabot 404 gitlab"></div>
<div class="paragraph fragment"><p>On y est presque!</p></div>
<aside class="notes"><div class="paragraph"><p>dependabot gitlab
updatecli
renovabot gitlab</p></div>
<div class="paragraph"><p>gitlab complet docker compose
jenkins complet docker compose
Kube?</p></div>
<div class="paragraph"><p>services ashutosh mix and match de conteneurs</p></div>
<div class="paragraph"><p>build arm64, cloud et buildx</p></div></aside></div></section><section id="debugging_docker_exec"><h2>Debugging : docker exec</h2><div class="slide-content"><div class="paragraph"><p>rappel : `docker container exec `permet de lancer une commande dans un container</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker exec &lt;containerID&gt; echo "hello"</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker exec ‚Äìit &lt;containerID&gt; bash</code></pre></div></div></div></section><section id="debugging_docker_inspect"><h2>Debugging : docker inspect</h2><div class="slide-content"><div class="paragraph"><p>rappel : `docker inspect `permet de lister toutes les caract√©ristiques d&#8217;une image ou d&#8217;un container.</p></div>
<div class="paragraph"><p>On peut filtrer le retour de la commande avec <code>jq</code> ou l&#8217;option <code>--format</code>.</p></div></div></section><section id="debugging_docker_cp"><h2>Debugging : docker cp</h2><div class="slide-content"><div class="paragraph"><p>Cette commande permet d&#8217;√©changer des fichiers entre un conteneur et la machine h√¥te.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker cp --help
Usage:  docker cp [OPTIONS] CONTAINER:SRC_PATH DEST_PATH|-
        docker cp [OPTIONS] SRC_PATH|- CONTAINER:DEST_PATH
Copy files/folders between a container and the local filesystem
Options:
  -a, --archive       Archive mode (copy all uid/gid information)
  -L, --follow-link   Always follow symbol link in SRC_PATH</code></pre></div></div></div></section><section id="debugging_docker_history"><h2>Debugging : docker history</h2><div class="slide-content"><div class="paragraph"><p>Cette commande permet d&#8217;afficher la concat√©nation de tous les Dockerfiles qui ont abouti √† cette image.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker history nginx
IMAGE               CREATED             CREATED BY                                      SIZE                f35646e83998        4 weeks ago         /bin/sh -c #(nop)  CMD ["nginx" "-g" "daemon‚Ä¶   0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  STOPSIGNAL SIGTERM           0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  EXPOSE 80                    0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  ENTRYPOINT ["/docker-entr‚Ä¶   0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop) COPY file:0fd5fca330dcd6a7‚Ä¶   1.04kB
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop) COPY file:1d0a4127e78a26c1‚Ä¶   1.96kB
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop) COPY file:e7e183879c35719c‚Ä¶   1.2kB
&lt;missing&gt;           4 weeks ago         /bin/sh -c set -x     &amp;&amp; addgroup --system -‚Ä¶   63.6MB
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  ENV PKG_RELEASE=1~buster     0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  ENV NJS_VERSION=0.4.4        0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  ENV NGINX_VERSION=1.19.3     0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  LABEL maintainer=NGINX Do‚Ä¶   0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  CMD ["bash"]                 0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop) ADD file:0dc53e7886c35bc21‚Ä¶   69.2MB</code></pre></div></div></div></section><section id="debugging_docker_stats"><h2>Debugging : docker stats</h2><div class="slide-content"><div class="paragraph"><p>Cette commande permet d&#8217;avoir les stats en temps r√©el d&#8217;un conteneur.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker stats 42f128
CONTAINER           CPU %     MEM USAGE/LIMIT     MEM %     NET I/O
42f128              0.00%     1.454 MB/4.145 GB   0.04%     648 B/648 B</code></pre></div></div></div></section><section id="travaux_pratiques_14"><h2>üéì Travaux pratiques #14</h2><div class="slide-content"><div class="paragraph"><p>Notre valeureux coll√®gue Jean-Michel s&#8217;initiait √† l&#8217;art myst√©rieux de Docker, et g√©n√©reusement partageait ses cr√©ations sous forme d&#8217;images Docker pour l&#8217;entreprise.</p></div>
<div class="paragraph"><p>Michel a soudainement d√©croch√© le jackpot du Loto, laissant derri√®re lui son bureau du jour au lendemain, alors qu&#8217;il √©tait sur le point de nous offrir une image Nginx.</p></div>
<div class="paragraph"><p>D√©sormais, nous n&#8217;avons que le binaire de son chef-d&#8217;≈ìuvre, accessible √† cette adresse :</p></div>
<div class="paragraph"><p><a href="https://owncloud.univ-artois.fr/index.php/s/9s8XBLXvRwBJsrm" class="bare">https://owncloud.univ-artois.fr/index.php/s/9s8XBLXvRwBJsrm</a></p></div>
<div class="paragraph"><p>Rassurez-vous, on nous a dit que <code>docker load</code> est la premi√®re √©tape de la formule magique pour percer les secrets de son ≈ìuvre.</p></div>
<div class="paragraph"><p>√Ä vos claviers ! üßô‚Äç‚ôÇÔ∏è‚ú®</p></div></div></section><section id="solution_travaux_pratiques_14" data-auto-animate><h2>‚úÖ Solution travaux pratiques #14üïµÔ∏è‚Äç‚ôÇÔ∏èüîç</h2><div class="slide-content"><div class="paragraph"><p><code>docker load</code> est la premi√®re √©tape de la formule magique</p></div>
<div class="paragraph fragment"><p>Okay&#8230;&#8203;</p></div>
<div class="paragraph fragment"><p>üßô‚Äç‚ôÇÔ∏è‚ú®</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker load -i bad-nginx.dkr
Loaded image: bad-nginx:1</code></pre></div></div>
<div class="paragraph fragment"><p>Nous voil√† bien avanc√©s&#8230;&#8203;</p></div>
<div class="paragraph fragment"><p>On essaye de lancer un conteneur bas√© dessus‚ÄØ?</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run -d --name bad-1 bad-nginx:1
f4caa4a641729c0ab3d7b5974fa735c128047f75292c7f16495b72c7c6808502</code></pre></div></div>
<div class="paragraph fragment"><p>C&#8217;est lanc√©‚ÄØ?</p></div></div></section><section id="solution_travaux_pratiques_14_2" data-auto-animate><h2>‚úÖ Solution travaux pratiques #14üïµÔ∏è‚Äç‚ôÇÔ∏èüîç</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container ls --format '{{.Names}}' | grep "bad"</code></pre></div></div>
<div class="paragraph fragment"><p>Oups, il n&#8217;est pas l√†&#8230;&#8203;</p></div>
<div class="paragraph fragment"><p>Essayons encore.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container ls -a --format '{{.Names}}' | grep "bad"
bad-1</code></pre></div></div>
<div class="paragraph fragment"><p>C&#8217;est donc lanc√©, mais il a crash√©.</p></div>
<div class="paragraph fragment"><p>Allons donc chercher les logs&#8230;&#8203;</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container logs bad-1
Error : nginx is not executable</code></pre></div></div>
<div class="paragraph fragment"><p>On a trouv√© le probl√®me‚ÄØ!</p></div>
<div class="paragraph fragment"><p>Spoiler alert¬†: on a trouv√© UN probl√®me, pas LE probl√®me.</p></div></div></section><section id="solution_travaux_pratiques_14_3" data-auto-animate><h2>‚úÖ Solution travaux pratiques #14üïµÔ∏è‚Äç‚ôÇÔ∏èüîç</h2><div class="slide-content"><div class="paragraph"><p>Je ne sais pas ce qu&#8217;a fait Jean-Michel, mais il a cass√© le binaire de Nginx.</p></div>
<div class="paragraph fragment"><p>Est-ce un probl√®me de permission, de d√©pendance, de version, de compilation‚ÄØ?</p></div>
<div class="paragraph fragment"><p>En tous cas, c&#8217;est cass√©.</p></div>
<div class="paragraph fragment"><p>Regardons un peu ce que nous dit docker inspect de tout √ßa&#8230;&#8203;</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">docker image inspect bad-nginx:1
[
    {
        "Id": "sha256:a469e4d1cb0c61324298fc6fde09f78f211420a1848b690dec35d9ac324a6cab",
        "RepoTags": [
            "bad-nginx:1"
        ],
        [...]
        "ContainerConfig": {
            [...]
            "ExposedPorts": {
                "80/tcp": {}
            },</code></pre></div></div>
<div class="paragraph fragment"><p>Port 80 expos√©, c&#8217;est bon signe.</p></div></div></section><section id="solution_travaux_pratiques_14_4" data-auto-animate><h2>‚úÖ Solution travaux pratiques #14üïµÔ∏è‚Äç‚ôÇÔ∏èüîç</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">            [...]
            "Env": [
                "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
            ],</code></pre></div></div>
<div class="paragraph fragment"><p>On a un PATH, c&#8217;est bon signe.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">            "Cmd": [
                "/bin/sh",
                "-c",
                "#(nop) ",
                "CMD [\"/bin/sh\" \"-c\" \"nginx\"]"
            ],</code></pre></div></div>
<div class="paragraph fragment"><p>On a un CMD, c&#8217;est bon signe.</p></div></div></section><section id="solution_travaux_pratiques_14_5" data-auto-animate><h2>‚úÖ Solution travaux pratiques #14üïµÔ∏è‚Äç‚ôÇÔ∏èüîç</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">            [...]
            "Entrypoint": [
                "/bin/sh",
                "-c",
                "/tmp/entrypoint.sh"
            ],</code></pre></div></div>
<div class="paragraph fragment"><p>On a un Entrypoint, c&#8217;est bon signe.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">            [...]
            "Labels": {
                [...]
                "org.label-schema.name": "CentOS Base Image",
                [...]
            }
        },
        "DockerVersion": "18.09.0",
        [...]
        "Architecture": "amd64",
        "Os": "linux",
        [...]
    }
]</code></pre></div></div></div></section><section id="solution_travaux_pratiques_14_6" data-auto-animate><h2>‚úÖ Solution travaux pratiques #14üïµÔ∏è‚Äç‚ôÇÔ∏èüîç</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">            [...]
            "Labels": {
                [...]
                "org.label-schema.name": "CentOS Base Image",
                [...]
            }
        },
        "DockerVersion": "18.09.0",
        [...]
        "Architecture": "amd64",
        "Os": "linux",
        [...]
    }
]</code></pre></div></div>
<div class="paragraph fragment"><p>C&#8217;est bien une image Linux <code>amd64</code> (donc pour ton PC, mais pas pour ton Mac M1, toi l√†-bas), mais argh, c&#8217;est bas√© sur CentOS, pas sur Alpine ou Debian‚ÄØ!</p></div>
<div class="paragraph fragment"><p>√áa a √©t√© construit avec une vieille version de Docker.</p></div>
<div class="paragraph fragment"><p>Qu&#8217;est-ce qu&#8217;on fait maintenant‚ÄØ?</p></div></div></section><section id="solution_travaux_pratiques_14_7" class="columns" data-auto-animate><h2>‚úÖ Solution travaux pratiques #14üïµÔ∏è‚Äç‚ôÇÔ∏èüîç</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="paragraph"><p>Tournons-nous vers l&#8217;histoire‚ÄØ!</p></div>
<div class="imageblock"><img src="https://img.20mn.fr/JejnWnikSbSj5suCAo9pug/1200x768_stephane-bern-arrive-elysee-4-octobre-2017.jpg" alt="1200x768 stephane bern arrive elysee 4 octobre 2017"></div></div></div>
<div class="openblock column"><div class="content"><div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker history bad-nginx:1
IMAGE          CREATED       CREATED BY                                      SIZE      COMMENT
a469e4d1cb0c   3 years ago   /bin/sh -c #(nop)  CMD ["/bin/sh" "-c" "ngin‚Ä¶   0B
&lt;missing&gt;      3 years ago   /bin/sh -c #(nop)  ENTRYPOINT ["/bin/sh" "-c‚Ä¶   0B
&lt;missing&gt;      3 years ago   /bin/sh -c #(nop)  EXPOSE 80                    0B
&lt;missing&gt;      3 years ago   /bin/sh -c #(nop) COPY file:b0fc89bcaf962602‚Ä¶   98B
&lt;missing&gt;      3 years ago   /bin/sh -c yum install -y nginx &amp;&amp; yum clean‚Ä¶   56.7MB
&lt;missing&gt;      3 years ago   /bin/sh -c #(nop)  CMD ["/bin/bash"]            0B
&lt;missing&gt;      3 years ago   /bin/sh -c #(nop)  LABEL org.label-schema.sc‚Ä¶   0B
&lt;missing&gt;      3 years ago   /bin/sh -c #(nop) ADD file:538afc0c5c964ce0d‚Ä¶   215MB</code></pre></div></div>
<div class="paragraph fragment"><p>√áa se lit de bas en haut&#8230;&#8203;</p></div>
<div class="paragraph fragment"><p>Le premier <code>ADD</code> est l&#8217;image de base, CentOS.</p></div>
<div class="paragraph fragment"><p>La deuxi√®me ligne, c&#8217;est une m√©tadata, on s&#8217;en fiche un peu.</p></div>
<div class="paragraph fragment"><p>La troisi√®me ligne, c&#8217;est le <code>CMD</code> de l&#8217;image de base, qui est <code>bash</code>.</p></div>
<div class="paragraph fragment"><p>La quatri√®me ligne, c&#8217;est l&#8217;installation de Nginx par l&#8217;inf√¢me <code>yum</code> de Centos (d√©j√† rep√©r√© dans le <code>docker inspect</code>).</p></div></div></div></div></section><section id="solution_travaux_pratiques_14_8" data-auto-animate><h2>‚úÖ Solution travaux pratiques #14üïµÔ∏è‚Äç‚ôÇÔ∏èüîç</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker history bad-nginx:1
IMAGE          CREATED       CREATED BY                                      SIZE      COMMENT
a469e4d1cb0c   3 years ago   /bin/sh -c #(nop)  CMD ["/bin/sh" "-c" "ngin‚Ä¶   0B
&lt;missing&gt;      3 years ago   /bin/sh -c #(nop)  ENTRYPOINT ["/bin/sh" "-c‚Ä¶   0B
&lt;missing&gt;      3 years ago   /bin/sh -c #(nop)  EXPOSE 80                    0B
&lt;missing&gt;      3 years ago   /bin/sh -c #(nop) COPY file:b0fc89bcaf962602‚Ä¶   98B
&lt;missing&gt;      3 years ago   /bin/sh -c yum install -y nginx &amp;&amp; yum clean‚Ä¶   56.7MB
&lt;missing&gt;      3 years ago   /bin/sh -c #(nop)  CMD ["/bin/bash"]            0B
&lt;missing&gt;      3 years ago   /bin/sh -c #(nop)  LABEL org.label-schema.sc‚Ä¶   0B
&lt;missing&gt;      3 years ago   /bin/sh -c #(nop) ADD file:538afc0c5c964ce0d‚Ä¶   215MB</code></pre></div></div>
<div class="paragraph fragment"><p>La cinqui√®me ligne, c&#8217;est sans doute la copie du fichier <code>index.html</code>.</p></div>
<div class="paragraph fragment"><p>La sixi√®me ligne, c&#8217;est l' <code>EXPOSE</code> de l&#8217;image finale, qui est <code>80</code> (d√©j√† rep√©r√© dans le <code>docker inspect</code>).</p></div>
<div class="paragraph fragment"><p>La septi√®me ligne, c&#8217;est le <code>ENTRYPOINT</code> de l&#8217;image finale, qui est <code>/bin/sh -c /tmp/entrypoint.sh</code> (d√©j√† rep√©r√© dans le <code>docker inspect</code>).</p></div></div></section><section id="solution_travaux_pratiques_14_9" data-auto-animate><h2>‚úÖ Solution travaux pratiques #14üïµÔ∏è‚Äç‚ôÇÔ∏èüîç</h2><div class="slide-content"><div class="paragraph"><p>R√©sumons-nous&#8230;&#8203; On a:</p></div>
<div class="ulist"><ul><li class="fragment"><p>une image de base CentOS (√† remplacer par Alpine ou Debian)</p></li><li class="fragment"><p>une installation de <code>nginx</code>.</p></li><li class="fragment"><p>un port <code>80</code> expos√©</p></li><li class="fragment"><p>un <code>ENTRYPOINT</code> qui lance un script <code>nginx</code></p></li><li class="fragment"><p>un fichier HTML, qu&#8217;on n&#8217;a pas encore r√©cup√©r√©
√áa progresse&#8230;&#8203; On peut donc cr√©er un premier üíÄ Dockerfile</p></li></ul></div></div></section><section id="solution_travaux_pratiques_14_10" data-auto-animate><h2>‚úÖ Solution travaux pratiques #14üïµÔ∏è‚Äç‚ôÇÔ∏èüîçüíÄ</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile"># Utiliser Alpine ou Debian comme image de base
FROM alpine

# Mettre √† jour le syst√®me et installer nginx
RUN apk update &amp;&amp; apk add nginx

# Exposer le port 80
EXPOSE 80

# Ajouter un fichier HTML (remplacer /chemin/vers/votre/fichier.html par le chemin r√©el vers votre fichier HTML)
ADD /chemin/vers/votre/fichier.html /usr/share/nginx/html

# D√©finir le point d'entr√©e pour lancer nginx
ENTRYPOINT ["nginx", "-g", "daemon off;"]</code></pre></div></div>
<div class="paragraph fragment"><p>Comment r√©cup√©rer ce fichu fichier HTML?</p></div></div></section><section id="solution_travaux_pratiques_14_11" class="columns" data-auto-animate><h2>‚úÖ Solution travaux pratiques #14üïµÔ∏è‚Äç‚ôÇÔ∏èüîç</h2><div class="slide-content"><div class="openblock column is-half"><div class="content"><div class="paragraph"><p>Essayons de lancer un conteneur bas√© sur notre image, et de r√©cup√©rer le fichier HTML.</p></div>
<div class="paragraph fragment"><p>Le binaire <code>nginx</code> est non fonctionnel, essayons de lancer un conteneur avec un shell.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run -it --name bad-2 --entrypoint=sh bad-nginx:1 sh
/usr/bin/sh: /usr/bin/sh: cannot execute binary file</code></pre></div></div></div></div>
<div class="openblock column is-one-quarter"><div class="content"><div class="imageblock fragment"><img src="https://media.tenor.com/3gzS4mCevVkAAAAC/francais-queendugif.gif" alt="francais queendugif"></div>
<div class="paragraph fragment"><p>Oui, je sais, il y a une faute dans la l√©gende du gif&#8230;&#8203;</p></div></div></div>
<div class="openblock column is-one-quarter"><div class="content"><div class="admonitionblock warning fragment"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content">Jean-Micheeeeeeeeeeeeeeeeel, j&#8217;ai deux mots √† te dire! üò°</td></tr></table></div></div></div></div></section><section id="solution_travaux_pratiques_14_12" data-auto-animate><h2>‚úÖ Solution travaux pratiques #14üïµÔ∏è‚Äç‚ôÇÔ∏èüîç</h2><div class="slide-content"><div class="paragraph"><p>Le conteneur qui tourne, on oublie, donc&#8230;&#8203; Jean-Michel a laiss√© un terrain min√© derri√®re lui. üí£</p></div>
<div class="paragraph fragment"><p>Mais on a d&#8217;autres armes en r√©serve&#8230;&#8203; Le <code>docker container create</code> par exemple‚ÄØ!</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container create --name temp_container bad-nginx:1
9149745197df413f7966181f6ca517b68713edd32ff7c35cea6e958d549a7553</code></pre></div></div>
<div class="paragraph fragment"><p>Utilisons maintenant docker cp pour r√©cup√©rer le fichier HTML.</p></div>
<div class="paragraph fragment"><p>Quel est le r√©pertoire o√π nginx s&#8217;attend √† trouver ses fichiers HTML √† servir?</p></div>
<div class="paragraph fragment"><p><code>/usr/share/nginx/html</code></p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">mkdir /tmp/html &amp;&amp; cd /tmp/html
docker cp temp_container:/usr/share/nginx/html .</code></pre></div></div></div></section><section id="solution_travaux_pratiques_14_13" data-auto-animate><h2>‚úÖ Solution travaux pratiques #14üïµÔ∏è‚Äç‚ôÇÔ∏èüîç</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">head html/index.html</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"&gt;

&lt;html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"&gt;
    &lt;head&gt;
        &lt;title&gt;Test Page for the Nginx HTTP Server on Red Hat Enterprise Linux&lt;/title&gt;
        &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /&gt;
        &lt;style type="text/css"&gt;
            /*&lt;![CDATA[*/
            body {
                background-color: #fff;</code></pre></div></div>
<div class="paragraph fragment"><p>Jean-Michel n&#8217;avait m√™me pas fini de remplir son fichier HTML&#8230;&#8203;
C&#8217;est encore le fichier de base de nginx sous CentOs.
üòû</p></div>
<div class="paragraph fragment"><p>Jean-Michel, t&#8217;assures pas une ü•ú, l√†&#8230;&#8203;</p></div></div></section><section id="solution_travaux_pratiques_14_14" data-auto-animate><h2>‚úÖ Solution travaux pratiques #14üïµÔ∏è‚Äç‚ôÇÔ∏èüîç</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile"># Ce Dockerfile met en place un serveur web simple en utilisant Nginx sur Alpine Linux.

# Utilise Alpine Linux comme image de base. Alpine Linux est une distribution Linux l√©g√®re et orient√©e s√©curit√©.
FROM alpine

# Met √† jour la liste des paquets du syst√®me et installe Nginx.
# Nginx est un serveur web populaire qui peut √©galement √™tre utilis√© comme proxy inverse, √©quilibreur de charge et cache HTTP.
RUN apk update &amp;&amp; apk add nginx &amp;&amp; rm -rf /var/cache/apk/*

# Expose le port 80 au monde ext√©rieur. C'est le port standard pour le trafic HTTP.
EXPOSE 80

# Ajoute un fichier HTML √† la racine du document Nginx.
# Remplacez /chemin/vers/votre/fichier.html par le chemin r√©el vers votre fichier HTML.
ADD /chemin/vers/votre/fichier.html /usr/share/nginx/html

# D√©finit le point d'entr√©e pour le conteneur. Cette commande sera ex√©cut√©e lorsque le conteneur d√©marre.
# La commande "nginx" d√©marre le serveur Nginx.
# Le flag "-g" nous permet de d√©finir des directives globales. Dans ce cas, nous disons √† Nginx de fonctionner au premier plan (daemon off;).
ENTRYPOINT ["nginx", "-g", "daemon off;"]</code></pre></div></div>
<div class="paragraph fragment"><p>Finalement, le üíÄ de notre <code>Dockerfile</code> √©tait d√©j√† bon&#8230;&#8203;</p></div>
<div class="paragraph fragment"><p>Ou presque&#8230;&#8203; Rien ne vous g√™ne dans ce Dockerfile?</p></div>
<div class="paragraph fragment"><p>üë´ don&#8217;t let üë´&#8230;&#8203;</p></div></div></section><section id="lazy_docker" data-auto-animate><h2>üê≥üò¥ Lazy Docker</h2><div class="slide-content"><div class="paragraph"><p><a href="https://blog.stephane-robert.info/docs/conteneurs/moteurs-conteneurs/lazydocker/" class="bare">https://blog.stephane-robert.info/docs/conteneurs/moteurs-conteneurs/lazydocker/</a></p></div></div></section><section id="conseils_pour_l√©val" class="columns" data-auto-animate><h2>Conseils pour l&#8217;√©val'</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="imageblock"><img src="media/final%20answer.png" alt="final answer" height="500px"></div></div></div>
<div class="openblock column"><div class="content"><div class="ulist"><ul><li><p><a href="https://moodle.univ-artois.fr/mod/resource/view.php?id=39414" class="bare">https://moodle.univ-artois.fr/mod/resource/view.php?id=39414</a></p></li><li><p><a href="https://moodle.univ-artois.fr/mod/choicegroup/view.php?id=39415" class="bare">https://moodle.univ-artois.fr/mod/choicegroup/view.php?id=39415</a></p></li><li><p><a href="https://moodle.univ-artois.fr/mod/assign/view.php?id=39416" class="bare">https://moodle.univ-artois.fr/mod/assign/view.php?id=39416</a></p></li></ul></div></div></div></div></section><section id="conseils_pour_leval" data-auto-animate><h2>Conseils pour l&#8217;eval'</h2><div class="slide-content"><div class="imageblock"><img src="media/dont%20panic.png" alt="dont panic" height="500px"></div></div></section><section id="vous_devez_avoir_les_comp√©tences_suivantes"><h2>Vous devez avoir les comp√©tences suivantes:</h2><div class="slide-content"><div class="paragraph"><p>Savoir lancer un container avec toutes les options</p></div>
<div class="ulist"><ul><li><p><code>-v, -p, -w, -e, --rm, etc.</code></p></li></ul></div>
<div class="paragraph"><p>√âcrire un Dockerfile optimis√© pour "dockeriser" une application</p></div>
<div class="ulist"><ul><li><p>pas trop gourmand, facile √† modifier, param√©trable.</p></li></ul></div>
<div class="paragraph"><p>√âtudier une image ou un conteneur pour tout d√©bug √©ventuel.</p></div>
<div class="paragraph"><p>Savoir s&#8217;outiller pour avoir des images qui servent d&#8217;environnement d&#8217;ex√©cution √† votre CI.</p></div>
<div class="paragraph"><p>Monter un √©cosyst√®me applicatif complexe via docker-compose.</p></div></div></section><section id="que_revoir"><h2>Que revoir ?</h2><div class="slide-content"><div class="paragraph"><p>Les TPs sont vos meilleurs amis.</p></div>
<div class="paragraph"><p>La documentation officielle de Docker</p></div>
<div class="paragraph"><p><a href="https://docs.docker.com/engine/reference/run/" class="bare">https://docs.docker.com/engine/reference/run/</a></p></div>
<div class="paragraph"><p><a href="https://docs.docker.com/engine/reference/builder/" class="bare">https://docs.docker.com/engine/reference/builder/</a></p></div>
<div class="paragraph"><p><a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/" class="bare">https://docs.docker.com/develop/develop-images/dockerfile_best-practices/</a></p></div></div></section><section id="one_more_thing"><h2>ü§îüëâ One more thing</h2><div class="slide-content"><div class="imageblock"><img src="media/415439355-image7.png" alt="415439355 image7" height="500px"></div></div></section></section>
<section><section id="bibliographie" data-background-color="rgb(248, 228, 130)" data-state="invert"><h2>Bibliographie</h2></section><section id="ligne_de_commande_2"><h2>Ligne de commande</h2><div class="slide-content"><div class="ulist"><ul><li><p><a href="https://tldp.org" class="bare">https://tldp.org</a></p></li><li><p><a href="https://en.wikipedia.org/wiki/POSIX" class="bare">https://en.wikipedia.org/wiki/POSIX</a></p></li><li><p><a href="https://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop" class="bare">https://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop</a></p></li><li><p><a href="https://linuxhandbook.com/linux-directory-structure/" class="bare">https://linuxhandbook.com/linux-directory-structure/</a></p></li><li><p><a href="https://blog.stephane-robert.info/docs/admin-serveurs/linux/script-shell/" class="bare">https://blog.stephane-robert.info/docs/admin-serveurs/linux/script-shell/</a></p></li><li><p><a href="https://linuxopsys.com/topics/bash-script-examples" class="bare">https://linuxopsys.com/topics/bash-script-examples</a></p></li></ul></div></div></section><section id="git_vcs"><h2>Git / VCS</h2><div class="slide-content"><div class="ulist"><ul><li><p><a href="https://docs.github.com" class="bare">https://docs.github.com</a></p></li><li><p><a href="https://git-scm.com/book/en/v2/Getting-Started-About-Version-Control" class="bare">https://git-scm.com/book/en/v2/Getting-Started-About-Version-Control</a></p></li><li><p><a href="http://martinfowler.com/bliki/VersionControlTools.html" class="bare">http://martinfowler.com/bliki/VersionControlTools.html</a></p></li><li><p><a href="http://martinfowler.com/bliki/FeatureBranch.html" class="bare">http://martinfowler.com/bliki/FeatureBranch.html</a></p></li><li><p><a href="https://about.gitlab.com/2014/09/29/gitlab-flow/" class="bare">https://about.gitlab.com/2014/09/29/gitlab-flow/</a></p></li><li><p><a href="https://www.atlassian.com/git/tutorials/comparing-workflows" class="bare">https://www.atlassian.com/git/tutorials/comparing-workflows</a></p></li><li><p><a href="http://nvie.com/posts/a-successful-git-branching-model/" class="bare">http://nvie.com/posts/a-successful-git-branching-model/</a></p></li><li><p><a href="https://blog.stephane-robert.info/docs/developper/version/git/introduction/" class="bare">https://blog.stephane-robert.info/docs/developper/version/git/introduction/</a></p></li></ul></div></div></section><section id="int√©gration_continue"><h2>Int√©gration Continue</h2><div class="slide-content"><div class="ulist"><ul><li><p><a href="http://martinfowler.com/articles/continuousIntegration.html" class="bare">http://martinfowler.com/articles/continuousIntegration.html</a></p></li><li><p><a href="http://martinfowler.com/bliki/ContinuousDelivery.html" class="bare">http://martinfowler.com/bliki/ContinuousDelivery.html</a></p></li><li><p><a href="https://jaxenter.com/implementing-continuous-delivery-117916.html" class="bare">https://jaxenter.com/implementing-continuous-delivery-117916.html</a></p></li><li><p><a href="https://technologyconversations.com/2014/04/29/continuous-delivery-introduction-to-concepts-and-tools/" class="bare">https://technologyconversations.com/2014/04/29/continuous-delivery-introduction-to-concepts-and-tools/</a></p></li><li><p><a href="http://blog.arungupta.me/continuous-integration-delivery-deployment-maturity-model" class="bare">http://blog.arungupta.me/continuous-integration-delivery-deployment-maturity-model</a></p></li><li><p><a href="http://blog.crisp.se/2013/02/05/yassalsundman/continuous-delivery-vs-continuous-deployment" class="bare">http://blog.crisp.se/2013/02/05/yassalsundman/continuous-delivery-vs-continuous-deployment</a></p></li></ul></div></div></section><section id="docker_2"><h2>Docker</h2><div class="slide-content"><div class="ulist"><ul><li><p><a href="https://labs.play-with-docker.com/" class="bare">https://labs.play-with-docker.com/</a></p></li><li><p><a href="https://dduportal.github.io/cours/cnam-docker-2018" class="bare">https://dduportal.github.io/cours/cnam-docker-2018</a></p></li><li><p><a href="https://kodekloud.com/blog/docker-for-beginners/" class="bare">https://kodekloud.com/blog/docker-for-beginners/</a></p></li><li><p><a href="https://www.slideshare.net/dotCloud/why-docker" class="bare">https://www.slideshare.net/dotCloud/why-docker</a></p></li><li><p><a href="https://docs.docker.com/engine/reference/builder/" class="bare">https://docs.docker.com/engine/reference/builder/</a></p></li><li><p><a href="https://www.r-bloggers.com/2021/05/best-practices-for-r-with-docker/" class="bare">https://www.r-bloggers.com/2021/05/best-practices-for-r-with-docker/</a></p></li><li><p><a href="https://github.com/wagoodman/dive" class="bare">https://github.com/wagoodman/dive</a></p></li><li><p><a href="https://docs.docker.com/engine/tutorials/networkingcontainers/" class="bare">https://docs.docker.com/engine/tutorials/networkingcontainers/</a></p></li><li><p><a href="https://towardsdatascience.com/docker-networking-919461b7f498" class="bare">https://towardsdatascience.com/docker-networking-919461b7f498</a></p></li><li><p><a href="https://blog.stephane-robert.info/post/docker-buildkit-partie-1/" class="bare">https://blog.stephane-robert.info/post/docker-buildkit-partie-1/</a></p></li><li><p><a href="https://dev.to/montells/docker-args-1ael" class="bare">https://dev.to/montells/docker-args-1ael</a></p></li></ul></div></div></section><section id="devops"><h2>DevOps</h2><div class="slide-content"><div class="ulist"><ul><li><p><a href="https://blog.stephane-robert.info/docs/glossaire/introduction/" class="bare">https://blog.stephane-robert.info/docs/glossaire/introduction/</a></p></li></ul></div></div></section></section>
<section id="merci" data-background-color="rgb(248, 228, 130)" data-state="invert"><h2>Merci !</h2><div class="slide-content"><div class="paragraph"><p><span class="icon"><i class="fa fa-envelope"></i></span> <a href="mailto:gounthar@gmail.com">gounthar@gmail.com</a></p></div>
<div class="paragraph small"><small><a href="https://gounthar.github.io/gounthar/cours-devops-docker/main">Slides: https://gounthar.github.io/gounthar/cours-devops-docker/main</a></small></div>
<div class="imageblock"><img src="media/qrcode.png" alt="QRCode to this presentation" height="150"></div>
<div class="paragraph small"><small><a href="https://github.com/gounthar/gounthar/cours-devops-docker" target="_blank">Source on <span class="icon"><i class="fab fa-github"></i></span> : https://github.com/gounthar/gounthar/cours-devops-docker</a></small></div>
<aside class="notes"><div class="ulist"><ul><li><p>Pour transformer des diapos extraites de PowerPoint en les croppant et en rempla√ßant le blanc par du transparent:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {3..10}
do
  convert Diapositive${i}.PNG -crop 9583x4167+1917+1750 -transparent white -resize 1920x output${i}_with_transparency.png
done</code></pre></div></div>
<div class="ulist"><ul><li><p>Pour transformer un PPT en asciidoc (pour en r√©cup√©rer le texte et les images, il ne faut rien en attendre d&#8217;autre):</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">java -jar pptx2adoc.jar Slide.pptx</code></pre></div></div>
<div class="ulist"><ul><li><p>Le projet se trouve l√†: <a href="https://github.com/ullenboom/ppt2asciidocslides" class="bare">https://github.com/ullenboom/ppt2asciidocslides</a></p><div class="ulist"><ul><li><p>Certains des memes ont √©t√© g√©n√©r√© gr√¢ce √† memerator: <a href="https://damemerator.netlify.app/" class="bare">https://damemerator.netlify.app/</a></p></li></ul></div></li></ul></div></aside></div></section></div></div><script src="./reveal.js/dist/reveal.js"></script><script>Array.prototype.slice.call(document.querySelectorAll('.slides section')).forEach(function(slide) {
  if (slide.getAttribute('data-background-color')) return;
  // user needs to explicitly say he wants CSS color to override otherwise we might break custom css or theme (#226)
  if (!(slide.classList.contains('canvas') || slide.classList.contains('background'))) return;
  var bgColor = getComputedStyle(slide).backgroundColor;
  if (bgColor !== 'rgba(0, 0, 0, 0)' && bgColor !== 'transparent') {
    slide.setAttribute('data-background-color', bgColor);
    slide.style.backgroundColor = 'transparent';
  }
});

// More info about config & dependencies:
// - https://github.com/hakimel/reveal.js#configuration
// - https://github.com/hakimel/reveal.js#dependencies
Reveal.initialize({
  // Display presentation control arrows
  controls: true,
  // Help the user learn the controls by providing hints, for example by
  // bouncing the down arrow when they first encounter a vertical slide
  controlsTutorial: true,
  // Determines where controls appear, "edges" or "bottom-right"
  controlsLayout: 'bottom-right',
  // Visibility rule for backwards navigation arrows; "faded", "hidden"
  // or "visible"
  controlsBackArrows: 'faded',
  // Display a presentation progress bar
  progress: true,
  // Display the page number of the current slide
  slideNumber: 'true',
  // Control which views the slide number displays on
  showSlideNumber: 'all',
  // Add the current slide number to the URL hash so that reloading the
  // page/copying the URL will return you to the same slide
  hash: true,
  // Push each slide change to the browser history. Implies `hash: true`
  history: true,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Disables the default reveal.js slide layout so that you can use custom CSS layout
  disableLayout: false,
  // Vertical centering of slides
  center: true,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // See https://github.com/hakimel/reveal.js/#navigation-mode
  navigationMode: 'default',
  // Randomizes the order of slides each time the presentation loads
  shuffle: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags whether to include the current fragment in the URL,
  // so that reloading brings you to the same fragment position
  fragmentInURL: false,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Flags if we should show a help overlay when the questionmark
  // key is pressed
  help: true,
  // Flags if speaker notes should be visible to all viewers
  showNotes: false,
  // Global override for autolaying embedded media (video/audio/iframe)
  // - null: Media will only autoplay if data-autoplay is present
  // - true: All media will autoplay, regardless of individual setting
  // - false: No media will autoplay, regardless of individual setting
  autoPlayMedia: null,
  // Global override for preloading lazy-loaded iframes
  // - null: Iframes with data-src AND data-preload will be loaded when within
  //   the viewDistance, iframes with only data-src will be loaded when visible
  // - true: All iframes with data-src will be loaded when within the viewDistance
  // - false: All iframes with data-src will be loaded only when visible
  preloadIframes: null,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Use this method for navigation when auto-sliding
  autoSlideMethod: Reveal.navigateNext,
  // Specify the average time in seconds that you think you will spend
  // presenting each slide. This is used to show a pacing timer in the
  // speaker view
  defaultTiming: 120,
  // Specify the total time in seconds that is available to
  // present.  If this is set to a nonzero value, the pacing
  // timer will work out the time available for each slide,
  // instead of using the defaultTiming value
  totalTime: 0,
  // Specify the minimum amount of time you want to allot to
  // each slide, if using the totalTime calculation method.  If
  // the automated time allocation causes slide pacing to fall
  // below this threshold, then you will see an alert in the
  // speaker notes window
  minimumTimePerSlide: 0,
  // Enable slide navigation via mouse wheel
  mouseWheel: false,
  // Hide cursor if inactive
  hideInactiveCursor: true,
  // Time before the cursor is hidden (in ms)
  hideCursorTime: 5000,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  // Add `data-preview-link` and `data-preview-link="false"` to customise each link
  // individually
  previewLinks: false,
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: 'slide',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'fade',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Number of slides away from the current that are visible on mobile
  // devices. It is advisable to set this to a lower number than
  // viewDistance in order to save resources.
  mobileViewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: '',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '',
  // Number of pixels to move the parallax background per slide
  // - Calculated automatically unless specified
  // - Set to 0 to disable movement along an axis
  parallaxBackgroundHorizontal: null,
  parallaxBackgroundVertical: null,
  // The display mode that will be used to show slides
  display: 'block',

  // The "normal" size of the presentation, aspect ratio will be preserved
  // when the presentation is scaled to fit different resolutions. Can be
  // specified using percentage units.
  width: 1280,
  height: 720,

  // Factor of the display size that should remain empty around the content
  margin: 0.1,

  // Bounds for smallest/largest possible scale to apply to content
  minScale: 0.2,
  maxScale: 1.5,

  // PDF Export Options
  // Put each fragment on a separate page
  pdfSeparateFragments: true,
  // For slides that do not fit on a page, max number of pages
  pdfMaxPagesPerSlide: 1,

  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: './reveal.js/plugin/zoom/zoom.js', async: true, callback: function () { Reveal.registerPlugin(RevealZoom) } },
      { src: './reveal.js/plugin/notes/notes.js', async: true, callback: function () { Reveal.registerPlugin(RevealNotes) } }
  ],
});</script><script>var dom = {};
dom.slides = document.querySelector('.reveal .slides');

function getRemainingHeight(element, slideElement, height) {
  height = height || 0;
  if (element) {
    var newHeight, oldHeight = element.style.height;
    // Change the .stretch element height to 0 in order find the height of all
    // the other elements
    element.style.height = '0px';
    // In Overview mode, the parent (.slide) height is set of 700px.
    // Restore it temporarily to its natural height.
    slideElement.style.height = 'auto';
    newHeight = height - slideElement.offsetHeight;
    // Restore the old height, just in case
    element.style.height = oldHeight + 'px';
    // Clear the parent (.slide) height. .removeProperty works in IE9+
    slideElement.style.removeProperty('height');
    return newHeight;
  }
  return height;
}

function layoutSlideContents(width, height) {
  // Handle sizing of elements with the 'stretch' class
  toArray(dom.slides.querySelectorAll('section .stretch')).forEach(function (element) {
    // Determine how much vertical space we can use
    var limit = 5; // hard limit
    var parent = element.parentNode;
    while (parent.nodeName !== 'SECTION' && limit > 0) {
      parent = parent.parentNode;
      limit--;
    }
    if (limit === 0) {
      // unable to find parent, aborting!
      return;
    }
    var remainingHeight = getRemainingHeight(element, parent, height);
    // Consider the aspect ratio of media elements
    if (/(img|video)/gi.test(element.nodeName)) {
      var nw = element.naturalWidth || element.videoWidth, nh = element.naturalHeight || element.videoHeight;
      var es = Math.min(width / nw, remainingHeight / nh);
      element.style.width = (nw * es) + 'px';
      element.style.height = (nh * es) + 'px';
    } else {
      element.style.width = width + 'px';
      element.style.height = remainingHeight + 'px';
    }
  });
}

function toArray(o) {
  return Array.prototype.slice.call(o);
}

Reveal.addEventListener('slidechanged', function () {
  layoutSlideContents(1280, 720)
});
Reveal.addEventListener('ready', function () {
  layoutSlideContents(1280, 720)
});
Reveal.addEventListener('resize', function () {
  layoutSlideContents(1280, 720)
});</script><link rel="stylesheet" href="./reveal.js/plugin/highlight/monokai.css"/>
<script src="highlightjs/highlight.min.js"></script>
<script src="highlightjs/languages/groovy.min.js"></script>
<script src="highlightjs/languages/dockerfile.min.js"></script>
<script src="highlightjs/languages/yaml.min.js"></script>
<script src="highlightjs/languages/json.min.js"></script>
<script src="highlightjs/languages/bash.min.js"></script>
<script src="highlightjs/languages/java.min.js"></script>
<script src="highlightjs/languages/javascript.min.js"></script>
<script src="highlightjs/languages/xml.min.js"></script>
<script src="highlightjs/languages/sql.min.js"></script>
<script src="highlightjs/languages/properties.min.js"></script>
<script src="highlightjs/languages/markdown.min.js"></script>
<script src="highlightjs/languages/plaintext.min.js"></script>
<script src="highlightjs/languages/diff.min.js"></script>
<script src="highlightjs/languages/http.min.js"></script>
<script src="highlightjs/languages/apache.min.js"></script>

<script>

/* highlightjs-line-numbers.js 2.6.0 | (C) 2018 Yauheni Pakala | MIT License | github.com/wcoder/highlightjs-line-numbers.js */
/* Edited by Hakim for reveal.js; removed async timeout */
!function(n,e){"use strict";function t(){var n=e.createElement("style");n.type="text/css",n.innerHTML=g(".{0}{border-collapse:collapse}.{0} td{padding:0}.{1}:before{content:attr({2})}",[v,L,b]),e.getElementsByTagName("head")[0].appendChild(n)}function r(t){"interactive"===e.readyState||"complete"===e.readyState?i(t):n.addEventListener("DOMContentLoaded",function(){i(t)})}function i(t){try{var r=e.querySelectorAll("code.hljs,code.nohighlight");for(var i in r)r.hasOwnProperty(i)&&l(r[i],t)}catch(o){n.console.error("LineNumbers error: ",o)}}function l(n,e){"object"==typeof n&&f(function(){n.innerHTML=s(n,e)})}function o(n,e){if("string"==typeof n){var t=document.createElement("code");return t.innerHTML=n,s(t,e)}}function s(n,e){e=e||{singleLine:!1};var t=e.singleLine?0:1;return c(n),a(n.innerHTML,t)}function a(n,e){var t=u(n);if(""===t[t.length-1].trim()&&t.pop(),t.length>e){for(var r="",i=0,l=t.length;i<l;i++)r+=g('<tr><td class="{0}"><div class="{1} {2}" {3}="{5}"></div></td><td class="{4}"><div class="{1}">{6}</div></td></tr>',[j,m,L,b,p,i+1,t[i].length>0?t[i]:" "]);return g('<table class="{0}">{1}</table>',[v,r])}return n}function c(n){var e=n.childNodes;for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];h(r.textContent)>0&&(r.childNodes.length>0?c(r):d(r.parentNode))}}function d(n){var e=n.className;if(/hljs-/.test(e)){for(var t=u(n.innerHTML),r=0,i="";r<t.length;r++){var l=t[r].length>0?t[r]:" ";i+=g('<span class="{0}">{1}</span>\n',[e,l])}n.innerHTML=i.trim()}}function u(n){return 0===n.length?[]:n.split(y)}function h(n){return(n.trim().match(y)||[]).length}function f(e){e()}function g(n,e){return n.replace(/{(\d+)}/g,function(n,t){return e[t]?e[t]:n})}var v="hljs-ln",m="hljs-ln-line",p="hljs-ln-code",j="hljs-ln-numbers",L="hljs-ln-n",b="data-line-number",y=/\r\n|\r|\n/g;n.hljs?(n.hljs.initLineNumbersOnLoad=r,n.hljs.lineNumbersBlock=l,n.hljs.lineNumbersValue=o,t()):n.console.error("highlight.js not detected!")}(window,document);

/**
 * This reveal.js plugin is wrapper around the highlight.js
 * syntax highlighting library.
 */
(function( root, factory ) {
  if (typeof define === 'function' && define.amd) {
    root.RevealHighlight = factory();
  } else if( typeof exports === 'object' ) {
    module.exports = factory();
  } else {
    // Browser globals (root is window)
    root.RevealHighlight = factory();
  }
}( this, function() {

  // Function to perform a better "data-trim" on code snippets
  // Will slice an indentation amount on each line of the snippet (amount based on the line having the lowest indentation length)
  function betterTrim(snippetEl) {
    // Helper functions
    function trimLeft(val) {
      // Adapted from https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/Trim#Polyfill
      return val.replace(/^[\s\uFEFF\xA0]+/g, '');
    }
    function trimLineBreaks(input) {
      var lines = input.split('\n');

      // Trim line-breaks from the beginning
      for (var i = 0; i < lines.length; i++) {
        if (lines[i].trim() === '') {
          lines.splice(i--, 1);
        } else break;
      }

      // Trim line-breaks from the end
      for (var i = lines.length-1; i >= 0; i--) {
        if (lines[i].trim() === '') {
          lines.splice(i, 1);
        } else break;
      }

      return lines.join('\n');
    }

    // Main function for betterTrim()
    return (function(snippetEl) {
      var content = trimLineBreaks(snippetEl.innerHTML);
      var lines = content.split('\n');
      // Calculate the minimum amount to remove on each line start of the snippet (can be 0)
      var pad = lines.reduce(function(acc, line) {
        if (line.length > 0 && trimLeft(line).length > 0 && acc > line.length - trimLeft(line).length) {
          return line.length - trimLeft(line).length;
        }
        return acc;
      }, Number.POSITIVE_INFINITY);
      // Slice each line with this amount
      return lines.map(function(line, index) {
        return line.slice(pad);
      })
        .join('\n');
    })(snippetEl);
  }

  var RevealHighlight = {

    HIGHLIGHT_STEP_DELIMITER: '|',
    HIGHLIGHT_LINE_DELIMITER: ',',
    HIGHLIGHT_LINE_RANGE_DELIMITER: '-',

    init: function( reveal ) {

      // Read the plugin config options and provide fallbacks
      var config = Reveal.getConfig().highlight || {};
      config.highlightOnLoad = typeof config.highlightOnLoad === 'boolean' ? config.highlightOnLoad : true;
      config.escapeHTML = typeof config.escapeHTML === 'boolean' ? config.escapeHTML : true;

      [].slice.call( reveal.getRevealElement().querySelectorAll( 'pre code' ) ).forEach( function( block ) {

        block.parentNode.className = 'code-wrapper';

        // Code can optionally be wrapped in script template to avoid
        // HTML being parsed by the browser (i.e. when you need to
        // include <, > or & in your code).
        let substitute = block.querySelector( 'script[type="text/template"]' );
        if( substitute ) {
          // textContent handles the HTML entity escapes for us
          block.textContent = substitute.innerHTML;
        }

        // Trim whitespace if the "data-trim" attribute is present
        if( block.hasAttribute( 'data-trim' ) && typeof block.innerHTML.trim === 'function' ) {
          block.innerHTML = betterTrim( block );
        }

        // Escape HTML tags unless the "data-noescape" attrbute is present
        if( config.escapeHTML && !block.hasAttribute( 'data-noescape' )) {
          block.innerHTML = block.innerHTML.replace( /</g,"&lt;").replace(/>/g, '&gt;' );
        }

        // Re-highlight when focus is lost (for contenteditable code)
        block.addEventListener( 'focusout', function( event ) {
          hljs.highlightElement( event.currentTarget );
        }, false );

        if( config.highlightOnLoad ) {
          RevealHighlight.highlightBlock( block );
        }
      } );

      // If we're printing to PDF, scroll the code highlights of
      // all blocks in the deck into view at once
      reveal.on( 'pdf-ready', function() {
        [].slice.call( reveal.getRevealElement().querySelectorAll( 'pre code[data-line-numbers].current-fragment' ) ).forEach( function( block ) {
          RevealHighlight.scrollHighlightedLineIntoView( block, {}, true );
        } );
      } );
    },

    /**
     * Highlights a code block. If the <code> node has the
     * 'data-line-numbers' attribute we also generate slide
     * numbers.
     *
     * If the block contains multiple line highlight steps,
     * we clone the block and create a fragment for each step.
     */
    highlightBlock: function( block ) {

      hljs.highlightElement( block );

      // Don't generate line numbers for empty code blocks
      if( block.innerHTML.trim().length === 0 ) return;

      if( block.hasAttribute( 'data-line-numbers' ) ) {
        hljs.lineNumbersBlock( block, { singleLine: true } );

        var scrollState = { currentBlock: block };

        // If there is at least one highlight step, generate
        // fragments
        var highlightSteps = RevealHighlight.deserializeHighlightSteps( block.getAttribute( 'data-line-numbers' ) );
        if( highlightSteps.length > 1 ) {

          // If the original code block has a fragment-index,
          // each clone should follow in an incremental sequence
          var fragmentIndex = parseInt( block.getAttribute( 'data-fragment-index' ), 10 );

          if( typeof fragmentIndex !== 'number' || isNaN( fragmentIndex ) ) {
            fragmentIndex = null;
          }

          // Generate fragments for all steps except the original block
          highlightSteps.slice(1).forEach( function( highlight ) {

            var fragmentBlock = block.cloneNode( true );
            fragmentBlock.setAttribute( 'data-line-numbers', RevealHighlight.serializeHighlightSteps( [ highlight ] ) );
            fragmentBlock.classList.add( 'fragment' );
            block.parentNode.appendChild( fragmentBlock );
            RevealHighlight.highlightLines( fragmentBlock );

            if( typeof fragmentIndex === 'number' ) {
              fragmentBlock.setAttribute( 'data-fragment-index', fragmentIndex );
              fragmentIndex += 1;
            }
            else {
              fragmentBlock.removeAttribute( 'data-fragment-index' );
            }

            // Scroll highlights into view as we step through them
            fragmentBlock.addEventListener( 'visible', RevealHighlight.scrollHighlightedLineIntoView.bind( Plugin, fragmentBlock, scrollState ) );
            fragmentBlock.addEventListener( 'hidden', RevealHighlight.scrollHighlightedLineIntoView.bind( Plugin, fragmentBlock.previousSibling, scrollState ) );

          } );

          block.removeAttribute( 'data-fragment-index' )
          block.setAttribute( 'data-line-numbers', RevealHighlight.serializeHighlightSteps( [ highlightSteps[0] ] ) );

        }

        // Scroll the first highlight into view when the slide
        // becomes visible. Note supported in IE11 since it lacks
        // support for Element.closest.
        var slide = typeof block.closest === 'function' ? block.closest( 'section:not(.stack)' ) : null;
        if( slide ) {
          var scrollFirstHighlightIntoView = function() {
            RevealHighlight.scrollHighlightedLineIntoView( block, scrollState, true );
            slide.removeEventListener( 'visible', scrollFirstHighlightIntoView );
          }
          slide.addEventListener( 'visible', scrollFirstHighlightIntoView );
        }

        RevealHighlight.highlightLines( block );

      }

    },

    /**
     * Animates scrolling to the first highlighted line
     * in the given code block.
     */
    scrollHighlightedLineIntoView: function( block, scrollState, skipAnimation ) {

      cancelAnimationFrame( scrollState.animationFrameID );

      // Match the scroll position of the currently visible
      // code block
      if( scrollState.currentBlock ) {
        block.scrollTop = scrollState.currentBlock.scrollTop;
      }

      // Remember the current code block so that we can match
      // its scroll position when showing/hiding fragments
      scrollState.currentBlock = block;

      var highlightBounds = RevealHighlight.getHighlightedLineBounds( block )
      var viewportHeight = block.offsetHeight;

      // Subtract padding from the viewport height
      var blockStyles = getComputedStyle( block );
      viewportHeight -= parseInt( blockStyles.paddingTop ) + parseInt( blockStyles.paddingBottom );

      // Scroll position which centers all highlights
      var startTop = block.scrollTop;
      var targetTop = highlightBounds.top + ( Math.min( highlightBounds.bottom - highlightBounds.top, viewportHeight ) - viewportHeight ) / 2;

      // Account for offsets in position applied to the
      // <table> that holds our lines of code
      var lineTable = block.querySelector( '.hljs-ln' );
      if( lineTable ) targetTop += lineTable.offsetTop - parseInt( blockStyles.paddingTop );

      // Make sure the scroll target is within bounds
      targetTop = Math.max( Math.min( targetTop, block.scrollHeight - viewportHeight ), 0 );

      if( skipAnimation === true || startTop === targetTop ) {
        block.scrollTop = targetTop;
      }
      else {

        // Don't attempt to scroll if there is no overflow
        if( block.scrollHeight <= viewportHeight ) return;

        var time = 0;
        var animate = function() {
          time = Math.min( time + 0.02, 1 );

          // Update our eased scroll position
          block.scrollTop = startTop + ( targetTop - startTop ) * RevealHighlight.easeInOutQuart( time );

          // Keep animating unless we've reached the end
          if( time < 1 ) {
            scrollState.animationFrameID = requestAnimationFrame( animate );
          }
        };

        animate();

      }

    },

    /**
     * The easing function used when scrolling.
     */
    easeInOutQuart: function( t ) {

      // easeInOutQuart
      return t<.5 ? 8*t*t*t*t : 1-8*(--t)*t*t*t;

    },

    getHighlightedLineBounds: function( block ) {

      var highlightedLines = block.querySelectorAll( '.highlight-line' );
      if( highlightedLines.length === 0 ) {
        return { top: 0, bottom: 0 };
      }
      else {
        var firstHighlight = highlightedLines[0];
        var lastHighlight = highlightedLines[ highlightedLines.length -1 ];

        return {
          top: firstHighlight.offsetTop,
          bottom: lastHighlight.offsetTop + lastHighlight.offsetHeight
        }
      }

    },

    /**
     * Visually emphasize specific lines within a code block.
     * This only works on blocks with line numbering turned on.
     *
     * @param {HTMLElement} block a <code> block
     * @param {String} [linesToHighlight] The lines that should be
     * highlighted in this format:
     * "1" 		= highlights line 1
     * "2,5"	= highlights lines 2 & 5
     * "2,5-7"	= highlights lines 2, 5, 6 & 7
     */
    highlightLines: function( block, linesToHighlight ) {

      var highlightSteps = RevealHighlight.deserializeHighlightSteps( linesToHighlight || block.getAttribute( 'data-line-numbers' ) );

      if( highlightSteps.length ) {

        highlightSteps[0].forEach( function( highlight ) {

          var elementsToHighlight = [];

          // Highlight a range
          if( typeof highlight.end === 'number' ) {
            elementsToHighlight = [].slice.call( block.querySelectorAll( 'table tr:nth-child(n+'+highlight.start+'):nth-child(-n+'+highlight.end+')' ) );
          }
          // Highlight a single line
          else if( typeof highlight.start === 'number' ) {
            elementsToHighlight = [].slice.call( block.querySelectorAll( 'table tr:nth-child('+highlight.start+')' ) );
          }

          if( elementsToHighlight.length ) {
            elementsToHighlight.forEach( function( lineElement ) {
              lineElement.classList.add( 'highlight-line' );
            } );

            block.classList.add( 'has-highlights' );
          }

        } );

      }

    },

    /**
     * Parses and formats a user-defined string of line
     * numbers to highlight.
     *
     * @example
     * RevealHighlight.deserializeHighlightSteps( '1,2|3,5-10' )
     * // [
     * //   [ { start: 1 }, { start: 2 } ],
     * //   [ { start: 3 }, { start: 5, end: 10 } ]
     * // ]
     */
    deserializeHighlightSteps: function( highlightSteps ) {

      // Remove whitespace
      highlightSteps = highlightSteps.replace( /\s/g, '' );

      // Divide up our line number groups
      highlightSteps = highlightSteps.split( RevealHighlight.HIGHLIGHT_STEP_DELIMITER );

      return highlightSteps.map( function( highlights ) {

        return highlights.split( RevealHighlight.HIGHLIGHT_LINE_DELIMITER ).map( function( highlight ) {

          // Parse valid line numbers
          if( /^[\d-]+$/.test( highlight ) ) {

            highlight = highlight.split( RevealHighlight.HIGHLIGHT_LINE_RANGE_DELIMITER );

            var lineStart = parseInt( highlight[0], 10 ),
              lineEnd = parseInt( highlight[1], 10 );

            if( isNaN( lineEnd ) ) {
              return {
                start: lineStart
              };
            }
            else {
              return {
                start: lineStart,
                end: lineEnd
              };
            }

          }
          // If no line numbers are provided, no code will be highlighted
          else {

            return {};

          }

        } );

      } );

    },

    /**
     * Serializes parsed line number data into a string so
     * that we can store it in the DOM.
     */
    serializeHighlightSteps: function( highlightSteps ) {

      return highlightSteps.map( function( highlights ) {

        return highlights.map( function( highlight ) {

          // Line range
          if( typeof highlight.end === 'number' ) {
            return highlight.start + RevealHighlight.HIGHLIGHT_LINE_RANGE_DELIMITER + highlight.end;
          }
          // Single line
          else if( typeof highlight.start === 'number' ) {
            return highlight.start;
          }
          // All lines
          else {
            return '';
          }

        } ).join( RevealHighlight.HIGHLIGHT_LINE_DELIMITER );

      } ).join( RevealHighlight.HIGHLIGHT_STEP_DELIMITER );

    }

  }

  Reveal.registerPlugin( 'highlight', RevealHighlight );

  return RevealHighlight;

}));
        
hljs.configure({
  ignoreUnescapedHTML: true,
});
hljs.highlightAll();
</script><script src="reveal.js/plugin/reveal.js-copycode/copycode.js"></script>
<script src="reveal.js/reveal.js-plugins/menu/menu.js"></script>
<script src="reveal.js/plugin/search/search.js"></script>
<link rel="stylesheet" href="reveal.js/reveal.js-plugins/chalkboard/style.css">
<link rel="stylesheet" href="reveal.js/reveal.js-plugins/customcontrols/style.css">
<script src="reveal.js/reveal.js-plugins/chalkboard/plugin.js"></script>
<script src="reveal.js/reveal.js-plugins/customcontrols/plugin.js"></script>
<script>
  Reveal.configure({
    copycode: {
      button: "hover", // Allow not showing button when exporting to PDF
      display: "both",
      clipboardjspath: "scripts/clipboard.min.js",
      style: {
        scale: 0.7,
      },
    },
    customcontrols: {
      controls: [
        { icon: '<i class="fa fa-pen-square"></i>',
          title: 'Toggle chalkboard (B)',
          action: 'RevealChalkboard.toggleChalkboard();'
        },
        { icon: '<i class="fa fa-pen"></i>',
          title: 'Toggle notes canvas (C)',
          action: 'RevealChalkboard.toggleNotesCanvas();'
        }
      ]
    },
  })
  Reveal.registerPlugin(CopyCode)
  Reveal.registerPlugin(RevealMenu)
  Reveal.registerPlugin(RevealSearch)
  Reveal.registerPlugin(RevealChalkboard)
  Reveal.registerPlugin(RevealCustomControls)
</script></body></html>