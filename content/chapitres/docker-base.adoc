= Containers

image::blue-shipping-container.png[background, size=contain, position=left, opacity=0.1]

== ğŸ“ Exercice : Votre premier conteneur

C'est Ã  vous (ouf) !

* Allez dans Gitpod
* Dans un terminal, tapez la commande suivante :

[source,bash]
----
docker container run hello-world
# Equivalent de l'ancienne commande 'docker run'
----

[%auto-animate]
== ğŸ©» Anatomie

* Un service "Docker Engine" tourne en tÃ¢che de fond et publie une API REST
* La commande `docker container run ...` a lancÃ© un client docker qui a envoyÃ© une requÃªte `POST` au service docker
* Le service a tÃ©lÃ©chargÃ© une **Image** Docker depuis le registre **DockerHub**,
* Puis a exÃ©cutÃ© un **conteneur** basÃ© sur cette image

[%auto-animate]
== ğŸ©» Anatomie

image::output3_with_transparency.png[]

[%auto-animate]
== ğŸ©» Anatomie

image::output4_with_transparency.png[]

[%auto-animate]
== ğŸ©» Anatomie

image::output5_with_transparency.png[]
[%auto-animate]
== ğŸ©» Anatomie

image::output6_with_transparency.png[]

[%auto-animate]
== ğŸ©» Anatomie

image::output7_with_transparency.png[]

[%auto-animate]
== ğŸ©» Anatomie

image::output8_with_transparency.png[]

[%auto-animate]
== ğŸ©» Anatomie

image::output9_with_transparency.png[]

[%auto-animate]
== ğŸ©» Anatomie

image::output10_with_transparency.png[]

[%auto-animate]
== ğŸ©» Anatomie

image::dollar_date.png[]

[%auto-animate]
== ğŸ©» Anatomie

image::shell_dans_shell_pour_date.png[]

== ğŸ“ Exercice : OÃ¹ est mon conteneur ?

C'est Ã  vous !

[source,bash]
----
docker container ls --help
# ...
docker container ls
# ...
docker container ls --all
----

=> ğŸ¤” comment comprenez vous les rÃ©sultats des 2 derniÃ¨res commandes ?

== âœ… Solution : OÃ¹ est mon conteneur ?

Le conteneur est toujours prÃ©sent dans le "Docker Engine" mÃªme en Ã©tant arrÃªtÃ©

[source,shell]
----
CONTAINER ID   IMAGE         COMMAND    CREATED          STATUS                      PORTS     NAMES
109a9cdd3ec8   hello-world   "/hello"   33 seconds ago   Exited (0) 17 seconds ago             festive_faraday
----

* Un conteneur == une commande "conteneurisÃ©e"
** cf. colonne "*COMMAND*"

* Quand la commande s'arrÃªte : le conteneur s'arrÃªte
** cf. code de sortie dans la colonne "*STATUS*"

[%auto-animate]
== ğŸ« Rappels d'anatomie

[source, shell]
----
$ docker container run busybox echo hello world
----

[%auto-animate]
== ğŸ« Rappels d'anatomie

[source, shell]
----
$ docker container run busybox echo hello world
----

* Le moteur Docker crÃ©e un container Ã  partir de l'image "busybox".

[%auto-animate]
== ğŸ« Rappels d'anatomie

[source, shell]
----
$ docker container run busybox echo hello world
----

* Le moteur Docker crÃ©e un container Ã  partir de l'image "busybox".
* Le moteur Docker dÃ©marre le container crÃ©Ã©.

[%auto-animate]
== ğŸ« Rappels d'anatomie

[source, shell]
----
$ docker container run busybox echo hello world
----

* Le moteur Docker crÃ©e un container Ã  partir de l'image "busybox".
* Le moteur Docker dÃ©marre le container crÃ©Ã©.
* La commande "echo hello world" est exÃ©cutÃ©e Ã  l'intÃ©rieur du container.

[%auto-animate]
== ğŸ« Rappels d'anatomie

[source, shell]
----
$ docker container run busybox echo hello world
----

* Le moteur Docker crÃ©e un container Ã  partir de l'image "busybox".
* Le moteur Docker dÃ©marre le container crÃ©Ã©.
* La commande "echo hello world" est exÃ©cutÃ©e Ã  l'intÃ©rieur du container.
* On obtient le rÃ©sultat dans la sortie standard de la machine hÃ´te.

[%auto-animate]
== ğŸ« Rappels d'anatomie

[source, shell]
----
$ docker container run busybox echo hello world
----

* Le moteur Docker crÃ©e un container Ã  partir de l'image "busybox".
* Le moteur Docker dÃ©marre le container crÃ©Ã©.
* La commande "echo hello world" est exÃ©cutÃ©e Ã  l'intÃ©rieur du container.
* On obtient le rÃ©sultat dans la sortie standard de la machine hÃ´te.
* Le container est stoppÃ©.

[%auto-animate]
== ğŸ½ï¸ Cas d'usage

Outillage jetable

image::outillage-jetable.png[]

* Tester une version de Maven, de JDK, de NPM, â€¦

== ğŸ“ Exercice : Cycle de vie d'un conteneur simple

* Lancez un nouveau conteneur nommÃ© `bonjour`
** ğŸ’¡ `docker container run --help` ou https://docs.docker.com/engine/reference/commandline/container_run/[Documentation en ligne,window="_blank"]

* Affichez les "logs" du conteneur (==traces d'exÃ©cution Ã©crites sur le stdout + stderr de la commande conteneurisÃ©e)
** ğŸ’¡ `docker container logs  --help` ou https://docs.docker.com/engine/reference/commandline/container_logs/[Documentation en ligne,window="_blank"]

* Lancez le conteneur avec la commande https://docs.docker.com/engine/reference/commandline/container_start/[`docker container start`,window="_blank"]
** Regardez le rÃ©sultat dans les logs

* Supprimez le container avec la commande https://docs.docker.com/engine/reference/commandline/container_rm/[`docker container rm`,window="_blank"]

== âœ… Solution : Cycle de vie d'un conteneur simple

[source,bash]
----
docker container run --name=bonjour hello-world
# Affiche le texte habituel

docker container logs bonjour
# Affiche le mÃªme texte : pratique si on a fermÃ© le terminal

docker container start bonjour
# N'affiche pas le texte mais l'identifiant unique du conteneur 'bonjour'

docker container logs bonjour
# Le texte est affichÃ© 2 fois !

docker container ls --all
# Le conteneur est prÃ©sent
docker container rm bonjour
docker container ls --all
# Le conteneur n'est plus lÃ  : il a Ã©tÃ© supprimÃ© ainsi que ses logs

docker container logs bonjour
# Error: No such container: bonjour
----

== ğŸ¤” Que contient "hello-world" ?

* C'est une "image" de conteneur, c'est Ã  dire un modÃ¨le (template)
reprÃ©sentant une application auto-suffisante.
** On peut voir Ã§a comme un "paquetage" autonome

* C'est un systÃ¨me de fichier complet:
** Il y a au moins une racine `/`
** Ne contient que ce qui est censÃ© Ãªtre nÃ©cessaire (dÃ©pendances, librairies, binaires, etc.)

== Docker Hub

* https://hub.docker.com/ : C'est le registre d'images "par dÃ©faut"
** Exemple : Image officielle de https://hub.docker.com/_/ubuntu[conteneur "Ubuntu"]

* ğŸ“ Cherchez l'image `hello-world` pour en voir la page de documentation
** ğŸ’¡ pas besoin de crÃ©er de compte pour Ã§a

* Il existe d'autre "registres" en fonction des besoins (GitHub GHCR, Google GCR, etc.)

// Utiliser un conteneur interactif
include::./sous-chapitres/docker-base/interactif.adoc[leveloffset=1]


// Utiliser un conteneur en tÃ¢che de fond
include::./sous-chapitres/docker-base/demons.adoc[leveloffset=1]

// ParticularitÃ©s de la fac
include::./sous-chapitres/docker-base/proxy.adoc

== Checkpoint ğŸ¯

* Docker essaye de rÃ©soudre le problÃ¨me de l'empaquetage le plus "portable" possible
** On n'en a pas encore vu les effets, Ã§a arrive !

* Vous avez vu qu'un containeur permet d'exÃ©cuter une commande dans un environnement "prÃ©parÃ©"
** Catalogue d'images Docker par dÃ©faut : Le https://hub.docker.com[Docker Hub]

* Vous avez vu qu'on peut exÃ©cuter des conteneurs selon 3 modes :
** "One shot"
** Interactif
** En tÃ¢che de fond

=> ğŸ¤” Mais comment ces images sont-elles fabriquÃ©es ? Quelle confiance leur accorder ?
