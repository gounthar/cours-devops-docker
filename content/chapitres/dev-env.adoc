[{invert}]
= Pr√©parer votre environnement de travail

// Particularit√©s de la fac
== Particularit√©s du r√©seau
include::./sous-chapitres/dev-env/proxy.adoc[leveloffset=1]

== Autre approche... Gitpod

== Outils N√©cessaires üõ†

* Un navigateur web r√©cent (et d√©cent)
* Un compte sur link:https://github.com[{github_icon} GitHub,window="_blank"]

== GitPod

link:https://gitpod.io[GitPod.io,window="_blank"] : Environnement de d√©veloppement dans le ‚òÅÔ∏è "nuage"

* **But:** reproductible
* Puissance de calcul sur un serveur distant
* √âditeur de code VSCode dans le navigateur

[%step]
WARNING: Gratuit pour 50h par mois (‚ö†Ô∏è)
[%step]
WARNING: √áa, c'√©tait avant (‚ö†Ô∏è)
[%step]
WARNING: Gratuit pour 10h par mois (‚ö†Ô∏è)
[%step]
WARNING: Gratuit pour 50h par mois si compte {linkedin_icon} li√© (‚ö†Ô∏è)

== D√©marrer avec GitPod üöÄ

* Rendez vous sur link:https://gitpod.io[window="_blank"]

* Authentifiez vous en utilisant votre compte GitHub:
** Bouton "Login" en haut √† droite
** Puis choisissez le lien "{github_icon} Continue with GitHub"

[.small]
‚ö†Ô∏è Pour les "autorisations", passez sur la slide suivante

== Autorisations demand√©es par GitPod üîì

Lors de votre premi√®re connexion, GitPod va vous demander l'acc√®s (√† accepter) √† votre email public configur√© dans GitHub :

image::gitpod-github-permissions.png[width=400]

[.small]
‚ö†Ô∏è Passez √† la slide suivante avant d'aller plus loin

== Validation du Compte GitPod üì±

GitPod vous demande votre num√©ro de t√©l√©phone mobile afin d'√©viter les abus (service gratuit).
Saisissez un num√©ro de t√©l√©phone valide pour recevoir par SMS un code de d√©blocage :

image::gitpod-phone-validation.png[width=400]

[.small]
‚ö†Ô∏è Passez √† la slide suivante avant d'aller plus loin

== Choix de l'√âditeur de Code ‚úé

Choisissez l'√©diteur "VSCode Browser" (la premi√®re tuile) :

image::gitpod-select-editor.png[width=600]

[.small]
‚ö†Ô∏è Passez √† la slide suivante avant d'aller plus loin

== Workspaces GitPod üóÇ

* Vous arrivez sur la link:https://gitpod.io/workspaces[page listant les "workspaces" GitPod,window="_blank"] :

* Un workspace est une instance d'un environnement de travail virtuel (C'est un ordinateur distant)

* ‚ö†  Faites attention √† r√©utiliser le m√™me workspace tout au long de ce cours ‚ö†

image::gitpod-workspaces.png[width=600]

== Permissions GitPod <-> GitHub üîê

* Pour les besoins de ce cours, vous devez autoriser GitPod √† pouvoir effectuer certaines modification dans vos d√©p√¥ts GitHub
* Rendez-vous sur https://gitpod.io/user/integrations[la page des int√©grations avec GitPod,window="_blank"]
* √âditez les permissions de la ligne "GitHub" (les 3 petits points √† droits) et s√©lectionnez uniquement :
** `user:email`
** `public_repo`
** `workflow`

== D√©marrer l'environnement GitPod

Cliquez sur le bouton ci-dessous pour d√©marrer un environnement GitPod personnalis√©:

image::https://gitpod.io/button/open-in-gitpod.svg[link="https://gitpod.io#{gitpod_github_repo_url}",window="_blank"]

Apr√®s quelques secondes (minutes?), vous avez acc√®s √† l'environnement:

* Gauche: navigateur de fichiers ("Workspace")
* Haut: √©diteur de texte ("Get Started")
* Bas: Terminal interactif
* √Ä droite en bas: plein de popups √† ignorer (ou pas?)

[.small]
Source disponible dans : link:{gitpod_github_repo_url}[{github_icon} {gitpod_github_repo_url}, window="_blank"]

== Checkpoint üéØ

* Vous devriez pouvoir taper la commande `whoami` dans le terminal de GitPod:
** Retour attendu: `gitpod`

* Vous devriez pouvoir fermer le fichier "Get Started"...
** ... et ouvrir n'importe quel autre fichier...

Bien, on peut maintenant fermer ce workspace, il ne s'agirait pas de gaspiller vos 50 heures.

== üìö Et Gitlab?

GitPod fonctionne aussi avec gitlab.com, mais pour les instances on premise, il faut l'installer, l'instancier, avoir un "inner cloud"

[%step]
Bref, on ne l'a pas ici. `¬Ø\_(„ÉÑ)_/¬Ø`

== üê≥ Installation locale de Docker

=== Ubuntu 25.04 et le conflit Podman ‚ö†Ô∏è

**Probl√®me :** Ubuntu 25.04+ est livr√© avec Podman par d√©faut, ce qui peut emp√™cher Docker de fonctionner correctement.

**Sympt√¥me :** Erreur "Cannot connect to the Docker daemon"

[.columns]
=== Solution 1 : Variable DOCKER_HOST (rapide)

**Pour une session :**
[source,bash]
----
export DOCKER_HOST=unix:///var/run/docker.sock
docker ps  # Devrait fonctionner
----

**Permanent (ajouter √† ~/.bashrc ou ~/.zshrc) :**
[source,bash]
----
echo 'export DOCKER_HOST=unix:///var/run/docker.sock' >> ~/.bashrc
source ~/.bashrc
----

=== Solution 2 : D√©sinstaller Podman (recommand√©)

**Si vous n'utilisez pas Podman :**
[source,bash]
----
sudo apt remove podman podman-docker
sudo apt install docker.io
sudo systemctl start docker
sudo systemctl enable docker
----

[.notes]
--
**CONTEXTE - UBUNTU 25.04 ET PODMAN :**

Ubuntu 25.04 (Noble Numbat) marque un changement majeur : Podman devient le moteur de conteneurs par d√©faut √† la place de Docker.

**Pourquoi ce changement ?**
- Podman est "daemonless" (pas de daemon en root)
- Mieux int√©gr√© avec systemd
- Compatible OCI (Open Container Initiative)
- Plus s√©curis√© par d√©faut (rootless)

**Le conflit :**
- Podman cr√©e un socket `/run/podman/podman.sock`
- Docker cherche `/var/run/docker.sock`
- Si les deux sont install√©s : confusion entre les sockets

**Solution 1 - DOCKER_HOST :**
‚úÖ Rapide, non-destructif
‚úÖ Permet de garder Podman install√©
‚ùå Doit √™tre configur√© pour chaque session/utilisateur
‚ùå Peut causer confusion si oubli√©

**Solution 2 - D√©sinstaller Podman :**
‚úÖ Solution propre et d√©finitive
‚úÖ Pas de configuration suppl√©mentaire
‚úÖ Recommand√© pour un cours Docker
‚ùå Supprime Podman si vous en avez besoin

**Pour le TP :**
- Recommander Solution 2 si les √©tudiants ne connaissent pas Podman
- Solution 1 acceptable pour tests rapides
- Dans GitPod : aucun probl√®me, Docker pr√©configur√©

**Alternative bonus - Podman :**
Si vous voulez enseigner Podman au lieu de Docker :
```bash
alias docker=podman
```
Podman est compatible avec la CLI Docker !

**MESSAGE CL√â :**
"Ubuntu 25.04 privil√©gie Podman, mais pour ce cours Docker, choisissez une solution claire : soit Docker seul, soit Podman avec alias. √âvitez d'avoir les deux install√©s simultan√©ment sans configuration."
--

[.small]
On peut commencer !