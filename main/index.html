<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui"><title>🇫🇷 Devops : Docker</title><link rel="stylesheet" href="./reveal.js/dist/reset.css"><link rel="stylesheet" href="./reveal.js/dist/reveal.css"><link rel="stylesheet" href="./styles/build.css" id="theme"><!--This CSS is generated by the Asciidoctor reveal.js converter to further integrate AsciiDoc's existing semantic with reveal.js--><style type="text/css">.reveal div.right {
  float: right
}

/* source blocks */
.reveal .listingblock.stretch > .content {
  height: 100%
}

.reveal .listingblock.stretch > .content > pre {
  height: 100%
}

.reveal .listingblock.stretch > .content > pre > code {
  height: 100%;
  max-height: 100%
}

/* auto-animate feature */
/* hide the scrollbar when auto-animating source blocks */
.reveal pre[data-auto-animate-target] {
  overflow: hidden;
}

.reveal pre[data-auto-animate-target] code {
  overflow: hidden;
}

/* add a min width to avoid horizontal shift on line numbers */
code.hljs .hljs-ln-line.hljs-ln-n {
  min-width: 1.25em;
}

/* tables */
table {
  border-collapse: collapse;
  border-spacing: 0
}

table {
  margin-bottom: 1.25em;
  border: solid 1px #dedede
}

table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td {
  padding: .5em .625em .625em;
  font-size: inherit;
  text-align: left
}

table tr th, table tr td {
  padding: .5625em .625em;
  font-size: inherit
}

table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td {
  display: table-cell;
  line-height: 1.6
}

td.tableblock > .content {
  margin-bottom: 1.25em
}

td.tableblock > .content > :last-child {
  margin-bottom: -1.25em
}

table.tableblock, th.tableblock, td.tableblock {
  border: 0 solid #dedede
}

table.grid-all > thead > tr > .tableblock, table.grid-all > tbody > tr > .tableblock {
  border-width: 0 1px 1px 0
}

table.grid-all > tfoot > tr > .tableblock {
  border-width: 1px 1px 0 0
}

table.grid-cols > * > tr > .tableblock {
  border-width: 0 1px 0 0
}

table.grid-rows > thead > tr > .tableblock, table.grid-rows > tbody > tr > .tableblock {
  border-width: 0 0 1px
}

table.grid-rows > tfoot > tr > .tableblock {
  border-width: 1px 0 0
}

table.grid-all > * > tr > .tableblock:last-child, table.grid-cols > * > tr > .tableblock:last-child {
  border-right-width: 0
}

table.grid-all > tbody > tr:last-child > .tableblock, table.grid-all > thead:last-child > tr > .tableblock, table.grid-rows > tbody > tr:last-child > .tableblock, table.grid-rows > thead:last-child > tr > .tableblock {
  border-bottom-width: 0
}

table.frame-all {
  border-width: 1px
}

table.frame-sides {
  border-width: 0 1px
}

table.frame-topbot, table.frame-ends {
  border-width: 1px 0
}

.reveal table th.halign-left, .reveal table td.halign-left {
  text-align: left
}

.reveal table th.halign-right, .reveal table td.halign-right {
  text-align: right
}

.reveal table th.halign-center, .reveal table td.halign-center {
  text-align: center
}

.reveal table th.valign-top, .reveal table td.valign-top {
  vertical-align: top
}

.reveal table th.valign-bottom, .reveal table td.valign-bottom {
  vertical-align: bottom
}

.reveal table th.valign-middle, .reveal table td.valign-middle {
  vertical-align: middle
}

table thead th, table tfoot th {
  font-weight: bold
}

tbody tr th {
  display: table-cell;
  line-height: 1.6
}

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p {
  font-weight: bold
}

thead {
  display: table-header-group
}

.reveal table.grid-none th, .reveal table.grid-none td {
  border-bottom: 0 !important
}

/* kbd macro */
kbd {
  font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace;
  display: inline-block;
  color: rgba(0, 0, 0, .8);
  font-size: .65em;
  line-height: 1.45;
  background: #f7f7f7;
  border: 1px solid #ccc;
  -webkit-border-radius: 3px;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, .2), 0 0 0 .1em white inset;
  box-shadow: 0 1px 0 rgba(0, 0, 0, .2), 0 0 0 .1em #fff inset;
  margin: 0 .15em;
  padding: .2em .5em;
  vertical-align: middle;
  position: relative;
  top: -.1em;
  white-space: nowrap
}

.keyseq kbd:first-child {
  margin-left: 0
}

.keyseq kbd:last-child {
  margin-right: 0
}

/* callouts */
.conum[data-value] {
  display: inline-block;
  color: #fff !important;
  background: rgba(0, 0, 0, .8);
  -webkit-border-radius: 50%;
  border-radius: 50%;
  text-align: center;
  font-size: .75em;
  width: 1.67em;
  height: 1.67em;
  line-height: 1.67em;
  font-family: "Open Sans", "DejaVu Sans", sans-serif;
  font-style: normal;
  font-weight: bold
}

.conum[data-value] * {
  color: #fff !important
}

.conum[data-value] + b {
  display: none
}

.conum[data-value]:after {
  content: attr(data-value)
}

pre .conum[data-value] {
  position: relative;
  top: -.125em
}

b.conum * {
  color: inherit !important
}

.conum:not([data-value]):empty {
  display: none
}

/* Callout list */
.hdlist > table, .colist > table {
  border: 0;
  background: none
}

.hdlist > table > tbody > tr, .colist > table > tbody > tr {
  background: none
}

td.hdlist1, td.hdlist2 {
  vertical-align: top;
  padding: 0 .625em
}

td.hdlist1 {
  font-weight: bold;
  padding-bottom: 1.25em
}

/* Disabled from Asciidoctor CSS because it caused callout list to go under the
 * source listing when .stretch is applied (see #335)
 * .literalblock+.colist,.listingblock+.colist{margin-top:-.5em} */
.colist td:not([class]):first-child {
  padding: .4em .75em 0;
  line-height: 1;
  vertical-align: top
}

.colist td:not([class]):first-child img {
  max-width: none
}

.colist td:not([class]):last-child {
  padding: .25em 0
}

/* Override Asciidoctor CSS that causes issues with reveal.js features */
.reveal .hljs table {
  border: 0
}

/* Callout list rows would have a bottom border with some reveal.js themes (see #335) */
.reveal .colist > table th, .reveal .colist > table td {
  border-bottom: 0
}

/* Fixes line height with Highlight.js source listing when linenums enabled (see #331) */
.reveal .hljs table thead tr th, .reveal .hljs table tfoot tr th, .reveal .hljs table tbody tr td, .reveal .hljs table tr td, .reveal .hljs table tfoot tr td {
  line-height: inherit
}

/* Columns layout */
.columns .slide-content {
  display: flex;
}

.columns.wrap .slide-content {
  flex-wrap: wrap;
}

.columns.is-vcentered .slide-content {
  align-items: center;
}

.columns .slide-content > .column {
  display: block;
  flex-basis: 0;
  flex-grow: 1;
  flex-shrink: 1;
}

.columns .slide-content > .column > * {
  padding: .75rem;
}

/* See #353 */
.columns.wrap .slide-content > .column {
  flex-basis: auto;
}

.columns .slide-content > .column.is-full {
  flex: none;
  width: 100%;
}

.columns .slide-content > .column.is-four-fifths {
  flex: none;
  width: 80%;
}

.columns .slide-content > .column.is-three-quarters {
  flex: none;
  width: 75%;
}

.columns .slide-content > .column.is-two-thirds {
  flex: none;
  width: 66.6666%;
}

.columns .slide-content > .column.is-three-fifths {
  flex: none;
  width: 60%;
}

.columns .slide-content > .column.is-half {
  flex: none;
  width: 50%;
}

.columns .slide-content > .column.is-two-fifths {
  flex: none;
  width: 40%;
}

.columns .slide-content > .column.is-one-third {
  flex: none;
  width: 33.3333%;
}

.columns .slide-content > .column.is-one-quarter {
  flex: none;
  width: 25%;
}

.columns .slide-content > .column.is-one-fifth {
  flex: none;
  width: 20%;
}

.columns .slide-content > .column.has-text-left {
  text-align: left;
}

.columns .slide-content > .column.has-text-justified {
  text-align: justify;
}

.columns .slide-content > .column.has-text-right {
  text-align: right;
}

.columns .slide-content > .column.has-text-left {
  text-align: left;
}

.columns .slide-content > .column.has-text-justified {
  text-align: justify;
}

.columns .slide-content > .column.has-text-right {
  text-align: right;
}

.text-left {
  text-align: left !important
}

.text-right {
  text-align: right !important
}

.text-center {
  text-align: center !important
}

.text-justify {
  text-align: justify !important
}

.footnotes {
  border-top: 1px solid rgba(0, 0, 0, 0.2);
  padding: 0.5em 0 0 0;
  font-size: 0.65em;
  margin-top: 4em;
}

.byline {
  font-size:.8em
}
ul.byline {
  list-style-type: none;
}
ul.byline li + li {
  margin-top: 0.25em;
}
</style><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/v4-shims.min.css"><link rel="stylesheet" href="./styles/build.css"></head><body><div class="reveal"><div class="slides"><section class="title" data-state="title"><h1>🇫🇷 Devops </h1><h2>Docker</h2><div class="preamble"><div class="paragraph title"><p>2024/2025</p></div>
<div class="imageblock"><img src="media/qrcode.png" alt="QRCode to this presentation" height="150"></div>
<div class="ulist small"><ul><li><p>Présentation disponible à l’adresse: <a href="https://gounthar.github.io/gounthar/cours-devops-docker/main">https://gounthar.github.io/gounthar/cours-devops-docker/main</a></p></li><li><p>Version PDF de la présentation : <a href="slides.pdf" target="_blank"><span class="icon"><i class="fa fa-file-pdf"></i></span> Cliquez ici</a></p></li><li><p>Contenu sous licence <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">Creative Commons Attribution 4.0 International License</a></p></li><li><p>Code source de la présentation: <a href="https://github.com/gounthar/gounthar/cours-devops-docker" target="_blank"><span class="icon"><i class="fab fa-github"></i></span> https://github.com/gounthar/gounthar/cours-devops-docker</a></p></li></ul></div></div></section>
<section id="comment_utiliser_cette_présentation" class="dark background columns" data-background-color="MediumBlue" data-background-image="media/logo-t-shirt-transparent-1080.png" data-background-size="contain" data-background-position="left"><h2>Comment utiliser cette présentation ?</h2><div class="slide-content"><div class="openblock column"><div class="content"></div></div>
<div class="openblock column"><div class="content"><div class="ulist"><ul><li><p>Pour naviguer, utilisez les flèches en bas à droite (ou celles de votre clavier)</p><div class="ulist"><ul><li><p>Gauche/Droite: changer de chapitre</p></li><li><p>Haut/Bas: naviguer dans un chapitre</p></li></ul></div></li><li><p>Pour avoir une vue globale : utiliser la touche "o" (pour "<strong>Overview</strong>")</p></li></ul></div></div></div></div></section>
<section><section id="bonjour" data-background-color="rgb(248, 228, 130)" data-state="invert"><h2>Bonjour !</h2><div class="slide-content"><div class="imageblock"><img src="media/bitmoji-hello.png" alt="bitmoji hello" width="200"></div><div class="imageblock"><img src="media/hello-from-docker.svg" alt="hello from docker"></div><div class="paragraph small"><small>La suite: vers le bas ⬇️</small></div></div></section><section data-background-color="rgb(248, 228, 130)" data-background-image="media/docker_love.png" data-background-size="contain" data-background-position="center" data-state="invert"><div class="slide-content">
<aside class="notes"><div class="paragraph"><p>On en reparlera après, mais j&#8217;aime Docker depuis longtemps, d&#8217;un amour platonique et non réciproque.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>ESN, sécurité des laptops et méfiance</p></li><li><p>Early days, Raspberry Pi &amp; consorts</p></li><li><p>Ce n&#8217;est pas qu&#8217;un projet open source. Et si j&#8217;y bossais ?</p></li></ol></div></aside></div></section><section class="columns" data-background-color="rgb(248, 228, 130)" data-background-image="media/logo.svg" data-background-size="contain" data-background-position="left" data-state="invert"><div class="slide-content"><div class="openblock column"><div class="content"></div></div>
<div class="openblock column"><div class="content"><div class="paragraph strong"><p>Bruno VERACHTEN</p></div>
<div class="imageblock"><img src="media/cloudbees.svg" alt="cloudbees"></div>
<div class="ulist"><ul><li><p>Sr Developer Relations chez <a href="https://www.cloudbees.com" target="_blank">CloudBees</a> pour le projet <a href="https://www.jenkins.io/" target="_blank">Jenkins</a> 👨🏻‍⚖️</p></li><li><p>Me contacter :</p><div class="ulist"><ul><li><p><span class="icon"><i class="fa fa-envelope"></i></span> <a href="mailto:gounthar@gmail.com">gounthar@gmail.com</a></p></li><li><p><a href="https://github.com/gounthar" target="_blank"><span class="icon"><i class="fab fa-github"></i></span> gounthar</a></p></li><li><p><a href="https://bruno.verachten.fr/" class="bare">https://bruno.verachten.fr/</a></p></li><li><p><a href="https://fr.linkedin.com/in/poddingue" target="_blank"><span class="icon"><i class="fab fa-linkedin"></i></span> Bruno Verachten</a></p></li><li><p><a href="https://twitter.com/poddingue" target="_blank"><span class="icon"><i class="fab fa-twitter"></i></span> @poddingue</a></p></li></ul></div></li></ul></div></div></div></div></section><section id="et_vous"><h2>Et vous ?</h2><div class="slide-content"><div class="videoblock"><video src="media/yourturn.mp4" width="600" height="100%" data-autoplay>Your browser does not support the video tag.</video></div></div></section><section id="a_propos_du_cours" data-background-color="rgb(248, 228, 130)" data-state="invert"><h2>A propos du cours</h2><div class="slide-content"><div class="ulist"><ul><li><p>Première itération d&#8217;une découverte Docker dans le cadre du DevOps</p></li><li><p>Contenu entièrement libre et open-source</p></li><li><p>Méchamment basé sur le travail de <a href="https://github.com/dduportal">Damien Duportal</a> et <a href="https://www.linkedin.com/in/awillemant/?originalSubdomain=fr">Amaury Willemant</a></p></li></ul></div>
<div class="ulist small"><ul><li><p>N&#8217;hésitez pas ouvrir des Pull Request si vous voyez des améliorations ou problèmes: <a href="https://github.com/gounthar/gounthar/cours-devops-docker/pulls" target="_blank">sur cette page</a> (😉 wink wink)</p></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>Ceci n&#8217;est pas un cours exhaustif de Docker, nous n&#8217;en avons pas le temps, et ce n&#8217;est pas le but.</p></li><li><p>Ce que nous voulons est vous enseigner les rudiments pour que vous soyez armés pour la seconde partie de ce module</p></li><li><p>La partie Gitlab a besoin de ces pré-requis</p></li></ul></div></aside></div></section><section id="calendrier"><h2>Calendrier</h2><div class="slide-content"><div class="paragraph"><p>🚧 Work in progress&#8230;&#8203; 🚧</p></div>
<div class="ulist"><ul><li><p>26 septembre après-midi</p></li><li><p>24 octobre après-midi</p></li><li><p>07 novembre après-midi</p></li><li><p>&#8230;&#8203;</p></li></ul></div></div></section><section id="évaluation"><h2>📊 Évaluation</h2><div class="slide-content"><div class="videoblock"><video src="media/ohno.mp4" width="200" height="100%" data-autoplay loop>Your browser does not support the video tag.</video></div>
<div class="ulist"><ul><li><p>Pourquoi ? s&#8217;assurer que vous avez acquis un minimum de concepts</p></li><li><p>Quoi ? Sans doute une note sur 20, basée sur une liste de critères exhaustifs</p></li><li><p>Comment ? Un projet Gitlab (probable) ou GitHub (peu probable) à me rendre (timing à déterminer ensemble)</p></li></ul></div></div></section><section id="plan" data-background-video="media/plan.mp4" data-background-video-loop data-background-video-muted><h2>Plan</h2><div class="slide-content"><div class="ulist"><ul><li><p>Intro</p></li><li><p>Base</p></li><li><p>Containers</p></li><li><p>Images</p></li><li><p>Fichiers, nommage, inspect</p></li><li><p>Volumes</p></li><li><p>Réseaux</p></li><li><p>Docker Compose</p></li><li><p>Bonus</p></li></ul></div>
<div class="paragraph small"><small>La suite: vers la droite ➡️</small></div></div></section></section>
<section><section id="docker" class="container background" data-background-color="rgb(248, 228, 130)" data-background-image="media/empty_harbor.png" data-background-size="cover" data-background-position="left" data-state="invert"><h2>Docker</h2><div class="slide-content"><div class="paragraph"><p>"La Base"</p></div></div></section><section id="pourquoi"><h2>Pourquoi ?</h2><div class="slide-content"><div class="imageblock"><img src="media/docker-logo-monochromatic.png" alt="docker logo monochromatic" width="200"></div>
<div class="paragraph"><p>🤔 Quel est le problème ?</p></div></div></section><section id="pourquoi_commencer_par_un_problème" data-auto-animate><h2>Pourquoi commencer par un problème ?</h2><div class="slide-content"><div class="imageblock"><img src="media/docker-logo-monochromatic.png" alt="docker logo monochromatic" width="200"></div>
<div class="paragraph"><p>🤔 Commençons plutôt par une définition:</p></div>
<div class="quoteblock"><blockquote><div class="paragraph"><p>Docker c&#8217;est &#8230;&#8203;</p></div></blockquote></div>
<aside class="notes"><div class="ulist"><ul><li><p>Demander à l&#8217;assistance une définition</p></li></ul></div></aside></div></section><section id="pourquoi_commencer_par_un_problème_2" data-auto-animate><h2>Pourquoi commencer par un problème ?</h2><div class="slide-content"><div class="imageblock"><img src="media/docker-logo-monochromatic.png" alt="docker logo monochromatic" width="200"></div>
<div class="paragraph"><p>🤔 Définition quelque peu datée (2014):</p></div>
<div class="quoteblock"><blockquote><div class="paragraph"><p>Docker is &#8230;&#8203;</p></div></blockquote></div>
<aside class="notes"><div class="ulist"><ul><li><p>Demander à l&#8217;assistance une définition</p></li><li><p>make a point</p></li></ul></div></aside></div></section><section id="pourquoi_commencer_par_un_problème_3" data-auto-animate><h2>Pourquoi commencer par un problème ?</h2><div class="slide-content"><div class="imageblock"><img src="media/docker-logo-monochromatic.png" alt="docker logo monochromatic" width="200"></div>
<div class="paragraph"><p>🤔 Définition quelque peu datée (2014):</p></div>
<div class="quoteblock"><blockquote><div class="paragraph"><p>Docker is a toolset for Linux containers designed to ‘build, ship and run’ distributed applications.</p></div></blockquote></div>
<div class="paragraph small"><small><a href="https://www.infoq.com/articles/docker-future/" class="bare">https://www.infoq.com/articles/docker-future/</a></small></div>
<aside class="notes"><div class="ulist"><ul><li><p><a href="https://www.infoq.com/articles/docker-future/" class="bare">https://www.infoq.com/articles/docker-future/</a></p></li></ul></div></aside></div></section><section id="linux_containers" data-auto-animate><h2>Linux containers ?</h2><div class="slide-content"><div class="imageblock"><img src="media/docker-logo-monochromatic.png" alt="docker logo monochromatic" width="200"></div>
<div class="paragraph"><p>🤔 Nous voilà bien&#8230;&#8203;</p></div>
<div class="quoteblock"><blockquote><div class="paragraph"><p>C&#8217;est quoi un container?</p></div></blockquote></div>
<aside class="notes"><div class="ulist"><ul><li><p><a href="https://www.infoq.com/articles/docker-future/" class="bare">https://www.infoq.com/articles/docker-future/</a></p></li></ul></div></aside></div></section><section id="linux_containers_2" data-auto-animate><h2>Linux containers ?</h2><div class="slide-content"><div class="imageblock"><img src="media/docker-logo-monochromatic.png" alt="docker logo monochromatic" width="200"></div>
<div class="paragraph"><p>🤔 Nous voilà bien&#8230;&#8203;</p></div>
<div class="quoteblock"><blockquote><div class="paragraph"><p>C&#8217;est quoi un container?</p></div></blockquote></div>
<div class="paragraph small"><small>Vous voulez la version enfant de 5 ans? Je ne crois pas&#8230;&#8203;</small></div>
<aside class="notes"><div class="ulist"><ul><li><p>J&#8217;ai la version "les containers expliqués à un enfant de 5 ans", mais pas sûr que vous appréciez&#8230;&#8203;</p></li><li><p>On va donc passer à la suite, et on y revient dans un moment.</p></li><li><p>Imagine que tu as une boîte magique appelée "conteneur".</p></li><li><p>Cette boîte peut contenir toutes sortes de choses, comme des jouets, des bonbons ou même des dessins.</p></li><li><p>Maintenant, dans le monde de l&#8217;informatique, un conteneur Docker est un peu comme cette boîte magique.</p></li><li><p>Mais au lieu de jouets ou de bonbons, un conteneur Docker peut contenir des programmes et toutes les choses dont ces programmes ont besoin pour fonctionner.</p></li><li><p>Par exemple, il peut contenir un site Web, une application ou même une partie d&#8217;un jeu vidéo.</p></li><li><p>Ce qui est vraiment cool avec les conteneurs Docker, c&#8217;est qu&#8217;ils sont très spéciaux.</p></li><li><p>Chaque conteneur est comme une petite boîte magique qui garde tout bien organisé à l&#8217;intérieur.</p></li><li><p>Et tu peux facilement prendre cette boîte magique et la mettre sur n&#8217;importe quel ordinateur, qu&#8217;il soit grand ou petit, comme si tu transportais tes jouets préférés chez un ami.</p></li><li><p>Cela signifie que les conteneurs Docker aident les développeurs à s&#8217;assurer que leurs programmes fonctionnent de la même manière partout où ils les utilisent. C&#8217;est comme si tu pouvais t&#8217;amuser avec tes jouets préférés chez toi, chez un ami, ou même à l&#8217;école, et tout fonctionnerait toujours comme prévu.</p></li><li><p>En résumé, un conteneur Docker est comme une boîte magique pour les programmes informatiques.</p></li><li><p>Il garde tout bien organisé à l&#8217;intérieur et peut être déplacé facilement d&#8217;un ordinateur à un autre, comme si tu emportais tes jouets préférés partout où tu vas. C&#8217;est super pratique pour les personnes qui créent des choses sur l&#8217;ordinateur !</p></li></ul></div></aside></div></section><section id="docker_est_vieux" data-background-color="rgb(248, 228, 130)" data-state="invert" data-auto-animate><h2>Docker est vieux</h2><div class="slide-content"><div class="paragraph"><p>10 ans déjà&#8230;&#8203;</p></div>
<div class="imageblock"><img src="media/containerconteneuraccidenteavariejpg_5e8b87ccc8c27.jpg" alt="containerconteneuraccidenteavariejpg 5e8b87ccc8c27"></div>
<aside class="notes"><div class="ulist"><ul><li><p>The story of Docker starts in Paris with a startup called DotCloud, founded by Solomon Hykes, Kamel Founadi,
and Sebastien Pahl in 2008 to provide cloud hosting services for software developers.</p></li><li><p>It was first released as an open source project by DotCloud in March 2013.</p></li><li><p>The project quickly became popular, leading to DotCloud rebranded as Docker Inc</p></li></ul></div></aside></div></section><section id="docker_est_vieux_2" data-background-color="rgb(248, 228, 130)" data-state="invert" data-auto-animate><h2>Docker est vieux</h2><div class="slide-content"><div class="paragraph"><p>Mais moi aussi&#8230;&#8203;</p></div>
<div class="imageblock"><img src="media/piWorkshop.png" alt="piWorkshop"></div>
<aside class="notes"><div class="ulist"><ul><li><p>parler de mes débuts en 2015/2016</p><div class="ulist"><ul><li><p>Reprendre la déclaration du début: j&#8217;ai toujours été brouillon, devops avant que le mot n&#8217;existe, trifouillant 1000 projets à la fois, et donc la matrix from hell, c&#8217;était mon quotidien</p></li><li><p>Machine Linux non officielle, non autorisée, docker impossible sur nos machines de dév, obligé de passer par une VM</p></li><li><p>Docker intéressant, mais interdit en prod, impossible en dév&#8230;&#8203;</p></li><li><p>Là dessus arrive Damien, qui nous fait un workshop Docker sur Raspberry, et là je craque</p></li><li><p>J&#8217;ai besoin d&#8217;un laboratoire à distance de terminaux Android, et Docker sur Raspberry Pi pourrait être la solution</p></li></ul></div></li></ul></div></aside></div></section><section id="docker_on_arm" data-background-color="rgb(248, 228, 130)" data-state="invert" data-auto-animate><h2>Docker on arm</h2><div class="slide-content"><div class="paragraph"><p>Aucune raison que ça soit réservé aux puissants! La révolution vaincra!</p></div>
<div class="imageblock"><img src="media/resin-ports-docker-to-arm.png" alt="resin ports docker to arm"></div>
<aside class="notes"><div class="ulist"><ul><li><p>Parler de balena</p></li></ul></div></aside></div></section><section id="docker_on" data-background-color="rgb(248, 228, 130)" data-state="invert" data-auto-animate><h2>Docker on *</h2><div class="slide-content"><div class="paragraph"><p>Linux everywhere&#8230;&#8203; And then Docker to follow.</p></div>
<div class="imageblock"><img src="media/buildx_multi_arch.png" alt="buildx multi arch"></div>
<aside class="notes"><div class="ulist"><ul><li><p>Parler de riscv, de buildx qui permet de builder pour riscv alors que docker pour riscv n&#8217;est pas encore supporté</p></li><li><p>Finir par sortir la Radxa Zero, la brancher, s&#8217;y connecter et faire le docker container run hello world</p></li></ul></div></aside></div></section><section id="on_navait_pas_parlé_dun_problème" data-auto-animate><h2>On n&#8217;avait pas parlé d&#8217;un problème?</h2><div class="slide-content"><div class="imageblock"><img src="media/base_du_problème_sans_dev.png" alt="base du problème sans dev"></div></div></section><section id="on_navait_pas_parlé_dun_problème_2" data-auto-animate><h2>On n&#8217;avait pas parlé d&#8217;un problème?</h2><div class="slide-content"><div class="imageblock"><img src="media/base_du_problème_sans_dev_et_ops.png" alt="base du problème sans dev et ops"></div></div></section><section id="on_navait_pas_parlé_dun_problème_3" data-auto-animate><h2>On n&#8217;avait pas parlé d&#8217;un problème?</h2><div class="slide-content"><div class="imageblock"><img src="media/base_du_problème_sans_stabilité.png" alt="base du problème sans stabilité"></div></div></section><section id="on_navait_pas_parlé_dun_problème_4" data-auto-animate><h2>On n&#8217;avait pas parlé d&#8217;un problème?</h2><div class="slide-content"><div class="imageblock"><img src="media/base_du_problème_sans_frontièrel.png" alt="base du problème sans frontièrel"></div></div></section><section id="on_navait_pas_parlé_dun_problème_5" data-auto-animate><h2>On n&#8217;avait pas parlé d&#8217;un problème?</h2><div class="slide-content"><div class="imageblock"><img src="media/base_du_problème_final.png" alt="base du problème final"></div></div></section><section id="on_navait_pas_parlé_dun_problème_6" data-auto-animate><h2>On n&#8217;avait pas parlé d&#8217;un problème?</h2><div class="slide-content"><div class="paragraph"><p>Histoire vraie.</p></div>
<table class="tableblock frame-none grid-none" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><tbody><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><code>Hey salut  !</code></p></td><td class="tableblock halign-left valign-top"></td></tr></table></div></section><section id="on_navait_pas_parlé_dun_problème_7" data-auto-animate><h2>On n&#8217;avait pas parlé d&#8217;un problème?</h2><div class="slide-content"><div class="paragraph"><p>Histoire vraie.</p></div>
<table class="tableblock frame-none grid-none" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><tbody><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><code>Hey salut  !</code></p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-center valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>cc</em></p></td></tr></table></div></section><section id="on_navait_pas_parlé_dun_problème_8" data-auto-animate><h2>On n&#8217;avait pas parlé d&#8217;un problème?</h2><div class="slide-content"><div class="paragraph"><p>Histoire vraie.</p></div>
<table class="tableblock frame-none grid-none" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><tbody><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><code>Hey salut  !</code></p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-center valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>cc</em></p></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><code>Tu peux mettre à jour les packages système steup ? j&#8217;ai un truc à tester.</code></p></td><td class="tableblock halign-left valign-top"></td></tr></table></div></section><section id="on_navait_pas_parlé_dun_problème_9" data-auto-animate><h2>On n&#8217;avait pas parlé d&#8217;un problème?</h2><div class="slide-content"><div class="paragraph"><p>Histoire vraie.</p></div>
<table class="tableblock frame-none grid-none" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><tbody><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><code>Hey salut  !</code></p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-center valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>cc</em></p></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><code>Tu peux mettre à jour les packages système steup ? j&#8217;ai un truc à tester.</code></p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-center valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>nan</em></p></td></tr></table></div></section><section id="on_navait_pas_parlé_dun_problème_10" data-auto-animate><h2>On n&#8217;avait pas parlé d&#8217;un problème?</h2><div class="slide-content"><div class="paragraph"><p>Histoire vraie.</p></div>
<table class="tableblock frame-none grid-none" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><tbody><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><code>Hey salut  !</code></p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-center valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>cc</em></p></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><code>Tu peux mettre à jour les packages système steup ? j&#8217;ai un truc à tester.</code></p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-center valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>nan</em></p></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><code>???</code></p></td><td class="tableblock halign-left valign-top"></td></tr></table></div></section><section id="on_navait_pas_parlé_dun_problème_11" data-auto-animate><h2>On n&#8217;avait pas parlé d&#8217;un problème?</h2><div class="slide-content"><div class="paragraph"><p>Histoire vraie.</p></div>
<table class="tableblock frame-none grid-none" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><tbody><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><code>Hey salut  !</code></p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-center valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>cc</em></p></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><code>Tu peux mettre à jour les packages système steup ? j&#8217;ai un truc à tester.</code></p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-center valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>nan</em></p></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><code>???</code></p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-center valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>pas standard dsl</em></p></td></tr></table></div></section><section id="on_navait_pas_parlé_dun_problème_12" data-auto-animate><h2>On n&#8217;avait pas parlé d&#8217;un problème?</h2><div class="slide-content"><div class="paragraph"><p>Histoire vraie.</p></div>
<table class="tableblock frame-none grid-none" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><tbody><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><code>Hey salut  !</code></p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-center valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>cc</em></p></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><code>Tu peux mettre à jour les packages système steup ? j&#8217;ai un truc à tester.</code></p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-center valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>nan</em></p></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><code>???</code></p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-center valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>pas standard dsl</em></p></td></tr></table>
<div class="imageblock"><img src="media/1072129428-image16.png" alt="1072129428 image16"></div></div></section><section id="on_navait_pas_parlé_dun_problème_13"><h2>On n&#8217;avait pas parlé d&#8217;un problème?</h2><div class="slide-content"><div class="imageblock"><img src="media/matrixfromhell.jpg" alt="matrixfromhell"></div>
<div class="paragraph"><p>Problème de temps <strong>exponentiel</strong></p></div>
<aside class="notes"><div class="ulist"><ul><li><p>Le "problème de la matrice de l&#8217;enfer" (ou "matrix from hell" en anglais) est une expression qui fait référence à la complexité croissante des configurations logicielles dans le monde de l&#8217;informatique.</p></li><li><p>Avant l&#8217;arrivée de Docker, il était souvent difficile de gérer toutes les dépendances et les paramètres nécessaires pour exécuter des applications sur différents ordinateurs.</p></li><li><p>Docker tente de résoudre ce problème en introduisant la notion de conteneurs.</p></li><li><p>Les conteneurs Docker sont des environnements autonomes qui contiennent une application et toutes ses dépendances, y compris les bibliothèques et les paramètres. Cela signifie que les développeurs peuvent créer un conteneur qui fonctionne parfaitement sur leur propre ordinateur, puis le partager avec d&#8217;autres sans se soucier des différences entre les environnements.</p></li><li><p>En résumé, Docker résout le "problème de la matrice de l&#8217;enfer" en permettant aux développeurs de créer des conteneurs contenant leurs applications, ce qui garantit que celles-ci fonctionneront de la même manière partout, évitant ainsi les tracas liés aux configurations complexes.</p></li></ul></div></aside></div></section><section id="déjà_vu"><h2>Déjà vu ?</h2><div class="slide-content"><div class="paragraph"><p>L&#8217;IT n&#8217;est pas la seule industrie à résoudre des problèmes&#8230;&#8203;</p></div>
<div class="imageblock"><img src="media/also-a-matrix-from-hell.png" alt="also a matrix from hell"></div></div></section><section id="solution_le_conteneur_intermodal"><h2>Solution: Le conteneur intermodal</h2><div class="slide-content"><div class="paragraph"><p>"Separation of Concerns"</p></div>
<div class="imageblock"><img src="media/blue-shipping-container.png" alt="blue shipping container"></div>
<aside class="notes"><div class="paragraph"><p>Faire le parallèle avec les containers marchands contenant des jouets, de l&#8217;électronique, de la nourriture, le tout connecté au même bateau, sans pour autant être interdépendants.
Docker apporte une séparation claire des préoccupations grâce à ses conteneurs. Cette séparation des préoccupations signifie que chaque composant d&#8217;une application est isolé dans son propre conteneur. Voici comment cela fonctionne :</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Isolation des Composants : Avec Docker, chaque composant d&#8217;une application (comme une base de données, un serveur web, etc.) est emballé dans un conteneur distinct. Ces conteneurs fonctionnent de manière indépendante les uns des autres, ce qui signifie que si un composant rencontre un problème ou nécessite une mise à jour, cela n&#8217;affecte pas les autres composants.</p></li><li><p>Portabilité : Les conteneurs Docker encapsulent non seulement l&#8217;application, mais aussi toutes ses dépendances. Cela garantit que l&#8217;application fonctionnera de la même manière quel que soit l&#8217;endroit où vous l&#8217;exécutez, que ce soit sur votre ordinateur local, un serveur en nuage ou ailleurs. Cela simplifie la gestion de l&#8217;application à l&#8217;échelle.</p></li><li><p>Facilité de Déploiement : En raison de cette séparation, le déploiement d&#8217;applications devient plus simple. Vous pouvez gérer chaque conteneur individuellement, les mettre à jour sans perturber le reste de l&#8217;application, et même les répliquer pour mettre en place des configurations complexes.</p></li><li><p>Gestion des Ressources : Docker permet également de gérer efficacement les ressources de l&#8217;ordinateur hôte. Chaque conteneur a sa propre allocation de ressources, ce qui empêche un conteneur de monopoliser toute la puissance de calcul, garantissant ainsi des performances stables pour toutes les parties de l&#8217;application.</p></li></ol></div>
<div class="paragraph"><p>En résumé, Docker apporte une séparation des préoccupations claire en isolant chaque composant d&#8217;une application dans son propre conteneur. Cela facilite le déploiement, la gestion et la maintenance des applications, tout en garantissant la portabilité et la stabilité des performances.</p></div></aside></div></section><section id="comment_ça_marche" data-auto-animate><h2>Comment ça marche ?</h2><div class="slide-content"><div class="paragraph"><p>"Virtualisation <strong>Légère</strong>"</p></div>
<div class="imageblock"><img src="media/container_vs_vm.jpg" alt="container vs vm"></div>
<aside class="notes"><div class="paragraph"><p>La virtualisation légère, dans le contexte des conteneurs Docker, est une méthode de virtualisation qui permet d&#8217;exécuter plusieurs environnements isolés (conteneurs) sur un seul système d&#8217;exploitation (hôte). Contrairement à la virtualisation traditionnelle, où chaque machine virtuelle (VM) nécessite son propre système d&#8217;exploitation, les conteneurs partagent le même noyau du système d&#8217;exploitation de l&#8217;hôte.</p></div>
<div class="paragraph"><p>Les principales caractéristiques de la virtualisation légère sont les suivantes :</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Isolation : Chaque conteneur est isolé des autres, ce qui signifie qu&#8217;ils ne peuvent pas interférer les uns avec les autres. Cela permet d&#8217;exécuter différentes applications avec leurs propres dépendances sans conflits.</p></li><li><p>Efficacité des ressources : Étant donné que les conteneurs partagent le même noyau du système d&#8217;exploitation, ils sont beaucoup plus légers en termes de ressources que les machines virtuelles. Cela permet d&#8217;exécuter de nombreux conteneurs sur une seule machine physique, ce qui est efficace en termes d&#8217;utilisation des ressources.</p></li><li><p>Démarrage rapide : Les conteneurs se lancent rapidement, en quelques secondes, car ils n&#8217;ont pas besoin de démarrer un système d&#8217;exploitation complet. Cela permet une mise à l&#8217;échelle rapide des applications.</p></li><li><p>Portabilité : Les conteneurs sont portables, ce qui signifie qu&#8217;ils fonctionnent de la même manière sur n&#8217;importe quel système qui prend en charge Docker. Cela simplifie le déploiement et la gestion des applications.</p></li></ol></div>
<div class="paragraph"><p>En résumé, la virtualisation légère des conteneurs Docker permet d&#8217;exécuter efficacement plusieurs environnements isolés sur un même système d&#8217;exploitation, offrant ainsi une isolation, une efficacité des ressources, un démarrage rapide et une portabilité des applications.</p></div></aside></div></section><section id="comment_ça_marche_2" data-auto-animate><h2>Comment ça marche ?</h2><div class="slide-content"><div class="paragraph"><p>Virtualisation</p></div>
<div class="imageblock"><img src="media/types_of_hypervisors.png" alt="https://medium.com/teamresellerclub/type-1-and-type-2-hypervisors-what-makes-them-different-6a1755d6ae2c"></div>
<aside class="notes"><div class="paragraph"><p>Un hyperviseur est un logiciel spécialisé qui permet d&#8217;exécuter plusieurs systèmes d&#8217;exploitation (comme Windows, Linux, etc.) sur un seul matériel physique (comme un serveur). Il agit comme une couche d&#8217;abstraction entre le matériel et les systèmes d&#8217;exploitation invités.</p></div>
<div class="paragraph"><p>Il existe deux types d&#8217;hyperviseurs :</p></div>
<div class="paragraph"><p>Hyperviseurs de type 1 (ou bare-metal) : Ils s&#8217;installent directement sur le matériel physique et n&#8217;ont pas besoin d&#8217;un système d&#8217;exploitation hôte. Ils sont très efficaces et sont généralement utilisés dans les centres de données pour exécuter plusieurs VM de manière isolée.</p></div>
<div class="paragraph"><p>Hyperviseurs de type 2 (ou hosted) : Ils s&#8217;exécutent sur un système d&#8217;exploitation existant, comme une application. Ils sont généralement utilisés pour la virtualisation de bureau ou le développement, mais sont moins efficaces que les hyperviseurs de type 1.</p></div>
<div class="paragraph"><p>En résumé, un hyperviseur vous permet d&#8217;exécuter plusieurs systèmes d&#8217;exploitation sur un seul serveur physique, ce qui vous permet de maximiser l&#8217;utilisation des ressources matérielles et de simplifier la gestion des environnements informatiques.</p></div></aside></div></section><section id="comment_ça_marche_3" class="columns" data-auto-animate><h2>Comment ça marche ?</h2><div class="slide-content"><div class="paragraph column"><p>Virtualisation</p></div>
<hr>
<div class="imageblock"><img src="media/type-1-hypervisor-examples.png" alt="https://www.ubackup.com/enterprise-backup/type-1-hypervisor-vs-type-2.html"></div>
<hr>
<hr>
<div class="imageblock"><img src="media/type-2-hypervisor-examples.png" alt="https://www.ubackup.com/enterprise-backup/type-1-hypervisor-vs-type-2.html"></div>
<hr></div></section><section id="comment_ça_marche_4" data-auto-animate><h2>Comment ça marche ?</h2><div class="slide-content"><div class="paragraph"><p>"Virtualisation <strong>Légère</strong>"</p></div>
<div class="imageblock"><img src="media/container_vs_vm.jpg" alt="container vs vm"></div>
<div class="ulist"><ul><li><p>Légère, vraiment?</p></li></ul></div></div></section><section id="légère_vraiment" data-background-image="media/RPiDockerConChallenge.png" data-background-size="contain" data-background-position="left" data-auto-animate><h2>Légère, vraiment!</h2><div class="slide-content">
<div class="paragraph small"><small><a href="http://web.archive.org/web/20200810061020/https://www.docker.com/blog/raspberry-pi-dockercon-challenge-winner/" class="bare">http://web.archive.org/web/20200810061020/https://www.docker.com/blog/raspberry-pi-dockercon-challenge-winner/</a></small></div></div></section><section id="légère_vraiment_2" data-background-image="media/esxpi.png" data-background-size="contain" data-background-position="left" data-auto-animate><h2>Légère, vraiment!</h2><div class="slide-content">
<div class="paragraph small"><small><a href="https://www.architecting.it/blog/esxi-on-raspberry-pi/" class="bare">https://www.architecting.it/blog/esxi-on-raspberry-pi/</a></small></div></div></section><section id="conteneur_vm" data-auto-animate><h2>Conteneur != VM</h2><div class="slide-content"><div class="imageblock"><img src="media/docker-n-est-pas-VM.png" alt="docker n est pas VM"></div>
<div class="ulist"><ul><li><p>Idée erronée mais citée trop fréquemment !</p></li></ul></div></div></section><section id="conteneur_vm_2" data-auto-animate><h2>Conteneur != VM</h2><div class="slide-content"><div class="imageblock"><img src="media/not-a-vm-9.png" alt="not a vm 9"></div></div></section><section id="conteneur_vm_3" data-auto-animate><h2>Conteneur != VM</h2><div class="slide-content"><div class="imageblock"><img src="media/not-a-vm-8.png" alt="not a vm 8"></div></div></section><section id="conteneur_vm_4" data-auto-animate><h2>Conteneur != VM</h2><div class="slide-content"><div class="imageblock"><img src="media/not-a-vm-7.png" alt="not a vm 7"></div></div></section><section id="conteneur_vm_5" data-auto-animate><h2>Conteneur != VM</h2><div class="slide-content"><div class="imageblock"><img src="media/not-a-vm-6.png" alt="not a vm 6"></div></div></section><section id="conteneur_vm_6" data-auto-animate><h2>Conteneur != VM</h2><div class="slide-content"><div class="imageblock"><img src="media/not-a-vm-5.png" alt="not a vm 5"></div></div></section><section id="conteneur_vm_7" data-auto-animate><h2>Conteneur != VM</h2><div class="slide-content"><div class="imageblock"><img src="media/not-a-vm-4.png" alt="not a vm 4"></div></div></section><section id="conteneur_vm_8" data-auto-animate><h2>Conteneur != VM</h2><div class="slide-content"><div class="imageblock"><img src="media/not-a-vm-3.png" alt="not a vm 3"></div></div></section><section id="conteneur_vm_9" data-auto-animate><h2>Conteneur != VM</h2><div class="slide-content"><div class="imageblock"><img src="media/not-a-vm-2.png" alt="not a vm 2"></div></div></section><section id="conteneur_vm_10" data-auto-animate><h2>Conteneur != VM</h2><div class="slide-content"><div class="imageblock"><img src="media/not-a-vm-1.png" alt="not a vm 1"></div></div></section><section id="conteneur_vm_11" data-auto-animate><h2>Conteneur != VM</h2><div class="slide-content"><div class="imageblock"><img src="media/not-a-vm.png" alt="not a vm"></div></div></section><section id="conteneur_vm_12" data-auto-animate><h2>Conteneur != VM</h2><div class="slide-content"><div class="paragraph"><p>"Separation of concerns": 1 "tâche" par conteneur</p></div>
<div class="imageblock"><img src="media/vm-and-container.png" alt="vm and container"></div>
<aside class="notes"><div class="paragraph"><p>Les hyperviseurs et les machines virtuelles (VM) sont comme des maisons entièrement meublées où chaque invité a sa propre maison séparée.</p></div>
<div class="ulist"><ul><li><p>Chaque maison est une VM, avec son propre système d&#8217;exploitation et ses ressources, et elles peuvent fonctionner sur le même serveur physique.</p></li><li><p>En revanche, les conteneurs sont comme des appartements dans un même immeuble. Ils partagent la même infrastructure, comme les escaliers et les couloirs (le noyau du système d&#8217;exploitation), mais chaque appartement (conteneur) est séparé et possède son propre espace privé. Les conteneurs partagent efficacement les ressources du serveur, car ils évitent de dupliquer tout le système d&#8217;exploitation, ce qui les rend plus légers et plus rapides que les VM.</p></li></ul></div>
<div class="paragraph"><p>En résumé, les VM sont comme des maisons séparées, tandis que les conteneurs sont comme des appartements dans le même bâtiment, partageant certaines parties communes mais offrant toujours une séparation.</p></div></aside></div></section><section id="vms_conteneurs"><h2>VMs &amp; Conteneurs</h2><div class="slide-content"><div class="paragraph"><p>Non exclusifs mutuellement</p></div>
<div class="imageblock"><img src="media/containers-and-vms-together.png" alt="containers and vms together"></div>
<aside class="notes"><div class="paragraph"><p>Les machines virtuelles (VM) et les conteneurs peuvent être utilisés ensemble pour obtenir les avantages des deux mondes.</p></div>
<div class="ulist"><ul><li><p>Les VMs offrent une isolation plus forte en exécutant des systèmes d&#8217;exploitation virtuels complets, ce qui les rend idéales pour des charges de travail nécessitant une sécurité et une isolation élevées.
Les conteneurs, en revanche, sont légers et rapides, ce qui les rend parfaits pour exécuter de nombreuses applications sur un seul serveur.</p></li><li><p>En combinant les deux, vous pouvez exécuter des VMs pour isoler et protéger des charges de travail sensibles, tout en utilisant des conteneurs pour exécuter des applications légères et faciles à gérer.
Cela permet une flexibilité accrue dans la gestion des ressources et des charges de travail sur votre infrastructure informatique.</p></li></ul></div></aside></div></section><section id="docker_cest_pas_un_peu_une_vm_quand_même"><h2>🤡 Docker, c&#8217;est pas un peu une VM quand même?</h2><div class="slide-content"><div class="imageblock"><img src="media/mobyvm.png" alt="mobyvm" height="1000"></div></div></section><section id="docker_cest_pas_un_peu_une_vm_quand_même_2"><h2>🤡 Docker, c&#8217;est pas un peu une VM quand même?</h2><div class="slide-content"><div class="ulist"><ul><li><p>Docker sur Windows pour exécuter des conteneurs Linux :</p><div class="ulist"><ul><li class="fragment"><p>Hyper-V : Sous Windows, Docker utilise souvent Hyper-V pour exécuter des machines virtuelles légères (VM) Linux.</p></li><li class="fragment"><p>Performance : Docker sur Windows pour les conteneurs Linux peut être légèrement moins performant que Docker sur Linux natif.</p></li><li class="fragment"><p>Isolation : Isolation différente de celle des conteneurs Linux natifs.</p></li></ul></div></li><li><p>Docker sur Linux pour exécuter des conteneurs Linux :</p><div class="ulist"><ul><li class="fragment"><p>Native : Docker fonctionne nativement car il partage le même noyau Linux.</p></li><li class="fragment"><p>Efficacité : Il  est très efficace en termes de consommation de ressources.</p></li><li class="fragment"><p>Isolation : Isolation basée sur les cgroups et les namespaces du noyau Linux.</p></li></ul></div></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>Docker sur Linux pour exécuter des conteneurs Linux :</p><div class="ulist"><ul><li><p>Native : Sur un système Linux, Docker fonctionne nativement car il partage le même noyau Linux. Il offre donc une performance optimale et une intégration transparente avec le système hôte.</p></li><li><p>Efficacité : Comme Docker sur Linux partage le noyau du système hôte, il est très efficace en termes de consommation de ressources. Les conteneurs Linux sont légers et se lancent rapidement.</p></li><li><p>Isolation : Les conteneurs Linux sur Docker offrent une isolation basée sur les cgroups et les namespaces du noyau Linux. Cela permet d&#8217;isoler efficacement les applications et de garantir qu&#8217;elles n&#8217;interfèrent pas les unes avec les autres.</p></li><li><p>Images Linux : Docker sur Linux est optimisé pour les images de conteneurs Linux. Vous utiliserez principalement des images Linux pour vos conteneurs.</p></li></ul></div></li><li><p>Docker sur Windows pour exécuter des conteneurs Linux :</p><div class="ulist"><ul><li><p>Hyper-V : Sur un système Windows, Docker utilise souvent Hyper-V pour exécuter des machines virtuelles légères (VM) Linux. Cela signifie que vous exécutez un hyperviseur (Hyper-V) pour exécuter Linux, ce qui ajoute une couche de virtualisation.</p></li><li><p>Performance : En raison de la virtualisation, Docker sur Windows pour les conteneurs Linux peut être légèrement moins performant que Docker sur Linux natif. Il existe une surcharge en raison de la virtualisation.</p></li><li><p>Isolation : Les conteneurs Linux s&#8217;exécutent dans des VM légères, ce qui ajoute une isolation, mais elle est différente de celle des conteneurs Linux natifs. Les conteneurs Linux s&#8217;exécutent toujours sur le même noyau, mais ils sont isolés au niveau du système de fichiers.</p></li><li><p>Images Linux : Vous utilisez également des images Linux pour les conteneurs Linux exécutés sous Docker sur Windows.</p></li></ul></div></li></ul></div>
<div class="paragraph"><p>En résumé, Docker sur Linux est la meilleure option pour exécuter des conteneurs Linux, car il offre une intégration transparente et des performances optimales. Docker sur Windows utilise Hyper-V pour exécuter des conteneurs Linux, ce qui ajoute une couche de virtualisation et peut entraîner une légère perte de performances. Cependant, cela fonctionne bien lorsque vous avez besoin d&#8217;exécuter des conteneurs Linux sur une machine Windows.</p></div></aside></div></section><section id="cas_dusage" data-auto-animate><h2>Cas d&#8217;usage</h2><div class="slide-content"><div class="paragraph"><p>Le bac à sable</p></div>
<div class="imageblock"><img src="media/bac_à_sable.png" alt="bac à sable"></div></div></section><section id="cas_dusage_2" data-auto-animate><h2>Cas d&#8217;usage</h2><div class="slide-content"><div class="paragraph"><p>Le bac à sable</p></div>
<div class="imageblock"><img src="media/bac_à_sable.png" alt="bac à sable"></div>
<div class="ulist"><ul><li><p>Un environnement tout propre tout neuf !</p></li></ul></div></div></section><section id="cas_dusage_3" data-auto-animate><h2>Cas d&#8217;usage</h2><div class="slide-content"><div class="paragraph"><p>Le bac à sable</p></div>
<div class="imageblock"><img src="media/bac_à_sable.png" alt="bac à sable"></div>
<div class="ulist"><ul><li><p>Un environnement tout propre tout neuf !</p></li><li><p>Le poste de travail n&#8217;est pas impacté</p></li></ul></div></div></section><section id="cas_dusage_4" data-auto-animate><h2>Cas d&#8217;usage</h2><div class="slide-content"><div class="paragraph"><p>Le bac à sable</p></div>
<div class="imageblock"><img src="media/bac_à_sable.png" alt="bac à sable"></div>
<div class="ulist"><ul><li><p>Un environnement tout propre tout neuf !</p></li><li><p>Le poste de travail n&#8217;est pas impacté</p></li><li><p>La configuration reste également isolée sans effet sur le poste de travail</p></li></ul></div></div></section><section id="cas_dusage_5" data-auto-animate><h2>Cas d&#8217;usage</h2><div class="slide-content"><div class="paragraph"><p>La machine de dév</p></div>
<div class="imageblock"><img src="media/dis-le-encore-une-fois.png" alt="dis le encore une fois"></div></div></section><section id="cas_dusage_6" data-auto-animate><h2>Cas d&#8217;usage</h2><div class="slide-content"><div class="paragraph"><p>La machine de dév</p></div>
<div class="imageblock"><img src="media/dis-le-encore-une-fois.png" alt="dis le encore une fois"></div>
<div class="ulist"><ul><li><p>Avoir un environnement reproductible pour rendre homogène le développement et les tests.</p></li></ul></div></div></section><section id="cas_dusage_7" data-auto-animate><h2>Cas d&#8217;usage</h2><div class="slide-content"><div class="paragraph"><p>La machine de dév</p></div>
<div class="imageblock"><img src="media/docker-birth.png" alt="docker birth"></div></div></section><section id="cas_dusage_8" data-auto-animate><h2>Cas d&#8217;usage</h2><div class="slide-content"><div class="paragraph"><p>La machine de dév</p></div>
<div class="imageblock"><img src="media/give-computer-client.png" alt="give computer client"></div></div></section><section id="cas_dusage_9" data-auto-animate><h2>Cas d&#8217;usage</h2><div class="slide-content"><div class="paragraph"><p>Déploiement en production</p></div>
<div class="imageblock"><img src="media/prod-probleme.png" alt="prod probleme"></div></div></section><section id="cas_dusage_10" data-auto-animate><h2>Cas d&#8217;usage</h2><div class="slide-content"><div class="paragraph"><p>Déploiement en production</p></div>
<div class="imageblock"><img src="media/prod-probleme.png" alt="prod probleme"></div>
<div class="ulist"><ul><li><p>Avec un container, si ca fonctionne en local, ca fonctionne en prod !</p></li></ul></div></div></section><section id="cas_dusage_11" data-auto-animate><h2>Cas d&#8217;usage</h2><div class="slide-content"><div class="paragraph"><p>Outillage jetable</p></div>
<div class="imageblock"><img src="media/outillage-jetable.png" alt="outillage jetable"></div></div></section><section id="cas_dusage_12" data-auto-animate><h2>Cas d&#8217;usage</h2><div class="slide-content"><div class="paragraph"><p>Outillage jetable</p></div>
<div class="imageblock"><img src="media/outillage-jetable.png" alt="outillage jetable"></div>
<div class="ulist"><ul><li><p>On instancie des applications sans les installer</p></li></ul></div></div></section><section id="cas_dusage_13" data-auto-animate><h2>Cas d&#8217;usage</h2><div class="slide-content"><div class="paragraph"><p>Outillage jetable</p></div>
<div class="imageblock"><img src="media/outillage-jetable.png" alt="outillage jetable"></div>
<div class="ulist"><ul><li><p>On instancie des applications sans les installer</p></li><li><p>On crée le container, on l&#8217;utilise puis on le jette</p></li></ul></div></div></section><section id="beau_boulot" class="columns" data-auto-animate><h2>Beau boulot! 🤗</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="imageblock"><img src="media/bitmoji-well%20done.png" alt="bitmoji well done"></div></div></div>
<div class="openblock column"><div class="content"><div class="paragraph"><p>On a la base, remplissons là maintenant de containers!</p></div>
<div class="paragraph small"><small>La suite: vers la droite ➡️</small></div></div></div>
<div class="openblock column"><div class="content"><div class="imageblock"><img src="media/empty_ship.png" alt="empty ship" height="720"></div></div></div></div></section></section>
<section><section id="préparer_votre_environnement_de_travail" data-background-color="rgb(248, 228, 130)" data-state="invert"><h2>Préparer votre environnement de travail</h2></section><section id="outils_nécessaires"><h2>Outils Nécessaires 🛠</h2><div class="slide-content"><div class="ulist"><ul><li><p>Un navigateur web récent (et décent)</p></li><li><p>Un compte sur <a href="https://github.com" target="_blank"><span class="icon"><i class="fab fa-github"></i></span> GitHub</a></p></li></ul></div></div></section><section id="gitpod"><h2>GitPod</h2><div class="slide-content"><div class="paragraph"><p><a href="https://gitpod.io" target="_blank">GitPod.io</a> : Environnement de développement dans le ☁️ "nuage"</p></div>
<div class="ulist"><ul><li><p><strong>But:</strong> reproductible</p></li><li><p>Puissance de calcul sur un serveur distant</p></li><li><p>Éditeur de code VSCode dans le navigateur</p></li></ul></div>
<div class="admonitionblock warning fragment"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content">Gratuit pour 50h par mois (⚠️)</td></tr></table></div>
<div class="admonitionblock warning fragment"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content">Ça, c&#8217;était avant (⚠️)</td></tr></table></div>
<div class="admonitionblock warning fragment"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content">Gratuit pour 10h par mois (⚠️)</td></tr></table></div>
<div class="admonitionblock warning fragment"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content">Gratuit pour 50h par mois si compte <span class="icon"><i class="fab fa-linkedin"></i></span> lié (⚠️)</td></tr></table></div></div></section><section id="démarrer_avec_gitpod"><h2>Démarrer avec GitPod 🚀</h2><div class="slide-content"><div class="ulist"><ul><li><p>Rendez vous sur <a href="https://gitpod.io" class="bare" target="_blank">https://gitpod.io</a></p></li><li><p>Authentifiez vous en utilisant votre compte GitHub:</p><div class="ulist"><ul><li><p>Bouton "Login" en haut à droite</p></li><li><p>Puis choisissez le lien "<span class="icon"><i class="fab fa-github"></i></span> Continue with GitHub"</p></li></ul></div></li></ul></div>
<div class="paragraph small"><small>⚠️ Pour les "autorisations", passez sur la slide suivante</small></div></div></section><section id="autorisations_demandées_par_gitpod"><h2>Autorisations demandées par GitPod 🔓</h2><div class="slide-content"><div class="paragraph"><p>Lors de votre première connexion, GitPod va vous demander l&#8217;accès (à accepter) à votre email public configuré dans GitHub :</p></div>
<div class="imageblock"><img src="media/gitpod-github-permissions.png" alt="gitpod github permissions" width="400"></div>
<div class="paragraph small"><small>⚠️ Passez à la slide suivante avant d&#8217;aller plus loin</small></div></div></section><section id="validation_du_compte_gitpod"><h2>Validation du Compte GitPod 📱</h2><div class="slide-content"><div class="paragraph"><p>GitPod vous demande votre numéro de téléphone mobile afin d&#8217;éviter les abus (service gratuit).
Saisissez un numéro de téléphone valide pour recevoir par SMS un code de déblocage :</p></div>
<div class="imageblock"><img src="media/gitpod-phone-validation.png" alt="gitpod phone validation" width="400"></div>
<div class="paragraph small"><small>⚠️ Passez à la slide suivante avant d&#8217;aller plus loin</small></div></div></section><section id="choix_de_léditeur_de_code"><h2>Choix de l&#8217;Éditeur de Code ✎</h2><div class="slide-content"><div class="paragraph"><p>Choisissez l&#8217;éditeur "VSCode Browser" (la première tuile) :</p></div>
<div class="imageblock"><img src="media/gitpod-select-editor.png" alt="gitpod select editor" width="600"></div>
<div class="paragraph small"><small>⚠️ Passez à la slide suivante avant d&#8217;aller plus loin</small></div></div></section><section id="workspaces_gitpod"><h2>Workspaces GitPod 🗂</h2><div class="slide-content"><div class="ulist"><ul><li><p>Vous arrivez sur la <a href="https://gitpod.io/workspaces" target="_blank">page listant les "workspaces" GitPod</a> :</p></li><li><p>Un workspace est une instance d&#8217;un environnement de travail virtuel (C&#8217;est un ordinateur distant)</p></li><li><p>⚠  Faites attention à réutiliser le même workspace tout au long de ce cours ⚠</p></li></ul></div>
<div class="imageblock"><img src="media/gitpod-workspaces.png" alt="gitpod workspaces" width="600"></div></div></section><section id="permissions_gitpod_github"><h2>Permissions GitPod &lt;&#8594; GitHub 🔐</h2><div class="slide-content"><div class="ulist"><ul><li><p>Pour les besoins de ce cours, vous devez autoriser GitPod à pouvoir effectuer certaines modification dans vos dépôts GitHub</p></li><li><p>Rendez-vous sur <a href="https://gitpod.io/user/integrations" target="_blank">la page des intégrations avec GitPod</a></p></li><li><p>Éditez les permissions de la ligne "GitHub" (les 3 petits points à droits) et sélectionnez uniquement :</p><div class="ulist"><ul><li><p><code>user:email</code></p></li><li><p><code>public_repo</code></p></li><li><p><code>workflow</code></p></li></ul></div></li></ul></div></div></section><section id="démarrer_lenvironnement_gitpod"><h2>Démarrer l&#8217;environnement GitPod</h2><div class="slide-content"><div class="paragraph"><p>Cliquez sur le bouton ci-dessous pour démarrer un environnement GitPod personnalisé:</p></div>
<div class="imageblock"><a class="image" href="https://gitpod.io#https://github.com/gounthar/cours-devops-docker" target="_blank" rel="noopener"><img src="https://gitpod.io/button/open-in-gitpod.svg" alt="open in gitpod"></a></div>
<div class="paragraph"><p>Après quelques secondes (minutes?), vous avez accès à l&#8217;environnement:</p></div>
<div class="ulist"><ul><li><p>Gauche: navigateur de fichiers ("Workspace")</p></li><li><p>Haut: éditeur de texte ("Get Started")</p></li><li><p>Bas: Terminal interactif</p></li><li><p>À droite en bas: plein de popups à ignorer (ou pas?)</p></li></ul></div>
<div class="paragraph small"><small>Source disponible dans : <a href="https://github.com/gounthar/cours-devops-docker" target="_blank"><span class="icon"><i class="fab fa-github"></i></span> https://github.com/gounthar/cours-devops-docker</a></small></div></div></section><section id="checkpoint"><h2>Checkpoint 🎯</h2><div class="slide-content"><div class="ulist"><ul><li><p>Vous devriez pouvoir taper la commande <code>whoami</code> dans le terminal de GitPod:</p><div class="ulist"><ul><li><p>Retour attendu: <code>gitpod</code></p></li></ul></div></li><li><p>Vous devriez pouvoir fermer le fichier "Get Started"&#8230;&#8203;</p><div class="ulist"><ul><li><p>&#8230;&#8203; et ouvrir n&#8217;importe quel autre fichier&#8230;&#8203;</p></li></ul></div></li></ul></div>
<div class="paragraph"><p>Bien, on peut maintenant fermer ce workspace, il ne s&#8217;agirait pas de gaspiller vos 50 heures.</p></div></div></section><section id="et_gitlab"><h2>📚 Et Gitlab?</h2><div class="slide-content"><div class="paragraph"><p>GitPod fonctionne aussi avec gitlab.com, mais pour les instances on premise, il faut l&#8217;installer, l&#8217;instancier, avoir un "inner cloud"</p></div>
<div class="paragraph fragment"><p>Bref, on ne l&#8217;a pas ici. <code>¯_(ツ)_/¯</code></p></div>
<div class="paragraph small"><small>On peut commencer !</small></div></div></section></section>
<section><section id="ligne_de_commande" data-background-color="rgb(248, 228, 130)" data-state="invert"><h2>Ligne de commande</h2><div class="slide-content"><div class="paragraph"><p>Guide de survie</p></div></div></section><section id="problématique"><h2>🤔 Problématique</h2><div class="slide-content"><div class="ulist"><ul><li><p>Communication Humain &lt;&#8594; Machine</p></li><li><p>Base commune de TOUS les outils</p></li></ul></div></div></section><section id="cli" data-background-color="rgb(248, 228, 130)" data-state="invert"><h2>CLI</h2><div class="slide-content"><div class="ulist"><ul><li><p>🇬🇧 CLI == "Command Line Interface"</p></li><li><p>🇫🇷 "Interface de Ligne de Commande"</p></li></ul></div></div></section><section id="repl"><h2>REPL</h2><div class="slide-content"><div class="paragraph"><p>Pour les théoriciens et curieux :</p></div>
<div class="ulist"><ul><li><p>🇬🇧 REPL == "Read–eval–print loop"</p></li></ul></div>
<div class="paragraph"><p><a href="https://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop" class="bare">https://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop</a></p></div></div></section><section id="anatomie_dune_commande"><h2>Anatomie d&#8217;une commande</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">ls --color=always -l /bin</code></pre></div></div>
<div class="ulist"><ul><li><p>Séparateur : l&#8217;espace</p></li><li><p>Premier élément (<code>ls</code>) : c&#8217;est la commande</p></li><li><p>Les éléments commençant par un tiret <code>-</code> sont des "options" et/ou drapeaux ("flags")</p><div class="ulist"><ul><li><p>"Option" == "Optionnel"</p></li></ul></div></li><li><p>Les autres éléments sont des arguments  (<code>/bin</code>)</p><div class="ulist"><ul><li><p>Nécessaire (par opposition)</p></li></ul></div></li></ul></div></div></section><section id="manuel_des_commande"><h2>Manuel des commande</h2><div class="slide-content"><div class="ulist"><ul><li><p>Afficher le manuel de <code>&lt;commande&gt;</code> :</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Commande 'man' avec comme argument le nom de ladite commande
man &lt;commande&gt;</code></pre></div></div>
<div class="ulist"><ul><li><p>Navigation avec les flèches haut et bas</p><div class="ulist"><ul><li><p>Tapez <code>/</code> puis une chaîne de texte pour chercher</p></li><li><p>Touche <code>n</code> pour sauter d’occurrence en occurrence</p></li></ul></div></li><li><p>Touche <code>q</code> pour quitter</p></li></ul></div></li></ul></div>
<div class="paragraph"><p>🎓 Essayez avec <code>ls</code>, chercher le mot <code>color</code></p></div>
<div class="ulist small"><ul><li><p>💡 La majorité des commandes fournit également une option (<code>--help</code>), un flag (<code>-h</code>)  ou un argument (<code>help</code>)</p></li><li><p>Google c&#8217;est pratique aussi hein !</p></li></ul></div></div></section><section id="raccourcis"><h2>Raccourcis</h2><div class="slide-content"><div class="paragraph"><p>Dans un terminal Unix/Linux/WSL :</p></div>
<div class="ulist"><ul><li><p><code>CTRL + C</code> : Annuler le process ou prompt en cours</p></li><li><p><code>CTRL + L</code> : Nettoyer le terminal</p></li><li><p><code>CTRL + A</code> : Positionner le curseur au début de la ligne</p></li><li><p><code>CTRL + E</code> : Positionner le curseur à la fin de la ligne</p></li><li><p><code>CTRL + R</code> : Rechercher dans l&#8217;historique de commandes</p></li></ul></div>
<div class="paragraph small"><small>🎓 Essayez-les !</small></div></div></section><section id="commandes_de_base_12"><h2>Commandes de base 1/2</h2><div class="slide-content"><div class="ulist"><ul><li><p><code>pwd</code> : Afficher le répertoire courant</p><div class="ulist"><ul><li><p>🎓 Option <code>-P</code> ?</p></li></ul></div></li><li><p><code>ls</code> : Lister le contenu du répertoire courant</p><div class="ulist"><ul><li><p>🎓 Options <code>-a</code> et <code>-l</code> ?</p></li></ul></div></li><li><p><code>cd</code> : Changer de répertoire</p><div class="ulist"><ul><li><p>🎓 Sans argument : que se passe t&#8217;il ?</p></li></ul></div></li><li><p><code>cat</code> : Afficher le contenu d&#8217;un fichier</p><div class="ulist"><ul><li><p>🎓 Essayez avec plusieurs arguments</p></li></ul></div></li><li><p><code>mkdir</code> : créer un répertoire</p><div class="ulist"><ul><li><p>🎓 Option <code>-p</code> ?</p></li></ul></div></li></ul></div></div></section><section id="commandes_de_base_22"><h2>Commandes de base 2/2</h2><div class="slide-content"><div class="ulist"><ul><li><p><code>echo</code> : Afficher un (des) message(s)</p></li><li><p><code>rm</code> : Supprimer un fichier ou dossier</p></li><li><p><code>touch</code> : Créer un fichier</p></li><li><p><code>grep</code> : Chercher un motif de texte</p></li></ul></div></div></section><section id="arborescence_de_fichiers_12"><h2>Arborescence de fichiers 1/2</h2><div class="slide-content"><div class="ulist"><ul><li><p>Le système de fichier a une structure d&#8217;arbre</p><div class="ulist"><ul><li><p>La racine du disque dur c&#8217;est <code>/</code> : 🎓 <code>ls -l /</code></p></li><li><p>Le séparateur c&#8217;est également <code>/</code> : 🎓 <code>ls -l /usr/bin</code></p></li></ul></div></li><li><p>Deux types de chemins :</p><div class="ulist"><ul><li><p>Absolu (depuis la racine): Commence par <code>/</code> (Ex. <code>/usr/bin</code>)</p></li><li><p>Sinon c&#8217;est relatif (e.g. depuis le dossier courant) (Ex <code>./bin</code> ou <code>local/bin/</code>)</p></li></ul></div></li></ul></div>
<div class="imageblock"><img src="media/linux-directory-structure.png" alt="linux directory structure" width="400"></div>
<div class="paragraph small"><small><a href="https://linuxhandbook.com/linux-directory-structure/" target="_blank">Source</a></small></div></div></section><section id="arborescence_de_fichiers_22"><h2>Arborescence de fichiers 2/2</h2><div class="slide-content"><div class="ulist"><ul><li><p>Le dossier "courant" c&#8217;est <code>.</code> : 🎓 <code>ls -l ./bin # Dans le dossier /usr</code></p></li><li><p>Le dossier "parent" c&#8217;est <code>..</code> : 🎓 <code>ls -l ../ # Dans le dossier /usr</code></p></li><li><p><code>~</code> (tilde) c&#8217;est un raccourci vers le dossier de l&#8217;utilisateur courant : 🎓 <code>ls -l ~</code></p></li><li><p>Sensible à la casse (majuscules/minuscules) et aux espaces :
🎓</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">ls -l /bin
ls -l /Bin
mkdir ~/"Accent tué"
ls -d ~/Accent\ tué</code></pre></div></div></li></ul></div></div></section><section id="un_language"><h2>Un language (?)</h2><div class="slide-content"><div class="ulist"><ul><li><p>Variables interpolées avec le caractère "dollar" <code>$</code> :</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">echo $MA_VARIABLE
echo "$MA_VARIABLE"
echo ${MA_VARIABLE}

# Recommendation
echo "${MA_VARIABLE}"

MA_VARIABLE="Salut tout le monde"

echo "${MA_VARIABLE}"</code></pre></div></div></li><li><p>Sous commandes avec <code>$(&lt;command&gt;)</code>:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">echo "&gt;&gt; Contenu de /tmp :\n$(ls /tmp)"</code></pre></div></div>
<div class="ulist"><ul><li><p>Des <code>if</code>, des <code>for</code> et plein d&#8217;autres trucs (<a href="https://tldp.org/LDP/abs/html/" class="bare" target="_blank">https://tldp.org/LDP/abs/html/</a>)</p></li></ul></div></div></section><section id="codes_de_sortie"><h2>Codes de sortie</h2><div class="slide-content"><div class="ulist"><ul><li><p>Chaque exécution de commande renvoie un code de retour (🇬🇧 "exit code")</p><div class="ulist"><ul><li><p>Nombre entier entre 0 et 255 (en <a href="https://en.wikipedia.org/wiki/POSIX" target="_blank">POSIX</a>)</p></li></ul></div></li><li><p>Code accessible dans la variable <strong>éphémère</strong> <code>$?</code> :</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">ls /tmp
echo $?

ls /do_not_exist
echo $?

# Une seconde fois. Que se passe-t'il ?
echo $?</code></pre></div></div></div></section><section id="entrée_sortie_standard_et_derreur"><h2>Entrée, sortie standard et d&#8217;erreur</h2><div class="slide-content"><div class="paragraph"><p><span class="image"><img src="media/cli-ios.png" alt="cli ios"></span></p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">ls -l /tmp
echo "Hello" &gt; /tmp/hello.txt
ls -l /tmp
ls -l /tmp &gt;/dev/null
ls -l /tmp 1&gt;/dev/null

ls -l /do_not_exist
ls -l /do_not_exist 1&gt;/dev/null
ls -l /do_not_exist 2&gt;/dev/null

ls -l /tmp /do_not_exist
ls -l /tmp /do_not_exist 1&gt;/dev/null 2&gt;&amp;1</code></pre></div></div></div></section><section id="pipelines"><h2>Pipelines</h2><div class="slide-content"><div class="ulist"><ul><li><p>Le caractère "pipe" <code>|</code> permet de chaîner des commandes</p><div class="ulist"><ul><li><p>Le "stdout" de la première commande est branchée sur le "stdin" de la seconde</p></li></ul></div></li><li><p>Exemple : Afficher les fichiers/dossiers contenant le lettre <code>d</code> dans le dossier <code>/bin</code> :</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">ls -l /bin

ls -l /bin | grep "d" --color=auto</code></pre></div></div></div></section><section id="exécution_12"><h2>Exécution 1/2</h2><div class="slide-content"><div class="ulist"><ul><li><p>Les commandes sont des fichier binaires exécutables sur le système :</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">command -v cat # équivalent de "which cat"

ls -l "$(command -v cat)"</code></pre></div></div></li><li><p>La variable d&#8217;environnement <code>$PATH</code> liste les dossiers dans lesquels chercher les binaires</p><div class="ulist"><ul><li><p>💡 Utiliser cette variable quand une commande fraîchement installée n&#8217;est pas trouvée</p></li></ul></div></li></ul></div></div></section><section id="exécution_22"><h2>Exécution 2/2</h2><div class="slide-content"><div class="ulist"><ul><li><p>Exécution de scripts :</p><div class="ulist"><ul><li><p>Soit appel direct avec l&#8217;interprétateur : <code>sh ~/monscript.txt</code></p></li><li><p>Soit droit d&#8217;exécution avec un "shebang" (e.g. <code>#!/bin/bash</code>)</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ chmod +x ./monscript.sh

$ head -n1 ./monscript.sh
#!/bin/bash

$ ./monscript.sh
# Exécution</code></pre></div></div></li></ul></div></li></ul></div></div></section></section>
<section><section id="git" data-background-color="rgb(248, 228, 130)" data-state="invert"><h2>Git</h2><div class="slide-content"><div class="paragraph"><p>Guide de survie</p></div></div></section><section id="problématique_2"><h2>🤔 Problématique</h2><div class="slide-content"><div class="ulist"><ul><li><p>Support de communication</p><div class="ulist"><ul><li><p>Humain &#8594; Machine</p></li><li><p>Humain &lt;&#8594; Humain</p></li></ul></div></li><li><p>Besoins de traçabilité, de définition explicite et de gestion de conflits</p><div class="ulist"><ul><li><p>Collaboration requise pour chaque changement (revue, responsabilités)</p></li></ul></div></li></ul></div></div></section><section id="tracer_le_changement_dans_le_code"><h2>Tracer le changement dans le code</h2><div class="slide-content"><div class="paragraph"><p>avec un <strong>VCS</strong> : 🇬🇧 Version Control System</p></div>
<div class="paragraph small"><small>également connu sous le nom de SCM (🇬🇧 Source Code Management)</small></div></div></section><section id="pourquoi_un_vcs"><h2>Pourquoi un VCS ?</h2><div class="slide-content"><div class="ulist"><ul><li><p>Pour conserver une trace de <strong>tous</strong> les changements dans un historique</p><div class="ulist"><ul><li><p>"Source unique de vérité" (🇬🇧 <em>Single Source of Truth</em>)</p></li></ul></div></li><li><p>Pour <strong>collaborer</strong> efficacement sur un même référentiel</p></li></ul></div></div></section><section id="concepts_des_vcs"><h2>Concepts des VCS</h2><div class="slide-content"><div class="imageblock"><img src="media/scm-local.png" alt="scm local" width="300"></div>
<div class="imageblock"><img src="media/scm-distributed.png" alt="scm distributed" width="300"></div>
<div class="paragraph small"><small>Source : <a href="https://git-scm.com/book/en/v2/Getting-Started-About-Version-Control" class="bare">https://git-scm.com/book/en/v2/Getting-Started-About-Version-Control</a></small></div></div></section><section id="quel_vcs_utiliser"><h2>Quel VCS utiliser ?</h2><div class="slide-content"><div class="imageblock"><img src="media/cloudwords-vcs.png" alt="cloudwords vcs" width="500"></div>
<div class="paragraph"><p>Nous allons utiliser <strong>Git</strong></p></div></div></section><section id="git_2"><h2>Git</h2><div class="slide-content"><div class="quoteblock"><blockquote><div class="paragraph"><p>Git is a free and open source distributed version control system designed to handle everything from small to very large projects with speed and efficiency.</p></div></blockquote></div>
<div class="paragraph"><p><a href="https://git-scm.com/" class="bare">https://git-scm.com/</a></p></div>
<div class="imageblock"><img src="media/git-logo.png" alt="git logo"></div></div></section><section id="les_3_états_avec_git"><h2>Les 3 états avec Git</h2><div class="slide-content"><div class="ulist"><ul><li><p>L&#8217;historique ("Version Database") : dossier <code>.git</code></p></li><li><p>Dossier de votre projet ("Working Directory") - Commande</p></li><li><p>La zone d&#8217;index ("Staging Area")</p></li></ul></div>
<div class="imageblock"><img src="media/git-3-etats.png" alt="git 3 etats" width="300"></div>
<div class="paragraph small"><small>Source : <a href="https://git-scm.com/book/fr/v2/D%C3%A9marrage-rapide-Rudiments-de-Git#" class="bare">https://git-scm.com/book/fr/v2/D%C3%A9marrage-rapide-Rudiments-de-Git#</a><em>les_trois</em>%C3%A9tats</small></div></div></section><section id="exercice_avec_git_1_1"><h2>🎓 Exercice avec Git - 1.1</h2><div class="slide-content"><div class="ulist"><ul><li><p>Dans le terminal de votre environnement GitPod:</p><div class="ulist"><ul><li><p>Créez un dossier vide nommé <code>projet-vcs-1</code> dans le répertoire <code>/workspace</code>, puis positionnez-vous dans ce dossier</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">mkdir -p /workspace/projet-vcs-1/
cd /workspace/projet-vcs-1/</code></pre></div></div></li><li><p>Est-ce qu&#8217;il y a un dossier <code>.git/</code> ?</p></li><li><p>Essayez la commande <code>git status</code> ?</p></li></ul></div></li><li><p>Initialisez le dépôt git avec <code>git init</code></p><div class="ulist"><ul><li><p>Est-ce qu&#8217;il y a un dossier <code>.git/</code> ?</p></li><li><p>Essayez la commande <code>git status</code> ?</p></li></ul></div></li></ul></div></div></section><section id="solution_de_lexercice_avec_git_1_1"><h2>✅ Solution de l&#8217;exercice avec Git - 1.1</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">mkdir -p /workspace/projet-vcs-1/
cd /workspace/projet-vcs-1/
ls -la # Pas de dossier .git
git status # Erreur "fatal: not a git repository"
git init ./
ls -la # On a un dossier .git
git status # Succès avec un message "On branch main No commits yet"</code></pre></div></div></div></section><section id="exercice_avec_git_1_2"><h2>🎓 Exercice avec Git - 1.2</h2><div class="slide-content"><div class="ulist"><ul><li><p>Créez un fichier <code>README.md</code> dedans avec un titre et vos nom et prénoms</p><div class="ulist"><ul><li><p>Essayez la commande <code>git status</code> ?</p></li></ul></div></li><li><p>Ajoutez le fichier à la zone d&#8217;indexation à l&#8217;aide de la commande <code>git add (&#8230;&#8203;)</code></p><div class="ulist"><ul><li><p>Essayez la commande <code>git status</code> ?</p></li></ul></div></li><li><p>Créez un commit qui ajoute le fichier <code>README.md</code> avec un message,
à l&#8217;aide de la commande <code>git commit -m &lt;message&gt;</code></p><div class="ulist"><ul><li><p>Essayez la commande <code>git status</code> ?</p></li></ul></div></li></ul></div></div></section><section id="solution_de_lexercice_avec_git_1_2"><h2>✅ Solution de l&#8217;exercice avec Git - 1.2</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">echo "# Read Me\n\nObi Wan" &gt; ./README.md
git status # Message "Untracked file"

git add ./README.md
git status # Message "Changes to be committed"
git commit -m "Ajout du README au projet"
git status  # Message "nothing to commit, working tree clean"</code></pre></div></div></div></section><section id="terminologie_de_git_diff_et_changeset"><h2>Terminologie de Git - Diff et changeset</h2><div class="slide-content"><div class="paragraph"><p><strong>diff:</strong> un ensemble de lignes "changées" sur un fichier donné</p></div>
<div class="imageblock"><img src="media/diff.png" alt="diff" width="600"></div>
<div class="paragraph"><p><strong>changeset:</strong> un ensemble de "diff" (donc peut couvrir plusieurs fichiers)</p></div>
<div class="imageblock"><img src="media/changeset.png" alt="changeset" height="200"></div></div></section><section id="terminologie_de_git_commit"><h2>Terminologie de Git - Commit</h2><div class="slide-content"><div class="paragraph"><p><strong>commit:</strong> un changeset qui possède un (commit) parent, associé à un message</p></div>
<div class="imageblock"><img src="media/commit.png" alt="commit" height="150"></div>
<div class="paragraph"><p><em>"HEAD"</em>: C&#8217;est le dernier commit dans l&#8217;historique</p></div>
<div class="imageblock"><img src="media/scm-basics-legend.png" alt="scm basics legend"></div>
<div class="imageblock"><img src="media/scm-basics-history.png" alt="scm basics history"></div></div></section><section id="exercice_avec_git_2"><h2>🎓 Exercice avec Git - 2</h2><div class="slide-content"><div class="ulist"><ul><li><p>Afficher la liste des commits</p></li><li><p>Afficher le changeset associé à un commit</p></li><li><p>Modifier du contenu dans <code>README.md</code> et afficher le diff</p></li><li><p>Annulez ce changement sur <code>README.md</code></p></li></ul></div></div></section><section id="solution_de_lexercice_avec_git_2"><h2>✅ Solution de l&#8217;exercice avec Git - 2</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">git log

git show # Show the "HEAD" commit
echo "# Read Me\n\nObi Wan Kenobi" &gt; ./README.md

git diff
git status

git checkout -- README.md
git status</code></pre></div></div></div></section><section id="terminologie_de_git_branche"><h2>Terminologie de Git - Branche</h2><div class="slide-content"><div class="ulist"><ul><li><p>Abstraction d&#8217;une version "isolée" du code</p></li><li><p>Concrètement, une <strong>branche</strong> est un alias pointant vers un "commit"</p></li></ul></div>
<div class="imageblock"><img src="media/scm-branches.png" alt="scm branches"></div></div></section><section id="exercice_avec_git_3"><h2>🎓 Exercice avec Git - 3</h2><div class="slide-content"><div class="ulist"><ul><li><p>Créer une branche nommée <code>feature/html</code></p></li><li><p>Ajouter un nouveau commit contenant un nouveau fichier <code>index.html</code> sur cette branche</p></li><li><p>Afficher le graphe correspondant à cette branche avec <code>git log --graph</code></p></li></ul></div></div></section><section id="solution_de_lexercice_avec_git_3"><h2>✅ Solution de l&#8217;exercice avec Git - 3</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">git switch --create feature/html
# Ou alors: git branch feature/html &amp;&amp; git switch feature/html
echo '&lt;h1&gt;Hello&lt;/h1&gt;' &gt; ./index.html
git add ./index.html &amp;&amp; git commit --message="Ajout d'une page HTML par défaut" # -m / --message

git log
git log --graph
git lg # cat ~/.gitconfig =&gt; regardez la section section [alias], cette commande est déjà définie!</code></pre></div></div></div></section><section id="terminologie_de_git_merge"><h2>Terminologie de Git - Merge</h2><div class="slide-content"><div class="ulist"><ul><li><p>On intègre une branche dans une autre en effectuant un <strong>merge</strong></p><div class="ulist"><ul><li><p>Un nouveau commit est créé, fruit de la combinaison de 2 autres commits</p></li></ul></div></li></ul></div>
<div class="imageblock"><img src="media/scm-merge.png" alt="scm merge"></div></div></section><section id="exercice_avec_git_4"><h2>🎓 Exercice avec Git - 4</h2><div class="slide-content"><div class="ulist"><ul><li><p>Merger la branche <code>feature/html</code> dans la branche principale</p><div class="ulist"><ul><li><p>⚠️ Pensez à utiliser l&#8217;option <code>--no-ff</code></p></li></ul></div></li><li><p>Afficher le graphe correspondant à cette branche avec <code>git log --graph</code></p></li></ul></div></div></section><section id="solution_de_lexercice_avec_git_4"><h2>✅ Solution de l&#8217;exercice avec Git - 4</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">git switch main
git merge --no-ff feature/html # Enregistrer puis fermer le fichier 'MERGE_MSG' qui a été ouvert
git log --graph

# git lg</code></pre></div></div></div></section><section id="feature_branch_flow"><h2>Feature Branch Flow</h2><div class="slide-content"><div class="ulist"><ul><li><p><strong>Une seule</strong> branche <strong>par</strong> fonctionnalité</p></li></ul></div>
<div class="imageblock"><a class="image" href="https://twitter.com/jay_gee/status/702638177471873024"><img src="media/scm-feature-branch-workflow.png" alt="scm feature branch workflow"></a></div></div></section><section id="exemple_dusages_de_vcs"><h2>Exemple d&#8217;usages de VCS</h2><div class="slide-content"><div class="ulist"><ul><li><p>"Infrastructure as Code" :</p><div class="ulist"><ul><li><p>Besoins de traçabilité, de définition explicite et de gestion de conflits</p></li><li><p>Collaboration requise pour chaque changement (revue, responsabilités)</p></li></ul></div></li><li><p>Code Civil:</p><div class="ulist"><ul><li><p><a href="https://github.com/steeve/france.code-civil" class="bare">https://github.com/steeve/france.code-civil</a></p></li><li><p><a href="https://github.com/steeve/france.code-civil/pull/40" class="bare">https://github.com/steeve/france.code-civil/pull/40</a></p></li><li><p><a href="https://github.com/steeve/france.code-civil/commit/b805ecf05a86162d149d3d182e04074ecf72c066" class="bare">https://github.com/steeve/france.code-civil/commit/b805ecf05a86162d149d3d182e04074ecf72c066</a></p></li></ul></div></li></ul></div></div></section><section id="checkpoint_2"><h2>Checkpoint 🎯</h2><div class="slide-content"><div class="ulist"><ul><li><p><code>git</code> est un des (plus populaires) de système de contrôle de versions</p></li><li><p>Cet outil vous permet:</p><div class="ulist"><ul><li><p>D&#8217;avoir un historique auditable de votre code source</p></li><li><p>De collaborer efficacement sur le code source (conflit <code>git</code> == "PARLEZ-VOUS")</p></li></ul></div></li></ul></div>
<div class="paragraph"><p>&#8658; C&#8217;est une ligne de commande (trop?) complète qui nécessite de pratiquer</p></div></div></section></section>
<section><section id="containers" data-background-image="media/blue-shipping-container.png" data-background-size="contain" data-background-position="left"><h2>Containers</h2><div class="slide-content"></div></section><section id="exercice_votre_premier_conteneur"><h2>🎓 Exercice : Votre premier conteneur</h2><div class="slide-content"><div class="paragraph"><p>C&#8217;est à vous (ouf) !</p></div>
<div class="ulist"><ul><li><p>Allez dans Gitpod</p></li><li><p>Dans un terminal, tapez la commande suivante :</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run hello-world
# Equivalent de l'ancienne commande 'docker run'</code></pre></div></div></div></section><section id="anatomie" data-auto-animate><h2>🩻 Anatomie</h2><div class="slide-content"><div class="ulist"><ul><li><p>Un service "Docker Engine" tourne en tâche de fond et publie une API REST</p></li><li><p>La commande <code>docker container run &#8230;&#8203;</code> a lancé un client docker qui a envoyé une requête <code>POST</code> au service docker</p></li><li><p>Le service a téléchargé une <strong>Image</strong> Docker depuis le registre <strong>DockerHub</strong>,</p></li><li><p>Puis a exécuté un <strong>conteneur</strong> basé sur cette image</p></li></ul></div></div></section><section id="anatomie_2" data-auto-animate><h2>🩻 Anatomie</h2><div class="slide-content"><div class="imageblock"><img src="media/output3_with_transparency.png" alt="output3 with transparency"></div></div></section><section id="anatomie_3" data-auto-animate><h2>🩻 Anatomie</h2><div class="slide-content"><div class="imageblock"><img src="media/output4_with_transparency.png" alt="output4 with transparency"></div></div></section><section id="anatomie_4" data-auto-animate><h2>🩻 Anatomie</h2><div class="slide-content"><div class="imageblock"><img src="media/output5_with_transparency.png" alt="output5 with transparency"></div></div></section><section id="anatomie_5" data-auto-animate><h2>🩻 Anatomie</h2><div class="slide-content"><div class="imageblock"><img src="media/output6_with_transparency.png" alt="output6 with transparency"></div></div></section><section id="anatomie_6" data-auto-animate><h2>🩻 Anatomie</h2><div class="slide-content"><div class="imageblock"><img src="media/output7_with_transparency.png" alt="output7 with transparency"></div></div></section><section id="anatomie_7" data-auto-animate><h2>🩻 Anatomie</h2><div class="slide-content"><div class="imageblock"><img src="media/output8_with_transparency.png" alt="output8 with transparency"></div></div></section><section id="anatomie_8" data-auto-animate><h2>🩻 Anatomie</h2><div class="slide-content"><div class="imageblock"><img src="media/output9_with_transparency.png" alt="output9 with transparency"></div></div></section><section id="anatomie_9" data-auto-animate><h2>🩻 Anatomie</h2><div class="slide-content"><div class="imageblock"><img src="media/output10_with_transparency.png" alt="output10 with transparency"></div></div></section><section id="anatomie_10" data-auto-animate><h2>🩻 Anatomie</h2><div class="slide-content"><div class="imageblock"><img src="media/dollar_date.png" alt="dollar date"></div></div></section><section id="anatomie_11" data-auto-animate><h2>🩻 Anatomie</h2><div class="slide-content"><div class="imageblock"><img src="media/shell_dans_shell_pour_date.png" alt="shell dans shell pour date"></div></div></section><section id="exercice_où_est_mon_conteneur"><h2>🎓 Exercice : Où est mon conteneur ?</h2><div class="slide-content"><div class="paragraph"><p>C&#8217;est à vous !</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container ls --help
# ...
docker container ls
# ...
docker container ls --all</code></pre></div></div>
<div class="paragraph"><p>&#8658; 🤔 comment comprenez vous les résultats des 2 dernières commandes ?</p></div></div></section><section id="solution_où_est_mon_conteneur"><h2>✅ Solution : Où est mon conteneur ?</h2><div class="slide-content"><div class="paragraph"><p>Le conteneur est toujours présent dans le "Docker Engine" même en étant arrêté</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">CONTAINER ID   IMAGE         COMMAND    CREATED          STATUS                      PORTS     NAMES
109a9cdd3ec8   hello-world   "/hello"   33 seconds ago   Exited (0) 17 seconds ago             festive_faraday</code></pre></div></div>
<div class="ulist"><ul><li><p>Un conteneur == une commande "conteneurisée"</p><div class="ulist"><ul><li><p>cf. colonne "<strong>COMMAND</strong>"</p></li></ul></div></li><li><p>Quand la commande s&#8217;arrête : le conteneur s&#8217;arrête</p><div class="ulist"><ul><li><p>cf. code de sortie dans la colonne "<strong>STATUS</strong>"</p></li></ul></div></li></ul></div></div></section><section id="rappels_danatomie" data-auto-animate><h2>🫁 Rappels d&#8217;anatomie</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ docker container run busybox echo hello world</code></pre></div></div></div></section><section id="rappels_danatomie_2" data-auto-animate><h2>🫁 Rappels d&#8217;anatomie</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ docker container run busybox echo hello world</code></pre></div></div>
<div class="ulist"><ul><li><p>Le moteur Docker crée un container à partir de l&#8217;image "busybox".</p></li></ul></div></div></section><section id="rappels_danatomie_3" data-auto-animate><h2>🫁 Rappels d&#8217;anatomie</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ docker container run busybox echo hello world</code></pre></div></div>
<div class="ulist"><ul><li><p>Le moteur Docker crée un container à partir de l&#8217;image "busybox".</p></li><li><p>Le moteur Docker démarre le container créé.</p></li></ul></div></div></section><section id="rappels_danatomie_4" data-auto-animate><h2>🫁 Rappels d&#8217;anatomie</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ docker container run busybox echo hello world</code></pre></div></div>
<div class="ulist"><ul><li><p>Le moteur Docker crée un container à partir de l&#8217;image "busybox".</p></li><li><p>Le moteur Docker démarre le container créé.</p></li><li><p>La commande "echo hello world" est exécutée à l&#8217;intérieur du container.</p></li></ul></div></div></section><section id="rappels_danatomie_5" data-auto-animate><h2>🫁 Rappels d&#8217;anatomie</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ docker container run busybox echo hello world</code></pre></div></div>
<div class="ulist"><ul><li><p>Le moteur Docker crée un container à partir de l&#8217;image "busybox".</p></li><li><p>Le moteur Docker démarre le container créé.</p></li><li><p>La commande "echo hello world" est exécutée à l&#8217;intérieur du container.</p></li><li><p>On obtient le résultat dans la sortie standard de la machine hôte.</p></li></ul></div></div></section><section id="rappels_danatomie_6" data-auto-animate><h2>🫁 Rappels d&#8217;anatomie</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ docker container run busybox echo hello world</code></pre></div></div>
<div class="ulist"><ul><li><p>Le moteur Docker crée un container à partir de l&#8217;image "busybox".</p></li><li><p>Le moteur Docker démarre le container créé.</p></li><li><p>La commande "echo hello world" est exécutée à l&#8217;intérieur du container.</p></li><li><p>On obtient le résultat dans la sortie standard de la machine hôte.</p></li><li><p>Le container est stoppé.</p></li></ul></div></div></section><section id="cas_dusage_14" data-auto-animate><h2>🍽️ Cas d&#8217;usage</h2><div class="slide-content"><div class="paragraph"><p>Outillage jetable</p></div>
<div class="imageblock"><img src="media/outillage-jetable.png" alt="outillage jetable"></div>
<div class="ulist"><ul><li><p>Tester une version de Maven, de JDK, de NPM, …</p></li></ul></div></div></section><section id="exercice_cycle_de_vie_dun_conteneur_simple"><h2>🎓 Exercice : Cycle de vie d&#8217;un conteneur simple</h2><div class="slide-content"><div class="ulist"><ul><li><p>Lancez un nouveau conteneur nommé <code>bonjour</code></p><div class="ulist"><ul><li><p>💡 <code>docker container run --help</code> ou <a href="https://docs.docker.com/engine/reference/commandline/container_run/" target="_blank">Documentation en ligne</a></p></li></ul></div></li><li><p>Affichez les "logs" du conteneur (==traces d&#8217;exécution écrites sur le stdout + stderr de la commande conteneurisée)</p><div class="ulist"><ul><li><p>💡 <code>docker container logs  --help</code> ou <a href="https://docs.docker.com/engine/reference/commandline/container_logs/" target="_blank">Documentation en ligne</a></p></li></ul></div></li><li><p>Lancez le conteneur avec la commande <a href="https://docs.docker.com/engine/reference/commandline/container_start/" target="_blank"><code>docker container start</code></a></p><div class="ulist"><ul><li><p>Regardez le résultat dans les logs</p></li></ul></div></li><li><p>Supprimez le container avec la commande <a href="https://docs.docker.com/engine/reference/commandline/container_rm/" target="_blank"><code>docker container rm</code></a></p></li></ul></div></div></section><section id="solution_cycle_de_vie_dun_conteneur_simple"><h2>✅ Solution : Cycle de vie d&#8217;un conteneur simple</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run --name=bonjour hello-world
# Affiche le texte habituel

docker container logs bonjour
# Affiche le même texte : pratique si on a fermé le terminal

docker container start bonjour
# N'affiche pas le texte mais l'identifiant unique du conteneur 'bonjour'

docker container logs bonjour
# Le texte est affiché 2 fois !

docker container ls --all
# Le conteneur est présent
docker container rm bonjour
docker container ls --all
# Le conteneur n'est plus là : il a été supprimé ainsi que ses logs

docker container logs bonjour
# Error: No such container: bonjour</code></pre></div></div></div></section><section id="que_contient_hello_world"><h2>🤔 Que contient "hello-world" ?</h2><div class="slide-content"><div class="ulist"><ul><li><p>C&#8217;est une "image" de conteneur, c&#8217;est à dire un modèle (template)
représentant une application auto-suffisante.</p><div class="ulist"><ul><li><p>On peut voir ça comme un "paquetage" autonome</p></li></ul></div></li><li><p>C&#8217;est un système de fichier complet:</p><div class="ulist"><ul><li><p>Il y a au moins une racine <code>/</code></p></li><li><p>Ne contient que ce qui est censé être nécessaire (dépendances, librairies, binaires, etc.)</p></li></ul></div></li></ul></div></div></section><section id="docker_hub"><h2>Docker Hub</h2><div class="slide-content"><div class="ulist"><ul><li><p><a href="https://hub.docker.com/" class="bare">https://hub.docker.com/</a> : C&#8217;est le registre d&#8217;images "par défaut"</p><div class="ulist"><ul><li><p>Exemple : Image officielle de <a href="https://hub.docker.com/_/ubuntu">conteneur "Ubuntu"</a></p></li></ul></div></li><li><p>🎓 Cherchez l&#8217;image <code>hello-world</code> pour en voir la page de documentation</p><div class="ulist"><ul><li><p>💡 pas besoin de créer de compte pour ça</p></li></ul></div></li><li><p>Il existe d&#8217;autre "registres" en fonction des besoins (GitHub GHCR, Google GCR, etc.)</p></li></ul></div></div></section><section id="lancer_un_container_interactif" data-auto-animate><h2>🏓 Lancer un container interactif</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run  --interactive --tty alpine</code></pre></div></div></div></section><section id="lancer_un_container_interactif_2" data-auto-animate><h2>🏓 Lancer un container interactif</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run  --interactive --tty alpine
/ $</code></pre></div></div></div></section><section id="lancer_un_container_interactif_3" data-auto-animate><h2>🏓 Lancer un container interactif</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run  --interactive --tty alpine
/ $</code></pre></div></div>
<div class="ulist"><ul><li><p>On lance un container à partir de l&#8217;image "alpine"</p></li></ul></div></div></section><section id="lancer_un_container_interactif_4" data-auto-animate><h2>🏓 Lancer un container interactif</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run  --interactive --tty alpine
/ $</code></pre></div></div>
<div class="ulist"><ul><li><p>On lance un container à partir de l&#8217;image "alpine"</p></li><li><p>On lance un <code>sh</code> dans ce container</p></li></ul></div></div></section><section id="lancer_un_container_interactif_5" data-auto-animate><h2>🏓 Lancer un container interactif</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run  --interactive --tty alpine
/ $</code></pre></div></div>
<div class="ulist"><ul><li><p>On lance un container à partir de l&#8217;image "alpine"</p></li><li><p>On lance un <code>sh</code>  dans ce container</p></li><li><p>On redirige l&#8217;entrée standard avec -i</p></li></ul></div></div></section><section id="lancer_un_container_interactif_6" data-auto-animate><h2>🏓 Lancer un container interactif</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run  --interactive --tty alpine
/ $</code></pre></div></div>
<div class="ulist"><ul><li><p>On lance un container à partir de l&#8217;image "alpine"</p></li><li><p>On lance un <code>sh</code>  dans ce container</p></li><li><p>On redirige l&#8217;entrée standard avec -i</p></li><li><p>On déclare un pseudo-terminal avec -t</p></li></ul></div></div></section><section id="exercice_conteneur_interactif"><h2>🎓 Exercice : conteneur interactif</h2><div class="slide-content"><div class="ulist"><ul><li><p>Quelle distribution Linux est utilisée dans le terminal Gitpod ?</p><div class="ulist"><ul><li><p>💡 Regardez le fichier <code>/etc/os-release</code></p></li></ul></div></li><li><p>Exécutez un conteneur interactif basé sur <code>alpine:3.18.3</code> (une distribution Linux ultra-légère) et regardez le contenu du fichier au même emplacement</p><div class="ulist"><ul><li><p>💡 <code>docker container run --help</code></p></li><li><p>💡 Demandez un <a href="https://en.wikipedia.org/wiki/TTY"><code>tty</code></a> à Docker</p></li><li><p>💡 Activez le mode interactif</p></li></ul></div></li><li><p>Exécutez la même commande dans un conteneur basé sur la même image mais en <strong>NON</strong> interactif</p><div class="ulist"><ul><li><p>💡 Comment surcharger la commande par défaut ?</p></li></ul></div></li></ul></div></div></section><section id="solution_conteneur_interactif"><h2>✅ Solution : conteneur interactif</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ cat /etc/os-release
# ... Ubuntu ....

$ docker container run --tty --interactive alpine:3.18.3
/ $ cat /etc/os-release
# ... Alpine ...
# Notez que le "prompt" du terminal est différent DANS le conteneur
/ $ exit
$ docker container ls --all

$ docker container run alpine:3.18.3 cat /etc/os-release
# ... Alpine ...</code></pre></div></div></div></section><section id="utiliser_un_container_interactif" data-auto-animate><h2>🏓 Utiliser un container interactif</h2><div class="slide-content"><div class="paragraph"><p>Revenons dans notre container interactif de tout à l&#8217;heure&#8230;&#8203;</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">/ $ curl google.fr</code></pre></div></div></div></section><section id="utiliser_un_container_interactif_2" data-auto-animate><h2>🏓 Utiliser un container interactif</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">/ $ curl google.fr
/bin/sh: curl: not found</code></pre></div></div></div></section><section id="utiliser_un_container_interactif_3" data-auto-animate><h2>🏓 Utiliser un container interactif</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">/ $ curl google.fr
/bin/sh: curl: not found</code></pre></div></div>
<div class="paragraph"><p><code>cURL</code> n&#8217;est pas disponible par défaut sur Alpine. Il faut l&#8217;installer au préalable</p></div></div></section><section id="utiliser_un_container_interactif_4" data-auto-animate><h2>🏓 Utiliser un container interactif</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">/ $ curl google.fr
/bin/sh: curl: not found</code></pre></div></div>
<div class="paragraph"><p><code>cURL</code> n&#8217;est pas disponible par défaut sur Alpine. Il faut l&#8217;installer au préalable</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">/ $ apk update &amp;&amp; apk add curl</code></pre></div></div></div></section><section id="utiliser_un_container_interactif_5" data-auto-animate><h2>🏓 Utiliser un container interactif</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">/ $ curl google.fr
/bin/sh: curl: not found</code></pre></div></div>
<div class="paragraph"><p><code>cURL</code> n&#8217;est pas disponible par défaut sur Alpine. Il faut l&#8217;installer au préalable</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">/ $ apk update &amp;&amp; apk add curl
fetch https://dl-cdn.alpinelinux.org/alpine/v3.18/main/x86_64/APKINDEX.tar.gz
fetch https://dl-cdn.alpinelinux.org/alpine/v3.18/community/x86_64/APKINDEX.tar.gz
v3.18.3-169-gd5adf7d7d28 [https://dl-cdn.alpinelinux.org/alpine/v3.18/main]
v3.18.3-171-g503977088b4 [https://dl-cdn.alpinelinux.org/alpine/v3.18/community]
OK: 20063 distinct packages available
(1/7) Installing ca-certificates (20230506-r0)
(2/7) Installing brotli-libs (1.0.9-r14)
(3/7) Installing libunistring (1.1-r1)
(4/7) Installing libidn2 (2.3.4-r1)
(5/7) Installing nghttp2-libs (1.55.1-r0)
(6/7) Installing libcurl (8.2.1-r0)
(7/7) Installing curl (8.2.1-r0)
Executing busybox-1.36.1-r2.trigger
Executing ca-certificates-20230506-r0.trigger
OK: 12 MiB in 22 packages</code></pre></div></div></div></section><section id="utiliser_un_container_interactif_6" data-auto-animate><h2>🏓 Utiliser un container interactif</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">/ $ curl google.fr
&lt;HTML&gt;&lt;HEAD&gt;&lt;meta http-equiv="content-type" content="text/html;charset=utf-8"&gt;
&lt;TITLE&gt;301 Moved&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;
&lt;H1&gt;301 Moved&lt;/H1&gt;
The document has moved
&lt;A HREF="http://www.google.fr/"&gt;here&lt;/A&gt;.
&lt;/BODY&gt;&lt;/HTML&gt;</code></pre></div></div>
<div class="paragraph"><p>C&#8217;est bon, on a <code>cURL</code> 🦱</p></div></div></section><section id="utiliser_un_container_interactif_7" data-auto-animate><h2>🏓 Utiliser un container interactif</h2><div class="slide-content"><div class="paragraph"><p>On peut quitter <code>sh</code> et revenir à la machine hôte !</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">/ $ exit</code></pre></div></div></div></section><section id="utiliser_un_container_interactif_8" data-auto-animate><h2>🏓 Utiliser un container interactif</h2><div class="slide-content"><div class="paragraph"><p>On peut quitter <code>sh</code> et revenir à la machine hôte !</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">/ $ exit</code></pre></div></div>
<div class="paragraph"><p>Si on veut réutiliser <code>cURL</code> sur Alpine, c&#8217;est simple, on relance le shell, non? 🤔</p></div></div></section><section id="utiliser_un_container_interactif_9" data-auto-animate><h2>🏓 Utiliser un container interactif</h2><div class="slide-content"><div class="paragraph"><p>On peut quitter <code>sh</code> et revenir à la machine hôte !</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">/ $ exit</code></pre></div></div>
<div class="paragraph"><p>Si on veut réutiliser <code>cURL</code> sur Alpine, c&#8217;est simple, on relance le shell, non? 🤔</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run  --interactive --tty alpine</code></pre></div></div></div></section><section id="utiliser_un_container_interactif_10" data-auto-animate><h2>🏓 Utiliser un container interactif</h2><div class="slide-content"><div class="paragraph"><p>On peut quitter <code>sh</code> et revenir à la machine hôte !</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">/ $ exit</code></pre></div></div>
<div class="paragraph"><p>Si on veut réutiliser <code>cURL</code> sur Alpine, c&#8217;est simple, on relance le shell, non? 🤔</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run  --interactive --tty alpine</code></pre></div></div>
<div class="paragraph"><p>On relance <code>cURL</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">/ $ curl google.fr</code></pre></div></div></div></section><section id="utiliser_un_container_interactif_11" data-auto-animate><h2>🏓 Utiliser un container interactif</h2><div class="slide-content"><div class="paragraph"><p>On peut quitter <code>sh</code> et revenir à la machine hôte !</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">/ $ exit</code></pre></div></div>
<div class="paragraph"><p>Si on veut réutiliser <code>cURL</code> sur Alpine, c&#8217;est simple, on relance le shell, non? 🤔</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run  --interactive --tty alpine</code></pre></div></div>
<div class="paragraph"><p>On relance <code>cURL</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">/ $ curl google.fr
/bin/sh: curl: not found</code></pre></div></div>
<div class="videoblock"><video src="media/surprise_blanker.mp4" width="600" height="100%" data-autoplay>Your browser does not support the video tag.</video></div></div></section><section id="utiliser_un_container_interactif_12" data-auto-animate><h2>🏓 Utiliser un container interactif</h2><div class="slide-content"><div class="paragraph"><p>En fait, c&#8217;est logique !</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run</code></pre></div></div>
<div class="ulist"><ul><li><p>Cette commande instancie un "nouveau container à chaque fois" !</p></li></ul></div></div></section><section id="utiliser_un_container_interactif_13" data-auto-animate><h2>🏓 Utiliser un container interactif</h2><div class="slide-content"><div class="paragraph"><p>En fait, c&#8217;est logique !</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run</code></pre></div></div>
<div class="ulist"><ul><li><p>Cette commande instancie un "nouveau container à chaque fois" !</p></li><li><p>Chaque container est différent.</p></li></ul></div></div></section><section id="utiliser_un_container_interactif_14" data-auto-animate><h2>🏓 Utiliser un container interactif</h2><div class="slide-content"><div class="paragraph"><p>En fait, c&#8217;est logique !</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run</code></pre></div></div>
<div class="ulist"><ul><li><p>Cette commande instancie un "nouveau container à chaque fois" !</p></li><li><p>Chaque container est différent.</p></li><li><p>Aucun partage entre les containers à part le contenu de base de l&#8217;image.</p></li></ul></div></div></section><section id="utiliser_un_container_interactif_15" data-auto-animate><h2>🏓 Utiliser un container interactif</h2><div class="slide-content"><div class="imageblock"><img src="media/1460541815-image8.png" alt="1460541815 image8"></div>
<div class="paragraph"><p><em>" On m&#8217;a vendu un truc qui permet de lancer des tonnes de </em><em>microservices</em><em>… mais là, on télécharge </em><em>nimps</em><em> et s&#8217;amuse à le perdre…"</em></p></div></div></section><section id="conteneur_en_tâche_de_fond" data-auto-animate><h2>⛅ Conteneur en tâche de fond</h2><div class="slide-content"><div class="paragraph"><p>Lançons un container bien particulier…</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run  --interactive --tty jpetazzo/clock</code></pre></div></div></div></section><section id="conteneur_en_tâche_de_fond_2" data-auto-animate><h2>⛅ Conteneur en tâche de fond</h2><div class="slide-content"><div class="paragraph"><p>Lançons un container bien particulier…</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run  --interactive --tty jpetazzo/clock
Mon Sep 25 10:33:51 UTC 2023
Mon Sep 25 10:33:52 UTC 2023
Mon Sep 25 10:33:53 UTC 2023
Mon Sep 25 10:33:54 UTC 2023
Mon Sep 25 10:33:55 UTC 2023
Mon Sep 25 10:33:56 UTC 2023
...</code></pre></div></div></div></section><section id="conteneur_en_tâche_de_fond_3" data-auto-animate><h2>⛅ Conteneur en tâche de fond</h2><div class="slide-content"><div class="paragraph"><p>Lançons un container bien particulier…</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run  --interactive --tty jpetazzo/clock
Mon Sep 25 10:33:51 UTC 2023
Mon Sep 25 10:33:52 UTC 2023
Mon Sep 25 10:33:53 UTC 2023
Mon Sep 25 10:33:54 UTC 2023
Mon Sep 25 10:33:55 UTC 2023
Mon Sep 25 10:33:56 UTC 2023
...</code></pre></div></div>
<div class="paragraph"><p>Ce container va tourner indéfiniment sauf si on le stoppe avec ⌨️ <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>C</kbd></span>…</p></div></div></section><section id="conteneur_en_tâche_de_fond_4" data-auto-animate><h2>⛅ Conteneur en tâche de fond</h2><div class="slide-content"><div class="paragraph"><p>Lançons un container bien particulier…</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run  --interactive --tty jpetazzo/clock
Mon Sep 25 10:33:51 UTC 2023
Mon Sep 25 10:33:52 UTC 2023
Mon Sep 25 10:33:53 UTC 2023
Mon Sep 25 10:33:54 UTC 2023
Mon Sep 25 10:33:55 UTC 2023
Mon Sep 25 10:33:56 UTC 2023
...</code></pre></div></div>
<div class="paragraph"><p>Ce container va tourner indéfiniment sauf si on le stoppe avec ⌨️ <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>C</kbd></span>…</p></div>
<div class="paragraph"><p>… mais ca va stopper le container !</p></div>
<div class="imageblock"><img src="media/lapalissade.jpg" alt="lapalissade"></div></div></section><section id="conteneur_en_tâche_de_fond_5" data-auto-animate><h2>⛅ Conteneur en tâche de fond</h2><div class="slide-content"><div class="paragraph"><p>Lançons un container bien particulier…</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run  --interactive --tty jpetazzo/clock
Mon Sep 25 10:33:51 UTC 2023
Mon Sep 25 10:33:52 UTC 2023
Mon Sep 25 10:33:53 UTC 2023
Mon Sep 25 10:33:54 UTC 2023
Mon Sep 25 10:33:55 UTC 2023
Mon Sep 25 10:33:56 UTC 2023
...</code></pre></div></div>
<div class="paragraph"><p>Ce container va tourner indéfiniment sauf si on le stoppe avec ⌨️ <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>C</kbd></span>…</p></div>
<div class="paragraph"><p>… mais ca va stopper le container !</p></div>
<div class="paragraph"><p>Oui car quand on stoppe le processus principal d&#8217;un container, ce dernier n&#8217;a plus de raison d&#8217;exister et s&#8217;arrête naturellement.</p></div></div></section><section id="conteneur_en_tâche_de_fond_6" data-auto-animate><h2>⛅ Conteneur en tâche de fond</h2><div class="slide-content"><div class="paragraph"><p>La solution : le flag  <code>--detach</code></p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run --detach jpetazzo/clock</code></pre></div></div></div></section><section id="conteneur_en_tâche_de_fond_7" data-auto-animate><h2>⛅ Conteneur en tâche de fond</h2><div class="slide-content"><div class="paragraph"><p>La solution : le flag  <code>--detach</code></p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run --detach jpetazzo/clock
399f3b23bc0585991afa80dfee854cf0a953d782b99153b4e2cbc74ab6b07770</code></pre></div></div>
<div class="paragraph"><p>Le retour de cette commande correspond à l&#8217;identifiant unique du container.</p></div>
<div class="paragraph"><p>Cette fois-ci, le container tourne, mais  en arrière plan !</p></div></div></section><section id="conteneur_en_tâche_de_fond_8" data-auto-animate><h2>⛅ Conteneur en tâche de fond</h2><div class="slide-content"><div class="imageblock"><img src="media/1460541815-image8.png" alt="1460541815 image8"></div>
<div class="paragraph"><p><em>" </em><em>Okay</em><em>, maintenant il n&#8217;écrit la date nulle part… mais toutes les secondes… à l&#8217;aide ! "</em></p></div></div></section><section id="conteneur_en_tâche_de_fond_9" data-auto-animate><h2>⛅ Conteneur en tâche de fond</h2><div class="slide-content"><div class="paragraph"><p>Le processus principal de ce container écrit dans la sortie standard… du container !</p></div>
<div class="paragraph"><p>Comment retrouver le contenu de la sortie standard du container ?</p></div></div></section><section id="conteneur_en_tâche_de_fond_10" data-auto-animate><h2>⛅ Conteneur en tâche de fond</h2><div class="slide-content"><div class="paragraph"><p>Le processus principal de ce container écrit dans la sortie standard… du container !</p></div>
<div class="paragraph"><p>Comment retrouver le contenu de la sortie standard du container ?</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker logs 399f3</code></pre></div></div></div></section><section id="conteneur_en_tâche_de_fond_11" data-auto-animate><h2>⛅ Conteneur en tâche de fond</h2><div class="slide-content"><div class="paragraph"><p>Le processus principal de ce container écrit dans la sortie standard… du container !</p></div>
<div class="paragraph"><p>Comment retrouver le contenu de la sortie standard du container ?</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker logs 399f3
Tue Sep 12 12:37:01 UTC 2023
Tue Sep 12 12:37:02 UTC 2023
Tue Sep 12 12:37:03 UTC 2023
Tue Sep 12 12:37:04 UTC 2023
Tue Sep 12 12:37:05 UTC 2023
Tue Sep 12 12:37:06 UTC 2023
Tue Sep 12 12:37:07 UTC 2023
Tue Sep 12 12:37:08 UTC 2023
Tue Sep 12 12:37:09 UTC 2023
Tue Sep 12 12:37:10 UTC 2023
Tue Sep 12 12:37:11 UTC 2023</code></pre></div></div></div></section><section id="conteneur_en_tâche_de_fond_12" data-auto-animate><h2>⛅ Conteneur en tâche de fond</h2><div class="slide-content"><div class="paragraph"><p>Le processus principal de ce container écrit dans la sortie standard… du container !</p></div>
<div class="paragraph"><p>Comment retrouver le contenu de la sortie standard du container ?</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker logs 399f3
Tue Sep 12 12:37:01 UTC 2023
Tue Sep 12 12:37:02 UTC 2023
Tue Sep 12 12:37:03 UTC 2023
Tue Sep 12 12:37:04 UTC 2023
Tue Sep 12 12:37:05 UTC 2023
Tue Sep 12 12:37:06 UTC 2023
Tue Sep 12 12:37:07 UTC 2023
Tue Sep 12 12:37:08 UTC 2023
Tue Sep 12 12:37:09 UTC 2023
Tue Sep 12 12:37:10 UTC 2023
Tue Sep 12 12:37:11 UTC 2023</code></pre></div></div>
<div class="paragraph"><p>Ouf ! On n&#8217;est pas obligé de saisir l&#8217;identifiant complet ! Il suffit de fournir le nombre suffisant de caractères pour que ce soit discriminant.</p></div></div></section><section id="lister_les_containers" data-auto-animate><h2>📖 Lister les containers</h2><div class="slide-content"><div class="paragraph"><p>Comment savoir si j&#8217;ai des containers en cours d&#8217;exécution ?</p></div>
<div class="paragraph"><p>💡 Commande vue un peu plus tôt&#8230;&#8203;</p></div></div></section><section id="lister_les_containers_2" data-auto-animate><h2>📖 Lister les containers</h2><div class="slide-content"><div class="paragraph"><p>Comment savoir si j&#8217;ai des containers en cours d&#8217;exécution ?</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container ls</code></pre></div></div></div></section><section id="lister_les_containers_3" data-auto-animate><h2>📖 Lister les containers</h2><div class="slide-content"><div class="paragraph"><p>Comment savoir si j&#8217;ai des containers en cours d&#8217;exécution ?</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container ls
CONTAINER ID   IMAGE                           COMMAND                  CREATED        STATUS       PORTS                    NAMES
02cbf2fb3721   cours-devops-docker-serve       "/sbin/tini -g gulp …"   3 hours ago    Up 3 hours   0.0.0.0:8000-&gt;8000/tcp   cours-devops-docker-serve-1
ebfbe695b2ec   moby/buildkit:buildx-stable-1   "buildkitd"              2 months ago   Up 3 hours                            buildx_buildkit_exciting_williams0</code></pre></div></div></div></section><section id="lister_les_containers_4" data-auto-animate><h2>📖 Lister les containers</h2><div class="slide-content"><div class="paragraph"><p>Comment savoir si j&#8217;ai des containers en cours d&#8217;exécution ?</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container ls
CONTAINER ID   IMAGE                           COMMAND                  CREATED        STATUS       PORTS                    NAMES
02cbf2fb3721   cours-devops-docker-serve       "/sbin/tini -g gulp …"   3 hours ago    Up 3 hours   0.0.0.0:8000-&gt;8000/tcp   cours-devops-docker-serve-1
ebfbe695b2ec   moby/buildkit:buildx-stable-1   "buildkitd"              2 months ago   Up 3 hours                            buildx_buildkit_exciting_williams0</code></pre></div></div>
<div class="paragraph"><p>On obtient un tableau de tous les containers en cours d&#8217;exécution.</p></div></div></section><section id="stop_start" data-auto-animate><h2>🛑 🏁 Stop / Start</h2><div class="slide-content"><div class="paragraph"><p>Il est possible de stopper un container.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container stop 399f3</code></pre></div></div></div></section><section id="stop_start_2" data-auto-animate><h2>🛑 🏁 Stop / Start</h2><div class="slide-content"><div class="paragraph"><p>Il est possible de stopper un container.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container stop 399f3</code></pre></div></div>
<div class="paragraph"><p>Pour redémarrer un container :</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container start 399f3</code></pre></div></div></div></section><section id="lister_tous_les_containers" data-auto-animate><h2>📖 Lister tous les containers</h2><div class="slide-content"><div class="paragraph"><p>Même les 💀.</p></div></div></section><section id="lister_tous_les_containers_2" data-auto-animate><h2>📖 Lister tous les containers</h2><div class="slide-content"><div class="paragraph"><p>Comment savoir si j&#8217;ai des containers stoppés ?</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container ls --all</code></pre></div></div></div></section><section id="lister_tous_les_containers_3" data-auto-animate><h2>📖 Lister tous les containers</h2><div class="slide-content"><div class="paragraph"><p>Comment savoir si j&#8217;ai des containers stoppés ?</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container ls --all
CONTAINER ID   IMAGE                           COMMAND                  CREATED          STATUS                        PORTS                    NAMES
90725f661d4e   hello-world                     "/hello"                 13 seconds ago   Exited (0) 12 seconds ago                              hardcore_wescoff
9d0a6586b9e1   busybox                         "echo hello world"       22 seconds ago   Exited (0) 21 seconds ago                              gracious_moser
368ed08a35e3   jpetazzo/clock                  "/bin/sh -c 'while d…"   6 minutes ago    Up 5 minutes                                           sweet_clarke
c036e57bbf05   jpetazzo/clock                  "/bin/sh -c 'while d…"   17 minutes ago   Exited (130) 17 minutes ago                            cool_euclid
02cbf2fb3721   cours-devops-docker-serve       "/sbin/tini -g gulp …"   3 hours ago      Up 3 hours                    0.0.0.0:8000-&gt;8000/tcp   cours-devops-docker-serve-1
ebfbe695b2ec   moby/buildkit:buildx-stable-1   "buildkitd"              2 months ago     Up 4 hours                                             buildx_buildkit_exciting_williams0</code></pre></div></div></div></section><section id="lister_tous_les_containers_4" data-auto-animate><h2>📖 Lister tous les containers</h2><div class="slide-content"><div class="paragraph"><p>Comment savoir si j&#8217;ai des containers stoppés ?</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell"> docker container ls --all
CONTAINER ID   IMAGE                           COMMAND                  CREATED          STATUS                        PORTS                    NAMES
90725f661d4e   hello-world                     "/hello"                 13 seconds ago   Exited (0) 12 seconds ago                              hardcore_wescoff
9d0a6586b9e1   busybox                         "echo hello world"       22 seconds ago   Exited (0) 21 seconds ago                              gracious_moser
368ed08a35e3   jpetazzo/clock                  "/bin/sh -c 'while d…"   6 minutes ago    Up 5 minutes                                           sweet_clarke
c036e57bbf05   jpetazzo/clock                  "/bin/sh -c 'while d…"   17 minutes ago   Exited (130) 17 minutes ago                            cool_euclid
02cbf2fb3721   cours-devops-docker-serve       "/sbin/tini -g gulp …"   3 hours ago      Up 3 hours                    0.0.0.0:8000-&gt;8000/tcp   cours-devops-docker-serve-1
ebfbe695b2ec   moby/buildkit:buildx-stable-1   "buildkitd"              2 months ago     Up 4 hours                                             buildx_buildkit_exciting_williams0</code></pre></div></div>
<div class="paragraph"><p>Avec le flag  <code>--all</code> , on obtient un tableau de tous les containers quel que soit leur état.</p></div></div></section><section id="nettoyage" data-auto-animate><h2>🧽 Nettoyage</h2><div class="slide-content"><div class="paragraph"><p>Tout container stoppé peut être supprimé.</p></div></div></section><section id="nettoyage_2" data-auto-animate><h2>🧽 Nettoyage</h2><div class="slide-content"><div class="paragraph"><p>Tout container stoppé peut être supprimé.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container rm 90725f661d4e</code></pre></div></div></div></section><section id="nettoyage_3" data-auto-animate><h2>🧽 Nettoyage</h2><div class="slide-content"><div class="paragraph"><p>Tout container stoppé peut être supprimé.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container rm 90725f661d4e
90725f661d4e</code></pre></div></div></div></section><section id="nettoyage_4" data-auto-animate><h2>🧽 Nettoyage</h2><div class="slide-content"><div class="paragraph"><p>Tout container stoppé peut être supprimé.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container rm 90725f661d4e
90725f661d4e</code></pre></div></div>
<div class="paragraph"><p>Container "auto-nettoyant" 🗑️</p></div></div></section><section id="nettoyage_5" data-auto-animate><h2>🧽 Nettoyage</h2><div class="slide-content"><div class="paragraph"><p>Tout container stoppé peut être supprimé.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container rm 90725f661d4e
90725f661d4e</code></pre></div></div>
<div class="paragraph"><p>Container "auto-nettoyant" 🗑️</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container run  --interactive --tty --rm jpetazzo/clock</code></pre></div></div>
<div class="paragraph small"><small>Aussitôt stoppé, aussitôt supprimé !</small></div></div></section><section id="rappel_cycle_de_vie_dun_container" data-auto-animate><h2>⏰ Rappel: cycle de vie d&#8217;un container</h2><div class="slide-content"><div class="imageblock"><img src="media/output68_with_transparency.png" alt="output68 with transparency"></div></div></section><section id="rappel_cycle_de_vie_dun_container_2" data-auto-animate><h2>⏰ Rappel: cycle de vie d&#8217;un container</h2><div class="slide-content"><div class="imageblock"><img src="media/output69_with_transparency.png" alt="output69 with transparency"></div></div></section><section id="rappel_cycle_de_vie_dun_container_3" data-auto-animate><h2>⏰ Rappel: cycle de vie d&#8217;un container</h2><div class="slide-content"><div class="imageblock"><img src="media/output70_with_transparency.png" alt="output70 with transparency"></div></div></section><section id="rappel_cycle_de_vie_dun_container_4" data-auto-animate><h2>⏰ Rappel: cycle de vie d&#8217;un container</h2><div class="slide-content"><div class="imageblock"><img src="media/output71_with_transparency.png" alt="output71 with transparency"></div></div></section><section id="rappel_cycle_de_vie_dun_container_5" data-auto-animate><h2>⏰ Rappel: cycle de vie d&#8217;un container</h2><div class="slide-content"><div class="imageblock"><img src="media/output72_with_transparency.png" alt="output72 with transparency"></div>
<aside class="notes"><div class="paragraph"><p><code>docker container create</code> is used to create a new container but without starting it immediately.
When you run docker create, Docker creates a container based on the specified image and prepares it to run, but it remains in a stopped state.
You can then start the container using the <code>docker container start</code> command.</p></div>
<div class="paragraph"><p>Here&#8217;s the basic syntax of the docker create command:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container create [OPTIONS] IMAGE [COMMAND] [ARG...]</code></pre></div></div>
<div class="ulist"><ul><li><p><code>OPTIONS</code> are various flags and settings you can apply to the container creation.</p></li><li><p><code>IMAGE</code> is the name or ID of the Docker image to use for creating the container.</p></li><li><p><code>COMMAND</code> (optional) specifies the command to run when the container starts.</p></li><li><p><code>ARG</code> (optional) provides arguments to pass to the command.</p></li></ul></div>
<div class="paragraph"><p>For example, to create a new container from an image called <code>myapp-image</code> without starting it immediately, you would use:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container create --name myapp-container myapp-image</code></pre></div></div>
<div class="paragraph"><p>After creating the container, you can start it with:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container start myapp-container</code></pre></div></div>
<div class="paragraph"><p>This separation of creation and starting allows you to configure the container further or set up networking and volumes before actually running the container.</p></div></aside></div></section><section id="reprendre_le_contrôle" data-auto-animate><h2>🔄 Reprendre le contrôle</h2><div class="slide-content"><div class="paragraph"><p>Sur un container en arrière-plan</p></div></div></section><section id="reprendre_le_contrôle_2" data-auto-animate><h2>🔄 Reprendre le contrôle</h2><div class="slide-content"><div class="paragraph"><p>Sur un container en arrière-plan</p></div>
<div class="paragraph"><p>Il est possible d&#8217;interagir avec un container en arrière-plan en cours d&#8217;exécution.</p></div></div></section><section id="reprendre_le_contrôle_3" data-auto-animate><h2>🔄 Reprendre le contrôle</h2><div class="slide-content"><div class="paragraph"><p>Sur un container en arrière-plan</p></div>
<div class="paragraph"><p>Il est possible d&#8217;interagir avec un container en arrière-plan en cours d&#8217;exécution.</p></div>
<div class="paragraph"><p>La commande suivante permet de lancer une commande à l&#8217;intérieur d&#8217;un container.</p></div></div></section><section id="reprendre_le_contrôle_4" data-auto-animate><h2>🔄 Reprendre le contrôle</h2><div class="slide-content"><div class="paragraph"><p>Sur un container en arrière-plan</p></div>
<div class="paragraph"><p>Il est possible d&#8217;interagir avec un container en arrière-plan en cours d&#8217;exécution.</p></div>
<div class="paragraph"><p>La commande suivante permet de lancer une commande à l&#8217;intérieur d&#8217;un container.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container exec &lt;containerID&gt; echo "hello"</code></pre></div></div></div></section><section id="reprendre_le_contrôle_5" data-auto-animate><h2>🔄 Reprendre le contrôle</h2><div class="slide-content"><div class="paragraph"><p>Sur un container en arrière-plan</p></div>
<div class="paragraph"><p>Il est possible d&#8217;interagir avec un container en arrière-plan en cours d&#8217;exécution.</p></div>
<div class="paragraph"><p>La commande suivante permet de lancer une commande à l&#8217;intérieur d&#8217;un container.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container ls</code></pre></div></div></div></section><section id="reprendre_le_contrôle_6" data-auto-animate><h2>🔄 Reprendre le contrôle</h2><div class="slide-content"><div class="paragraph"><p>Sur un container en arrière-plan</p></div>
<div class="paragraph"><p>Il est possible d&#8217;interagir avec un container en arrière-plan en cours d&#8217;exécution.</p></div>
<div class="paragraph"><p>La commande suivante permet de lancer une commande à l&#8217;intérieur d&#8217;un container.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container ls
CONTAINER ID   IMAGE                           COMMAND                  CREATED        STATUS       PORTS                    NAMES
368ed08a35e3   jpetazzo/clock                  "/bin/sh -c 'while d…"   4 hours ago    Up 4 hours                            sweet_clarke
02cbf2fb3721   cours-devops-docker-serve       "/sbin/tini -g gulp …"   7 hours ago    Up 7 hours   0.0.0.0:8000-&gt;8000/tcp   cours-devops-docker-serve-1
ebfbe695b2ec   moby/buildkit:buildx-stable-1   "buildkitd"              2 months ago   Up 7 hours                            buildx_buildkit_exciting_williams0</code></pre></div></div></div></section><section id="reprendre_le_contrôle_7" data-auto-animate><h2>🔄 Reprendre le contrôle</h2><div class="slide-content"><div class="paragraph"><p>Sur un container en arrière-plan</p></div>
<div class="paragraph"><p>Il est possible d&#8217;interagir avec un container en arrière-plan en cours d&#8217;exécution.</p></div>
<div class="paragraph"><p>La commande suivante permet de lancer une commande à l&#8217;intérieur d&#8217;un container.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container ls
CONTAINER ID   IMAGE                           COMMAND                  CREATED        STATUS       PORTS                    NAMES
368ed08a35e3   jpetazzo/clock                  "/bin/sh -c 'while d…"   4 hours ago    Up 4 hours                            sweet_clarke
02cbf2fb3721   cours-devops-docker-serve       "/sbin/tini -g gulp …"   7 hours ago    Up 7 hours   0.0.0.0:8000-&gt;8000/tcp   cours-devops-docker-serve-1
ebfbe695b2ec   moby/buildkit:buildx-stable-1   "buildkitd"              2 months ago   Up 7 hours                            buildx_buildkit_exciting_williams0

docker container exec 368ed08a35e3 echo hello
hello</code></pre></div></div></div></section><section id="reprendre_le_contrôle_8" data-auto-animate><h2>🔄 Reprendre le contrôle</h2><div class="slide-content"><div class="paragraph"><p>Sur un container en arrière-plan</p></div>
<div class="imageblock"><img src="media/1107521466-image9.png" alt="1107521466 image9"></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">docker container exec --interactive --tty &lt;containerID&gt; bash</code></pre></div></div>
<div class="paragraph"><p>Ca fonctionne aussi en interactif !</p></div></div></section><section id="exercice_conteneur_en_tâche_de_fond"><h2>🎓 Exercice : conteneur en tâche de fond</h2><div class="slide-content"><div class="paragraph"><p>Étapes</p></div>
<div class="ulist"><ul><li><p>Lancer un container "daemon" <code>jpetazzo/clock</code></p></li><li><p>Utiliser l&#8217;équivalent de <code>tail –f</code> pour lire la sortie standard du container 💡</p></li><li><p>Lancer un second container "daemon" 👹</p></li><li><p>Stocker l&#8217;identifiant de ce container dans une variable du shell, en une seule commande et en jouant avec <code>docker container ls</code></p></li><li><p>Stopper le container avec cet identifiant</p></li><li><p>Afficher les containers lancés 🏃📦</p></li><li><p>Afficher les containers arrêtés 🛑📦</p></li></ul></div></div></section><section id="solution_conteneur_en_tâche_de_fond"><h2>✅ Solution : conteneur en tâche de fond</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Lancer un container "daemon" `jpetazzo/clock`
docker container run --detach --name first-clock jpetazzo/clock

# Utiliser l'équivalent de `tail –f` pour lire la sortie standard du container 💡
docker container logs -f first-clock

# * Lancer un second container "daemon" 👹
docker container run --detach --name second-clock jpetazzo/clock

# Stocker l'identifiant de ce container dans une variable du shell, en une seule commande et en jouant avec `docker container ls`
# --filter "name=second-clock" filters the list of containers to include only those with the name "second-clock."
container_id=$(docker container ls -q --filter "name=second-clock")

# Stopper le container avec cet identifiant
docker container stop "$container_id"

# Afficher les containers lancés  🏃📦
docker container ls

# Afficher les containers arrêtés 🛑📦
docker container ls --filter "status=exited"</code></pre></div></div></div></section><section id="exercice_conteneur_en_tâche_de_fond_2"><h2>🎓 Exercice : conteneur en tâche de fond</h2><div class="slide-content"><div class="ulist"><ul><li><p>Relancer un des containers arrêtés.</p></li><li><p>Exécuter un `ps –ef `dans ce container</p></li><li><p>Quel est le PID du process principal ?</p></li><li><p>Vérifier que le container "tourne" toujours</p></li><li><p>Supprimer l&#8217;image (tip : <code>docker rmi</code>)</p></li><li><p>Supprimer les containers</p></li><li><p>Supprimer l&#8217;image (pour de vrai cette fois)</p></li></ul></div></div></section><section id="solution_conteneur_en_tâche_de_fond_2"><h2>✅ Solution : conteneur en tâche de fond</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Relancer un des containers arrêtés.
docker container start second-clock

# Exécuter un `ps –ef `dans ce container
docker container exec second-clock ps -ef
PID   USER     TIME  COMMAND
    1 root      0:00 /bin/sh -c while date; do sleep 1; done
   56 root      0:00 sleep 1
   57 root      0:00 ps -ef

# Quel est le PID du process principal ?
# 1

# Vérifier que le container "tourne" toujours
docker container ls
CONTAINER ID   IMAGE                           COMMAND                  CREATED         STATUS              PORTS                    NAMES
7d7085809ad2   cours-devops-docker-serve       "/sbin/tini -g gulp …"   6 minutes ago   Up 5 minutes        0.0.0.0:8000-&gt;8000/tcp   cours-devops-docker-serve-1
edea0c46c6d8   jpetazzo/clock                  "/bin/sh -c 'while d…"   9 minutes ago   Up About a minute                            second-clock
ebfbe695b2ec   moby/buildkit:buildx-stable-1   "buildkitd"              2 months ago    Up 11 hours                                  buildx_buildkit_exciting_williams0

# Supprimer l'image (tip : `docker rmi`)
docker rmi jpetazzo/clock
Error response from daemon: conflict: unable to remove repository reference "jpetazzo/clock" (must force) - container edea0c46c6d8 is using its referenced image 7a8965d6553e

# Supprimer les containers
docker stop second-clock
second-clock

docker rm second-clockl
second-clock
# Supprimer l'image (pour de vrai cette fois)
docker rmi jpetazzo/clock

Untagged: jpetazzo/clock:latest
Untagged: jpetazzo/clock@sha256:dc06bbc3744f7200404bff0bbb2516925e7adea115e07de9da8b36bf15fe3dd3
Deleted: sha256:7a8965d6553ea2289485744ef20521e0dd0d12ab51773f271882913b79813750
Deleted: sha256:67f770da229bf16d0c280f232629b0c1f1243a884df09f6b940a1c7288535a6d</code></pre></div></div>
<aside class="notes"><div class="paragraph"><p>Dans Docker, le PID (Process ID) principal est toujours 1, car c&#8217;est une convention spécifique à Docker.
Cette convention facilite la gestion des processus dans les conteneurs en isolant chaque processus du conteneur du système hôte.
En assignant toujours le PID 1 au processus principal du conteneur, Docker peut surveiller ce processus pour s&#8217;assurer qu&#8217;il est en cours d&#8217;exécution.
Cela permet également d&#8217;éviter des conflits potentiels avec les processus du système hôte, car les PID sont spécifiques à chaque espace de conteneur.
En résumé, cette convention est une pratique standard qui contribue à l&#8217;isolation et à la gestion efficace des processus dans les conteneurs Docker.</p></div></aside></div></section><section id="exercice_conteneur_en_tâche_de_fond_3"><h2>🎓 Exercice : conteneur en tâche de fond</h2><div class="slide-content"><div class="ulist"><ul><li><p>Exécutez un conteneur, basé sur l&#8217;image <code>nginx</code> en tâche de fond ("Background"), nommé <code>webserver-1</code></p><div class="ulist"><ul><li><p>💡 On parle de processus "détaché" (ou bien "démonisé") 👹</p></li><li><p>⚠️ Pensez bien à <code>docker container ls</code></p></li></ul></div></li><li><p>Regardez le contenu du fichier <code>/etc/os-release</code> dans ce conteneur</p><div class="ulist"><ul><li><p>💡 <code>docker container exec</code></p></li></ul></div></li><li><p>Essayez d&#8217;arrêter, démarrer puis redémarrer le conteneur</p><div class="ulist"><ul><li><p>⚠️ Pensez bien à <code>docker container ls</code> à chaque fois</p></li><li><p>💡 <code>stop</code>, <code>start</code>, <code>restart</code></p></li></ul></div></li></ul></div></div></section><section id="solution_conteneur_en_tâche_de_fond_3"><h2>✅ Solution : conteneur en tâche de fond</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run --detach --name=webserver-1 nginx
# &lt;ID du conteneur&gt;

docker container ls
docker container ls --all

docker container exec webserver-1 cat /etc/os-release
# ... Debian ...

docker container stop webserver-1
docker container ls
docker container ls --all

docker container start webserver-1
docker container ls
docker container ls --all

docker container start webserver-1
docker container ls</code></pre></div></div></div></section><section id="checkpoint_3" class="columns"><h2>Checkpoint 🎯</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="paragraph"><p>Vous savez désormais:</p></div>
<div class="ulist"><ul><li><p>Maîtriser le cycle de vie des containers</p></li><li><p>Interagir avec les containers existants</p></li></ul></div>
<div class="imageblock"><img src="media/1706694417-image2.png" alt="1706694417 image2"></div></div></div>
<div class="openblock column"><div class="content"><div class="imageblock"><img src="media/1497094497-image10.gif" alt="1497094497 image10"></div></div></div></div></section><section id="checkpoint_4"><h2>Checkpoint 🎯</h2><div class="slide-content"><div class="ulist"><ul><li><p>Docker essaye de résoudre le problème de l&#8217;empaquetage le plus "portable" possible</p><div class="ulist"><ul><li><p>On n&#8217;en a pas encore vu les effets, ça arrive !</p></li></ul></div></li><li><p>Vous avez vu qu&#8217;un containeur permet d&#8217;exécuter une commande dans un environnement "préparé"</p><div class="ulist"><ul><li><p>Catalogue d&#8217;images Docker par défaut : Le <a href="https://hub.docker.com">Docker Hub</a></p></li></ul></div></li><li><p>Vous avez vu qu&#8217;on peut exécuter des conteneurs selon 3 modes :</p><div class="ulist"><ul><li><p>"One shot"</p></li><li><p>Interactif</p></li><li><p>En tâche de fond</p></li></ul></div></li></ul></div>
<div class="paragraph"><p>&#8658; 🤔 Mais comment ces images sont-elles fabriquées ? Quelle confiance leur accorder ?</p></div></div></section></section>
<section><section id="docker_images" data-background-color="rgb(248, 228, 130)" data-state="invert"><h2>Docker Images</h2><div class="slide-content"><div class="imageblock"><img src="media/multi-layered-cake.jpeg" alt="multi layered cake" width="900"></div></div></section><section id="pourquoi_des_images"><h2>🤔 Pourquoi des images ?</h2><div class="slide-content"><div class="ulist"><ul><li><p>Un <strong>conteneur</strong> est toujours exécuté depuis une <strong>image</strong>.</p></li><li><p>Une <strong>image de conteneur</strong> (ou "Image Docker") est un  modèle ("template") d&#8217;application auto-suffisant.</p></li></ul></div>
<div class="paragraph"><p>&#8658; Permet de fournir un livrable portable (ou presque).</p></div></div></section><section id="cest_quoi_une_image" data-background-image="media/multi-layered-cake-removebg-preview.png" data-background-size="contain" data-background-position="left" data-auto-animate><h2>🤔 C&#8217;est quoi une image ?</h2><div class="slide-content">
<div class="paragraph"><p>C&#8217;est une collection de fichiers et de metadonnées.</p></div></div></section><section id="cest_quoi_une_image_2" data-background-image="media/multi-layered-cake-removebg-preview.png" data-background-size="contain" data-background-position="left"><h2>🤔 C&#8217;est quoi une image ?</h2><div class="slide-content">
<div class="paragraph"><p>C&#8217;est une collection de fichiers et de metadonnées.</p></div>
<div class="paragraph"><p>C&#8217;est une suite de couches superposées.</p></div></div></section><section id="cest_quoi_une_image_3"><h2>🤔 C&#8217;est quoi une image ?</h2><div class="slide-content"><div class="paragraph"><p>C&#8217;est une collection de fichiers et de metadonnées.</p></div>
<div class="paragraph"><p>C&#8217;est une suite de couches superposées.</p></div>
<div class="imageblock"><img src="media/images-output5_with_transparency.png" alt="images output5 with transparency"></div></div></section><section id="cest_quoi_une_image_4" data-auto-animate><h2>🤔 C&#8217;est quoi une image ?</h2><div class="slide-content"><div class="paragraph"><p>C&#8217;est une collection de fichiers et de metadonnées.</p></div>
<div class="paragraph"><p>C&#8217;est une suite de couches superposées.</p></div>
<div class="imageblock"><img src="media/images-output6_with_transparency.png" alt="images output6 with transparency"></div></div></section><section id="détail_des_couches" data-auto-animate><h2>🍰 Détail des couches</h2><div class="slide-content"><div class="paragraph"><p>Exemple d&#8217;une image Apache HTTPd "custom"</p></div>
<div class="imageblock"><img src="media/images-output8_with_transparency.png" alt="images output8 with transparency"></div></div></section><section id="détail_des_couches_2" data-auto-animate><h2>🍰 Détail des couches</h2><div class="slide-content"><div class="paragraph"><p>Exemple d&#8217;une image Apache HTTPd "custom"</p></div>
<div class="imageblock"><img src="media/images-output9_with_transparency.png" alt="images output9 with transparency"></div></div></section><section id="détail_des_couches_3" data-auto-animate><h2>🍰 Détail des couches</h2><div class="slide-content"><div class="paragraph"><p>Exemple d&#8217;une image Apache HTTPd "custom"</p></div>
<div class="imageblock"><img src="media/images-output10_with_transparency.png" alt="images output10 with transparency"></div></div></section><section id="détail_des_couches_4" data-auto-animate><h2>🍰 Détail des couches</h2><div class="slide-content"><div class="paragraph"><p>Exemple d&#8217;une image Apache HTTPd "custom"</p></div>
<div class="imageblock"><img src="media/images-output11_with_transparency.png" alt="images output11 with transparency"></div></div></section><section id="détail_des_couches_5" data-auto-animate><h2>🍰 Détail des couches</h2><div class="slide-content"><div class="paragraph"><p>Exemple d&#8217;une image Apache HTTPd "custom"</p></div>
<div class="imageblock"><img src="media/images-output12_with_transparency.png" alt="images output12 with transparency"></div></div></section><section id="détail_des_couches_6" data-auto-animate><h2>🍰 Détail des couches</h2><div class="slide-content"><div class="paragraph"><p>Exemple d&#8217;une image Apache HTTPd "custom"</p></div>
<div class="imageblock"><img src="media/images-output13_with_transparency.png" alt="images output13 with transparency"></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {8..13}; do convert Diapositive${i}.PNG -crop 10221x4830+1556+2420 -transparent white -resize x1080 images-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="dicton_du_jour"><h2>Dicton du jour</h2><div class="slide-content"><div class="paragraph"><p><strong><em>"L&#8217;image est à la classe ce que le container est à l&#8217;objet"</em></strong></p></div>
<div class="imageblock"><img src="media/dicton-du-jour.png" alt="dicton du jour"></div></div></section><section><div class="slide-content"><div class="paragraph"><p>🤔 Application Auto-Suffisante ?</p></div>
<div class="imageblock"><img src="media/docker-app-self-sufficient.png" alt="docker app self sufficient" width="900"></div></div></section><section id="cest_quoi_le_principe"><h2>C&#8217;est quoi le principe ?</h2><div class="slide-content"><div class="imageblock"><img src="media/dockerfile-flow.png" alt="dockerfile flow"></div></div></section><section id="le_livre_de_recettes" data-auto-animate><h2>🐋 📖🍳 Le livre de recettes</h2><div class="slide-content"><div class="imageblock"><img src="media/moby-kitchen.jpeg" alt="moby kitchen"></div>
<div class="imageblock"><img src="media/dockerfile.png" alt="dockerfile"></div></div></section><section id="le_livre_de_recettes_2" data-auto-animate><h2>🐋 📖🍳 Le livre de recettes</h2><div class="slide-content"><div class="imageblock"><img src="media/dockerfile.png" alt="dockerfile"></div></div></section><section id="le_livre_de_recettes_3" data-auto-animate><h2>🐋 📖🍳 Le livre de recettes</h2><div class="slide-content"><div class="imageblock"><img src="media/dockerfile.png" alt="dockerfile"></div>
<div class="paragraph"><p>Un simple fichier nommé "Dockerfile" (majuscule sur le D et pas d&#8217;extension).</p></div></div></section><section id="le_livre_de_recettes_4" data-auto-animate><h2>🐋 📖🍳 Le livre de recettes</h2><div class="slide-content"><div class="imageblock"><img src="media/dockerfile.png" alt="dockerfile"></div>
<div class="paragraph"><p>Un simple fichier nommé "Dockerfile" (majuscule sur le D et pas d&#8217;extension).</p></div>
<div class="paragraph"><p>C&#8217;est du texte, très pratique à stocker dans Git.</p></div></div></section><section id="le_livre_de_recettes_5" data-auto-animate><h2>🐋 📖🍳 Le livre de recettes</h2><div class="slide-content"><div class="imageblock"><img src="media/dockerfile.png" alt="dockerfile"></div>
<div class="paragraph"><p>Un simple fichier nommé "Dockerfile" (majuscule sur le D et pas d&#8217;extension).</p></div>
<div class="paragraph"><p>C&#8217;est du texte, très pratique à stocker dans Git.</p></div>
<div class="paragraph"><p>Une suite de clef-valeur.</p></div></div></section><section id="pourquoi_fabriquer_sa_propre_image"><h2>🤔 Pourquoi fabriquer sa propre image ?</h2><div class="slide-content"><div class="paragraph"><p>❗️ Problème :</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">cat /etc/os-release
# ...
git --version
# ...

# Même version de Linux que dans GitPod
docker container run --rm ubuntu:22.04 git --version
# docker: Error response from daemon: failed to create shim task: OCI runtime create failed: runc create failed: unable to start container process: exec: "git": executable file not found in $PATH: unknown.

# En interactif ?
docker container run --rm --tty --interactive ubuntu:22.04 git --version</code></pre></div></div></div></section><section id="fabriquer_sa_première_image"><h2>🎓 Fabriquer sa première image</h2><div class="slide-content"><div class="ulist"><ul><li><p><strong>But :</strong> fabriquer une image Docker qui contient <code>git</code></p></li><li><p>Dans votre workspace Gitpod, créez un dossier nommé <code>docker-git/</code></p></li><li><p>Dans ce dossier, créer un fichier <code>Dockerfile</code> avec le contenu ci-dessous :</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-Dockerfile hljs" data-noescape="true" data-lang="Dockerfile">FROM alpine:3.21.3

RUN apk update &amp;&amp; apk add --no-cache git</code></pre></div></div></li><li><p>Fabriquez votre image avec la commande <code>docker image build --tag=docker-git chemin/vers/docker-git/</code></p></li><li><p>Testez l&#8217;image fraîchement fabriquée</p><div class="ulist"><ul><li><p>💡 <code>docker image ls</code></p></li></ul></div></li></ul></div></div></section><section id="fabriquer_sa_première_image_2"><h2>✅ Fabriquer sa première image</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">cat &lt;&lt;EOF &gt;Dockerfile
FROM alpine:3.21.3

RUN apk update &amp;&amp; apk add --no-cache git
EOF

docker image build --tag=docker-git ./

docker image ls | grep docker-git

# Doit fonctionner
docker container run --rm docker-git:latest git --version</code></pre></div></div></div></section><section id="fabriquer_son_image" data-auto-animate><h2>🐋 📖🍳 Fabriquer son image</h2><div class="slide-content"><div class="paragraph"><p>Un peu de cuisine&#8230;&#8203;</p></div>
<div class="imageblock"><img src="media/445636559-image7.gif" alt="445636559 image7"></div></div></section><section id="fabriquer_son_image_2" data-auto-animate><h2>🐋 📖🍳 Fabriquer son image</h2><div class="slide-content"><div class="paragraph"><p><strong>💪🏁 DÉFI</strong></p></div>
<div class="paragraph"><p>Créer une image alpine avec un JRE installé.</p></div>
<div class="paragraph fragment"><p><strong>📖🍳 RECETTE</strong></p></div>
<div class="ulist"><ul><li class="fragment"><p>On part d&#8217;une image Alpine</p></li><li class="fragment"><p>On installe un JRE</p></li></ul></div></div></section><section data-background-image="media/images-output52_with_transparency.png" data-background-size="contain" data-auto-animate></section><section data-background-image="media/images-output53_with_transparency.png" data-background-size="contain" data-auto-animate></section><section data-background-image="media/images-output54_with_transparency.png" data-background-size="contain" data-auto-animate></section><section data-background-image="media/images-output56_with_transparency.png" data-background-size="contain" data-auto-animate><div class="slide-content">
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {52..56}; do convert Diapositive${i}.PNG -crop 9580x5224+1879+1795 -transparent white -resize x1080 images-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="fabriquer_son_image_3" class="columns" data-auto-animate><h2>🐋 📖🍳 Fabriquer son image</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="imageblock"><img src="media/images-output56_with_transparency.png" alt="images output56 with transparency"></div></div></div>
<div class="openblock column"><div class="content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM alpine:3.21.3
LABEL maintainer="Tony Stark"

RUN apk update

RUN apk add --no-cache openjdk17-jre-headless</code></pre></div></div></div></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {52..56}; do convert Diapositive${i}.PNG -crop 9580x5224+1879+1795 -transparent white -resize x1080 images-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="cuistot_au_boulot" data-auto-animate><h2>🐋 📖🍳 Cuistot, au boulot!</h2><div class="slide-content"><div class="imageblock"><img src="media/images-output57_with_transparency.png" alt="images output57 with transparency"></div></div></section><section id="cuistot_au_boulot_2" data-auto-animate><h2>🐋 📖🍳 Cuistot, au boulot!</h2><div class="slide-content"><div class="imageblock"><img src="media/images-output58_with_transparency.png" alt="images output58 with transparency"></div></div></section><section id="cuistot_au_boulot_3" data-auto-animate><h2>🐋 📖🍳 Cuistot, au boulot!</h2><div class="slide-content"><div class="imageblock"><img src="media/images-output59_with_transparency.png" alt="images output59 with transparency"></div></div></section><section id="cuistot_au_boulot_4" class="columns" data-auto-animate><h2>🐋 📖🍳 Cuistot, au boulot!</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="imageblock"><img src="media/images-output59_with_transparency.png" alt="images output59 with transparency"></div></div></div>
<div class="openblock column"><div class="content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker image build -t myjava:1.42 .</code></pre></div></div></div></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker image build -t myjava:1.42 .</code></pre></div></div></aside></div></section><section id="étapes_de_construction" data-auto-animate><h2>🪜 Étapes de construction</h2><div class="slide-content"><div class="imageblock"><img src="media/images-output60_with_transparency.png" alt="images output60 with transparency"></div></div></section><section id="étapes_de_construction_2" data-auto-animate><h2>🪜 Étapes de construction</h2><div class="slide-content"><div class="imageblock"><img src="media/images-output61_with_transparency.png" alt="images output61 with transparency"></div></div></section><section id="étapes_de_construction_3" data-auto-animate><h2>🪜 Étapes de construction</h2><div class="slide-content"><div class="imageblock"><img src="media/images-output62_with_transparency.png" alt="images output62 with transparency"></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {60..62}; do convert Diapositive${i}.PNG -crop 9068x5265+1920+1827 -transparent white -resize x1080 images-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="et_après"><h2>Et après ?</h2><div class="slide-content"><div class="paragraph fragment"><p>Quand le build se termine, il se trouve dans le registre local.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker images
REPOSITORY       TAG                 IMAGE ID
myjava           1.42                d3017f59d5e2</code></pre></div></div></div></section><section id="limage_est_dispo"><h2>L&#8217;image est dispo !</h2><div class="slide-content"><div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run --interactive --tty myjava:1.42 sh
/ $</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">/ $ java -version
openjdk version "17.0.8" 2023-07-18
OpenJDK Runtime Environment (build 17.0.8+7-alpine-r0)
OpenJDK 64-Bit Server VM (build 17.0.8+7-alpine-r0, mixed mode, sharing)</code></pre></div></div>
<div class="imageblock fragment"><img src="media/278458282-image10.gif" alt="278458282 image10"></div></div></section><section id="registre_local_mais_encore"><h2>Registre local, mais encore?</h2><div class="slide-content"><div class="paragraph"><p>On les trouve où, ces images ?</p></div>
<div class="paragraph fragment"><p>En local, on l&#8217;a vu.</p></div>
<div class="paragraph fragment"><p>Dans les registres Docker.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ docker images
REPOSITORY                                  TAG                             IMAGE ID       CREATED         SIZE
jenkinsciinfra/jenkins-agent-ubuntu-22.04   latest                          c87afa001ba1   25 hours ago    6.89GB
cours-devops-docker-serve                   latest                          6b7b6a3145fd   27 hours ago    427MB
cours-devops-docker-qrcode                  latest                          43f91abb9cfa   27 hours ago    427MB
jenkins/jenkins                             2.419-rhel-ubi8-jdk11           9e2076ee44fa   3 days ago      507MB
jenkins/jenkins                             2.419-slim                      b93a74bd73b4   3 days ago      394MB
jenkins/jenkins                             2.419                           2193a96f254a   3 days ago      478MB
jenkins/jenkins                             2.419-jdk11                     2193a96f254a   3 days ago      478MB
jenkins/jenkins                             2.419-alpine                    f700f6333bf2   3 days ago      249MB
jenkins/jenkins                             2.419-rhel-ubi9-jdk17           0dbee3b2c2fc   3 days ago      485MB
jenkins/jenkins                             2.419-slim-jdk17                d9a360e0a9bf   3 days ago      393MB
jenkins/jenkins                             2.419-jdk17                     1695080429f5   3 days ago      476MB
jenkins/jenkins                             2.419-alpine-jdk17              2ea0017744c8   3 days ago      249MB
jenkins/jenkins                             2.419-rhel-ubi9-jdk21-preview   66ee1f18309d   3 days ago      494MB
jenkins/jenkins                             2.419-slim-jdk21-preview        e31d85782d2b   3 days ago      414MB
jenkins/jenkins                             2.419-jdk21                     c1e6c123a3c7   3 days ago      485MB
jenkins/jenkins                             2.419-alpine-jdk21-preview      97764348fde6   3 days ago      261MB
jdk21                                       latest                          ba476a3f2cd9   5 days ago      218MB
mycurl                                      1.0                             292bf6b4a4df   6 days ago      13.3MB
myjava                                      1.42                            05b6d3da385e   6 days ago      198MB
&lt;none&gt;                                      &lt;none&gt;                          7bc71c53e776   7 days ago      427MB
&lt;none&gt;                                      &lt;none&gt;                          b45a84c7d06b   7 days ago      427MB
jenkins/jenkins                             latest-jdk21-preview            5b5828e392bf   8 days ago      485MB
moby/buildkit                               buildx-stable-1                 9291fad3b41c   4 weeks ago     172MB
alpine                                      latest                          7e01a0d0a1dc   6 weeks ago     7.34MB
busybox                                     latest                          a416a98b71e2   2 months ago    4.26MB
docker/volumes-backup-extension             1.1.4                           6872a696b721   3 months ago    119MB
portainer/portainer-docker-extension        2.18.3                          3d18fe6d6805   4 months ago    273MB
felipecruz/alpine-tar-zstd                  latest                          31988344315d   12 months ago   6.99MB
justincormack/nsenter1                      latest                          c81481184b1b   5 years ago     101kB</code></pre></div></div></div></section><section id="les_registres_docker"><h2>Les registres Docker</h2><div class="slide-content"><div class="paragraph"><p>Ce sont des plates-formes qui hébergent les images.</p></div>
<div class="paragraph"><p>Il est possible de créer ses propres registres (ex : registre privé d&#8217;entreprise)</p></div></div></section><section data-background-image="media/node_Official_Image_Docker_Hub.png" data-background-size="cover" data-background-position="left"><div class="slide-content">
<aside class="notes"><div class="paragraph"><p><a href="https://hub.docker.com/" class="bare">https://hub.docker.com/</a></p></div></aside></div></section><section id="les_images"><h2>🖼️ Les images</h2><div class="slide-content"><div class="paragraph"><p>Avant d&#8217;instancier un container, il faut récupérer l&#8217;image en local.</p></div>
<div class="paragraph fragment"><p>Méthode explicite :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker image pull mysql</code></pre></div></div>
<div class="paragraph small fragment"><small>On rapatrie l&#8217;image en local mais on n&#8217;en fait rien.</small></div>
<div class="paragraph fragment"><p>Méthode implicite :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run -d mysql</code></pre></div></div>
<div class="paragraph small fragment"><small>On rapatrie l&#8217;image et on démarre un container dans la foulée.</small></div></div></section><section id="un_téléchargement_par_couches"><h2>🍰 Un téléchargement par couches</h2><div class="slide-content"><div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ docker image pull mysql
Using default tag: latest
latest: Pulling from library/mysql
5f70bf18a086: Pull complete
a734b0ff4ca6: Already exists
ec46eb0ce0a7: Pull complete
a74b383379bc: Pull complete
Digest: sha256:42dc1b67073f7ebab1...8c8d36c9031e408db0d
Status: Downloaded newer image for mysql:latest</code></pre></div></div>
<div class="paragraph fragment"><p>Les couches déjà présentes en local ne sont pas téléchargées de nouveau !</p></div></div></section><section id="conventions_de_nommage_des_images" data-auto-animate><h2>🖼🏷️ Conventions de nommage des images</h2><div class="slide-content"><div class="imageblock"><img src="media/images-output26_with_transparency.png" alt="images output26 with transparency"></div></div></section><section id="conventions_de_nommage_des_images_2" data-auto-animate><h2>🖼🏷️ Conventions de nommage des images</h2><div class="slide-content"><div class="imageblock"><img src="media/images-output27_with_transparency.png" alt="images output27 with transparency"></div></div></section><section id="conventions_de_nommage_des_images_3" data-auto-animate><h2>🖼🏷️ Conventions de nommage des images</h2><div class="slide-content"><div class="imageblock"><img src="media/images-output28_with_transparency.png" alt="images output28 with transparency"></div></div></section><section id="conventions_de_nommage_des_images_4" data-auto-animate><h2>🖼🏷️ Conventions de nommage des images</h2><div class="slide-content"><div class="imageblock"><img src="media/images-output29_with_transparency.png" alt="images output29 with transparency"></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {26..29}; do convert Diapositive${i}.PNG -crop 8962x4645+2183+2192 -transparent white -resize x1080 images-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section data-background-image="media/images-output31_with_transparency.png" data-background-size="contain" data-auto-animate></section><section data-background-image="media/images-output32_with_transparency.png" data-background-size="contain" data-auto-animate></section><section data-background-image="media/images-output33_with_transparency.png" data-background-size="contain" data-auto-animate></section><section data-background-image="media/images-output34_with_transparency.png" data-background-size="contain" data-auto-animate><div class="slide-content">
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {31..34}; do convert Diapositive${i}.PNG -crop 8904x5130+2256+2006 -transparent white -resize x1080 images-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="conventions_de_nommage_des_images_5"><h2>📷🏷️ Conventions de nommage des images</h2><div class="slide-content"><div class="paragraph fragment"><p>Une même image peut avoir plusieurs noms et tags !</p></div>
<div class="paragraph fragment"><p>Le tag "latest" est régulièrement réaffecté sur les registres distants.</p></div>
<div class="paragraph fragment"><p><strong>Plusieurs noms pour une signature</strong></p></div></div></section><section data-background-image="media/different_labels_same_checksum.png" data-background-size="contain"></section><section id="conventions_de_nommage_des_images_6"><h2>📷🏷️ Conventions de nommage des images</h2><div class="slide-content"><div class="paragraph"><p>Une même image peut avoir plusieurs noms et tags !</p></div>
<div class="paragraph"><p>Le tag "latest" est régulièrement réaffecté sur les registres distants.</p></div>
<div class="paragraph"><p><strong>Plusieurs noms pour une signature</strong></p></div>
<div class="paragraph"><p><strong>Tags disponibles pour MySQL</strong></p></div>
<div class="imageblock"><img src="media/mysql_tags.png" alt="mysql tags" width="1900"></div></div></section><section id="conventions_de_nommage_des_images_7"><h2>📷🏷️ Conventions de nommage des images</h2><div class="slide-content"><div class="paragraph"><p>Pour résumer&#8230;&#8203;</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-plaintext hljs" data-noescape="true" data-lang="plaintext">[REGISTRY/][NAMESPACE/]NAME[:TAG|@DIGEST]</code></pre></div></div>
<div class="ulist"><ul><li class="fragment"><p>Pas de Registre ? Défaut: <code>registry.docker.com</code></p></li><li class="fragment"><p>Pas de Namespace ? Défaut: <code>library</code></p></li><li class="fragment"><p>Pas de tag ? Valeur par défaut: <code>latest</code></p><div class="ulist"><ul><li class="fragment"><p>⚠️ Friends don&#8217;t let friends use <code>latest</code> 👫</p></li></ul></div></li><li class="fragment"><p>Digest: signature unique basée sur le contenu</p></li></ul></div></div></section><section id="conventions_de_nommage_exemples"><h2>📷🏷️ Conventions de nommage : Exemples</h2><div class="slide-content"><div class="ulist"><ul><li><p><code>ubuntu:22.04</code> &#8658; <code>registry.docker.com/library/ubuntu:22.04</code></p></li><li><p><code>dduportal/docker-asciidoctor</code> &#8658; <code>registry.docker.com/dduportal/docker-asciidoctor:latest</code></p></li><li><p><code>ghcr.io/dduportal/docker-asciidoctor:1.3.2@sha256:xxxx</code></p></li></ul></div></div></section><section id="utilisons_les_tags"><h2>🎓 Utilisons les tags</h2><div class="slide-content"><div class="ulist"><ul><li><p>Rappel : ⚠️ Friends don&#8217;t let friends use <code>latest</code> 👫</p></li><li><p>Il est temps de "taguer" votre première image !</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker image tag docker-git:latest docker-git:1.0.0</code></pre></div></div></li><li><p>Testez le fonctionnement avec le nouveau tag</p></li><li><p>Comparez les 2 images dans la sortie de <code>docker image ls</code></p></li></ul></div></div></section><section id="utilisons_les_tags_2"><h2>✅ Utilisons les tags</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker image tag docker-git:latest docker-git:1.0.0

# 2 lignes
docker image ls | grep docker-git
# 1 ligne
docker image ls | grep docker-git | grep latest
# 1 ligne
docker image ls | grep docker-git | grep '1.0.0'

# Doit fonctionner
docker container run --rm docker-git:1.0.0 git --version</code></pre></div></div></div></section><section id="mettre_à_jour_votre_image_1_1_0"><h2>🎓 Mettre à jour votre image (1.1.0)</h2><div class="slide-content"><div class="ulist"><ul><li><p>Mettez à jour votre image en version <code>1.1.0</code> avec les changements suivants :</p><div class="ulist"><ul><li><p>Ajoutez un <a href="https://docs.docker.com/engine/reference/builder/#label" target="_blank"><code>LABEL</code></a> dont la clef est <code>description</code> (et la valeur de votre choix)</p></li><li><p>Configurez <code>git</code> pour utiliser une branche <code>main</code> par défaut au lieu de <code>master</code> (commande <code>git config --global init.defaultBranch main</code>)</p></li></ul></div></li><li><p>Indices :</p><div class="ulist"><ul><li><p>💡 Commande <code>docker image inspect &lt;image name&gt;</code></p></li><li><p>💡 Commande <code>git config --get init.defaultBranch</code> (dans le conteneur)</p></li><li><p>💡 Ajoutez des lignes <strong>à la fin</strong> du <code>Dockerfile</code></p></li><li><p>💡 <a href="https://docs.docker.com/engine/reference/builder/" target="_blank">Documentation de référence des <code>Dockerfile</code></a></p></li></ul></div></li></ul></div></div></section><section id="mettre_à_jour_votre_image_1_1_0_2"><h2>✅ Mettre à jour votre image (1.1.0)</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">cat ./Dockerfile
FROM ubuntu:22.04
RUN apt-get update &amp;&amp; apt-get install --yes --no-install-recommends git
LABEL description="Une image contenant git préconfiguré"
RUN git config --global init.defaultBranch main

docker image build -t docker-git:1.1.0 ./docker-git/
# Sending build context to Docker daemon  2.048kB
# Step 1/4 : FROM ubuntu:22.04
#  ---&gt; e40cf56b4be3
# Step 2/4 : RUN apt-get update &amp;&amp; apt-get install --yes --no-install-recommends git
#  ---&gt; Using cache
#  ---&gt; 926b8d87f128
# Step 3/4 : LABEL description="Une image contenant git préconfiguré"
#  ---&gt; Running in 0695fc62ecc8
# Removing intermediate container 0695fc62ecc8
#  ---&gt; 68c7d4fb8c88
# Step 4/4 : RUN git config --global init.defaultBranch main
#  ---&gt; Running in 7fb54ecf4070
# Removing intermediate container 7fb54ecf4070
#  ---&gt; 2858ff394edb
Successfully built 2858ff394edb
Successfully tagged docker-git:1.1.0

docker container run --rm docker-git:1.0.0 git config --get init.defaultBranch
docker container run --rm docker-git:1.1.0 git config --get init.defaultBranch
# main</code></pre></div></div></div></section><section id="cache_dimages_layers"><h2>Cache d&#8217;images &amp; Layers</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-plaintext hljs" data-noescape="true" data-lang="plaintext">Step 2/4 : RUN apt-get update &amp;&amp; apt-get install --yes --no-install-recommends git
  ---&gt; Using cache</code></pre></div></div>
<div class="paragraph"><p>🤔 En fait, Docker n&#8217;a PAS exécuté cette commande la seconde fois &#8658; ça va beaucoup plus vite !</p></div>
<div class="imageblock"><img src="media/docker-layers.jpg" alt="docker layers" width="400"></div>
<div class="paragraph"><p>🎓 Essayez de voir les layers avec (dans Gitpod) <a href="https://github.com/wagoodman/dive" target="_blank"><code>dive &lt;image&gt;:&lt;tag&gt;</code></a></p></div></div></section><section id="cache_dimages_layers_2"><h2>🎓 Cache d&#8217;images &amp; Layers</h2><div class="slide-content"><div class="ulist"><ul><li><p><strong>But :</strong> manipuler le cache d&#8217;images</p></li><li><p>Commencez par vérifier que le cache est utilisé : relancez la dernière commande <code>docker image build</code> (plusieurs fois s&#8217;il le faut)</p></li><li><p>Invalidez le cache en ajoutant le paquet APT <code>make</code> à installer en même temps que <code>git</code></p><div class="ulist"><ul><li><p>⚠️ Tag <code>1.2.0</code></p></li></ul></div></li><li><p>Vérifiez que le cache est bien présent de nouveau</p></li></ul></div></div></section><section id="cache_dimages_layers_3"><h2>✅ Cache d&#8217;images &amp; Layers</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Build one time
docker image build -t docker-git:1.1.0 ./docker-git/
# Second time is fully cached
docker image build -t docker-git:1.1.0 ./docker-git/

cat Dockerfile
# FROM ubuntu:22.04
# RUN apt-get update &amp;&amp; apt-get install --yes --no-install-recommends git make
# LABEL description="Une image contenant git préconfiguré"
# RUN git config --global init.defaultBranch main

# Build one time
docker image build -t docker-git:1.2.0 ./docker-git/
# Second time is fully cached
docker image build -t docker-git:1.2.0 ./docker-git/

## Vérification
# Renvoie une erreur
docker run --rm docker-git:1.1.0 make --version
# Doit fonctionner
docker run --rm docker-git:1.2.0 make --version</code></pre></div></div></div></section><section id="comportement_par_défaut_des_containers" data-auto-animate><h2>Comportement par défaut des containers</h2><div class="slide-content"><div class="paragraph"><p>Deux instructions permettent de définir la commande à lancer au démarrage du container.</p></div>
<div class="imageblock fragment"><img src="media/cmd.png" alt="cmd"></div></div></section><section id="comportement_par_défaut_des_containers_2" data-auto-animate><h2>Comportement par défaut des containers</h2><div class="slide-content"><div class="paragraph"><p>Deux instructions permettent de définir la commande à lancer au démarrage du container.</p></div>
<div class="imageblock"><img src="media/cmd-entrypoint.png" alt="cmd entrypoint"></div>
<div class="paragraph fragment"><p>Laquelle choisir ???</p></div></div></section><section id="cmd_vs_entrypoint" data-auto-animate><h2>CMD vs ENTRYPOINT</h2><div class="slide-content"><div class="paragraph"><p>Cas d&#8217;usage : énoncé du besoin.</p></div>
<div class="paragraph fragment"><p>Besoin : je veux utiliser <code>cURL</code> mais il n&#8217;est pas présent sur la machine hôte.</p></div>
<div class="paragraph fragment"><p><strong>Facile !</strong></p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run --rm curlimages/curl curl -x http://prx:3128 -L --connect-timeout 60  "http://google.com"</code></pre></div></div>
<div class="imageblock fragment"><img src="media/1956754704-image11.jpeg" alt="1956754704 image11"></div>
<aside class="notes"><div class="paragraph"><p>Pour ceux qui n&#8217;auraient pas de proxy parce que vous n&#8217;utilisez pas le réseau de la fac&#8230;&#8203; On peut en lancer un avec Docker.
Tout d&#8217;abord, créer un fichier <code>squid.conf</code> avec comme contenu:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-apache hljs" data-noescape="true" data-lang="apache">http_port 3128
acl all src all
http_access allow all</code></pre></div></div>
<div class="paragraph"><p>On peut ensuite lancer le proxy:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker run --name squid -d --restart=always --publish 3128:3128 -v $(pwd)/squid.conf:/etc/squid/squid.conf sameersbn/squid:3.5.27-2</code></pre></div></div>
<div class="paragraph"><p>Puis changer la commande en:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run --rm curlimages/curl curl -x http://host.docker.internal:3128 -L --connect-timeout 60  "http://google.com"</code></pre></div></div></aside></div></section><section id="cmd_vs_entrypoint_2" class="columns" data-auto-animate><h2>CMD vs ENTRYPOINT</h2><div class="slide-content"><div class="openblock column is-one-fifth"><div class="content"><div class="paragraph"><p>Cas d&#8217;usage.
On va s&#8217;outiller!</p></div></div></div>
<div class="openblock column is-half"><div class="content"><div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM alpine:3.21
LABEL maintainer="John Doe"
RUN apk update &amp;&amp; apk add curl
# Si vous utilisez le proxy de l'Université
CMD ["curl","-x", "http://prx:3128", "-L", "--connect-timeout", "60", "http://google.com"]
# Si vous utilisez votre propre proxy docker
# CMD ["curl","-x", "http://host.docker.internal:3128", "-L", "--connect-timeout", "60", "http://google.com"]</code></pre></div></div></div></div>
<div class="openblock column fragment"><div class="content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker image build -t my-curl:1.0 .</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run --rm my-curl:1.0
&lt;!doctype html&gt;&lt;html [...]
google blahblahblah [...]
&lt;/html&gt;</code></pre></div></div>
<div class="imageblock fragment"><img src="media/my-girl.gif" alt="my girl"></div></div></div></div></section><section id="cmd_vs_entrypoint_3" data-auto-animate><h2>CMD vs ENTRYPOINT</h2><div class="slide-content"><div class="paragraph"><p>Cas d&#8217;usage.</p></div>
<div class="imageblock fragment"><img src="media/images-output84_with_transparency.png" alt="%auto-animate"></div></div></section><section id="cmd_vs_entrypoint_4"><h2>CMD vs ENTRYPOINT</h2><div class="slide-content"><div class="paragraph"><p>Cas d&#8217;usage.</p></div>
<div class="imageblock"><img src="media/images-output85_with_transparency.png" alt="%auto-animate"></div>
<div class="imageblock fragment"><img src="media/1602759072-image12.gif" alt="1602759072 image12"></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {84..85}; do convert Diapositive${i}.PNG -crop 9670x2727+1832+2166 -transparent white -resize x1080 images-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="cmd_vs_entrypoint_5"><h2>CMD vs ENTRYPOINT</h2><div class="slide-content"><div class="paragraph"><p>Cas d&#8217;usage: un cran plus loin.</p></div>
<div class="paragraph"><p>L&#8217;image actuelle, c&#8217;est bien mais pas hyper flexible !</p></div>
<div class="paragraph fragment"><p>Et si on la rendait paramétrable ?</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run --rm my-curl:2.0 http://google.com
docker container run --rm my-curl:2.0 http://facebook.com
docker container run --rm my-curl:2.0 http://twitter.com</code></pre></div></div></div></section><section id="cmd_vs_entrypoint_6" class="columns" data-auto-animate><h2>CMD vs ENTRYPOINT</h2><div class="slide-content"><div class="openblock column is-one-fifth"><div class="content"><div class="paragraph"><p>Cas d&#8217;usage, un cran plus loin</p></div>
<div class="paragraph"><p>Paramétrable, et hop!</p></div></div></div>
<div class="openblock column is-half"><div class="content"><div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM alpine:3.21
LABEL maintainer="John Doe"
RUN apk update &amp;&amp; apk add curl
# Si vous utilisez le proxy de l'Université
ENTRYPOINT ["curl","-x", "http://prx:3128", "-L", "--connect-timeout", "60"]
# Si vous utilisez votre propre proxy docker
# CMD ["curl","-x", "http://host.docker.internal:3128", "-L", "--connect-timeout", "60"]</code></pre></div></div></div></div>
<div class="openblock column fragment"><div class="content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker image build -t my-curl:2.0 .</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run --rm my-curl:2.0 http://google.com
&lt;!doctype html&gt;&lt;html [...]
google blahblahblah [...]
&lt;/html&gt;</code></pre></div></div></div></div></div></section><section id="cmd_vs_entrypoint_7" class="columns" data-auto-animate><h2>CMD vs ENTRYPOINT</h2><div class="slide-content"><div class="openblock column is-one-fifth"><div class="content"><div class="paragraph"><p>Cas d&#8217;usage, un cran plus loin</p></div>
<div class="paragraph"><p>Paramétrable, et hop!</p></div></div></div>
<div class="openblock column is-half"><div class="content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM alpine:3.21
LABEL maintainer="John Doe"
RUN apk update &amp;&amp; apk add curl
# Si vous utilisez le proxy de l'Université
ENTRYPOINT ["curl","-x", "http://prx:3128", "-L", "--connect-timeout", "60"]
# Si vous utilisez votre propre proxy docker
# CMD ["curl","-x", "http://host.docker.internal:3128", "-L", "--connect-timeout", "60"]</code></pre></div></div>
<div class="imageblock"><img src="media/override.png" alt="override"></div></div></div>
<div class="openblock column"><div class="content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker image build -t my-curl:2.0 .</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run --rm my-curl:2.0 http://google.com
&lt;!doctype html&gt;&lt;html [...]
google blahblahblah [...]
&lt;/html&gt;</code></pre></div></div></div></div></div></section><section id="checkpoint_5"><h2>Checkpoint 🎯</h2><div class="slide-content"><div class="ulist"><ul><li><p>Une image Docker fournit un environnement de système de fichier auto-suffisant (application, dépendances, binaries, etc.) comme modèle de base d&#8217;un conteneur</p></li><li><p>Les images Docker ont une convention de nommage permettant d&#8217;identifier les images très précisément</p></li><li><p>On peut spécifier une recette de fabrication d&#8217;image à l&#8217;aide d&#8217;un <code>Dockerfile</code> et de la commande <code>docker image build</code></p></li></ul></div>
<div class="paragraph"><p>&#8658; 🤔 et si on utilisait Docker pour nous aider dans l&#8217;intégration continue ?</p></div></div></section></section>
<section><section id="nos_fichiers_dans_les_images" data-background-image="media/fichiers.png" data-background-size="cover" data-background-position="left"><h2>📁 Nos fichiers dans les images</h2><div class="slide-content"></div></section><section id="le_répertoire_de_travail"><h2>📂 Le répertoire de travail</h2><div class="slide-content"><div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run --interactive --tty httpd pwd /usr/local/apache2</code></pre></div></div>
<div class="paragraph fragment"><p>Comment paramétrer le répertoire de travail de tous nos containers ?</p></div></div></section><section id="workdir" data-auto-animate><h2>📂 WORKDIR</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM alpine:3.21
WORKDIR /repertoire/travail
RUN echo hello &gt; ./world.txt</code></pre></div></div></div></section><section id="workdir_2" data-auto-animate><h2>📂 WORKDIR</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM alpine:3.21
WORKDIR /repertoire/travail
RUN echo hello &gt; ./world.txt</code></pre></div></div>
<div class="imageblock"><img src="media/fichiers-output5_with_transparency.png" alt="fichiers output5 with transparency"></div></div></section><section id="workdir_3" data-auto-animate><h2>📂 WORKDIR</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM alpine:3.21
WORKDIR /repertoire/travail
RUN echo hello &gt; ./world.txt</code></pre></div></div>
<div class="imageblock"><img src="media/fichiers-output6_with_transparency.png" alt="fichiers output6 with transparency"></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {5..6}; do convert Diapositive${i}.PNG -crop 9667x3750+1833+3333 -transparent white -resize x1080 fichiers-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="workdir_4" data-auto-animate><h2>📂 WORKDIR</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM alpine:3.21
WORKDIR /repertoire/travail
RUN echo hello &gt; ./world.txt</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker image build --tag mon-img .
...</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ docker container run mon-img cat /repertoire/travail/world.txt
hello</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ docker container run mon-img pwd
/repertoire/travail</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ docker container run --workdir /home mon-img pwd
/home</code></pre></div></div></div></section><section id="embarquer_des_fichiers" data-auto-animate><h2>📁 Embarquer des fichiers</h2><div class="slide-content"><div class="paragraph"><p>Cas d&#8217;usage.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">ls
app.js</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ docker container run --workdir /customdir node app.js
&lt;error : app.js not found&gt;</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ docker container run --workdir /customdir --entrypoint ls node
&lt;0 fichiers présents !&gt;</code></pre></div></div>
<div class="paragraph fragment"><p>Comment fournir des fichiers à mes containers ?</p></div></div></section><section id="embarquer_des_fichiers_2" data-auto-animate><h2>📁 Embarquer des fichiers</h2><div class="slide-content"><div class="paragraph"><p>Copie de fichiers.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM node:22.2.0-alpine3.18
WORKDIR /app
COPY ./* /app</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker image build --tag mon-node .
...</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ docker container run --workdir /app --entrypoint ls mon-node
app.js</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ docker container run mon-node app.js
Hello Mad Javascript World!</code></pre></div></div></div></section><section id="embarquer_des_fichiers_3" data-auto-animate><h2>📁 Embarquer des fichiers</h2><div class="slide-content"><div class="paragraph"><p>Le mot clé <code>ADD</code>.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM image
ADD https://mon-nexus/foo/bar/1.0/package.tar /uncompressed/</code></pre></div></div>
<div class="paragraph fragment"><p>Il permet d&#8217;ajouter des fichiers aux images, tout comme <code>COPY</code>.</p></div>
<div class="paragraph fragment"><p>Il est capable de télécharger directement d&#8217;une URL</p></div>
<div class="paragraph fragment"><p>Il est capable de "untar" automatiquement.</p></div>
<div class="paragraph fragment"><p>On le retrouve dans d&#8217;anciens Dockerfile mais il tend à disparaître.</p></div></div></section><section id="embarquer_des_fichiers_4" data-auto-animate><h2>📁 Embarquer des fichiers</h2><div class="slide-content"><div class="paragraph"><p>Le mot clé <code>ADD</code></p></div>
<div class="paragraph small"><small>source : <a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#add-or-copy" class="bare">https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#add-or-copy</a></small></div>
<div class="imageblock"><img src="media/1108215415-image2.png" alt="1108215415 image2"></div></div></section><section id="embarquer_des_fichiers_5" data-auto-animate><h2>📁 Embarquer des fichiers</h2><div class="slide-content"><div class="paragraph"><p>Le mot clé <code>ADD</code>.</p></div>
<div class="paragraph small"><small>source : <a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#add-or-copy" class="bare">https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#add-or-copy</a></small></div>
<div class="imageblock"><img src="media/add-stabylo.png" alt="add stabylo"></div></div></section><section id="embarquer_des_fichiers_6" data-auto-animate><h2>📁 Embarquer des fichiers</h2><div class="slide-content"><div class="paragraph"><p>Oui, mais pas la terre entière !</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker image build --tag myjava:1.42 ./
Sending build context to Docker daemon  172.8MB</code></pre></div></div></div></section><section id="embarquer_des_fichiers_7" data-auto-animate><h2>📁 Embarquer des fichiers</h2><div class="slide-content"><div class="paragraph"><p>Oui, mais pas la terre entière !</p></div>
<div class="imageblock"><img src="media/fichiers-output19_with_transparency.png" alt="fichiers output19 with transparency"></div></div></section><section id="embarquer_des_fichiers_8" data-auto-animate><h2>📁 Embarquer des fichiers</h2><div class="slide-content"><div class="paragraph"><p>Oui, mais pas la terre entière !</p></div>
<div class="imageblock"><img src="media/fichiers-output20_with_transparency.png" alt="fichiers output20 with transparency"></div></div></section><section id="embarquer_des_fichiers_9" data-auto-animate><h2>📁 Embarquer des fichiers</h2><div class="slide-content"><div class="paragraph"><p>Oui, mais pas la terre entière !</p></div>
<div class="imageblock"><img src="media/fichiers-output21_with_transparency.png" alt="fichiers output21 with transparency"></div>
<div class="paragraph"><p>Si un gros fichier traîne dans le dossier alors qu&#8217;il n&#8217;est même pas utilisé ni référencé dans le Dockerfile, il sera tout de même envoyé au Docker daemon.</p></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {19..21}; do convert Diapositive${i}.PNG -crop 9250x2932+2097+1750 -transparent white -resize x1080 fichiers-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="embarquer_des_fichiers_10"><h2>📁 Embarquer des fichiers</h2><div class="slide-content"><div class="paragraph"><p>Oui, mais pas la terre entière !</p></div>
<div class="paragraph fragment"><p><em>"M&#8217;en fous ! j&#8217;ai une machine de fou et un réseau de fou ! YOLO !"</em></p></div>
<div class="paragraph fragment"><p>Et si la CI fait plusieurs builds par minute ?</p></div>
<div class="paragraph fragment"><p>Et si un vieux Keystore traîne dans les sources ?</p></div>
<div class="paragraph fragment"><p><code>.git/</code> ? <code>.idea/</code> ? vraiment ?</p></div>
<div class="paragraph fragment"><p>Attention à l&#8217;invalidation de cache d&#8217;un step de build à cause de l&#8217;ajout d&#8217;un fichier inutile !</p></div></div></section><section id="dockerignore"><h2>🙉 <code>.dockerignore</code></h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-.dockerignore hljs" data-noescape="true" data-lang=".dockerignore"># ignore les dossiers .git et .cache
.git
.cache</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-.dockerignore hljs" data-noescape="true" data-lang=".dockerignore"># ignore tous les fichiers *.class dans tous les dossiers
**/*.class</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-.dockerignore hljs" data-noescape="true" data-lang=".dockerignore"># ignore les markdown sauf les README*.md (README-secret.md sera tout de même ignoré par contre)
*.md
!README*.md
README-secret.md</code></pre></div></div></div></section><section data-background-image="media/docker-commands-table.png" data-background-size="contain" data-background-position="center"></section><section id="renommage_des_images" data-auto-animate><h2>📝 Renommage des images</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output25_with_transparency.png" alt="fichiers output25 with transparency"></div></div></section><section id="renommage_des_images_2" data-auto-animate><h2>📝 Renommage des images</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output26_with_transparency.png" alt="fichiers output26 with transparency"></div></div></section><section id="renommage_des_images_3" data-auto-animate><h2>📝 Renommage des images</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output27_with_transparency.png" alt="fichiers output27 with transparency"></div></div></section><section id="renommage_des_images_4" data-auto-animate><h2>📝 Renommage des images</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output28_with_transparency.png" alt="fichiers output28 with transparency"></div>
<div class="paragraph fragment"><p><code>httpd:latest</code> sera taggué en <code>fedora/httpd:version1.0</code></p></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"> for i in {25..28}; do convert Diapositive${i}.PNG -crop 9000x2684+2097+2083 -transparent white -resize x1080 fichiers-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="les_images_2" class="columns" data-auto-animate><h2>🖼️ LES IMAGES</h2><div class="slide-content"><div class="imageblock column"><img src="media/multi-layered-cake-removebg-preview.png" alt="multi layered cake removebg preview"></div>
<div class="openblock column"><div class="content"><div class="paragraph"><p>Le bilan</p></div>
<div class="paragraph"><p>Vous savez désormais:</p></div>
<div class="ulist"><ul><li><p>Rédiger un Dockerfile</p></li><li><p>Nommer vos images</p></li><li><p>Créer vos outils</p></li></ul></div></div></div></div></section><section id="les_images_3" class="columns" data-auto-animate><h2>🖼️ LES IMAGES</h2><div class="slide-content"><div class="imageblock column"><img src="media/384835330-image4.gif" alt="384835330 image4"></div>
<div class="openblock column"><div class="content"><div class="paragraph"><p>Le bilan</p></div>
<div class="paragraph"><p>Vous savez désormais:</p></div>
<div class="ulist"><ul><li><p>Rédiger un Dockerfile</p></li><li><p>Nommer vos images</p></li><li><p>Créer vos outils</p></li></ul></div></div></div></div></section><section id="les_registries"><h2>🗂️ Les registries</h2><div class="slide-content"><div class="imageblock"><img src="media/104336496-image5.png" alt="104336496 image5"></div></div></section><section id="golden_rule"><h2>Golden Rule</h2><div class="slide-content"><div class="paragraph"><p><strong>La construction d&#8217;une image doit être automatisée.</strong></p></div></div></section><section id="automatique_sécurisé"><h2>🤖 = 🔒 ? Automatique == sécurisé</h2><div class="slide-content"><div class="paragraph"><p>Le fait de déléguer la construction des images permet d&#8217;ajouter toute une chaîne de traitement, de contrôles des images pour s&#8217;assurer qu&#8217;elle respecte les règles RSSI.</p></div>
<div class="ulist"><ul><li class="fragment"><p>patch management</p></li><li class="fragment"><p>droits sur le FS</p></li><li class="fragment"><p>user</p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>C&#8217;est quoi le RSSI ?
RSSI : définition. Le responsable de la sécurité des systèmes d&#8217;information (ou RSSI pour Responsable de la Sécurité des Systèmes d&#8217;Information) définit et développe la politique de sécurité de l&#8217;information de son entreprise.</p></div></aside></div></section><section id="exemple_de_mise_en_place" data-auto-animate><h2>Exemple de mise en place</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output35_with_transparency.png" alt="fichiers output35 with transparency"></div></div></section><section id="exemple_de_mise_en_place_2" data-auto-animate><h2>Exemple de mise en place</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output36_with_transparency.png" alt="fichiers output36 with transparency"></div></div></section><section id="exemple_de_mise_en_place_3" data-auto-animate><h2>Exemple de mise en place</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output37_with_transparency.png" alt="fichiers output37 with transparency"></div></div></section><section id="exemple_de_mise_en_place_4" data-auto-animate><h2>Exemple de mise en place</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output38_with_transparency.png" alt="fichiers output38 with transparency"></div></div></section><section id="exemple_de_mise_en_place_5" data-auto-animate><h2>Exemple de mise en place</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output39_with_transparency.png" alt="fichiers output39 with transparency"></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {35..39}; do convert Diapositive${i}.PNG -crop 8803x3982+2273+2769 -transparent white -resize x1080 fichiers-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="exemple_continuous_build"><h2>➡️ Exemple : continuous build</h2><div class="slide-content"><div class="imageblock"><img src="media/107490784-image13.png" alt="107490784 image13"></div></div></section><section id="travaux_pratiques_5"><h2>🎓 Travaux pratiques #5</h2><div class="slide-content"><div class="paragraph"><p><a href="https://gitlab.univ-artois.fr/bruno.verachten/devops-docker-tp05" class="bare">https://gitlab.univ-artois.fr/bruno.verachten/devops-docker-tp05</a></p></div>
<div class="imageblock"><img src="media/636764807-image14.png" alt="636764807 image14"></div>
<aside class="notes"><div class="paragraph"><p>Solution là: <a href="https://gitlab.univ-artois.fr/bruno.verachten/devops-docker-tp-05-solution" class="bare">https://gitlab.univ-artois.fr/bruno.verachten/devops-docker-tp-05-solution</a></p></div></aside></div></section><section id="solution_travaux_pratiques_5" data-auto-animate><h2>✅ Solution Travaux pratiques #5</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-diff hljs" data-noescape="true" data-lang="diff">diff --git a/src/Dockerfile b/src/Dockerfile
index c92c67cd48121705628f67a2af14b2a65e54cdfd..77919a581fffde7c57f43c8b7cbee2a8d84b628b 100644
--- a/src/Dockerfile
+++ b/src/Dockerfile
@@ -9,6 +9,10 @@ COPY start.sh /bin/start.sh
 EXPOSE 4321
 # This line opens port 4321 on the container. It's like installing a door in your house.

+RUN adduser --disabled-password --gecos "" --home /home/www www
+USER www
+WORKDIR /home/www
+
 ENTRYPOINT ["/bin/start.sh"]
 # This line sets the command that will be run when the container starts. It's like setting the alarm clock in your house.</code></pre></div></div>
<aside class="notes"><div class="paragraph"><p>L&#8217;option <code>--gecos</code> dans la commande adduser est utilisée pour définir le champ GECOS (General Electric Comprehensive Operating System) de l&#8217;entrée de l&#8217;utilisateur dans le fichier <code>/etc/passwd</code>.
Le champ GECOS contient traditionnellement des informations supplémentaires sur l&#8217;utilisateur, telles que le nom complet de l&#8217;utilisateur, l&#8217;emplacement du bureau et le numéro de téléphone, bien que cela ne soit souvent pas utilisé dans les systèmes modernes.</p></div>
<div class="paragraph"><p>Dans les Dockerfiles et les configurations système, il est courant de définir le champ GECOS sur une chaîne vide ou une valeur de substitution comme "" pour indiquer que les informations ne sont pas nécessaires.
L&#8217;option --gecos "" définit effectivement le champ GECOS comme une chaîne vide, ce qui signifie qu&#8217;aucune information supplémentaire sur l&#8217;utilisateur n&#8217;est fournie.</p></div>
<div class="paragraph"><p>Pour les conteneurs Docker et les utilisateurs système créés à des fins spécifiques (comme l&#8217;exécution de services ou d&#8217;applications dans des conteneurs), il n&#8217;est souvent pas nécessaire de remplir le champ GECOS avec des informations détaillées, et l&#8217;utilisation de --gecos "" est une pratique courante pour maintenir une base d&#8217;utilisateurs propre et minimale dans le conteneur ou le système.
Cela contribue à maintenir une base d&#8217;utilisateurs propre et minimale dans le conteneur ou le système.</p></div>
<div class="paragraph"><p>L&#8217;utilisation de l&#8217;UID (User ID) 1001 pour un utilisateur créé dans un conteneur Docker est une pratique courante, mais elle n&#8217;est pas nécessairement fixe.
Cela dépend des besoins spécifiques de votre application et de la manière dont vous gérez les utilisateurs dans vos conteneurs. Voici quelques raisons courantes d&#8217;utiliser l&#8217;UID 1001 :</p></div>
<div class="paragraph"><p>Éviter les conflits : L&#8217;UID 1001 est souvent choisi pour éviter les conflits avec les utilisateurs système existants.
Dans de nombreuses distributions Linux, les utilisateurs système ont des UIDs inférieurs à 1000.
En utilisant l&#8217;UID 1001, vous minimisez le risque de conflits avec ces utilisateurs.</p></div>
<div class="paragraph"><p>Sécurité : Dans un environnement de conteneur, il est courant de limiter les privilèges des utilisateurs.
En utilisant un UID non réservé, vous réduisez le risque que l&#8217;utilisateur puisse accéder à des ressources système critiques.</p></div>
<div class="paragraph"><p>Personnalisation : Vous pouvez choisir un UID personnalisé en fonction de vos besoins.
Dans certains cas, l&#8217;UID 1001 est simplement choisi par convention. Si vous avez des exigences spécifiques en matière de numéros d&#8217;UID, vous pouvez les personnaliser en conséquence.</p></div>
<div class="paragraph"><p>Isolation : En attribuant des UIDs spécifiques aux utilisateurs de vos conteneurs, vous pouvez mieux isoler ces utilisateurs des autres utilisateurs système ou des autres conteneurs.</p></div>
<div class="paragraph"><p>Il est important de noter que le choix de l&#8217;UID dépend de la manière dont vous configurez vos conteneurs et de vos exigences en matière de sécurité et d&#8217;isolation.
L&#8217;UID 1001 est courant, mais il n&#8217;est pas la seule option, et vous pouvez choisir un UID qui convient le mieux à votre cas d&#8217;utilisation particulier.</p></div></aside></div></section><section id="solution_travaux_pratiques_5_2" data-auto-animate><h2>✅ Solution Travaux pratiques #5</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-diff hljs" data-noescape="true" data-lang="diff">diff --git a/src/start.sh b/src/start.sh
index 44006d6cd8414706a5fcf564dbfd1e9c38d4bc0b..a6ed60fdf88759d4962685e7ceb6cdbc21867448 100755
--- a/src/start.sh
+++ b/src/start.sh
@@ -4,7 +4,7 @@
 set -eux
 # These are shell options. 'e' exits on error, 'u' treats unset variables as an error, and 'x' prints each command to the terminal. It's like the script's personal assistant, making sure everything runs smoothly.

-touch /home/www/started.time
+touch /tmp/started.time
 # This creates a file named 'started.time' in the '/home/www' directory. It's like the script's way of marking its territory.

 if [ $? -ne 0 ]; then
@@ -12,7 +12,7 @@ if [ $? -ne 0 ]; then
 fi
 # This checks the exit status of the last command. If it's not zero, which means there was an error, it exits the script. It's like the script's way of saying, "If I can't do it right, I won't do it at all."

-date &gt; /home/www/started.time
+date &gt; /tmp/started.time
 # This writes the current date and time to the 'started.time' file. It's like the script's way of keeping a diary.

 exec "$@"</code></pre></div></div></div></section><section id="solution_travaux_pratiques_5_3" data-auto-animate><h2>✅ Solution Travaux pratiques #5</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">stages:
  - "validator.sh"
  - "docker scout"

variables:
  PROXY: "http://cache-etu.univ-artois.fr:3128"
  IMAGE: "devops-docker-tp05:latest"

validator-job:
  image: cache-ili.univ-artois.fr/proxy_cache/library/docker
  stage: "validator.sh"
  before_script:
    - export HTTP_PROXY="$PROXY"
    - export HTTPS_PROXY="$PROXY"
    - apk add -U bash
  script:
    - errors=$(./validator.sh)
    - echo "$errors"
    - exit $([ -z "$errors" ] &amp;&amp; echo 0 || echo 1)
  tags:
    - docker2

# No login needed, using docker desktop with wsl
scout-job:
  stage: "docker scout"
  script:
    - cd ./src
    - docker build . -t "$IMAGE"
    - docker scout cves --format only-packages --only-vuln-packages "$IMAGE"
    - docker rmi "$IMAGE"
  tags:
    - myshell</code></pre></div></div></div></section><section id="solution_travaux_pratiques_5_4" data-auto-animate><h2>✅ Solution Travaux pratiques #5</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">stages:
  - run_script
  - docker_scan

run_script:
  stage: run_script
  script:
    - chmod +x validator.sh src/start.sh &amp;&amp; ./validator.sh # Makes the scripts executable and runs validator.sh
    - |
        if [ $? -eq 0 ]; then
          echo "Script exited successfully."
        else
          echo "Script exited with an error."
          exit 1  # Mark the job as a failure
        fi

docker_scan:
  stage: docker_scan
  script:
    - IMG=$(echo img$$)
    - docker image build --tag $IMG ./src &gt; /dev/null
    - echo "Will scan $IMG"
    - echo $DOCKER_TOKEN | docker login -u $DOCKER_USERNAME --password-stdin
    - docker scout cves --format only-packages --only-vuln-packages $IMG # Runs docker scout to scan the image
    - docker scout recommendations $IMG # View base image update recommendations</code></pre></div></div></div></section><section id="inspection_et_nommage_des_containers"><h2>🔍 Inspection et nommage des containers</h2><div class="slide-content"><div class="imageblock"><img src="media/1712651753-image15.png" alt="1712651753 image15"></div></div></section><section id="nommage_des_containers" data-auto-animate><h2>📛 Nommage des containers</h2><div class="slide-content"><div class="imageblock"><img src="media/docker-container-logs.png" alt="docker container logs"></div>
<div class="paragraph fragment"><p>Ne peut-on pas trouver plus 'user-friendly'?</p></div></div></section><section id="nommage_des_containers_2" data-auto-animate><h2>📛 Nommage des containers</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output47_with_transparency.png" alt="fichiers output47 with transparency"></div></div></section><section id="nommage_des_containers_3" data-auto-animate><h2>📛 Nommage des containers</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output48_with_transparency.png" alt="fichiers output48 with transparency"></div></div></section><section id="nommage_des_containers_4" data-auto-animate><h2>📛 Nommage des containers</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output49_with_transparency.png" alt="fichiers output49 with transparency"></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {46..49}; do convert Diapositive${i}.PNG -crop 13243x4424+61+2040 -transparent white -resize x1080 fichiers-output${i}_with_transparency.png; done</code></pre></div></div>
<div class="paragraph"><p>Jean-Claude Poitras est un créateur de mode, un designer multidisciplinaire, un chroniqueur, un conférencier et un artiste né à Montréal au Canada le 18 juin 1949.</p></div></aside></div></section><section id="nommage_des_containers_5"><h2>📛 Nommage des containers</h2><div class="slide-content"><div class="paragraph"><p>Humour de g33k</p></div>
<div class="imageblock"><img src="media/1671853138-image16.png" alt="1671853138 image16"></div>
<div class="paragraph"><p>source : <a href="https://github.com/docker/engine/blob/master/pkg/namesgenerator/names-generator.go" class="bare">https://github.com/docker/engine/blob/master/pkg/namesgenerator/names-generator.go</a></p></div></div></section><section id="nommage_des_containers_6"><h2>📛 Nommage des containers</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run --detach --name my-web httpd</code></pre></div></div>
<div class="paragraph fragment"><p>Nom du container explicite</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container logs my-web</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker exec --interactive --tty my-web sh</code></pre></div></div></div></section><section id="renommage_des_containers" class="columns" data-auto-animate><h2>🦸‍♂️ Renommage des containers</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="paragraph"><p>Attention, spoiler pour les n00bs de DC Comics</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container rename clark_kent superman</code></pre></div></div></div></div>
<div class="openblock column"><div class="content"><div class="imageblock fragment"><img src="media/kent_and_superman.jpeg" alt="kent and superman"></div></div></div></div></section><section id="renommage_des_containers_2" data-auto-animate><h2>🦸‍♂️ Renommage des containers</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output55_with_transparency.png" alt="fichiers output55 with transparency"></div></div></section><section id="renommage_des_containers_3" data-auto-animate><h2>🦸‍♂️ Renommage des containers</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output56_with_transparency.png" alt="fichiers output56 with transparency"></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"> for i in {55..56}; do convert Diapositive${i}.PNG -crop 8883x3982+2104+2080 -transparent white -resize x1080 fichiers-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="inspection_des_containers" class="columns"><h2>🔍 Inspection des containers</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="imageblock"><img src="media/inspecting-containers.jpeg" alt="inspecting containers"></div></div></div>
<div class="openblock column"><div class="content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container inspect my-web
[
    {
        "Id": "0ac8cdf8d447c6d316a04bd1a7f74cd2677eea3478f11f0be5241c1bb2d4c7da",
        "Created": "2023-10-24T19:40:11.84788911Z",
        "Path": "httpd-foreground",
        "Args": [],
        "State": {
            "Status": "running",
            "Running": true,
            "Paused": false,
            "Restarting": false,
            "OOMKilled": false,
            "Dead": false,
            "Pid": 3275,
            "ExitCode": 0,
            "Error": "",
            "StartedAt": "2023-10-24T19:40:12.363841649Z",
            "FinishedAt": "0001-01-01T00:00:00Z"
        },
...
]</code></pre></div></div></div></div></div></section><section id="comment_exploiter_le_json"><h2>Comment exploiter le JSON ?</h2><div class="slide-content"><div class="paragraph"><p>JQ est le meilleur outil pour parser du JSON dans le shell</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container inspect my-web | jq .</code></pre></div></div>
<div class="paragraph fragment"><p>Les <a href="https://pkg.go.dev/text/template">templates de GO</a> peuvent être utilisés directement</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container inspect --format '{{json .Created }}' my-web</code></pre></div></div></div></section><section id="travaux_pratiques_6"><h2>🎓 Travaux pratiques #6</h2><div class="slide-content"><div class="paragraph"><p>Étapes:</p></div>
<div class="ulist"><ul><li class="fragment"><p>Lancer un container HTTPd</p></li><li class="fragment"><p>Trouver la syntaxe permettant d&#8217;extraire le "CMD" qui a été passé au démarrage du container</p></li><li class="fragment"><p>Trouver une seconde méthode pour faire la même chose</p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>On démarre un container nginx avec la commande</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Here we're using the 'docker container run' command to start a new Docker container.
# The '--detach' option tells Docker to run the container in the background and print the container ID.
# The '--name' option allows us to give our container a custom name, in this case 'my-web'.
# Finally, 'nginx' is the name of the Docker image we want to use to create the container.
# So, to sum up, this command will start a new Docker container in the background, using the 'nginx' image, and name it 'my-web'.
docker container run --detach --name my-web nginx</code></pre></div></div>
<div class="paragraph"><p>Une solution facile est de faire:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># In this command, we're using 'docker container inspect' to get detailed information about our 'my-web' container.
# The '--format' option allows us to specify the output format. Here, we're using the Go template '{{json .Config.Cmd }}' to get the command used to start the container in JSON format.
# We then pipe this JSON output to 'jq', a powerful command-line JSON processor.
# The '.' in 'jq .' tells 'jq' to take the input JSON and output it as is, effectively pretty-printing it.
# So, to sum up, this command will give us the command used to start the 'my-web' container, in a pretty-printed JSON format.
docker container inspect --format '{{json .Config.Cmd }}' my-web | jq .</code></pre></div></div>
<div class="paragraph"><p>Ça nous donne:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">[
  "nginx",
  "-g",
  "daemon off;"
]</code></pre></div></div>
<div class="paragraph"><p>Qu&#8217;on pourrait nettoyer pour avoir <code>nginx -g daemon off;</code> avec:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># This command is a symphony in three parts. First, we're using 'docker container inspect' to get detailed information about our 'my-web' container.
# The '--format' option allows us to specify the output format. Here, we're using the Go template '{{json .Config.Cmd }}' to get the command used to start the container in JSON format.
# We then pipe this JSON output to 'jq', a powerful command-line JSON processor. The '-r' option tells 'jq' to output raw strings instead of JSON-encoded strings, and '.[]' tells 'jq' to output the elements of the array.
# But we're not done yet. We then pipe this output to 'tr', which replaces the newlines with spaces, giving us a neat, single-line command.
# So, to sum up, this command will give us the command used to start the 'my-web' container, as a single line of text.
docker container inspect --format '{{json .Config.Cmd }}' my-web | jq -r '.[]' | tr '\n' ' '</code></pre></div></div>
<div class="paragraph"><p>qui donne <code>nginx -g daemon off;</code>.</p></div>
<div class="paragraph"><p>Une autre solution serait:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># This command is using 'docker container ls' to list our Docker containers. The '--filter' option allows us to only show containers with the name 'my-web', and '--no-trunc' prevents Docker from truncating the output.
# We then pipe this output to 'awk', a powerful text processing tool. 'NR==1 {cmd=index($0, "COMMAND"); created=index($0, "CREATED")}' tells 'awk' to find the positions of the 'COMMAND' and 'CREATED' headers in the first line of the output.
# 'NR&gt;1 {print substr($0, cmd, created-cmd)}' then tells 'awk' to print the substring from the start of the 'COMMAND' field to the start of the 'CREATED' field for the rest of the lines.
# So, to sum up, this command will give us the command used to start the 'my-web' container, extracted from the output of 'docker container ls'.
docker container ls --filter "name=my-web" --no-trunc | awk 'NR==1 {cmd=index($0, "COMMAND"); created=index($0, "CREATED")} NR&gt;1 {print substr($0, cmd, created-cmd)}'</code></pre></div></div>
<div class="paragraph"><p>qui donnerait <code>"/docker-entrypoint.sh nginx -g 'daemon off;'"</code>.</p></div></aside></div></section><section id="solution_travaux_pratiques_6" data-auto-animate><h2>✅ Solution Travaux Pratiques #6</h2><div class="slide-content"><div class="paragraph"><p>On démarre un container nginx avec la commande</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Here we're using the 'docker container run' command to start a new Docker container.
# The '--detach' option tells Docker to run the container in the background and print the container ID.
# The '--name' option allows us to give our container a custom name, in this case 'my-web'.
# Finally, 'nginx' is the name of the Docker image we want to use to create the container.
# So, to sum up, this command will start a new Docker container in the background, using the 'nginx' image, and name it 'my-web'.
docker container run --detach --name my-web nginx</code></pre></div></div>
<div class="paragraph fragment"><p>Une solution facile est de faire:</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># In this command, we're using 'docker container inspect' to get detailed information about our 'my-web' container.
# The '--format' option allows us to specify the output format. Here, we're using the Go template '{{json .Config.Cmd }}' to get the command used to start the container in JSON format.
# We then pipe this JSON output to 'jq', a powerful command-line JSON processor.
# The '.' in 'jq .' tells 'jq' to take the input JSON and output it as is, effectively pretty-printing it.
# So, to sum up, this command will give us the command used to start the 'my-web' container, in a pretty-printed JSON format.
docker container inspect --format '{{json .Config.Cmd }}' my-web | jq .</code></pre></div></div>
<div class="paragraph fragment"><p>Ça nous donne:</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">[
  "nginx",
  "-g",
  "daemon off;"
]</code></pre></div></div></div></section><section id="solution_travaux_pratiques_6_2" data-auto-animate><h2>✅ Solution Travaux Pratiques #6</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">[
  "nginx",
  "-g",
  "daemon off;"
]</code></pre></div></div>
<div class="paragraph"><p>Qu&#8217;on pourrait nettoyer pour avoir <code>nginx -g daemon off;</code> avec:</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># This command is a symphony in three parts. First, we're using 'docker container inspect' to get detailed information about our 'my-web' container.
# The '--format' option allows us to specify the output format. Here, we're using the Go template '{{json .Config.Cmd }}' to get the command used to start the container in JSON format.
# We then pipe this JSON output to 'jq', a powerful command-line JSON processor. The '-r' option tells 'jq' to output raw strings instead of JSON-encoded strings, and '.[]' tells 'jq' to output the elements of the array.
# But we're not done yet. We then pipe this output to 'tr', which replaces the newlines with spaces, giving us a neat, single-line command.
# So, to sum up, this command will give us the command used to start the 'my-web' container, as a single line of text.
docker container inspect --format '{{json .Config.Cmd }}' my-web | jq -r '.[]' | tr '\n' ' '</code></pre></div></div>
<div class="paragraph fragment"><p>qui donne <code>nginx -g daemon off;</code>.</p></div>
<div class="paragraph fragment"><p>Une autre solution serait:</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># This command is using 'docker container ls' to list our Docker containers. The '--filter' option allows us to only show containers with the name 'my-web', and '--no-trunc' prevents Docker from truncating the output.
# We then pipe this output to 'awk', a powerful text processing tool. 'NR==1 {cmd=index($0, "COMMAND"); created=index($0, "CREATED")}' tells 'awk' to find the positions of the 'COMMAND' and 'CREATED' headers in the first line of the output.
# 'NR&gt;1 {print substr($0, cmd, created-cmd)}' then tells 'awk' to print the substring from the start of the 'COMMAND' field to the start of the 'CREATED' field for the rest of the lines.
# So, to sum up, this command will give us the command used to start the 'my-web' container, extracted from the output of 'docker container ls'.
docker container ls --filter "name=my-web" --no-trunc | awk 'NR==1 {cmd=index($0, "COMMAND"); created=index($0, "CREATED")} NR&gt;1 {print substr($0, cmd, created-cmd)}'</code></pre></div></div></div></section><section id="solution_travaux_pratiques_6_3" data-auto-animate><h2>✅ Solution Travaux Pratiques #6</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># This command is using 'docker container ls' to list our Docker containers. The '--filter' option allows us to only show containers with the name 'my-web', and '--no-trunc' prevents Docker from truncating the output.
# We then pipe this output to 'awk', a powerful text processing tool. 'NR==1 {cmd=index($0, "COMMAND"); created=index($0, "CREATED")}' tells 'awk' to find the positions of the 'COMMAND' and 'CREATED' headers in the first line of the output.
# 'NR&gt;1 {print substr($0, cmd, created-cmd)}' then tells 'awk' to print the substring from the start of the 'COMMAND' field to the start of the 'CREATED' field for the rest of the lines.
# So, to sum up, this command will give us the command used to start the 'my-web' container, extracted from the output of 'docker container ls'.
docker container ls --filter "name=my-web" --no-trunc | awk 'NR==1 {cmd=index($0, "COMMAND"); created=index($0, "CREATED")} NR&gt;1 {print substr($0, cmd, created-cmd)}'</code></pre></div></div>
<div class="paragraph fragment"><p>qui donnerait <code>"/docker-entrypoint.sh nginx -g 'daemon off;'"</code>.</p></div>
<aside class="notes"><div class="paragraph"><p>Dans le contexte de l&#8217;utilisation de la commande docker inspect ou docker ps, l&#8217;une des principales différences entre ENTRYPOINT et CMD réside dans leur rôle et leur impact sur la visibilité des informations.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p><strong>ENTRYPOINT</strong> :
Lorsque vous utilisez docker inspect ou docker ps pour examiner un conteneur qui utilise ENTRYPOINT, vous verrez que ENTRYPOINT apparaît en tant que commande principale du conteneur. Cela signifie que l&#8217;entrée principale de l&#8217;application, généralement un exécutable ou un script, est affichée.
Les options et les arguments passés en ligne de commande lors du lancement du conteneur sont ajoutés après l&#8217;entrée principale, comme des arguments à cette commande.
Si un ENTRYPOINT est défini, la commande spécifiée en utilisant docker run est ignorée.</p></li><li><p><strong>CMD</strong> :
Lorsque vous utilisez docker inspect ou docker ps pour examiner un conteneur qui utilise CMD, vous verrez que la commande CMD est répertoriée sous forme d&#8217;argument pour /bin/sh -c, ce qui signifie qu&#8217;elle est exécutée par le shell par défaut du conteneur.
Les options et les arguments passés en ligne de commande lors du lancement du conteneur remplacent la commande CMD.
Vous pouvez également ajouter des arguments supplémentaires à la commande CMD en utilisant docker run.</p></li></ol></div>
<div class="paragraph"><p>En résumé, ENTRYPOINT est généralement utilisé pour spécifier la commande principale de l&#8217;application dans le conteneur, et les arguments fournis lors du lancement du conteneur sont traités comme des arguments pour cette commande. En revanche, CMD est utilisé pour spécifier une commande par défaut qui peut être écrasée en passant d&#8217;autres commandes lors du lancement du conteneur. L&#8217;utilisation de l&#8217;un ou de l&#8217;autre dépend des besoins spécifiques de votre application et de la manière dont vous souhaitez gérer la personnalisation des commandes dans vos conteneurs.</p></div></aside></div></section><section id="trouver_son_container_en_réseau"><h2>🌐 Trouver son container en réseau</h2><div class="slide-content"><div class="imageblock"><img src="media/1233103020-image17.jpeg" alt="1233103020 image17"></div></div></section><section id="le_container_en_réseau"><h2>🌐 Le Container en réseau</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run --detach nginx
bd12c4d7110d17ce80...`</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container ls
CONTAINERID     IMAGE   COMMAND      CREATED    STATUS    PORTS
bd12c4d71       nginx   "nginx …"    35 s. ago  Up 33 s.  80/tcp, 443/tcp</code></pre></div></div>
<div class="paragraph fragment"><p>Ok, mon container expose un service sur les ports <code>TCP 80</code> et <code>443</code> mais j&#8217;appelle comment mon Nginx ?</p></div></div></section><section id="que_nous_dit_docker_container_inspect" data-auto-animate><h2>🔍 Que nous dit docker container inspect ?</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">"Networks": {
                "bridge": {
                    "IPAMConfig": null,
                    "Links": null,
                    "Aliases": null,
                    "NetworkID": "c0fcec43e3e8…eecd6558ac0870a468a3",
                    "EndpointID": "0ec8fb237a10e9227359b4…db23edc32",
                    "Gateway": "172.17.0.1",
                    "IPAddress": "172.17.0.2",
                    "IPPrefixLen": 16,
                    "IPv6Gateway": "",
                    "GlobalIPv6Address": "",
                    "GlobalIPv6PrefixLen": 0,
                    "MacAddress": "02:42:ac:11:00:02",
                    "DriverOpts": null
                }
            }</code></pre></div></div></div></section><section id="que_nous_dit_docker_container_inspect_2" data-auto-animate><h2>🔍 Que nous dit docker container inspect ?</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output66_with_transparency.png" alt="fichiers output66 with transparency" height="500"></div></div></section><section id="que_nous_dit_docker_container_inspect_3" data-auto-animate><h2>🔍 Que nous dit docker container inspect ?</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output67_with_transparency.png" alt="fichiers output67 with transparency" height="500"></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container inspect --format "{{.NetworkSettings.IPAddress}}" &lt;ContainerID&gt;</code></pre></div></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {66..67}; do convert Diapositive${i}.PNG -crop 9519x5022+1833+1472 -transparent white -resize x1080 fichiers-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="et_voilà"><h2>Et voilà !</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">curl -I --noproxy '*' http://172.17.0.2:80
HTTP/1.1 200 OK
....
`Server: nginx/1.25 ...
`</code></pre></div></div>
<div class="paragraph"><p>Il est maintenant facile d&#8217;interagir avec notre serveur web !</p></div></div></section><section id="mapping_de_port" data-auto-animate><h2>🗺️ Mapping de Port</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output71_with_transparency.png" alt="fichiers output71 with transparency"></div></div></section><section id="mapping_de_port_2" data-auto-animate><h2>🗺️ Mapping de Port</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output72_with_transparency.png" alt="fichiers output72 with transparency"></div></div></section><section id="mapping_de_port_3" data-auto-animate><h2>🗺️ Mapping de Port</h2><div class="slide-content"><div class="imageblock"><img src="media/fichiers-output73_with_transparency.png" alt="fichiers output73 with transparency"></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">curl -I --noproxy '*' http://172.17.0.2:80</code></pre></div></div></div></section><section id="mapping_de_port_4" data-auto-animate><h2>🗺️ Mapping de Port</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">curl -I --noproxy '*' http://172.17.0.2:80
HTTP/1.1 200 OK
Server: nginx/1.25.2
Date: Wed, 18 Oct 2023 11:54:49 GMT
Content-Type: text/html
Content-Length: 284237
Last-Modified: Tue, 10 Oct 2023 12:12:13 GMT
Connection: keep-alive
ETag: "65253f9d-4564d"
Accept-Ranges: bytes</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">$ curl -I --noproxy '*' http://localhost:8000`
HTTP/1.1 200 OK
Server: nginx/1.25.2
Date: Wed, 18 Oct 2023 11:57:25 GMT
Content-Type: text/html
Content-Length: 284237
Last-Modified: Tue, 10 Oct 2023 12:12:13 GMT
Connection: keep-alive
ETag: "65253f9d-4564d"
Accept-Ranges: bytes</code></pre></div></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {71..73}; do convert Diapositive${i}.PNG -crop 10146x4801+2250+1833 -transparent white -resize x1080 fichiers-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="travaux_pratiques_7"><h2>🎓 Travaux pratiques #7</h2><div class="slide-content"><div class="paragraph"><p>Étapes:</p></div>
<div class="ulist"><ul><li class="fragment"><p>Créer un fichier HTML et le distribuer à partir d&#8217;un container <code>nginx</code></p></li><li class="fragment"><p>Récupérer un war sur Gitlab et le déployer dans un container <code>wildfly (<a href="https://gitlab.univ-artois.fr/bruno.verachten/devops-docker-tp07/-/raw/master/sample.war" class="bare">https://gitlab.univ-artois.fr/bruno.verachten/devops-docker-tp07/-/raw/master/sample.war</a>)</code></p></li><li class="fragment"><p>Récupérer le code sur <a href="https://spring.io/guides/gs/spring-boot/" class="bare">https://spring.io/guides/gs/spring-boot/</a> et faire tourner l&#8217;appli (sous répertoire <code>complete</code>)</p></li></ul></div></div></section><section id="solution_travaux_pratiques_7" data-auto-animate><h2>✅ Solution travaux pratiques #7</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-html hljs" data-noescape="true" data-lang="html">&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;header&gt;
&lt;title&gt;http://info.cern.ch&lt;/title&gt;
&lt;/header&gt;

&lt;h1&gt;http://info.cern.ch - home of the first website&lt;/h1&gt;
&lt;p&gt;From here you can:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://info.cern.ch/hypertext/WWW/TheProject.html"&gt;Browse the first website&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://line-mode.cern.ch/www/hypertext/WWW/TheProject.html"&gt;Browse the first website using the line-mode browser simulator&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://home.web.cern.ch/topics/birth-web"&gt;Learn about the birth of the web&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://home.web.cern.ch/about"&gt;Learn about CERN, the physics laboratory where the web was born&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/body&gt;&lt;/html&gt;</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker run --name my-nginx -v /fully/qualified/path/on/my/computer/:/usr/share/nginx/html:ro -d -p 8000:80 nginx</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">curl --noproxy '*' http://localhost:8000
&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;header&gt;
&lt;title&gt;http://info.cern.ch&lt;/title&gt;
&lt;/header&gt;

&lt;h1&gt;http://info.cern.ch - home of the first website&lt;/h1&gt;
&lt;p&gt;From here you can:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://info.cern.ch/hypertext/WWW/TheProject.html"&gt;Browse the first website&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://line-mode.cern.ch/www/hypertext/WWW/TheProject.html"&gt;Browse the first website using the line-mode browser simulator&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://home.web.cern.ch/topics/birth-web"&gt;Learn about the birth of the web&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://home.web.cern.ch/about"&gt;Learn about CERN, the physics laboratory where the web was born&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/body&gt;&lt;/html&gt;</code></pre></div></div></div></section><section id="solution_travaux_pratiques_7_2" data-auto-animate><h2>✅ Solution travaux pratiques #7</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">wget https://gitlab.univ-artois.fr/bruno.verachten/devops-docker-tp07/-/raw/master/sample.war</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Used to run a Docker container with the name "wildfly-container" using the "jboss/wildfly" image. The container is
# configured to expose ports 8080 and 9990 on the host machine, which will be mapped to the corresponding ports inside
# the container. Additionally, a volume is mounted to the container, linking the
# "/fully/qualified/path/on/my/computer/sample.war" file to "/opt/jboss/wildfly/standalone/deployments/sample.war"
# path within the container. This allows the WildFly server running inside the container to access and deploy the
# "sample.war" file. The "-d" flag is used to run the container in detached mode, meaning it will run in the
# background.
docker run -d -p 8080:8080 -p 9990:9990 --name wildfly-container -v /fully/qualified/path/on/my/computer/sample.war:/opt/jboss/wildfly/standalone/deployments/sample.war jboss/wildfly</code></pre></div></div>
<div class="paragraph fragment"><p>Visitez avec votre navigateur <code><a href="http://localhost:8080/sample/" class="bare">http://localhost:8080/sample/</a></code>.</p></div></div></section><section id="solution_travaux_pratiques_7_3" data-auto-animate><h2>✅ Solution travaux pratiques #7</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">git clone https://github.com/spring-guides/gs-spring-boot.git</code></pre></div></div>
<div class="paragraph"><p>C&#8217;est un début&#8230;&#8203;</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">cd gs-spring-boot/complete</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">mvn package</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">java -jar target/spring-boot-complete-0.0.1-SNAPSHOT.jar</code></pre></div></div>
<div class="paragraph fragment"><p>Ok, il y a de l&#8217;idée&#8230;&#8203;</p></div></div></section><section id="solution_travaux_pratiques_7_4" data-auto-animate><h2>✅ Solution travaux pratiques #7</h2><div class="slide-content"><div class="paragraph"><p>Assemblons tout ça dans un <code>Dockerfile</code>.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile"># Use a Maven image for building the application
FROM maven:3.9.8-eclipse-temurin-22-alpine
WORKDIR /app

# Clone the Spring Boot application repository
RUN apk add git &amp;&amp; git clone https://github.com/spring-guides/gs-spring-boot.git

# Change directory to the application's complete directory
WORKDIR /app/gs-spring-boot/complete

# Build the application using Maven
RUN mvn package

WORKDIR /app/gs-spring-boot/complete/target

# Command to run the Spring Boot application
CMD ["java", "-jar", "spring-boot-complete-0.0.1-SNAPSHOT.jar"]</code></pre></div></div>
<div class="paragraph fragment"><p>Spoiler alert: le nom de fichier donne une indication&#8230;&#8203;</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker build -t spring-boot-app --file Dockerfile.ugly .</code></pre></div></div>
<div class="paragraph fragment"><p>Et logiquement&#8230;&#8203;</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker run -d -p 8080:8080 --name spring-boot-container spring-boot-app</code></pre></div></div></div></section><section id="attends_un_peu"><h2>⏳ Attends un peu…</h2><div class="slide-content"><div class="imageblock"><img src="media/1779074283-image19.gif" alt="1779074283 image19"></div>
<div class="paragraph"><p><em>Ça fonctionne, mais c&#8217;est comme si  je laissais la grue dans la chambre une fois que j&#8217;avais fini de construire ma maison !</em></p></div></div></section><section id="solution_travaux_pratiques_7_5" data-auto-animate><h2>✅ Solution travaux pratiques #7</h2><div class="slide-content"><div class="paragraph"><p>On essaye un <code>Dockerfile</code> moins BTP?</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile"># Use a Maven image for building the application
FROM maven:3.9.8-eclipse-temurin-22-alpine AS build
WORKDIR /app

# Clone the Spring Boot application repository
RUN apk add git &amp;&amp; git clone https://github.com/spring-guides/gs-spring-boot.git

# Change directory to the application's complete directory
WORKDIR /app/gs-spring-boot/complete

# Build the application using Maven
RUN mvn package

# Use a lightweight Java image for running the application
FROM eclipse-temurin:24_36-jre-alpine
WORKDIR /app

# Copy the built JAR file from the previous build stage
COPY --from=build /app/gs-spring-boot/complete/target/spring-boot-complete-0.0.1-SNAPSHOT.jar ./

# Command to run the Spring Boot application
CMD ["java", "-jar", "spring-boot-complete-0.0.1-SNAPSHOT.jar"]</code></pre></div></div>
<div class="paragraph fragment"><p>Le multistage, c&#8217;est la classe à Arras.
On en reparle après.</p></div></div></section><section id="une_première_solution"><h2>🧩 Une première solution</h2><div class="slide-content"><div class="paragraph"><p>Avec un autre exemple&#8230;&#8203;
Une image pour construire l&#8217;appli:</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM golang:1.24

WORKDIR /go/src/github.com/alexellis/href-counter/

COPY go.mod .
COPY go.sum .
COPY app.go	.


RUN CGO_ENABLED=0 GOOS=linux go build  -ldflags "-s -w" -o app .</code></pre></div></div>
<div class="paragraph fragment"><p>Une image pour faire tourner l&#8217;appli</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM alpine:3.21.3
RUN apk --no-cache add ca-certificates

WORKDIR /root/

COPY app    .

CMD ["./app"]</code></pre></div></div>
<aside class="notes"><div class="paragraph"><p>De base, j&#8217;avais plutôt</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">link:https://raw.githubusercontent.com/alexellis/href-counter/master/Dockerfile.build[role=include]</code></pre></div></div>
<div class="paragraph fragment"><p>Une image pour faire tourner l&#8217;appli</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">link:https://raw.githubusercontent.com/alexellis/href-counter/master/Dockerfile[role=include]</code></pre></div></div>
<div class="paragraph"><p>À bosser pour pouvoir rester à jour</p></div></aside></div></section><section id="une_première_solution_2" data-auto-animate><h2>🧩 Une première solution</h2><div class="slide-content"><div class="paragraph"><p>Avec un autre exemple</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">#!/bin/sh
echo Building alexellis2/href-counter:build

docker image build --build-arg https_proxy=$https_proxy --build-arg http_proxy=$http_proxy \
    -t alexellis2/href-counter:build . -f Dockerfile.build
docker container create --name extract alexellis2/href-counter:build
docker container cp extract:/go/src/github.com/alexellis/href-counter/app ./app
docker container rm -f extract

echo Building alexellis2/href-counter:latest
docker image build --no-cache -t alexellis2/href-counter:latest .
rm ./app</code></pre></div></div></div></section><section id="une_première_solution_3" data-auto-animate><h2>🧩 Une première solution</h2><div class="slide-content"><div class="paragraph"><p>Avec un autre exemple</p></div>
<div class="imageblock"><img src="media/fichiers-output81_with_transparency.png" alt="fichiers output81 with transparency" height="500"></div></div></section><section id="une_première_solution_4" data-auto-animate><h2>🧩 Une première solution</h2><div class="slide-content"><div class="paragraph"><p>Avec un autre exemple</p></div>
<div class="imageblock"><img src="media/fichiers-output82_with_transparency.png" alt="fichiers output82 with transparency" height="500"></div></div></section><section id="une_première_solution_5" data-auto-animate><h2>🧩 Une première solution</h2><div class="slide-content"><div class="paragraph"><p>Avec un autre exemple</p></div>
<div class="imageblock"><img src="media/fichiers-output83_with_transparency.png" alt="fichiers output83 with transparency" height="500"></div></div></section><section id="une_première_solution_6" class="columns" data-auto-animate><h2>🧩 Une première solution</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="paragraph"><p>Avec un autre exemple</p></div>
<div class="imageblock"><img src="media/fichiers-output83_with_transparency.png" alt="fichiers output83 with transparency"></div></div></div>
<div class="openblock column"><div class="content"><div class="imageblock"><img src="media/1956754704-image20.jpeg" alt="1956754704 image20"></div></div></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {81..84}; do convert Diapositive${i}.PNG -crop 8940x4930+2182+1700 -transparent white -resize x1080 fichiers-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="multistage_build" data-auto-animate><h2>🪜 Multistage build</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM golang:1.19

WORKDIR /go/src/github.com/alexellis/href-counter/

COPY go.mod .
COPY go.sum .
COPY app.go	.

RUN CGO_ENABLED=0 GOOS=linux go build  -ldflags "-s -w" -o app .

FROM alpine:3.17.1
RUN apk --no-cache add ca-certificates

WORKDIR /root/

COPY --from=0 /go/src/github.com/alexellis/href-counter/app    .

CMD ["./app"]</code></pre></div></div>
<aside class="notes"><div class="paragraph"><p>J&#8217;aurais préféré:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">link:https://raw.githubusercontent.com/alexellis/href-counter/master/Dockerfile.multi[role=include]</code></pre></div></div></aside></div></section><section id="multistage_build_2" data-auto-animate><h2>🪜 Multistage build</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM golang:1.19

WORKDIR /go/src/github.com/alexellis/href-counter/

COPY go.mod .
COPY go.sum .
COPY app.go	.

RUN CGO_ENABLED=0 GOOS=linux go build  -ldflags "-s -w" -o app .

FROM alpine:3.17.1
RUN apk --no-cache add ca-certificates

WORKDIR /root/

COPY --from=0 /go/src/github.com/alexellis/href-counter/app    .

CMD ["./app"]</code></pre></div></div>
<div class="paragraph"><p>On copie les fichiers depuis le premier stage</p></div></div></section><section id="les_containers" class="columns"><h2>📦 LES CONTAINERS</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="paragraph"><p>Le bilan : achievement unlocked</p></div>
<div class="paragraph"><p>Vous savez désormais:</p></div>
<div class="ulist"><ul><li class="fragment"><p>Maîtriser le cycle de vie des containers</p></li><li class="fragment"><p>Interagir avec les containers existants</p></li><li class="fragment"><p>Nommer les containers</p></li><li class="fragment"><p>Inspecter les containers</p></li><li class="fragment"><p>Appeler les containers</p></li><li class="fragment"><p>Obtenir des containers légers</p></li></ul></div></div></div>
<div class="openblock column"><div class="content"><div class="imageblock"><img src="media/1706694417-image21.png" alt="1706694417 image21"></div></div></div></div></section></section>
<section><section id="les_volumes"><h2>Les volumes</h2><div class="slide-content"><div class="imageblock"><img src="media/1300236655-image2.jpeg" alt="1300236655 image2"></div></div></section><section id="3_types_de_gestion_de_données" data-auto-animate><h2>🔴🔵🟢 3 types de gestion de données</h2><div class="slide-content"><div class="imageblock"><img src="media/3_types_gestions_donnees.png" alt="3 types gestions donnees" height="600"></div>
<aside class="notes"><div class="paragraph"><p>Vue d&#8217;ensemble des trois types de gestion des données couramment utilisés dans Docker :</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Mapping de Système de Fichiers (Filesystem Mapping) :
<strong>Description</strong> : Le mappage de système de fichiers consiste à partager un répertoire de votre système hôte avec un conteneur Docker.
Cela permet au conteneur d&#8217;accéder et de modifier des fichiers dans ce répertoire.
<strong>Utilisation</strong> : Utile pour partager des fichiers ou des données de configuration avec un conteneur.
Les données sont stockées sur le système hôte, mais sont accessibles depuis le conteneur.
<strong>Exemple</strong> : <code>docker container run -v /chemin/du/systeme/hote:/chemin/dans/le/conteneur</code></p></li><li><p>Volumes :
<strong>Description</strong> : Les volumes sont un mécanisme de stockage persistant qui permet de stocker des données en dehors du système de fichiers du conteneur.
Ils sont gérés par Docker et offrent une plus grande flexibilité que le simple mappage de système de fichiers.
<strong>Utilisation</strong> : Idéaux pour stocker des données qui doivent survivre à l&#8217;arrêt ou à la suppression d&#8217;un conteneur.
Les volumes sont indépendants du cycle de vie du conteneur.
<strong>Exemple</strong> : <code>docker run -v nom_du_volume:/chemin/dans/le/conteneur</code></p></li><li><p>Système de Fichiers RAM (RAM Filesystem) :
<strong>Description</strong> : Il s&#8217;agit d&#8217;un système de fichiers temporaire stocké en mémoire RAM.
Les données sont stockées de manière éphémère, ce qui signifie qu&#8217;elles sont perdues lorsque le conteneur est arrêté.
<strong>Utilisation</strong> : Utile lorsque des données temporaires doivent être stockées en mémoire pour des performances élevées.
Les données n&#8217;existent que tant que le conteneur est en cours d&#8217;exécution.
<strong>Exemple</strong> : <code>docker run --tmpfs /chemin/dans/le/conteneur</code></p></li></ol></div>
<div class="paragraph"><p>En résumé, ces trois méthodes de gestion des données en Docker offrent des avantages différents en fonction des besoins spécifiques d&#8217;un conteneur. Le mappage de système de fichiers est utile pour partager des fichiers depuis le système hôte, les volumes sont idéaux pour la persistance des données, tandis que les systèmes de fichiers RAM sont parfaits pour des données temporaires à haute performance.</p></div></aside></div></section><section id="3_types_de_gestion_de_données_2" class="columns" data-auto-animate><h2>🔴🔵🟢 3 types de gestion de données</h2><div class="slide-content"><div class="openblock column is-one-third"><div class="content"><div class="imageblock"><img src="media/mapping_fs.png" alt="mapping fs"></div></div></div>
<div class="openblock column"><div class="content"><div class="paragraph"><p>Partage d&#8217;un répertoire de votre système hôte avec un conteneur Docker.</p></div>
<div class="ulist"><ul><li class="fragment"><p>Utile pour partager des fichiers ou des données de configuration avec un conteneur.</p></li><li class="fragment"><p>Données stockées sur le système hôte, mais accessibles depuis le conteneur.</p></li></ul></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run -v /chemin/du/systeme/hote:/chemin/dans/le/conteneur</code></pre></div></div></div></div>
<aside class="notes"><div class="olist arabic"><ol class="arabic"><li><p>Mapping de Système de Fichiers (Filesystem Mapping) :
<strong>Description</strong> : Le mappage de système de fichiers consiste à partager un répertoire de votre système hôte avec un conteneur Docker.
Cela permet au conteneur d&#8217;accéder et de modifier des fichiers dans ce répertoire.
<strong>Utilisation</strong> : Utile pour partager des fichiers ou des données de configuration avec un conteneur.
Les données sont stockées sur le système hôte, mais sont accessibles depuis le conteneur.
<strong>Exemple</strong> : <code>docker container run -v /chemin/du/systeme/hote:/chemin/dans/le/conteneur</code></p></li></ol></div></aside></div></section><section id="3_types_de_gestion_de_données_3" class="columns" data-auto-animate><h2>🔴🔵🟢 3 types de gestion de données</h2><div class="slide-content"><div class="openblock column is-one-third"><div class="content"><div class="imageblock"><img src="media/volumes.png" alt="volumes"></div></div></div>
<div class="openblock column"><div class="content"><div class="paragraph"><p>Stockage persistant &#8658; données en dehors du système de fichiers du conteneur.</p></div>
<div class="ulist"><ul><li class="fragment"><p>Utile pour stocker des données qui doivent survivre à l&#8217;arrêt ou à la suppression d&#8217;un conteneur.</p></li><li class="fragment"><p>Volumes indépendants du cycle de vie du conteneur.</p></li></ul></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run -v nom_du_volume:/chemin/dans/le/conteneur</code></pre></div></div></div></div>
<aside class="notes"><div class="paragraph"><p>Volumes :
<strong>Description</strong> : Les volumes sont un mécanisme de stockage persistant qui permet de stocker des données en dehors du système de fichiers du conteneur.
Ils sont gérés par Docker et offrent une plus grande flexibilité que le simple mappage de système de fichiers.
<strong>Utilisation</strong> : Idéaux pour stocker des données qui doivent survivre à l&#8217;arrêt ou à la suppression d&#8217;un conteneur.
Les volumes sont indépendants du cycle de vie du conteneur.
<strong>Exemple</strong> : <code>docker container run -v nom_du_volume:/chemin/dans/le/conteneur</code></p></div></aside></div></section><section id="3_types_de_gestion_de_données_4" class="columns" data-auto-animate><h2>🔴🔵🟢 3 types de gestion de données</h2><div class="slide-content"><div class="openblock column is-one-third"><div class="content"><div class="imageblock"><img src="media/fs_ram.png" alt="fs ram"></div></div></div>
<div class="openblock column"><div class="content"><div class="paragraph"><p>Système de fichiers temporaire stocké en RAM.</p></div>
<div class="ulist"><ul><li class="fragment"><p>Utile lorsque des données temporaires doivent être stockées en mémoire pour des performances élevées.</p></li><li class="fragment"><p>Les données n&#8217;existent que tant que le conteneur est en cours d&#8217;exécution.</p></li></ul></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run --tmpfs /chemin/dans/le/conteneur</code></pre></div></div></div></div>
<aside class="notes"><div class="paragraph"><p>Système de Fichiers RAM (RAM Filesystem) :
<strong>Description</strong> : Il s&#8217;agit d&#8217;un système de fichiers temporaire stocké en mémoire RAM.
Les données sont stockées de manière éphémère, ce qui signifie qu&#8217;elles sont perdues lorsque le conteneur est arrêté.
<strong>Utilisation</strong> : Utile lorsque des données temporaires doivent être stockées en mémoire pour des performances élevées.
Les données n&#8217;existent que tant que le conteneur est en cours d&#8217;exécution.
<strong>Exemple</strong> : <code>docker container run --tmpfs /chemin/dans/le/conteneur</code></p></div>
<div class="paragraph"><p>En résumé, ces trois méthodes de gestion des données en Docker offrent des avantages différents en fonction des besoins spécifiques d&#8217;un conteneur. Le mappage de système de fichiers est utile pour partager des fichiers depuis le système hôte, les volumes sont idéaux pour la persistance des données, tandis que les systèmes de fichiers RAM sont parfaits pour des données temporaires à haute performance.</p></div></aside></div></section><section id="3_types_de_gestion_de_données_5" data-auto-animate><h2>🔴🔵🟢 3 types de gestion de données</h2><div class="slide-content"><div class="imageblock"><img src="media/1329201553-image3.png" alt="1329201553 image3"></div></div></section><section id="mapping_de_filesystem"><h2>🗺️📂 Mapping de FileSystem</h2><div class="slide-content"><div class="imageblock"><img src="media/293990221-image4.png" alt="293990221 image4" height="600"></div></div></section><section id="mapping_de_filesystem_2"><h2>🗺️📂 Mapping de FileSystem</h2><div class="slide-content"><div class="paragraph"><p><strong><em>"Créer une image avec les sources de mon application web juste pour distribuer des ressources statiques via Apache ! Merci Docker !"</em></strong></p></div>
<div class="paragraph"><p>Un étudiant excédé</p></div>
<div class="imageblock"><img src="media/1105931517-image5.png" alt="1105931517 image5"></div></div></section><section id="mapping_de_filesystem_3"><h2>🗺️📂 Mapping de FileSystem</h2><div class="slide-content"><div class="imageblock"><img src="media/1771886276-image6.png" alt="1771886276 image6" width="1000"></div>
<div class="paragraph small"><small>Source : <a href="https://hub.docker.com/_/nginx" class="bare">https://hub.docker.com/_/nginx</a></small></div>
<div class="imageblock fragment"><img src="media/383920810-image7.png" alt="383920810 image7"></div></div></section><section id="mapping_de_filesystem_4"><h2>🗺️📂 Mapping de FileSystem</h2><div class="slide-content"><div class="paragraph"><p>Partage de dossier</p></div>
<div class="imageblock fragment"><img src="media/partage_dossier.png" alt="partage dossier"></div>
<div class="paragraph fragment"><p>Partage de fichier</p></div>
<div class="imageblock fragment"><img src="media/partage_fichier.png" alt="partage fichier"></div>
<div class="admonitionblock caution fragment"><table><tr><td class="icon"><i class="fa fa-fire" title="Caution"></i></td><td class="content">Le chemin dans la machine hôte doit être un chemin absolu !</td></tr></table></div>
<div class="admonitionblock warning fragment"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content">L&#8217;exemple ci-dessus ne peut donc pas fonctionner</td></tr></table></div></div></section><section id="les_volumes_2"><h2>📦📁 Les volumes</h2><div class="slide-content"><div class="imageblock"><img src="media/726805516-image8.png" alt="726805516 image8" height="600"></div></div></section><section id="les_volumes_3"><h2>📦📁 Les volumes</h2><div class="slide-content"><div class="paragraph"><p>Il est possible de créer des "espaces mémoire" que l&#8217;on peut mettre à disposition des containers.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker volume create --name my-data</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker run -v my-data:/data busybox ls /data</code></pre></div></div>
<div class="admonitionblock caution fragment"><table><tr><td class="icon"><i class="fa fa-fire" title="Caution"></i></td><td class="content"><strong>my_data</strong> n&#8217;est plus un chemin absolu, mais juste le nom du volume</td></tr></table></div></div></section><section id="les_volumes_4"><h2>📦📁 Les volumes</h2><div class="slide-content"><div class="paragraph"><p>Lister tous les volumes</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker volume ls</code></pre></div></div>
<div class="paragraph fragment"><p>Supprimer un volume</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker volume rm my-data</code></pre></div></div>
<div class="paragraph fragment"><p>Inspecter un volume</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker volume inspect my-data</code></pre></div></div></div></section><section id="les_volumes_anonymes"><h2>📦📁🕶️ Les volumes "anonymes"</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM alpine:3.21
WORKDIR /repertoire/travail
VOLUME ["/data"]
RUN echo hello &gt; ./world.txt</code></pre></div></div>
<div class="paragraph fragment"><p>Création d&#8217;un volume anonyme mappé sur le répertoire /data des containers basés sur cette image</p></div></div></section><section id="filesystem_en_ram" data-auto-animate><h2>💾🧠 FileSystem en RAM</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run
  -d
  --read-only
  --tmpfs /run/httpd
  --tmpfs /tmp
  httpd</code></pre></div></div>
<div class="admonitionblock caution fragment"><table><tr><td class="icon"><i class="fa fa-fire" title="Caution"></i></td><td class="content">Les données sont perdues à l&#8217;arrêt du container.</td></tr></table></div></div></section><section id="filesystem_en_ram_2" data-auto-animate><h2>💾🧠 FileSystem en RAM</h2><div class="slide-content"><div class="imageblock"><img src="media/volumes-output21_with_transparency.png" alt="volumes output21 with transparency"></div>
<div class="admonitionblock caution"><table><tr><td class="icon"><i class="fa fa-fire" title="Caution"></i></td><td class="content">Les données sont perdues à l&#8217;arrêt du container.</td></tr></table></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {21..22}; do convert Diapositive${i}.PNG -crop 9342x3359+2250+1652 -transparent white -resize x1080 volumes-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="filesystem_en_ram_3" data-auto-animate><h2>💾🧠 FileSystem en RAM</h2><div class="slide-content"><div class="imageblock"><img src="media/volumes-output22_with_transparency.png" alt="volumes output22 with transparency"></div>
<div class="admonitionblock caution"><table><tr><td class="icon"><i class="fa fa-fire" title="Caution"></i></td><td class="content">Les données sont perdues à l&#8217;arrêt du container.</td></tr></table></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {21..22}; do convert Diapositive${i}.PNG -crop 9342x3359+2250+1652 -transparent white -resize x1080 volumes-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="bilan_de_compétences" data-auto-animate><h2>📊📝 Bilan de compétences</h2><div class="slide-content"><div class="ulist"><ul><li><p>Création d&#8217;images</p></li><li><p>Création des containers</p><div class="ulist"><ul><li><p>cycle de vie</p></li><li><p>nommage</p></li><li><p>débug</p></li><li><p>réseau</p></li><li><p>volumes</p></li></ul></div></li></ul></div></div></section><section id="bilan_de_compétences_2" data-auto-animate><h2>📊📝 Bilan de compétences</h2><div class="slide-content"><div class="ulist"><ul><li><p>Création d&#8217;images ✅</p></li><li><p>Création des containers ✅</p><div class="ulist"><ul><li><p>cycle de vie ✅</p></li><li><p>nommage ✅</p></li><li><p>débug ✅</p></li><li><p>réseau  ✅</p></li><li><p>volumes ✅</p></li></ul></div></li></ul></div></div></section><section id="travaux_pratiques_8" data-auto-animate><h2>🎓 Travaux pratiques #8</h2><div class="slide-content"><div class="paragraph"><p>Lancer un container `nginx `et lui faire distribuer une page web externe au container.</p></div>
<div class="imageblock"><img src="media/1763880002-image10.png" alt="1763880002 image10"></div></div></section><section id="solution_travaux_pratiques_8" data-auto-animate><h2>✅ Solution travaux pratiques #8</h2><div class="slide-content"><div class="paragraph title"><p>En utilisant un montage de répertoire (Bind Mount) :</p></div>
<div class="paragraph fragment"><p>Utilisez un montage de répertoire pour mapper un répertoire de l&#8217;hôte vers le conteneur Nginx.</p></div>
<div class="paragraph fragment"><p>Placez vos fichiers HTML dans un répertoire sur votre machine hôte, puis mappez ce répertoire vers le conteneur Nginx.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run -d -p 80:80 --name mon-nginx -v /chemin/vers/la/page/web/sur/lhote:/usr/share/nginx/html nginx</code></pre></div></div>
<div class="paragraph fragment"><p>Remplacez <code>/chemin/vers/la/page/web/sur/lhote</code> par le chemin réel vers le répertoire contenant vos fichiers de la page web sur l&#8217;hôte.</p></div></div></section><section id="solution_travaux_pratiques_8_2" data-auto-animate><h2>✅ Solution travaux pratiques #8</h2><div class="slide-content"><div class="paragraph title"><p>En utilisant un volume nommé (Named Volume) :</p></div>
<div class="paragraph fragment"><p>Créez un volume nommé et copiez vos fichiers de la page web dedans.</p></div>
<div class="paragraph fragment"><p>Montez ce volume nommé dans le conteneur Nginx.</p></div>
<div class="paragraph fragment"><p>Tout d&#8217;abord, créez un volume nommé :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker volume create mon-nginx-html</code></pre></div></div>
<div class="paragraph fragment"><p>Copiez vos fichiers de la page web dans ce volume :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run --rm \
  --volume mon-nginx-html:/cible \   # Montez le volume nommé "mon-nginx-html" dans le conteneur sous le répertoire "/cible".
  --volume /chemin/vers/la/page/web/sur/lhote:/html \ # Montez le répertoire où se trouve le fichier html
  --workdir /cible \                # Définissez le répertoire de travail à "/cible" dans le conteneur.
  busybox cp -r /html .   # Copiez récursivement le contenu depuis "/chemin/vers/la/page/web/sur/lhote" dans le répertoire actuel du conteneur.</code></pre></div></div>
<div class="paragraph fragment"><p>Maintenant, lancez le conteneur Nginx et montez le volume nommé :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run -d -p 80:80 --name mon-nginx -v mon-nginx-html:/usr/share/nginx/html nginx</code></pre></div></div></div></section><section id="travaux_pratiques_9"><h2>🎓 Travaux pratiques #9</h2><div class="slide-content"><div class="paragraph title"><p>Étapes:</p></div>
<div class="ulist"><ul><li class="fragment"><p>Créer un volume nommé "data"</p></li><li class="fragment"><p>Démarrer un container attaché à ce volume</p></li><li class="fragment"><p>Lancer un processus qui écrit un fichier dans le volume</p></li><li class="fragment"><p>Démarrer un second container attaché à ce volume</p></li><li class="fragment"><p>Lire les données du volume depuis le second container</p></li><li class="fragment"><p>Supprimer le volume</p></li></ul></div></div></section><section id="solution_travaux_pratiques_9"><h2>✅ Solution travaux pratiques #9</h2><div class="slide-content"><div class="paragraph"><p>Créer un volume nommé "data" :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker volume create data</code></pre></div></div>
<div class="paragraph fragment"><p>Démarrer un premier conteneur attaché à ce volume :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run -it --name premier-container -v data:/donnees busybox</code></pre></div></div>
<div class="paragraph fragment"><p>Dans le premier conteneur, lancez un processus qui écrit un fichier dans le volume (par exemple, un fichier texte) :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">echo "Données du premier conteneur" &gt; /donnees/mon-fichier.txt</code></pre></div></div>
<div class="paragraph fragment"><p>Quittez le premier conteneur.</p></div>
<div class="paragraph fragment"><p>Démarrer un second conteneur attaché au même volume :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run -it --name second-container -v data:/donnees busybox</code></pre></div></div></div></section><section id="solution_travaux_pratiques_9_2"><h2>✅ Solution travaux pratiques #9</h2><div class="slide-content"><div class="paragraph"><p>Démarrer un second conteneur attaché au même volume :</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run -it --name second-container -v data:/donnees busybox</code></pre></div></div>
<div class="paragraph"><p>Dans le second conteneur, lisez les données du volume (le fichier texte) :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">cat /donnees/mon-fichier.txt</code></pre></div></div>
<div class="paragraph fragment"><p>Vous devriez voir le contenu du fichier affiché à l&#8217;écran.</p></div>
<div class="paragraph fragment"><p>Quittez le second conteneur.</p></div>
<div class="paragraph fragment"><p>Vous pouvez maintenant supprimer le volume "data" car vous n&#8217;en avez plus besoin :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker volume rm data</code></pre></div></div></div></section><section id="travaux_pratiques_10"><h2>🎓  Travaux pratiques #10</h2><div class="slide-content"><div class="paragraph"><p>Écrire un Dockerfile qui:</p></div>
<div class="ulist"><ul><li class="fragment"><p>Ajoute des fichiers dans un dossier</p></li><li class="fragment"><p>Déclare ce dossier comme volume anonyme</p></li><li class="fragment"><p>Ajoute d&#8217;autres fichiers dans ce dossier</p></li></ul></div>
<div class="paragraph fragment"><p><strong>Que verra-ton dans ce dossier au sein de nos containers ?</strong></p></div></div></section><section id="solution_travaux_pratiques_10" data-auto-animate><h2>✅ Solution travaux pratiques #10</h2><div class="slide-content"><div class="paragraph"><p>Tout d&#8217;abord, créez un répertoire pour votre projet et placez-vous dedans.</p></div>
<div class="paragraph fragment"><p>Créez un Dockerfile avec le contenu suivant :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM alpine:3.21

# Ajoutez des fichiers dans un dossier
RUN mkdir /mon-dossier
RUN echo "Contenu du fichier 1" &gt; /mon-dossier/fichier1.txt
RUN echo "Contenu du fichier 2" &gt; /mon-dossier/fichier2.txt

# Déclarez ce dossier comme un volume anonyme
VOLUME ["/mon-dossier"]

# Ajoutez d'autres fichiers dans ce dossier
RUN echo "Nouveau contenu du fichier 3" &gt; /mon-dossier/fichier3.txt</code></pre></div></div>
<div class="paragraph fragment"><p>Ensuite, vous pouvez créer une image Docker à partir de ce Dockerfile en exécutant la commande suivante dans le même répertoire que le Dockerfile :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker image build -t mon-image .</code></pre></div></div></div></section><section id="solution_travaux_pratiques_10_2" data-auto-animate><h2>✅ Solution travaux pratiques #10</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker image build -t mon-image .</code></pre></div></div>
<div class="paragraph"><p>Assurez-vous que "mon-image" est le nom que vous souhaitez donner à votre image Docker.
Après avoir créé l&#8217;image, vous pouvez exécuter un conteneur basé sur cette image :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run -it mon-image</code></pre></div></div>
<div class="paragraph fragment"><p>Lorsque vous êtes dans le conteneur, accédez au dossier /mon-dossier :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">cd /mon-dossier</code></pre></div></div>
<div class="paragraph fragment"><p>Vous verrez les fichiers "fichier1.txt", "fichier2.txt" et "fichier3.txt" dans ce dossier.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">ls</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">fichier1.txt  fichier2.txt  fichier3.txt</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">cat *</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">Contenu du fichier 1
Contenu du fichier 2
Nouveau contenu du fichier 3</code></pre></div></div></div></section><section id="solution_travaux_pratiques_10_3" data-auto-animate><h2>✅ Solution travaux pratiques #10</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">cat *</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">Contenu du fichier 1
Contenu du fichier 2
Nouveau contenu du fichier 3</code></pre></div></div>
<div class="paragraph fragment"><p>Vous devriez voir la liste des fichiers et leurs contenus.</p></div>
<div class="paragraph fragment"><p>Cela montre que les fichiers que vous avez ajoutés dans le dossier, même après avoir déclaré ce dossier comme un volume anonyme, restent accessibles dans le conteneur.</p></div>
<div class="paragraph fragment"><p>C&#8217;est ainsi que vous pouvez ajouter des fichiers dans un dossier, le déclarer comme un volume anonyme, puis ajouter d&#8217;autres fichiers dans ce dossier tout en y ayant accès à l&#8217;intérieur du conteneur.</p></div></div></section></section>
<section><section id="réseaux_et_docker"><h2>Réseaux et Docker</h2><div class="slide-content"><div class="paragraph title"><p>Interagir avec le Docker ENGINE</p></div><div class="imageblock"><img src="media/2375.png" alt="2375"></div></div></section><section id="interagir_avec_le_docker_engine" data-auto-animate><h2>🤝 Interagir avec le Docker Engine</h2><div class="slide-content"><div class="imageblock"><img src="media/reseaux-output2_with_transparency.png" alt="reseaux output2 with transparency" height="600"></div></div></section><section id="interagir_avec_le_docker_engine_2" data-auto-animate><h2>🤝 Interagir avec le Docker Engine</h2><div class="slide-content"><div class="imageblock"><img src="media/reseaux-output3_with_transparency.png" alt="reseaux output3 with transparency" height="600"></div></div></section><section id="interagir_avec_le_docker_engine_3" data-auto-animate><h2>🤝 Interagir avec le Docker Engine</h2><div class="slide-content"><div class="imageblock"><img src="media/reseaux-output4_with_transparency.png" alt="reseaux output4 with transparency" height="600"></div></div></section><section id="interagir_avec_le_docker_engine_4" data-auto-animate><h2>🤝 Interagir avec le Docker Engine</h2><div class="slide-content"><div class="imageblock"><img src="media/reseaux-output5_with_transparency.png" alt="reseaux output5 with transparency" height="600"></div>
<aside class="notes"><div class="paragraph"><p>La communication d&#8217;un navigateur avec le moteur Docker sur le port 2375 peut se faire via l&#8217;API Docker exposée sur ce port. Voici comment cela fonctionne :</p></div>
<div class="paragraph"><p>Exposer l&#8217;API Docker sur le port 2375 : Tout d&#8217;abord, pour permettre la communication du navigateur avec le moteur Docker, vous devez vous assurer que l&#8217;API Docker est exposée sur le port 2375. Vous pouvez spécifier cela lors de la configuration du moteur Docker. Par exemple, en utilisant l&#8217;option -H :</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">dockerd -H tcp://0.0.0.0:2375</code></pre></div></div>
<div class="paragraph"><p>Cela signifie que le moteur Docker écoutera les requêtes sur le port 2375.</p></div>
<div class="paragraph"><p>Utilisation de l&#8217;API Docker : Une fois que l&#8217;API Docker est exposée, vous pouvez effectuer des opérations Docker en utilisant des requêtes HTTP. Le navigateur peut envoyer des requêtes HTTP directement à l&#8217;adresse IP du serveur Docker et au port 2375.</p></div>
<div class="paragraph"><p>Par exemple, pour lister les conteneurs en cours d&#8217;exécution, vous pouvez utiliser une requête HTTP GET :</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http hljs" data-noescape="true" data-lang="http">GET http://adresse_ip_du_serveur_docker:2375/containers/json</code></pre></div></div>
<div class="paragraph"><p>Le serveur Docker répondra avec les détails des conteneurs en cours d&#8217;exécution au format JSON.</p></div>
<div class="paragraph"><p>Sécurité : Il est important de noter que l&#8217;exposition de l&#8217;API Docker sur un port non sécurisé peut présenter des risques de sécurité, car n&#8217;importe qui avec accès au port 2375 peut potentiellement contrôler le moteur Docker. Pour des raisons de sécurité, il est recommandé de limiter l&#8217;accès à l&#8217;API Docker en utilisant des mécanismes d&#8217;authentification, d&#8217;autorisation et de chiffrement.</p></div>
<div class="paragraph"><p>Outils tiers : En pratique, les navigateurs ne sont pas souvent utilisés pour interagir directement avec l&#8217;API Docker. Au lieu de cela, des outils tiers, des bibliothèques ou des clients Docker sont souvent utilisés pour simplifier les opérations Docker et fournir une couche de sécurité supplémentaire.</p></div></aside></div></section><section id="interagir_avec_le_docker_engine_5" data-auto-animate><h2>🤝 Interagir avec le Docker Engine</h2><div class="slide-content"><div class="imageblock"><img src="media/reseaux-output6_with_transparency.png" alt="reseaux output6 with transparency" height="600"></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {2..6}; do convert Diapositive${i}.PNG -crop 9004x5341+1968+1654 -transparent white -resize x1080 reseaux-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="ex_intégration_intellij" class="intellij background" data-background-image="media/intellij-docker.png" data-background-size="cover" data-background-position="left"><h2>Ex : intégration IntelliJ</h2></section><section id="les_réseaux_de_containers"><h2>Les réseaux de containers</h2><div class="slide-content"><div class="imageblock"><img src="media/1435904594-image8.png" alt="1435904594 image8"></div></div></section><section id="mapping_de_port_rappel" data-auto-animate><h2>🗺️🔀 Mapping de Port : Rappel</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run –d -p 8000:80 nginx</code></pre></div></div></div></section><section id="mapping_de_port_rappel_2" data-auto-animate><h2>🗺️🔀 Mapping de Port : Rappel</h2><div class="slide-content"><div class="imageblock"><img src="media/reseaux-output11_with_transparency.png" alt="reseaux output11 with transparency"></div></div></section><section id="mapping_de_port_rappel_3" data-auto-animate><h2>🗺️🔀 Mapping de Port : Rappel</h2><div class="slide-content"><div class="imageblock"><img src="media/reseaux-output12_with_transparency.png" alt="reseaux output12 with transparency"></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">curl -I --noproxy '*' http://172.17.0.2:80
It works!</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">curl -I --noproxy '*' http://localhost:8000
It works too!</code></pre></div></div>
<aside class="notes"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {11..12}; do convert Diapositive${i}.PNG -crop 8833x2599+2250+1833 -transparent white -resize x1080 reseaux-output${i}_with_transparency.png; done</code></pre></div></div></aside></div></section><section id="les_réseaux" data-auto-animate><h2>🌐 Les réseaux</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker network ls</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">NETWORK ID     NAME                                                             DRIVER    SCOPE
11b7af7b16e4   bridge                                                           bridge    local
1112832d205b   cours-devops-docker_default                                      bridge    local
7ab15cc28199   docker_volumes-backup-extension-desktop-extension_default        bridge    local
34caf4674478   host                                                             host      local
2a179c7be3b3   none                                                             null      local
0c577a792771   portainer_portainer-docker-extension-desktop-extension_default   bridge    local</code></pre></div></div>
<div class="imageblock fragment"><img src="media/les_réseaux.png" alt="les réseaux"></div>
<aside class="notes"><div class="paragraph"><p>Dans le contexte de la commande "docker network ls", la colonne "DRIVER" (pilote) fait référence au pilote réseau utilisé pour créer le réseau Docker. Voici quelques explications concernant les valeurs possibles de cette colonne :</p></div>
<div class="olist arabic"><ol class="arabic"><li><p><strong>Local (bridge)</strong> : Un réseau avec une portée "local" est généralement un réseau de pont (bridge).
Il n&#8217;est accessible qu&#8217;à l&#8217;intérieur de l&#8217;hôte Docker où il a été créé.
Les conteneurs connectés au même réseau local peuvent communiquer entre eux, mais ce réseau est isolé des autres hôtes Docker ou réseaux externes.</p></li><li><p><strong>Host (hôte)</strong> : Un réseau avec une portée "host" n&#8217;offre aucune isolation réseau, ce qui signifie qu&#8217;il est accessible depuis l&#8217;hôte où Docker est en cours d&#8217;exécution.
Les conteneurs sur ce réseau partagent la pile réseau de l&#8217;hôte et peuvent accéder directement aux ressources de l&#8217;hôte.</p></li><li><p><strong>Null (null)</strong> : Un réseau avec une portée "null" est un type de réseau qui ne fournit aucune connectivité.
C&#8217;est essentiellement un réseau sans portée, et il est utilisé pour les conteneurs qui n&#8217;ont pas besoin d&#8217;un accès réseau.</p></li></ol></div>
<div class="paragraph"><p>D&#8217;autres pilotes de réseau peuvent également être disponibles, en fonction de la configuration de Docker et des plugins installés.
Chaque pilote offre des fonctionnalités et des options de configuration spécifiques pour répondre aux besoins de divers cas d&#8217;utilisation.</p></div>
<div class="paragraph"><p>La colonne "DRIVER" vous permet de comprendre quel pilote réseau est associé à chaque réseau Docker et comment il fonctionne.
Elle joue un rôle essentiel dans la définition de la manière dont les conteneurs communiquent entre eux et avec le réseau externe.</p></div></aside></div></section><section id="les_réseaux_2" data-auto-animate><h2>🌐 Les réseaux</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker network ls</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">NETWORK ID     NAME                                                             DRIVER    SCOPE
11b7af7b16e4   bridge                                                           bridge    local
1112832d205b   cours-devops-docker_default                                      bridge    local
7ab15cc28199   docker_volumes-backup-extension-desktop-extension_default        bridge    local
34caf4674478   host                                                             host      local
2a179c7be3b3   none                                                             null      local
0c577a792771   portainer_portainer-docker-extension-desktop-extension_default   bridge    local</code></pre></div></div>
<div class="imageblock"><img src="media/les_réseaux.png" alt="les réseaux"></div>
<aside class="notes"><div class="paragraph"><p>Le terme "SCOPE" dans le contexte de "docker network ls" se réfère au domaine de validité du réseau Docker. Voici une explication en français :</p></div>
<div class="olist arabic"><ol class="arabic"><li><p><strong>Local</strong> : Lorsque vous voyez "local" dans la colonne "SCOPE", cela signifie que le réseau Docker a une portée locale.
Les réseaux ayant une portée locale sont accessibles uniquement sur l&#8217;hôte où ils ont été créés.
Les conteneurs sur cet hôte peuvent se connecter au réseau, mais ils ne peuvent pas le faire depuis d&#8217;autres hôtes.</p></li><li><p><strong>Global</strong> : En revanche, si vous voyez "global" dans la colonne "SCOPE", cela signifie que le réseau Docker a une portée globale.
Cela permet aux conteneurs de se connecter à ce réseau depuis d&#8217;autres hôtes de votre environnement Docker.</p></li></ol></div>
<div class="paragraph"><p>Ainsi, la valeur "SCOPE" vous indique si un réseau Docker est limité à un seul hôte (portée locale) ou s&#8217;il est accessible depuis d&#8217;autres hôtes (portée globale).
La portée détermine la manière dont les conteneurs peuvent communiquer avec ce réseau, en fonction de la configuration de Docker.</p></div></aside></div></section><section id="les_réseaux_inspection"><h2>🔍🌐 Les réseaux : inspection</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker network inspect bridge</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">[
    {
        "Name": "bridge",
        "Id": "11b7af7b16e4cf9fe42733aa1b6900ed876407e3b55e692c9dfe03505e2af19f",
        "Created": "2023-10-31T15:08:44.054140179Z",
        "Scope": "local",
        "Driver": "bridge",
        "EnableIPv6": false,
        "IPAM": {
            "Driver": "default",
            "Options": null,
            "Config": [
                {
                    "Subnet": "172.17.0.0/16",
                    "Gateway": "172.17.0.1"
                }
            ]
        },
        ...</code></pre></div></div>
<aside class="notes"><div class="paragraph"><p>Lorsque vous exécutez la commande "docker network inspect bridge," vous obtenez des informations sur le réseau "bridge" dans Docker.</p></div>
<div class="paragraph"><p>Voici ce que chaque élément signifie :</p></div>
<div class="olist arabic"><ol class="arabic"><li><p><strong>Name (Nom)</strong> : C&#8217;est le nom du réseau, dans ce cas, "bridge." Docker attribue un nom par défaut à ce réseau, qui est utilisé par les conteneurs pour communiquer entre eux.</p></li><li><p><strong>Id (Identifiant)</strong> : C&#8217;est un identifiant unique attribué au réseau Docker, utilisé en interne par Docker pour le gérer. Il est généré automatiquement.</p></li><li><p><strong>Created (Créé)</strong> : Cette date indique quand le réseau a été créé. Cela peut être utile pour suivre l&#8217;historique des opérations Docker.</p></li><li><p><strong>Scope (Portée)</strong> : Dans cet exemple, la portée est "local," ce qui signifie que le réseau "bridge" est uniquement accessible localement sur l&#8217;hôte Docker. Les conteneurs sur cet hôte peuvent se connecter au réseau "bridge," mais les conteneurs sur d&#8217;autres hôtes Docker ne le peuvent pas.</p></li><li><p><strong>Driver (Pilote)</strong> : Le pilote du réseau "bridge" est "bridge." C&#8217;est le pilote par défaut utilisé pour connecter les conteneurs sur un même hôte.</p></li><li><p><strong>EnableIPv6 (Activer IPv6)</strong> : Dans cet exemple, la valeur est "false," ce qui signifie que l&#8217;IPv6 n&#8217;est pas activé sur ce réseau. Docker prend en charge à la fois l&#8217;IPv4 et l&#8217;IPv6.</p></li><li><p><strong>IPAM (IP Address Management - Gestion des adresses IP)</strong> : C&#8217;est la section qui gère les adresses IP pour le réseau. Dans cet exemple, le pilote est "default," ce qui signifie que Docker utilise ses paramètres par défaut pour gérer les adresses IP.</p></li><li><p><strong>Subnet (Sous-réseau)</strong> : C&#8217;est l&#8217;intervalle d&#8217;adresses IP utilisé par les conteneurs connectés à ce réseau. Dans cet exemple, le sous-réseau est "172.17.0.0/16," ce qui signifie que les adresses IP de ce réseau sont comprises entre 172.17.0.1 et 172.17.255.254.</p></li><li><p><strong>Gateway (Passerelle)</strong> : Il s&#8217;agit de l&#8217;adresse IP de la passerelle utilisée par les conteneurs pour accéder à d&#8217;autres réseaux ou à Internet. Dans ce cas, la passerelle est "172.17.0.1."</p></li></ol></div>
<div class="paragraph"><p>Ces informations fournissent un aperçu de la configuration du réseau "bridge" dans Docker.</p></div></aside></div></section><section id="les_réseaux_création"><h2>🌐✨ Les réseaux : création</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker network create mon-reseau</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker network ls</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">NETWORK ID     NAME                                                             DRIVER    SCOPE
11b7af7b16e4   bridge                                                           bridge    local
1112832d205b   cours-devops-docker_default                                      bridge    local
7ab15cc28199   docker_volumes-backup-extension-desktop-extension_default        bridge    local
34caf4674478   host                                                             host      local
46953dc9b3d5   mon-reseau                                                       bridge    local
2a179c7be3b3   none                                                             null      local
0c577a792771   portainer_portainer-docker-extension-desktop-extension_default   bridge    local</code></pre></div></div>
<aside class="notes"><div class="paragraph"><p>Lorsque vous exécutez la commande "docker network create mon-reseau," vous créez un nouveau réseau Docker avec le nom "mon-reseau." Voici ce que chaque élément signifie :</p></div>
<div class="olist arabic"><ol class="arabic"><li><p><strong>NETWORK ID (Identifiant du réseau)</strong> : C&#8217;est un identifiant unique attribué au réseau que Docker utilise en interne pour le gérer. Il est généré automatiquement.</p></li><li><p><strong>NAME (Nom)</strong> : Il s&#8217;agit du nom que vous avez choisi pour votre réseau, dans ce cas, "mon-reseau."</p></li><li><p><strong>DRIVER (Pilote)</strong> : Le pilote de ce réseau est "bridge." Le pilote "bridge" est utilisé pour connecter des conteneurs sur le même hôte.</p></li><li><p><strong>SCOPE (Portée)</strong> : Dans cet exemple, la portée est "local," ce qui signifie que le réseau "mon-reseau" est uniquement accessible localement sur l&#8217;hôte Docker. Les conteneurs sur cet hôte peuvent se connecter à "mon-reseau," mais les conteneurs sur d&#8217;autres hôtes Docker ne le peuvent pas.</p></li></ol></div>
<div class="paragraph"><p>Ensuite, lorsque vous exécutez "docker network ls," vous obtenez une liste de tous les réseaux Docker existants, y compris celui que vous venez de créer ("mon-reseau").
Vous pouvez voir les détails de ce réseau dans le tableau, y compris son identifiant, son nom, son pilote, et sa portée.</p></div>
<div class="paragraph"><p>En résumé, avec ces commandes, vous avez créé un nouveau réseau Docker nommé "mon-reseau" qui peut être utilisé pour connecter des conteneurs sur le même hôte.</p></div></aside></div></section><section id="attacher_un_container_à_un_réseau_particulier"><h2>🐳🔗 Attacher un container à un réseau particulier</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker run –d --net=mon-reseau --name=app img</code></pre></div></div>
<div class="paragraph fragment"><p>Il est opportun de nommer un container quand on l&#8217;attache à un réseau.</p></div>
<div class="paragraph fragment"><p>Docker fournit un DNS interne dans les réseaux custom. Les containers d&#8217;un même réseau peuvent se "voir" et "s&#8217;appeler" par leur noms.</p></div></div></section><section id="microdns" data-auto-animate><h2>🖥️🔍 MicroDNS</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker network create mynet</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run -d --name web --net mynet nginx</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run --net mynet alpine ping web</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">PING web (172.21.0.2): 56 data bytes
64 bytes from 172.21.0.2: seq=0 ttl=64 time=0.442 ms
64 bytes from 172.21.0.2: seq=1 ttl=64 time=0.105 ms
64 bytes from 172.21.0.2: seq=2 ttl=64 time=0.099 ms
64 bytes from 172.21.0.2: seq=3 ttl=64 time=0.150 ms
64 bytes from 172.21.0.2: seq=4 ttl=64 time=0.114 ms
64 bytes from 172.21.0.2: seq=5 ttl=64 time=0.098 ms
64 bytes from 172.21.0.2: seq=6 ttl=64 time=0.099 ms
64 bytes from 172.21.0.2: seq=7 ttl=64 time=0.100 ms
64 bytes from 172.21.0.2: seq=8 ttl=64 time=0.114 ms
64 bytes from 172.21.0.2: seq=9 ttl=64 time=0.097 ms
^C
--- web ping statistics ---
10 packets transmitted, 10 packets received, 0% packet loss
round-trip min/avg/max = 0.097/0.141/0.442 ms</code></pre></div></div></div></section><section id="microdns_2" data-auto-animate><h2>🖥️🔍 MicroDNS</h2><div class="slide-content"><div class="imageblock"><img src="media/appeler_son_voisin.png" alt="appeler son voisin" height="600"></div></div></section><section id="se_connecter_à_un_réseau"><h2>📶🔌 Se connecter à un réseau</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker network connect mynet myapp</code></pre></div></div>
<div class="paragraph fragment"><p>Cette commande permet d&#8217;attacher un container à un réseau après sa création.</p></div></div></section><section id="travaux_pratiques_11"><h2>🎓 Travaux pratiques #11</h2><div class="slide-content"><div class="paragraph"><p>Étapes:</p></div>
<div class="ulist"><ul><li class="fragment"><p>Lister et inspecter les réseaux existants</p></li><li class="fragment"><p>Lancer un container `nginx `nommé "web1"</p></li><li class="fragment"><p>A quel réseau est-il attaché ?</p></li><li class="fragment"><p>Créer un réseau de type bridge et l&#8217;inspecter</p></li><li class="fragment"><p>Lancer un container <code>nginx</code> nommé "web2" et l&#8217;attacher au réseau créé</p></li><li class="fragment"><p>L&#8217;inspection confirme-t-elle l&#8217;attachement ?</p></li><li class="fragment"><p>Lancer un bash dans le container "web1"</p></li><li class="fragment"><p>Est-ce que "web1" peut voir "web2" ?</p></li><li class="fragment"><p>Corriger pour que ce soit le cas</p></li></ul></div></div></section><section id="solution_travaux_pratiques_11" data-auto-animate><h2>✅ Solution travaux pratiques #11</h2><div class="slide-content"><div class="paragraph"><p>Étape 1 : Lister et inspecter les réseaux existants</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Liste tous les réseaux Docker existants
docker network ls

# Inspecte un réseau spécifique (par exemple, le réseau bridge, d'autres réseaux peuvent être inspectés)
docker network inspect bridge</code></pre></div></div>
<div class="paragraph fragment"><p>Étape 2 : Lancer un container "nginx" nommé "web1"</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Lance un conteneur "nginx" nommé "web1"
docker container run --name web1 -d nginx</code></pre></div></div>
<div class="paragraph fragment"><p>Étape 3 : Vérifier le réseau auquel "web1" est attaché</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Récupère l'identifiant de réseau complet pour le container "web1"
network_id=$(docker container inspect -f '{{.NetworkSettings.Networks.bridge.NetworkID}}' web1)

# Raccourcit l'identifiant du réseau aux premiers 12 caractères
shortened_network_id=$(echo $network_id | cut -c 1-12)

# Liste tous les réseaux docker, en filtrant par l'identifiant du réseau
docker network ls --format "table {{.ID}}\t{{.Name}}" | awk -v network_id="$shortened_network_id" '$1 == network_id {print $2}'</code></pre></div></div></div></section><section id="solution_travaux_pratiques_11_2" data-auto-animate><h2>✅ Solution travaux pratiques #11</h2><div class="slide-content"><div class="paragraph"><p>Étape 3 : Vérifier le réseau auquel "web1" est attaché</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Récupère l'identifiant de réseau complet pour le container "web1"
network_id=$(docker container inspect -f '{{.NetworkSettings.Networks.bridge.NetworkID}}' web1)

# Raccourcit l'identifiant du réseau aux premiers 12 caractères
shortened_network_id=$(echo $network_id | cut -c 1-12)

# Liste tous les réseaux docker, en filtrant par l'identifiant du réseau
docker network ls --format "table {{.ID}}\t{{.Name}}" | awk -v network_id="$shortened_network_id" '$1 == network_id {print $2}'</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">bridge</code></pre></div></div>
<div class="paragraph fragment"><p>Étape 4 : Créer un réseau de type bridge et l&#8217;inspecter</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Crée un réseau Docker de type bridge nommé "mon-reseau"
docker network create mon-reseau

# Inspecte le réseau "mon-reseau"
docker network inspect mon-reseau</code></pre></div></div>
<div class="paragraph fragment"><p>Étape 5 : Lancer un container "nginx" nommé "web2" et l&#8217;attacher au réseau créé</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Lance un conteneur "nginx" nommé "web2" et l'attache au réseau "mon-reseau"
docker container run --name web2 -d --network mon-reseau nginx</code></pre></div></div></div></section><section id="solution_travaux_pratiques_11_3" data-auto-animate><h2>✅ Solution travaux pratiques #11</h2><div class="slide-content"><div class="paragraph"><p>Étape 5 : Lancer un container "nginx" nommé "web2" et l&#8217;attacher au réseau créé</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Lance un conteneur "nginx" nommé "web2" et l'attache au réseau "mon-reseau"
docker container run --name web2 -d --network mon-reseau nginx</code></pre></div></div>
<div class="paragraph"><p>Étape 6 : Vérifier l&#8217;attachement du container "web2" au réseau</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Inspecte le conteneur "web2" pour vérifier le réseau auquel il est attaché
docker container inspect web2 | grep NetworkMode</code></pre></div></div>
<div class="paragraph fragment"><p>Étape 7 : Lancer un bash dans le container "web1"</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Lance un shell interactif dans le conteneur "web1"
docker container exec -it web1 bash</code></pre></div></div>
<div class="paragraph fragment"><p>Étape 8 : Vérifier si "web1" peut voir "web2"</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># À l'intérieur du conteneur "web1," essayez de faire une requête HTTP vers "web2"
curl web2</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">curl: (6) Could not resolve host: web2</code></pre></div></div></div></section><section id="solution_travaux_pratiques_11_4" data-auto-animate><h2>✅ Solution travaux pratiques #11</h2><div class="slide-content"><div class="paragraph"><p>Étape 9 : Corriger pour permettre la communication entre "web1" et "web2"</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Sortez du shell du conteneur "web1" en tapant "exit"

# Attachez "web1" au même réseau "mon-reseau"
docker network connect mon-reseau web1</code></pre></div></div>
<div class="paragraph fragment"><p>Après avoir suivi ces étapes, les conteneurs "web1" et "web2" devraient être attachés au même réseau "mon-reseau" et être capables de communiquer entre eux.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># Lance un shell interactif dans le conteneur "web1"
docker container exec -it web1 bash</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"># À l'intérieur du conteneur "web1," essayez de faire une requête HTTP vers "web2"
curl web2</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-html hljs" data-noescape="true" data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Welcome to nginx!&lt;/title&gt;
&lt;style&gt;
[...]</code></pre></div></div></div></section></section>
<section><section id="docker_compose"><h2>🐋🐙 Docker compose</h2><div class="slide-content"><div class="imageblock"><img src="media/2073552164-image2.png" alt="2073552164 image2" height="550px"></div></div></section><section id="un_cas_de_la_vraie_vie"><h2>🌐🏡 Un cas de la vraie vie</h2><div class="slide-content"><div class="paragraph"><p>Une application riche repose souvent sur plusieurs éléments techniques à coordonner ensemble.</p></div>
<div class="paragraph"><p>(Apache, Tomcat, Node, MongoDB, ElasticSearch, Logstash, etc.)</p></div>
<div class="paragraph"><p>Comment automatiser ces déploiements ?</p></div></div></section><section id="on_pourrait_tout_scripter"><h2>📜💻 On pourrait tout scripter…</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">#!/bin/sh
docker network create my-net
docker container run –d --net=my-net –p 3306:3306 mysql
docker container run –d --net=my-net –v /docs:/docs --name col1 httpd:2.4.58-bookworm
docker container run –d --net=my-net –v /docs:/docs --name col2 httpd:2.4.58-bookworm</code></pre></div></div></div></section><section id="tout_scripter"><h2>📜💻 Tout scripter</h2><div class="slide-content"><div class="imageblock"><img src="media/351794078-image3.gif" alt="351794078 image3"></div>
<div class="ulist"><ul><li class="fragment"><p>Et tout lancer indépendamment ?</p></li><li class="fragment"><p>Et tout monitorer un par un ?</p></li><li class="fragment"><p>Peut mieux faire, non ?</p></li></ul></div></div></section><section id="docker_compose_yml"><h2>🐋🐙 docker compose.yml</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:</code></pre></div></div></div></section><section id="docker_compose_yml_2"><h2>🐋🐙 docker compose.yml</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  apache:







  middle:



  db:</code></pre></div></div></div></section><section id="docker_compose_yml_3"><h2>🐋🐙 docker compose.yml</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  apache:
    image: "my-httpd:2.4"






  middle:



  db:</code></pre></div></div></div></section><section id="docker_compose_yml_4"><h2>🐋🐙 docker compose.yml</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  apache:
    image: "my-httpd:2.4"
    ports:
      - "80:80"




  middle:



  db:</code></pre></div></div></div></section><section id="docker_compose_yml_5"><h2>🐋🐙 docker compose.yml</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  apache:
    image: "my-httpd:2.4"
    ports:
      - "80:80"
    environment:
      - MIDDLE_HOST_1=middle


  middle:



  db:</code></pre></div></div></div></section><section id="docker_compose_yml_6"><h2>🐋🐙 docker compose.yml</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  apache:
    image: "my-httpd:2.4"
    ports:
      - "80:80"
    environment:
      - MIDDLE_HOST_1=middle
    volumes:
      - ./etc/httpd/workers.properties:/etc/httpd/conf/workers.properties
  middle:



  db:</code></pre></div></div></div></section><section id="docker_compose_yml_7"><h2>🐋🐙 docker compose.yml</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  apache:
    image: "my-httpd:2.4"
    ports:
      - "80:80"
    environment:
      - MIDDLE_HOST_1=middle
    volumes:
      - ./etc/httpd/workers.properties:/etc/httpd/conf/workers.properties
  middle:
    build: .


  db:</code></pre></div></div></div></section><section id="docker_compose_yml_8"><h2>🐋🐙 docker compose.yml</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  apache:
    image: "my-httpd:2.4"
    ports:
      - "80:80"
    environment:
      - MIDDLE_HOST_1=middle
    volumes:
      - ./etc/httpd/workers.properties:/etc/httpd/conf/workers.properties
  middle:
    build: .
    environment:
      - DB_HOST=db
  db:</code></pre></div></div></div></section><section id="docker_compose_yml_9"><h2>🐋🐙 docker compose.yml</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  apache:
    image: "my-httpd:2.4"
    ports:
      - "80:80"
    environment:
      - MIDDLE_HOST_1=middle
    volumes:
      - ./etc/httpd/workers.properties:/etc/httpd/conf/workers.properties
  middle:
    build: .
    environment:
      - DB_HOST=db
  db:
    image: "mysql:5.6"</code></pre></div></div></div></section><section id="docker_compose_yml_10"><h2>🐋🐙 docker compose.yml</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  apache:
    image: "my-httpd:2.4"
    ports:
      - "80:80"
    environment:
      - MIDDLE_HOST_1=middle
    volumes:
      - ./etc/httpd/workers.properties:/etc/httpd/conf/workers.properties
  middle:
    build: .
    environment:
      - DB_HOST=db
  db:
    image: "mysql:5.6"
    ports:
      - "3306:3306"</code></pre></div></div></div></section><section id="et_après_2" data-auto-animate><h2>🤔➡️ Et après ?</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker compose up -d
docker compose build
docker compose logs
docker compose stop
docker compose restart
docker compose down</code></pre></div></div></div></section><section id="ordre_de_démarrage" data-auto-animate><h2>🏁🔢 Ordre de démarrage</h2><div class="slide-content"><div class="paragraph"><p>L&#8217;ordre de démarrage fait référence à la séquence dans laquelle les services définis dans un fichier Docker Compose sont lancés.</p></div></div></section><section id="ordre_de_démarrage_2" data-auto-animate><h2>🏁🔢 Ordre de démarrage</h2><div class="slide-content"><div class="paragraph title"><p>Pourquoi est-ce important ?</p></div>
<div class="paragraph fragment"><p>Certains services peuvent dépendre d&#8217;autres services pour fonctionner correctement.</p></div>
<div class="paragraph fragment"><p>Par exemple, une application web peut avoir besoin qu&#8217;une base de données soit opérationnelle avant de pouvoir démarrer.</p></div></div></section><section id="ordre_de_démarrage_3" data-auto-animate><h2>🏁🔢 Ordre de démarrage</h2><div class="slide-content"><div class="paragraph title"><p>Comment Docker Compose gère-t-il l&#8217;ordre de démarrage ?</p></div>
<div class="paragraph fragment"><p>Par défaut, Docker Compose démarre les services dans l&#8217;ordre dans lequel ils sont définis dans le fichier Docker Compose.</p></div>
<div class="paragraph fragment"><p>Cependant, cela ne garantit pas que les services dépendants seront prêts à être utilisés lorsque les services qui en dépendent seront lancés.</p></div></div></section><section id="ordre_de_démarrage_4" data-auto-animate><h2>🏁🔢 Ordre de démarrage</h2><div class="slide-content"><div class="paragraph title"><p>Comment gérer les dépendances entre services ?</p></div>
<div class="paragraph fragment"><p>Docker Compose offre deux directives pour gérer les dépendances entre services : <code>depends_on</code> et <code>healthcheck</code>.</p></div>
<div class="ulist"><ul><li class="fragment"><p><code>depends_on</code> : Cette directive peut être utilisée pour indiquer qu&#8217;un service dépend d&#8217;un autre service.
Cependant, cela ne garantit pas que le service dépendant sera prêt à être utilisé lorsque le service qui en dépend sera lancé.</p></li><li class="fragment"><p><code>healthcheck</code> : Cette directive peut être utilisée pour vérifier l&#8217;état de santé d&#8217;un service.
En combinaison avec <code>depends_on</code>, elle peut aider à s&#8217;assurer qu&#8217;un service est prêt à être utilisé avant de lancer les services qui en dépendent.</p></li></ul></div></div></section><section id="ordre_de_démarrage_5" data-auto-animate><h2>🏁🔢 Ordre de démarrage</h2><div class="slide-content"><div class="paragraph title"><p>Exemple
Voici un exemple de fichier Docker Compose qui utilise <code>depends_on</code> et <code>healthcheck</code> pour gérer l&#8217;ordre de démarrage des services :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">version: '3'
services:
  web:
    build: .
    depends_on:
      db:
        condition: service_healthy
  db:
    image: postgres
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 30s
      timeout: 30s
      retries: 3</code></pre></div></div>
<div class="paragraph fragment"><p>Dans cet exemple, le service web dépend du service db.
Le service db est vérifié toutes les 30 secondes pour s&#8217;assurer qu&#8217;il est prêt à être utilisé.
Le service web ne sera lancé que lorsque le service db sera en bonne santé.</p></div></div></section><section id="ordre_de_démarrage_conditions" data-auto-animate><h2>🏁🔢 Ordre de démarrage❓🤔 Conditions.</h2><div class="slide-content"><div class="admonitionblock warning"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content">Rappel:
La directive <code>depends_on</code> dans un fichier Docker Compose est utilisée pour indiquer qu&#8217;un service dépend d&#8217;un autre service.
Cela signifie que le service dépendant ne sera pas démarré tant que les services dont il dépend n&#8217;auront pas été démarrés.</td></tr></table></div></div></section><section id="ordre_de_démarrage_autres_conditions" data-auto-animate><h2>🏁🔢 Ordre de démarrage❓🤔 Autres conditions.</h2><div class="slide-content"><div class="paragraph"><p>En plus de la condition service_healthy, il existe d&#8217;autres conditions que vous pouvez utiliser avec <code>depends_on</code>:</p></div>
<div class="paragraph fragment"><p><code>service_started</code> : Cette condition signifie que le service dépendant ne sera pas démarré tant que le service dont il dépend n&#8217;aura pas été démarré.</p></div>
<div class="paragraph fragment"><p><code>service_completed_successfully</code>: Cette condition indique qu&#8217;un service dépendant ne doit pas démarrer avant qu&#8217;un autre service ait terminé avec succès. Cela peut être utile dans des scénarios où un service doit effectuer une tâche unique qui doit être terminée avant que d&#8217;autres services puissent débuter.</p></div>
<div class="paragraph fragment"><p>Cependant, cela ne garantit pas que le service dont il dépend est prêt à être utilisé.</p></div></div></section><section id="ordre_de_démarrage_autre_condition" data-auto-animate><h2>🏁🔢 Ordre de démarrage❓🤔 Autre condition.</h2><div class="slide-content"><div class="paragraph"><p>Voici un exemple de comment vous pourriez utiliser <code>service_started</code> dans un fichier Docker Compose :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">version: '3'
services:
  web:
    build: .
    depends_on:
      db:
        condition: service_started
  db:
    image: postgres</code></pre></div></div>
<div class="paragraph fragment"><p>Dans cet exemple, le service <code>web</code> ne sera démarré que lorsque le service <code>db</code> aura été démarré.</p></div></div></section><section id="ordre_de_démarrage_healthcheck" data-auto-animate><h2>🏁🔢 Ordre de démarrage &amp; 🩺✅ healthcheck</h2><div class="slide-content"><div class="admonitionblock warning"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content">Rappel
<code>healthcheck</code> est une instruction dans un <code>Dockerfile</code> qui permet de vérifier l&#8217;état de santé d&#8217;un service.
Il peut être utilisé pour déterminer si un service est prêt à être utilisé ou non.</td></tr></table></div>
<div class="paragraph fragment"><p>Voici un exemple de <code>healthcheck</code> dans un <code>Dockerfile</code> :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM postgres
HEALTHCHECK --interval=5m --timeout=3s \
  CMD pg_isready -U postgres || exit 1</code></pre></div></div>
<div class="paragraph fragment"><p>Dans cet exemple, <code>pg_isready -U postgres</code> est la commande utilisée pour vérifier l&#8217;état de santé du service.
Si cette commande réussit, le service est considéré comme sain.
Sinon, il est considéré comme malsain.</p></div></div></section><section id="ordre_de_démarrage_healthcheck_2" data-auto-animate><h2>🏁🔢 Ordre de démarrage &amp; 🩺✅ healthcheck</h2><div class="slide-content"><div class="admonitionblock warning"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content">Rappel
<code>depends_on</code> est une directive dans un fichier Docker Compose qui indique qu&#8217;un service dépend d&#8217;un autre service.
Il peut être utilisé pour contrôler l&#8217;ordre de démarrage des services.</td></tr></table></div>
<div class="paragraph fragment"><p>Voici un exemple de depends_on dans un fichier Docker Compose :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">version: '3'
services:
  web:
    build: .
    depends_on:
      db:
        condition: service_healthy
  db:
    image: postgres</code></pre></div></div>
<div class="paragraph fragment"><p>Dans cet exemple, le service <code>web</code> dépend du service <code>db</code>.
Le service web ne sera démarré que lorsque le service db sera en bonne santé.</p></div></div></section><section id="comment_healthcheck_et_depends_on_travaillent_ensemble" data-auto-animate><h2>🏁🔢 🩺✅ Comment healthcheck et depends_on travaillent ensemble ?</h2><div class="slide-content"><div class="paragraph title"><p>En combinant <code>healthcheck</code> et <code>depends_on</code>, vous pouvez contrôler l&#8217;ordre de démarrage des services en fonction de leur état de santé.
Par exemple, vous pouvez vous assurer qu&#8217;un service de base de données est prêt à être utilisé avant de démarrer une application web qui en dépend.</p></div></div></section><section id="ordre_de_démarrage_pour_résumer" data-auto-animate><h2>🏁🔢 Ordre de démarrage 📊📝 Pour résumer</h2><div class="slide-content"><div class="paragraph"><p>L&#8217;ordre de démarrage fait référence à la séquence dans laquelle les services définis dans un fichier Docker Compose sont lancés.
Par défaut, Docker Compose démarre les services dans l&#8217;ordre dans lequel ils sont définis dans le fichier Docker Compose.</p></div>
<div class="paragraph fragment"><p>Docker Compose offre deux directives pour gérer les dépendances entre services : <code>depends_on</code> et <code>healthcheck</code>.</p></div></div></section><section id="ordre_de_démarrage_pour_résumer_2" data-auto-animate><h2>🏁🔢 Ordre de démarrage 📊📝 Pour résumer</h2><div class="slide-content"><div class="ulist"><ul><li><p><code>depends_on</code> : Cette directive peut être utilisée pour indiquer qu&#8217;un service dépend d&#8217;un autre service. Elle peut être utilisée avec deux conditions : <code>service_started</code> et <code>service_healthy</code>.</p></li><li><p><code>service_started</code> : Cette condition signifie que le service dépendant ne sera pas démarré tant que le service dont il dépend n&#8217;aura pas été démarré. Cependant, cela ne garantit pas que le service dont il dépend est prêt à être utilisé.</p></li><li><p><code>service_healthy</code> : Cette condition est utilisée avec la directive healthcheck dans un Dockerfile pour vérifier l&#8217;état de santé d&#8217;un service. Si la commande healthcheck réussit, Docker considère le service comme sain. Sinon, il est considéré comme malsain.</p></li></ul></div></div></section><section id="ordre_de_démarrage_pour_résumer_3" data-auto-animate><h2>🏁🔢 Ordre de démarrage 📊📝 Pour résumer</h2><div class="slide-content"><div class="paragraph title"><p>Exemple
Voici un exemple de fichier Docker Compose qui utilise depends_on et healthcheck pour gérer l&#8217;ordre de démarrage des services :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">version: '3'
services:
  web:
    build: .
    depends_on:
      db:
        condition: service_healthy
  db:
    image: postgres
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 30s
      timeout: 30s
      retries: 3</code></pre></div></div></div></section><section id="étude_de_cas" data-auto-animate><h2>🏁🔢 Étude de cas 📚🔍</h2><div class="slide-content"><div class="paragraph"><p>Un exemple de fichier docker-compose.yml utilisé dans Jenkins:</p></div>
<div class="paragraph"><p><a href="https://raw.githubusercontent.com/jenkins-docs/quickstart-tutorials/refs/heads/main/docker-compose.yaml" class="bare">https://raw.githubusercontent.com/jenkins-docs/quickstart-tutorials/refs/heads/main/docker-compose.yaml</a></p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">sidekick_service:
    # Configuration for the sidekick service
    image: ${DOCKERHUB_USERNAME}/jenkinsci-tutorials:sidekick_
    stdin_open: true
    tty: true
    entrypoint: sh -c "/usr/local/bin/keygen.sh /ssh-dir"  # Runs the keygen.sh script and specifies the output directory
    volumes:
      - agent-ssh-dir:/ssh-dir  # Mounts the agent-ssh-dir volume to the /ssh-dir path inside the container
    healthcheck:
      test: [ "CMD-SHELL", "[ -f /ssh-dir/conductor_ok ] || exit 1" ]  # Checks if the conductor_ok file exists in the /ssh-dir path
      interval: 5s
      timeout: 10s
      retries: 5</code></pre></div></div>
<div class="paragraph fragment"><p>Les options <code>stdin_open: true</code> et <code>tty: true</code> sont utilisées pour garder l&#8217;entrée standard du conteneur ouverte et pour allouer un pseudo-TTY au conteneur, respectivement.
C&#8217;est généralement fait lorsque vous voulez interagir avec le service en cours d&#8217;exécution.</p></div></div></section><section id="étude_de_cas_2" data-auto-animate><h2>🏁🔢 Étude de cas 📚🔍</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">sidekick_service:
    # Configuration for the sidekick service
    image: ${DOCKERHUB_USERNAME}/jenkinsci-tutorials:sidekick_
    stdin_open: true
    tty: true
    entrypoint: sh -c "/usr/local/bin/keygen.sh /ssh-dir"  # Runs the keygen.sh script and specifies the output directory
    volumes:
      - agent-ssh-dir:/ssh-dir  # Mounts the agent-ssh-dir volume to the /ssh-dir path inside the container
    healthcheck:
      test: [ "CMD-SHELL", "[ -f /ssh-dir/conductor_ok ] || exit 1" ]  # Checks if the conductor_ok file exists in the /ssh-dir path
      interval: 5s
      timeout: 10s
      retries: 5</code></pre></div></div>
<div class="ulist"><ul><li><p>La directive <code>entrypoint</code> est utilisée pour spécifier la commande qui sera exécutée lorsque le conteneur démarre.</p></li><li><p>Dans ce cas, elle exécute une commande shell qui exécute un script nommé <code>keygen.sh</code> situé à <code>/usr/local/bin/keygen.sh</code>.</p></li><li><p>Le script reçoit un argument <code>/ssh-dir</code>, qui est le répertoire où le script effectuera ses opérations.</p></li></ul></div></div></section><section id="étude_de_cas_3" data-auto-animate><h2>🏁🔢 Étude de cas 📚🔍</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">sidekick_service:
    # Configuration for the sidekick service
    image: ${DOCKERHUB_USERNAME}/jenkinsci-tutorials:sidekick_
    stdin_open: true
    tty: true
    entrypoint: sh -c "/usr/local/bin/keygen.sh /ssh-dir"  # Runs the keygen.sh script and specifies the output directory
    volumes:
      - agent-ssh-dir:/ssh-dir  # Mounts the agent-ssh-dir volume to the /ssh-dir path inside the container
    healthcheck:
      test: [ "CMD-SHELL", "[ -f /ssh-dir/conductor_ok ] || exit 1" ]  # Checks if the conductor_ok file exists in the /ssh-dir path
      interval: 5s
      timeout: 10s
      retries: 5</code></pre></div></div>
<div class="ulist"><ul><li class="fragment"><p>La directive volumes est utilisée pour monter un volume nommé <code>agent-ssh-dir</code> sur le chemin <code>/ssh-dir</code> à l&#8217;intérieur du conteneur.</p></li><li class="fragment"><p>Cela permet de conserver les données entre les redémarrages du conteneur et peut également être utilisé pour partager des données entre les conteneurs.</p></li></ul></div></div></section><section id="étude_de_cas_4" data-auto-animate><h2>🏁🔢 Étude de cas 📚🔍</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">sidekick_service:
    # Configuration for the sidekick service
    image: ${DOCKERHUB_USERNAME}/jenkinsci-tutorials:sidekick_
    stdin_open: true
    tty: true
    entrypoint: sh -c "/usr/local/bin/keygen.sh /ssh-dir"  # Runs the keygen.sh script and specifies the output directory
    volumes:
      - agent-ssh-dir:/ssh-dir  # Mounts the agent-ssh-dir volume to the /ssh-dir path inside the container
    healthcheck:
      test: [ "CMD-SHELL", "[ -f /ssh-dir/conductor_ok ] || exit 1" ]  # Checks if the conductor_ok file exists in the /ssh-dir path
      interval: 5s
      timeout: 10s
      retries: 5</code></pre></div></div>
<div class="ulist"><ul><li class="fragment"><p>Enfin, un healthcheck est défini pour le service. Il s&#8217;agit d&#8217;une commande que Docker exécutera à l&#8217;intérieur du conteneur pour vérifier sa santé.</p></li><li class="fragment"><p>Dans ce cas, la commande vérifie si un fichier nommé <code>conductor_ok</code> existe dans le répertoire <code>/ssh-dir</code>.</p></li><li class="fragment"><p>Si le fichier existe, la commande réussit et Docker considère le service comme sain.</p></li><li class="fragment"><p>Si le fichier n&#8217;existe pas, la commande échoue et Docker considère le service comme malsain.</p></li><li class="fragment"><p>Docker exécutera cette vérification de santé toutes les 5 secondes (<code>interval: 5s</code>), et si elle ne répond pas dans les 10 secondes (<code>timeout: 10s</code>), Docker la considérera comme un échec. Docker réessaiera une vérification de santé échouée 5 fois (<code>retries: 5</code>) avant de considérer le service comme malsain.</p></li></ul></div></div></section><section id="étude_de_cas_5" class="columns" data-auto-animate><h2>🏁🔢 Étude de cas 📚🔍</h2><div class="slide-content"><div class="openblock column is-two-thirds"><div class="content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  sidekick_service: [...]

  jenkins_controller: [...]
    depends_on:
      sidekick_service:
        condition: service_completed_successfully  # Depends on the successful completion of the sidekick_service
    healthcheck:
      test: [ "CMD-SHELL", "[ -f /ssh-dir/conductor_ok ] || exit 1" ]  # Checks if the conductor_ok file exists in the /ssh-dir path
      interval: 5s
      timeout: 10s
      retries: 5

  default_agent: [...]
    depends_on:
      sidekick_service:
        condition: service_completed_successfully  # Depends on the successful completion of the sidekick_service
      jenkins_controller:
        condition: service_started
    healthcheck:
      test: [ "CMD-SHELL", "[ -f /home/jenkins/.ssh/authorized_keys ] || exit 1" ]  # Checks if the authorized_keys file exists in the /home/jenkins/.ssh path
      interval: 5s
      timeout: 10s
      retries: 5
    volumes:
      - agent-ssh-dir:/home/jenkins/.ssh:ro  # Mounts the agent-ssh-dir volume to the /home/jenkins/.ssh path inside the container as read-only</code></pre></div></div></div></div>
<div class="openblock column"><div class="content"><div class="ulist"><ul><li><p>Service jenkins_controller</p><div class="ulist"><ul><li class="fragment"><p>Ce service dépend du <code>sidekick_service</code>.</p></li><li class="fragment"><p>Il ne démarrera que lorsque le <code>sidekick_service</code> aura terminé avec succès.</p></li><li class="fragment"><p>C&#8217;est ce que signifie la condition <code>service_completed_successfully</code>.</p></li></ul></div></li></ul></div></div></div></div></section><section id="étude_de_cas_6" class="columns" data-auto-animate><h2>🏁🔢 Étude de cas 📚🔍</h2><div class="slide-content"><div class="openblock column is-two-thirds"><div class="content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  sidekick_service: [...]

  jenkins_controller: [...]
    depends_on:
      sidekick_service:
        condition: service_completed_successfully  # Depends on the successful completion of the sidekick_service
    healthcheck:
      test: [ "CMD-SHELL", "[ -f /ssh-dir/conductor_ok ] || exit 1" ]  # Checks if the conductor_ok file exists in the /ssh-dir path
      interval: 5s
      timeout: 10s
      retries: 5

  default_agent: [...]
    depends_on:
      sidekick_service:
        condition: service_completed_successfully  # Depends on the successful completion of the sidekick_service
      jenkins_controller:
        condition: service_started
    healthcheck:
      test: [ "CMD-SHELL", "[ -f /home/jenkins/.ssh/authorized_keys ] || exit 1" ]  # Checks if the authorized_keys file exists in the /home/jenkins/.ssh path
      interval: 5s
      timeout: 10s
      retries: 5
    volumes:
      - agent-ssh-dir:/home/jenkins/.ssh:ro  # Mounts the agent-ssh-dir volume to the /home/jenkins/.ssh path inside the container as read-only</code></pre></div></div></div></div>
<div class="openblock column"><div class="content"><div class="paragraph"><p>Un <code>healthcheck</code> est également défini pour ce service.</p></div>
<div class="ulist"><ul><li class="fragment"><p>Docker vérifie si un fichier nommé <code>conductor_ok</code> existe dans le chemin <code>/ssh-dir</code>.</p></li><li class="fragment"><p>Si le fichier existe, Docker considère le service comme sain.</p></li><li class="fragment"><p>Sinon, il est considéré comme malsain.</p></li></ul></div></div></div></div></section><section id="étude_de_cas_7" class="columns" data-auto-animate><h2>🏁🔢 Étude de cas 📚🔍</h2><div class="slide-content"><div class="openblock column is-two-thirds"><div class="content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  sidekick_service: [...]

  jenkins_controller: [...]
    depends_on:
      sidekick_service:
        condition: service_completed_successfully  # Depends on the successful completion of the sidekick_service
    healthcheck:
      test: [ "CMD-SHELL", "[ -f /ssh-dir/conductor_ok ] || exit 1" ]  # Checks if the conductor_ok file exists in the /ssh-dir path
      interval: 5s
      timeout: 10s
      retries: 5

  default_agent: [...]
    depends_on:
      sidekick_service:
        condition: service_completed_successfully  # Depends on the successful completion of the sidekick_service
      jenkins_controller:
        condition: service_started
    healthcheck:
      test: [ "CMD-SHELL", "[ -f /home/jenkins/.ssh/authorized_keys ] || exit 1" ]  # Checks if the authorized_keys file exists in the /home/jenkins/.ssh path
      interval: 5s
      timeout: 10s
      retries: 5
    volumes:
      - agent-ssh-dir:/home/jenkins/.ssh:ro  # Mounts the agent-ssh-dir volume to the /home/jenkins/.ssh path inside the container as read-only</code></pre></div></div></div></div>
<div class="openblock column"><div class="content"><div class="paragraph"><p>Service <code>default_agent</code></p></div>
<div class="ulist"><ul><li class="fragment"><p>Ce service dépend également du <code>sidekick_service</code> et du <code>jenkins_controller</code>.</p></li><li class="fragment"><p>Il ne démarrera que lorsque le <code>sidekick_service</code> aura terminé avec succès et que le <code>jenkins_controller</code> aura démarré.</p></li><li class="fragment"><p>C&#8217;est ce que signifient les conditions <code>service_completed_successfully</code> et <code>service_started</code>.</p></li></ul></div></div></div></div></section><section id="étude_de_cas_8" class="columns" data-auto-animate><h2>🏁🔢 Étude de cas 📚🔍</h2><div class="slide-content"><div class="openblock column is-two-thirds"><div class="content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  sidekick_service: [...]

  jenkins_controller: [...]
    depends_on:
      sidekick_service:
        condition: service_completed_successfully  # Depends on the successful completion of the sidekick_service
    healthcheck:
      test: [ "CMD-SHELL", "[ -f /ssh-dir/conductor_ok ] || exit 1" ]  # Checks if the conductor_ok file exists in the /ssh-dir path
      interval: 5s
      timeout: 10s
      retries: 5

  default_agent: [...]
    depends_on:
      sidekick_service:
        condition: service_completed_successfully  # Depends on the successful completion of the sidekick_service
      jenkins_controller:
        condition: service_started
    healthcheck:
      test: [ "CMD-SHELL", "[ -f /home/jenkins/.ssh/authorized_keys ] || exit 1" ]  # Checks if the authorized_keys file exists in the /home/jenkins/.ssh path
      interval: 5s
      timeout: 10s
      retries: 5
    volumes:
      - agent-ssh-dir:/home/jenkins/.ssh:ro  # Mounts the agent-ssh-dir volume to the /home/jenkins/.ssh path inside the container as read-only</code></pre></div></div></div></div>
<div class="openblock column"><div class="content"><div class="paragraph"><p>Un <code>healthcheck</code> est également défini pour ce service.</p></div>
<div class="ulist"><ul><li class="fragment"><p>Docker vérifie si un fichier nommé <code>authorized_keys</code> existe dans le chemin <code>/home/jenkins/.ssh</code>.</p></li><li class="fragment"><p>Si le fichier existe, Docker considère le service comme sain.</p></li><li class="fragment"><p>Sinon, il est considéré comme malsain.</p></li></ul></div></div></div></div></section><section id="étude_de_cas_9" class="columns" data-auto-animate><h2>🏁🔢 Étude de cas 📚🔍</h2><div class="slide-content"><div class="openblock column is-two-thirds"><div class="content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  sidekick_service: [...]

  jenkins_controller: [...]
    depends_on:
      sidekick_service:
        condition: service_completed_successfully  # Depends on the successful completion of the sidekick_service
    healthcheck:
      test: [ "CMD-SHELL", "[ -f /ssh-dir/conductor_ok ] || exit 1" ]  # Checks if the conductor_ok file exists in the /ssh-dir path
      interval: 5s
      timeout: 10s
      retries: 5

  default_agent: [...]
    depends_on:
      sidekick_service:
        condition: service_completed_successfully  # Depends on the successful completion of the sidekick_service
      jenkins_controller:
        condition: service_started
    healthcheck:
      test: [ "CMD-SHELL", "[ -f /home/jenkins/.ssh/authorized_keys ] || exit 1" ]  # Checks if the authorized_keys file exists in the /home/jenkins/.ssh path
      interval: 5s
      timeout: 10s
      retries: 5
    volumes:
      - agent-ssh-dir:/home/jenkins/.ssh:ro  # Mounts the agent-ssh-dir volume to the /home/jenkins/.ssh path inside the container as read-only</code></pre></div></div></div></div>
<div class="openblock column"><div class="content"><div class="paragraph"><p>Enfin, un volume nommé <code>agent-ssh-dir</code> est monté sur le chemin <code>/home/jenkins/.ssh</code> à l&#8217;intérieur du conteneur en lecture seule.</p></div></div></div></div></section><section id="étude_de_cas_10" data-auto-animate><h2>🏁🔢 Étude de cas 📚🔍</h2><div class="slide-content"><div class="paragraph"><p>À étudier au calme chez vous:</p></div>
<div class="paragraph"><p><a href="https://raw.githubusercontent.com/gounthar/MyFirstAndroidAppBuiltByJenkins/stf/jenkins/docker-compose.yml" class="bare">https://raw.githubusercontent.com/gounthar/MyFirstAndroidAppBuiltByJenkins/stf/jenkins/docker-compose.yml</a></p></div>
<div class="imageblock"><img src="media/47642838-image4.png" alt="47642838 image4"></div>
<aside class="notes"><div class="paragraph"><p>Dans le temps, on recommandait de faire un script qui attendait que le service soit démarré avant de continuer.
<a href="https://github.com/vishnubob/wait-for-it" class="bare">https://github.com/vishnubob/wait-for-it</a></p></div></aside></div></section><section id="transformer_son_application_en_docker_compose"><h2>Transformer son application en docker compose</h2><div class="slide-content"><div class="paragraph"><p>Deux approches différentes et complémentaires :</p></div>
<div class="ulist"><ul><li class="fragment"><p><a href="https://www.composerize.com/" class="bare">https://www.composerize.com/</a></p></li><li class="fragment"><p><a href="https://github.com/jwilder/dockerize" class="bare">https://github.com/jwilder/dockerize</a></p></li></ul></div></div></section><section id="travaux_pratiques_12"><h2>🎓 Travaux pratiques #12</h2><div class="slide-content"><div class="imageblock"><img src="media/497269344-image5.png" alt="497269344 image5"></div>
<div class="paragraph"><p><a href="https://gitlab.univ-artois.fr/bruno.verachten/devops-docker-tp12.git" class="bare">https://gitlab.univ-artois.fr/bruno.verachten/devops-docker-tp12.git</a></p></div></div></section><section id="travaux_pratiques_12_bis" data-auto-animate><h2>🎓 Travaux pratiques #12-BIS 🔨🔥</h2><div class="slide-content"><div class="paragraph"><p>Ça vous dirait d&#8217;avoir votre propre forge Gitlab ?</p></div>
<div class="paragraph fragment"><p>😏 Non, et bien c&#8217;est parti quand même.</p></div>
<div class="ulist"><ul><li class="fragment"><p>Créez un nouveau fichier appelé <code>docker-compose.yml</code>.</p></li><li class="fragment"><p>Dans ce fichier, définissez trois services : <code>gitlab</code>, <code>gitlab-runner-1</code> et <code>gitlab-runner-2</code>.</p></li><li class="fragment"><p>Pour le service <code>gitlab</code>:</p><div class="ulist"><ul><li><p>utilisez l&#8217;image <code>gitlab/gitlab-ce:latest</code> (préfixée par le cache spécifique ILI)</p></li><li><p>redémarrez toujours le conteneur s&#8217;il s&#8217;arrête,</p></li><li><p>définissez le nom d&#8217;hôte sur <code>localhost</code>,</p></li><li><p>définissez l&#8217;URL externe sur <code><a href="http://localhost" class="bare">http://localhost</a></code> et exposez les ports <code>80</code>, <code>443</code> et <code>22</code>.</p></li></ul></div></li></ul></div></div></section><section id="travaux_pratiques_12_bis_2" data-auto-animate><h2>🎓 Travaux pratiques #12-BIS</h2><div class="slide-content"><div class="ulist"><ul><li class="fragment"><p>Pour les services gitlab-runner-1 et gitlab-runner-2:</p><div class="ulist"><ul><li class="fragment"><p>utilisez l&#8217;image <code>gitlab/gitlab-runner:latest</code> (préfixée par le cache spécifique ILI),</p></li><li class="fragment"><p>redémarrez toujours le conteneur s&#8217;il s&#8217;arrête,</p></li><li class="fragment"><p>dépendez du service gitlab et montez le socket Docker et le fichier de configuration de GitLab Runner.</p></li></ul></div></li><li class="fragment"><p>Créez des volumes pour:</p><div class="ulist"><ul><li class="fragment"><p>les fichiers de configuration,</p></li><li class="fragment"><p>les fichiers journaux</p></li><li class="fragment"><p>et les fichiers de données de GitLab,</p></li><li class="fragment"><p>ainsi que pour les fichiers de configuration de GitLab Runner.</p></li></ul></div></li></ul></div></div></section><section id="travaux_pratiques_12_bis_3" data-auto-animate><h2>🎓 Travaux pratiques #12-BIS 🔨🔥</h2><div class="slide-content"><div class="paragraph"><p>Pas assez détaillé? 😨</p></div>
<div class="ulist"><ul><li class="fragment"><p>Ouvrez votre éditeur de texte préféré et créez un nouveau fichier.</p></li><li class="fragment"><p>Nommez ce fichier <code>docker-compose.yml</code>.</p></li><li class="fragment"><p>Commencez le fichier avec la ligne <code>services:</code> pour commencer à définir les services de votre application.</p></li><li class="fragment"><p>Commencez à définir votre premier service en tapant <code>gitlab:</code> sur une nouvelle ligne. Ce sera le service pour votre serveur GitLab.</p></li><li class="fragment"><p>Sous <code>gitlab:</code>, ajoutez les détails de votre service.</p><div class="ulist"><ul><li class="fragment"><p>Par exemple, <code>image: 'gitlab/gitlab-ce:latest'</code> pour spécifier l&#8217;image Docker à utiliser pour ce service.</p></li></ul></div></li></ul></div></div></section><section id="travaux_pratiques_12_bis_4" data-auto-animate><h2>🎓 Travaux pratiques #12-BIS 🔨🔥</h2><div class="slide-content"><div class="ulist"><ul><li><p>Sous <code>gitlab:</code>, ajoutez les détails de votre service.</p><div class="ulist"><ul><li><p>Par exemple, <code>image: 'gitlab/gitlab-ce:latest'</code> pour spécifier l&#8217;image Docker à utiliser pour ce service.</p></li><li><p>Continuez à ajouter des détails pour le service gitlab, comme <code>restart: always</code> pour toujours redémarrer le conteneur s&#8217;il s&#8217;arrête, et <code>hostname: 'localhost'</code> pour définir le nom d&#8217;hôte du serveur GitLab.</p></li></ul></div></li><li><p>Définissez l&#8217;URL externe de votre serveur GitLab en ajoutant <code>environment:</code> et <code>GITLAB_OMNIBUS_CONFIG: |</code> sur de nouvelles lignes,</p></li><li><p>puis <code>external_url 'http://localhost'</code> sur la ligne suivante.</p></li><li><p>Exposez les ports nécessaires en ajoutant <code>ports:</code> sur une nouvelle ligne,</p></li><li><p>puis <code>- '80:80'</code>, <code>- '443:443'</code> et <code>- '22:22'</code> sur les lignes suivantes.</p></li></ul></div></div></section><section id="travaux_pratiques_12_bis_5" data-auto-animate><h2>🎓 Travaux pratiques #12-BIS 🔨🔥</h2><div class="slide-content"><div class="ulist"><ul><li class="fragment"><p>Montez les volumes nécessaires en ajoutant <code>volumes:</code> sur une nouvelle ligne,</p><div class="ulist"><ul><li class="fragment"><p>puis <code>- 'gitlab_config:/etc/gitlab'</code>,</p></li><li class="fragment"><p><code>- 'gitlab_logs:/var/log/gitlab'</code></p></li><li class="fragment"><p>et <code>- 'gitlab_data:/var/opt/gitlab'</code> sur les lignes suivantes.</p></li></ul></div></li><li class="fragment"><p>Répétez ces étapes pour les services gitlab-runner-1 et gitlab-runner-2, en remplaçant <code>gitlab</code> par <code>gitlab-runner-1</code> et <code>gitlab-runner-2</code> respectivement.</p></li></ul></div></div></section><section id="travaux_pratiques_12_bis_6" data-auto-animate><h2>🎓 Travaux pratiques #12-BIS 🔨🔥</h2><div class="slide-content"><div class="ulist"><ul><li class="fragment"><p>Pour les services <code>gitlab-runner-1</code> et <code>gitlab-runner-2</code>, remplacez l&#8217;URL externe par une dépendance au service gitlab en ajoutant <code>depends_on:</code> sur une nouvelle ligne, puis <code>- gitlab</code> sur la ligne suivante.</p></li><li class="fragment"><p>Montez le socket Docker et le fichier de configuration de GitLab Runner</p><div class="ulist"><ul><li class="fragment"><p>en ajoutant <code>- '/var/run/docker.sock:/var/run/docker.sock'</code></p></li><li class="fragment"><p>et <code>- 'gitlab-runner-1-config:/etc/gitlab-runner'</code> (ou <code>- 'gitlab-runner-2-config:/etc/gitlab-runner'</code> pour <code>gitlab-runner-2</code>) sous <code>volumes:</code>.</p></li></ul></div></li></ul></div></div></section><section id="travaux_pratiques_12_bis_7" data-auto-animate><h2>🎓 Travaux pratiques #12-BIS 🔨🔥</h2><div class="slide-content"><div class="paragraph fragment"><p>Enfin, définissez les volumes pour votre application en ajoutant <code>volumes:</code> sur une nouvelle ligne à la fin de votre fichier, puis</p></div>
<div class="ulist"><ul><li class="fragment"><p><code>- gitlab_config:</code>,</p></li><li class="fragment"><p><code>- gitlab_logs:</code>,</p></li><li class="fragment"><p><code>- gitlab_data:</code>,</p></li><li class="fragment"><p><code>- gitlab-runner-1-config:</code></p></li><li class="fragment"><p>et <code>- gitlab-runner-2-config:</code> sur les lignes suivantes.</p></li></ul></div></div></section><section id="solution_travaux_pratiques_12_bis"><h2>✅ Solution Travaux pratiques #12-BIS 🔨🔥</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml"># This is a Docker Compose file for setting up a GitLab server and two GitLab runners.

services:
  # The GitLab server service
  gitlab:
    # The Docker image to use for the GitLab server
    image: 'gitlab/gitlab-ce:16.6.0-ce.0'
    # Always restart the container if it stops
    restart: always
    # The hostname for the GitLab server
    hostname: 'localhost'
    # Environment variables for the GitLab server
    environment:
      # Configuration for the GitLab Omnibus package
      GITLAB_OMNIBUS_CONFIG: |
        # The external URL for the GitLab server
        external_url 'http://localhost'
    # The ports to expose from the GitLab server
    ports:
      - '80:80'   # HTTP
      - '443:443' # HTTPS
      - '22:22'   # SSH
    # The volumes to mount for the GitLab server
    volumes:
      - 'gitlab_config:/etc/gitlab'       # Configuration files
      - 'gitlab_logs:/var/log/gitlab'     # Log files
      - 'gitlab_data:/var/opt/gitlab'     # Data files

  # The first GitLab runner service
  gitlab-runner-1:
    # The Docker image to use for the GitLab runner
    image: 'gitlab/gitlab-runner:alpine3.16-v16.6.0'
    # Always restart the container if it stops
    restart: always
    # The services this service depends on
    depends_on:
      - gitlab # Depends on the GitLab server
    # The volumes to mount for the GitLab runner
    volumes:
      - '/var/run/docker.sock:/var/run/docker.sock' # Docker socket for running Docker commands
      - 'gitlab-runner-1-config:/etc/gitlab-runner' # Configuration files

  # The second GitLab runner service
  gitlab-runner-2:
    # The Docker image to use for the GitLab runner
    image: 'gitlab/gitlab-runner:alpine3.16-v16.6.0'
    # Always restart the container if it stops
    restart: always
    # The services this service depends on
    depends_on:
      - gitlab # Depends on the GitLab server
    # The volumes to mount for the GitLab runner
    volumes:
      - '/var/run/docker.sock:/var/run/docker.sock' # Docker socket for running Docker commands
      - 'gitlab-runner-2-config:/etc/gitlab-runner' # Configuration files

# The volumes to create for the services
volumes:
  gitlab_config:         # Volume for GitLab server configuration files
  gitlab_logs:           # Volume for GitLab server log files
  gitlab_data:           # Volume for GitLab server data files
  gitlab-runner-1-config: # Volume for GitLab runner 1 configuration files
    name: gitlab-runner-1-config
  gitlab-runner-2-config: # Volume for GitLab runner 2 configuration files
    name: gitlab-runner-2-config</code></pre></div></div></div></section><section id="jai_ma_forge_bon_et_maintenant" class="columns" data-auto-animate><h2>🔨🔥 J&#8217;ai ma forge! Bon, et maintenant? 😐</h2><div class="slide-content"><div class="imageblock column"><img src="media/when.png" alt="when" height="500px"></div>
<div class="videoblock column"><video src="media/gitlab-logs.speed.very.small.mp4" width="100%" height="loop" data-autoplay controls>Your browser does not support the video tag.</video></div></div></section><section id="jai_ma_forge_bon_et_maintenant_2" class="intellij background" data-background-video="media/2000_years_later.mp4" data-background-video-loop data-background-video-muted data-auto-animate><h2>🔨🔥 J&#8217;ai ma forge! Bon, et maintenant? 😐</h2><div class="slide-content"><div class="paragraph"><p>Il va falloir se logguer, lier les runners au serveur, créer un projet, etc&#8230;&#8203;</p></div></div></section><section id="jai_ma_forge_bon_et_maintenant_3" class="columns" data-auto-animate><h2>🔨🔥 J&#8217;ai ma forge! Bon, et maintenant? 😐</h2><div class="slide-content"><div class="imageblock column"><img src="media/gitlab-login.png" alt="gitlab login" height="500px"></div>
<div class="openblock column"><div class="content"><div class="paragraph"><p>Pour trouver le mot de passe, il va falloir le demander gentiment à Gitlab:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker compose -f tp12-bis.yml exec -it gitlab grep 'Password:' /etc/gitlab/initial_root_password
Password: qaPxXU+RqioolV3bAljvs2VYnyYa4jO/UYcis/UXLAk=</code></pre></div></div>
<div class="paragraph fragment"><p>Ensuite, il va falloir restreindre l&#8217;accès:</p></div>
<div class="imageblock fragment"><img src="media/sign-up-restrictions.png" alt="sign up restrictions"></div></div></div></div></section><section id="jai_ma_forge_bon_et_maintenant_4" data-auto-animate><h2>🔨🔥 J&#8217;ai ma forge! Bon, et maintenant? 😐</h2><div class="slide-content"><div class="paragraph"><p>Pour utiliser le runner GitLab dans GitLab, vous devez le configurer.</p></div>
<div class="ulist"><ul><li class="fragment"><p>Pour une configuration correcte, nous aurons besoin d&#8217;un jeton copié depuis le portail.</p></li><li class="fragment"><p>Pire que ça, pas un jeton, mais carrément une commande à adapter à <code>docker compose</code>.</p></li><li class="fragment"><p>Pour ce faire, allez à l&#8217;adresse : <a href="http://localhost/admin/runners" class="bare">http://localhost/admin/runners</a> et cliquez sur le bouton "New instance runner".</p></li><li class="fragment"><p>Choisissez "Linux".</p></li><li class="fragment"><p>"Run untagged jobs"</p></li><li class="fragment"><p>Donnez une description au runner.</p></li><li class="fragment"><p>Cliquez sur le bouton "Create runner"</p></li><li class="fragment"><p>Vous avez ensuite une commande à copier et modifier pour <code>docker compose</code>.</p></li></ul></div></div></section><section id="jai_ma_forge_bon_et_maintenant_5" data-background-iframe="https://www.youtube.com/embed/S-npLuur6KM?rel=0&start=0&enablejsapi=1&autoplay=1&loop=1&controls=1&modestbranding=1" data-auto-animate><div class="slide-content"><aside class="notes"><div class="paragraph"><p><a href="https://youtu.be/S-npLuur6KM" class="bare">https://youtu.be/S-npLuur6KM</a></p></div></aside></div></section><section id="jai_ma_forge_bon_et_maintenant_6" data-auto-animate><h2>🔨🔥 J&#8217;ai ma forge! Bon, et maintenant? 😐</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker compose -f tp12-bis.yml exec gitlab-runner-1 gitlab-runner register --url http://gitlab  --token glrt-PF5rLbUKzku5g8BL2y7J
Runtime platform                                    arch=amd64 os=linux pid=103 revision=853330f9 version=16.5.0
Running in system-mode.

Enter the GitLab instance URL (for example, https://gitlab.com/):
[http://gitlab]:
Verifying runner... is valid                        runner=PF5rLbUKz
Enter a name for the runner. This is stored only in the local config.toml file:
[3c2ee0d97d2b]: runner 1
Enter an executor: parallels, docker-autoscaler, docker+machine, custom, docker, docker-windows, shell, ssh, virtualbox, instance, kubernetes:
shell
Runner registered successfully. Feel free to start it, but if it's running already the config should be automatically reloaded!

Configuration (with the authentication token) was saved in "/etc/gitlab-runner/config.toml"</code></pre></div></div></div></section><section data-background-image="media/gitlab-runners-compose.png" data-background-size="cover" data-auto-animate></section><section id="profils_dans_docker_compose" data-auto-animate><h2>👤 Profils dans Docker Compose 🐙</h2><div class="slide-content"><div class="paragraph"><p>On a vu déjà l&#8217;instruction <code>depends_on</code> dans un fichier Docker Compose.</p></div>
<div class="ulist"><ul><li class="fragment"><p>Elle permet de définir des dépendances entre les services.</p></li><li class="fragment"><p>Mais que faire si on veut définir un lot de services qui fonctionnent ensemble, sans pour autant être en interdépendance ?</p></li><li class="fragment"><p>Les profils dans Docker Compose permettent de définir des groupes de services qui peuvent être activés ou désactivés ensemble.</p></li><li class="fragment"><p>Cela peut être utile pour gérer des environnements de développement, de test et de production différents dans le même fichier Docker Compose.</p></li><li class="fragment"><p>Pour définir un profil pour un service, vous pouvez ajouter la clé <code>profiles</code> à la définition du service dans votre fichier Docker Compose.</p></li></ul></div></div></section><section id="profils_dans_docker_compose_2" data-auto-animate><h2>👤 Profils dans Docker Compose 🐙</h2><div class="slide-content"><div class="paragraph"><p>Par exemple :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  mon_service:
    image: mon_image
    profiles:
      - dev</code></pre></div></div>
<div class="paragraph fragment"><p>Dans cet exemple, le service mon_service appartient au profil dev.</p></div></div></section><section id="profils_dans_docker_compose_3" data-auto-animate><h2>👤 Profils dans Docker Compose 🐙</h2><div class="slide-content"><div class="ulist"><ul><li class="fragment"><p>Pour démarrer seulement les services qui appartiennent à un certain profil, vous pouvez utiliser l&#8217;option <code>--profile</code> avec la commande <code>docker compose up</code>.</p></li><li class="fragment"><p>Par exemple :</p></li></ul></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker compose up --profile dev</code></pre></div></div>
<div class="paragraph fragment"><p>Cette commande démarrera seulement les services qui appartiennent au profil <code>dev</code>.</p></div></div></section><section id="profils_dans_docker_compose_4" data-auto-animate><h2>👤 Profils dans Docker Compose 🐙</h2><div class="slide-content"><div class="ulist"><ul><li class="fragment"><p>Les profils peuvent rendre votre fichier Docker Compose plus organisé et flexible.</p></li><li class="fragment"><p>Ils vous permettent de définir différents environnements dans le même fichier et de choisir facilement quels services démarrer en fonction de vos besoins.</p></li><li class="fragment"><p>Jetons un coup d&#8217;œil à un exemple de fichier Docker Compose avec des profils :</p></li></ul></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  service_dev:
    image: mon_image_dev
    profiles:
      - dev
  service_prod:
    image: mon_image_prod
    profiles:
      - prod</code></pre></div></div>
<div class="ulist"><ul><li class="fragment"><p>Dans cet exemple, nous avons deux services : <code>service_dev</code> et <code>service_prod</code>.</p></li><li class="fragment"><p>Chacun appartient à un profil différent.</p></li></ul></div></div></section><section id="profils_dans_docker_compose_5" data-auto-animate><h2>👤 Profils dans Docker Compose 🐙</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  service_dev:
    image: mon_image_dev
    profiles:
      - dev
  service_prod:
    image: mon_image_prod
    profiles:
      - prod</code></pre></div></div>
<div class="ulist"><ul><li class="fragment"><p>Nous pouvons choisir de démarrer seulement les services de développement avec <code>docker compose up --profile dev</code>, ou uniquement les services de production avec <code>docker compose up --profile prod</code>.</p></li><li class="fragment"><p>Les profils dans Docker Compose sont un outil puissant pour gérer différents environnements dans le même fichier Docker Compose.</p></li><li class="fragment"><p>Ils peuvent rendre votre développement et vos tests plus efficaces et organisés.</p></li></ul></div></div></section><section id="une_autre_forge_ça_vous_dit"><h2>🔨🔥 Une autre forge, ça vous dit? 😐</h2><div class="slide-content"><div class="paragraph fragment"><p>😏 Non, et bien, c&#8217;est parti quand même.</p></div>
<div class="paragraph fragment"><p><a href="https://raw.githubusercontent.com/jenkins-docs/quickstart-tutorials/refs/heads/main/docker-compose.yaml" class="bare">https://raw.githubusercontent.com/jenkins-docs/quickstart-tutorials/refs/heads/main/docker-compose.yaml</a></p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  # Le service sidekick est responsable de la génération des clés SSH et de la vérification de leur existence.
  sidekick_service:
    build: dockerfiles/sidekick/.  # Le Dockerfile pour construire l'image du service sidekick.
    stdin_open: true  # Permet au service de garder STDIN ouvert même s'il n'est pas attaché.
    tty: true  # Alloue un pseudo-TTY pour le service.
    entrypoint: sh -c "/usr/local/bin/keygen.sh /ssh-dir"  # La commande que le service exécute lorsqu'il démarre.
    volumes:
      - agent-ssh-dir:/ssh-dir  # Monte le volume agent-ssh-dir au chemin /ssh-dir à l'intérieur du conteneur.
    healthcheck:  # La commande de vérification de santé pour le service.
      test: [ "CMD-SHELL", "[ -f /ssh-dir/conductor_ok ] || exit 1" ]  # Vérifie si le fichier conductor_ok existe dans le chemin /ssh-dir.
      interval: 5s  # Le temps entre les vérifications de santé.
      timeout: 10s  # Le temps à attendre avant de considérer que la vérification a échoué.
      retries: 5  # Le nombre d'échecs consécutifs nécessaires pour considérer un service comme malsain.

  # Le service jenkins_controller est responsable de la gestion des jobs et des configurations Jenkins.
  jenkins_controller:
    build: dockerfiles/.  # Le Dockerfile pour construire l'image du service jenkins_controller.
    restart: on-failure  # Le service sera redémarré s'il quitte en raison d'une erreur.
    ports:
      - "8080:8080"  # Expose le port 8080 du service à l'hôte.
    volumes:
      - jenkins_home:/var/jenkins_home  # Monte le volume jenkins_home au chemin /var/jenkins_home à l'intérieur du conteneur.
      - agent-ssh-dir:/ssh-dir  # Monte le volume agent-ssh-dir au chemin /ssh-dir à l'intérieur du conteneur.
    depends_on:  # Les services dont ce service dépend.
      sidekick_service:
        condition: service_completed_successfully  # Le sidekick_service doit se terminer avec succès avant que ce service ne démarre.
    healthcheck:  # La commande de vérification de santé pour le service.
      test: [ "CMD-SHELL", "[ -f /ssh-dir/conductor_ok ] || exit 1" ]  # Vérifie si le fichier conductor_ok existe dans le chemin /ssh-dir.
      interval: 5s  # Le temps entre les vérifications de santé.
      timeout: 10s  # Le temps à attendre avant de considérer que la vérification a échoué.
      retries: 5  # Le nombre d'échecs consécutifs nécessaires pour considérer un service comme malsain.

  # Le service default_agent est un agent Jenkins avec un JDK installé.
  default_agent:
    image: jenkins/ssh-agent:5.5.0-jdk17  # L'image Docker pour le service.
    container_name: desktop-jenkins_agent-1  # Le nom du conteneur.
    depends_on:  # Les services dont ce service dépend.
      sidekick_service:
        condition: service_completed_successfully  # Le sidekick_service doit se terminer avec succès avant que ce service ne démarre.
      jenkins_controller:
        condition: service_started  # Le service jenkins_controller doit démarrer avant que ce service ne démarre.
    healthcheck:  # La commande de vérification de santé pour le service.
      test: [ "CMD-SHELL", "[ -f /home/jenkins/.ssh/authorized_keys ] || exit 1" ]  # Vérifie si le fichier authorized_keys existe dans le chemin /home/jenkins/.ssh.
      interval: 5s  # Le temps entre les vérifications de santé.
      timeout: 10s  # Le temps à attendre avant de considérer que la vérification a échoué.
      retries: 5  # Le nombre d'échecs consécutifs nécessaires pour considérer un service comme malsain.
    volumes:
      - agent-ssh-dir:/home/jenkins/.ssh:ro  # Monte le volume agent-ssh-dir au chemin /home/jenkins/.ssh à l'intérieur du conteneur en lecture seule.

  # Le service maven est un agent Jenkins avec Maven installé.
  maven:
    build: dockerfiles/maven/.  # Le Dockerfile pour construire l'image du service Maven.
    container_name: desktop-jenkins_agent-1  # Le nom du conteneur.
    profiles:
      - maven  # Les profils à appliquer au service. Cela permet de personnaliser le comportement du service en fonction des besoins spécifiques.
    depends_on:  # Les services dont ce service dépend.
      sidekick_service:
        condition: service_completed_successfully  # Le sidekick_service doit se terminer avec succès avant que ce service ne démarre.
      jenkins_controller:
        condition: service_started  # Le service jenkins_controller doit démarrer avant que ce service ne démarre.
    healthcheck:  # La commande de vérification de santé pour le service.
      test: [ "CMD-SHELL", "[ -f /home/jenkins/.ssh/authorized_keys ] || exit 1" ]  # Vérifie si le fichier authorized_keys existe dans le chemin /home/jenkins/.ssh.
      interval: 5s  # Le temps entre les vérifications de santé.
      timeout: 10s  # Le temps à attendre avant de considérer que la vérification a échoué.
      retries: 5  # Le nombre d'échecs consécutifs nécessaires pour considérer un service comme malsain.
    volumes:
      - agent-ssh-dir:/home/jenkins/.ssh:ro  # Monte le volume agent-ssh-dir au chemin /home/jenkins/.ssh à l'intérieur du conteneur en lecture seule.

  # Le service python est un agent Jenkins avec Python installé.
  python:
    build: dockerfiles/python/.  # Le Dockerfile pour construire l'image du service Python.
    container_name: desktop-jenkins_agent-1  # Le nom du conteneur.
    profiles:
      - python  # Les profils à appliquer au service. Cela permet de personnaliser le comportement du service en fonction des besoins spécifiques.
    depends_on:  # Les services dont ce service dépend.
      sidekick_service:
        condition: service_completed_successfully  # Le sidekick_service doit se terminer avec succès avant que ce service ne démarre.
      jenkins_controller:
        condition: service_started  # Le service jenkins_controller doit démarrer avant que ce service ne démarre.
    healthcheck:  # La commande de vérification de santé pour le service.
      test: [ "CMD-SHELL", "[ -f /home/jenkins/.ssh/authorized_keys ] || exit 1" ]  # Vérifie si le fichier authorized_keys existe dans le chemin /home/jenkins/.ssh.
      interval: 5s  # Le temps entre les vérifications de santé.
      timeout: 10s  # Le temps à attendre avant de considérer que la vérification a échoué.
      retries: 5  # Le nombre d'échecs consécutifs nécessaires pour considérer un service comme malsain.
    volumes:
      - agent-ssh-dir:/home/jenkins/.ssh:ro  # Monte le volume agent-ssh-dir au chemin /home/jenkins/.ssh à l'intérieur du conteneur en lecture seule.

  # Le service node est un agent Jenkins avec Node.js installé.
  node:
    build: dockerfiles/node/.  # Le Dockerfile pour construire l'image du service Node.js.
    environment:
      - GITPOD_WORKSPACE_URL=${GITPOD_WORKSPACE_URL}  # Les variables d'environnement pour le service.
    container_name: desktop-jenkins_agent-1  # Le nom du conteneur.
    profiles:
      - node  # Les profils à appliquer au service. Cela permet de personnaliser le comportement du service en fonction des besoins spécifiques.
    depends_on:  # Les services dont ce service dépend.
      sidekick_service:
        condition: service_completed_successfully  # Le sidekick_service doit se terminer avec succès avant que ce service ne démarre.
      jenkins_controller:
        condition: service_started  # Le service jenkins_controller doit démarrer avant que ce service ne démarre.
    ports:
      - "3000:3000"  # Expose le port 3000 du service à l'hôte.
    healthcheck:  # La commande de vérification de santé pour le service.
      test: [ "CMD-SHELL", "[ -f /home/jenkins/.ssh/authorized_keys ] || exit 1" ]  # Vérifie si le fichier authorized_keys existe dans le chemin /home/jenkins/.ssh.
      interval: 5s  # Le temps entre les vérifications de santé.
      timeout: 10s  # Le temps à attendre avant de considérer que la vérification a échoué.
      retries: 5  # Le nombre d'échecs consécutifs nécessaires pour considérer un service comme malsain.
    volumes:
      - agent-ssh-dir:/home/jenkins/.ssh:ro  # Monte le volume agent-ssh-dir au chemin /home/jenkins/.ssh à l'intérieur du conteneur en lecture seule.

  # Le service multi_jenkins_controller est un contrôleur Jenkins pour gérer plusieurs jobs et configurations Jenkins.
  multi_jenkins_controller:
    build: 06_multibranch_pipeline/dockerfiles/.  # Le Dockerfile pour construire l'image du service multi Jenkins controller.
    restart: on-failure  # Le service sera redémarré s'il quitte en raison d'une erreur.
    ports:
      - "8080:8080"  # Expose le port 8080 du service à l'hôte.
    volumes:
      - jenkins_home:/var/jenkins_home  # Monte le volume jenkins_home au chemin /var/jenkins_home à l'intérieur du conteneur.
      - agent-ssh-dir:/ssh-dir  # Monte le volume agent-ssh-dir au chemin /ssh-dir à l'intérieur du conteneur.
    depends_on:  # Les services dont ce service dépend.
      sidekick_service:
        condition: service_completed_successfully  # Le sidekick_service doit se terminer avec succès avant que ce service ne démarre.
    healthcheck:  # La commande de vérification de santé pour le service.
      test: [ "CMD-SHELL", "[ -f /ssh-dir/conductor_ok ] || exit 1" ]  # Vérifie si le fichier conductor_ok existe dans le chemin /ssh-dir.
      interval: 5s  # Le temps entre les vérifications de santé.
      timeout: 10s  # Le temps à attendre avant de considérer que la vérification a échoué.
      retries: 5  # Le nombre d'échecs consécutifs nécessaires pour considérer un service comme malsain.

  # Le service multi est un agent Jenkins pour gérer plusieurs jobs et configurations Jenkins.
  multi:
    build: 06_multibranch_pipeline/dockerfiles/agent/.  # Le Dockerfile pour construire l'image du service multi Jenkins agent.
    environment:
      - GITPOD_WORKSPACE_URL=${GITPOD_WORKSPACE_URL}  # Les variables d'environnement pour le service.
    container_name: desktop-jenkins_agent-1  # Le nom du conteneur.
    profiles:
      - multi  # Les profils à appliquer au service. Cela permet de personnaliser le comportement du service en fonction des besoins spécifiques.
    depends_on:  # Les services dont ce service dépend.
      sidekick_service:
        condition: service_completed_successfully  # Le sidekick_service doit se terminer avec succès avant que ce service ne démarre.
      multi_jenkins_controller:
        condition: service_started  # Le service multi_jenkins_controller doit démarrer avant que ce service ne démarre.
    ports:
      - "3000:3000"  # Expose le port 3000 du service à l'hôte.
      - "5000:5000"  # Expose le port 5000 du service à l'hôte.
    healthcheck:  # La commande de vérification de santé pour le service.
      test: [ "CMD-SHELL", "[ -f /home/jenkins/.ssh/authorized_keys ] || exit 1" ]  # Vérifie si le fichier authorized_keys existe dans le chemin /home/jenkins/.ssh.
      interval: 5s  # Le temps entre les vérifications de santé.
      timeout: 10s  # Le temps à attendre avant de considérer que la vérification a échoué.
      retries: 5  # Le nombre d'échecs consécutifs nécessaires pour considérer un service comme malsain.
    volumes:
      - agent-ssh-dir:/home/jenkins/.ssh:ro  # Monte le volume agent-ssh-dir au chemin /home/jenkins/.ssh à l'intérieur du conteneur en lecture seule.

# Les volumes utilisés par les services.
volumes:
  jenkins_home:  # Un volume pour stocker les données de Jenkins.
  agent-ssh-dir:  # Un volume pour stocker les clés SSH.
    name: agent-ssh-dir  # Le nom du volume.</code></pre></div></div></div></section><section id="une_autre_forge_ça_vous_dit_2"><h2>🔨🔥 Une autre forge, ça vous dit? 😐</h2><div class="slide-content"><div class="paragraph"><p>Indigeste? 😨</p></div>
<div class="paragraph fragment"><p>Ne relevons que les points importants:</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">  # Le service maven est un agent Jenkins avec Maven installé.
  maven:
    build: dockerfiles/maven/.  # Le Dockerfile pour construire l'image du service Maven.
    container_name: desktop-jenkins_agent-1  # Le nom du conteneur.
    profiles:
      - maven  # Les profils à appliquer au service. Cela permet de personnaliser le comportement du service en fonction des besoins spécifiques.
    depends_on:  # Les services dont ce service dépend.
      sidekick_service:
        condition: service_completed_successfully  # Le sidekick_service doit se terminer avec succès avant que ce service ne démarre.
      jenkins_controller:
        condition: service_started  # Le service jenkins_controller doit démarrer avant que ce service ne démarre.
    healthcheck:  # La commande de vérification de santé pour le service.
      test: [ "CMD-SHELL", "[ -f /home/jenkins/.ssh/authorized_keys ] || exit 1" ]  # Vérifie si le fichier authorized_keys existe dans le chemin /home/jenkins/.ssh.
      interval: 5s  # Le temps entre les vérifications de santé.
      timeout: 10s  # Le temps à attendre avant de considérer que la vérification a échoué.
      retries: 5  # Le nombre d'échecs consécutifs nécessaires pour considérer un service comme malsain.
    volumes:
      - agent-ssh-dir:/home/jenkins/.ssh:ro  # Monte le volume agent-ssh-dir au chemin /home/jenkins/.ssh à l'intérieur du conteneur en lecture seule.</code></pre></div></div></div></section><section id="une_autre_forge_ça_vous_dit_3" data-auto-animate><h2>🔨🔥 Une autre forge, ça vous dit? 😐</h2><div class="slide-content"><div class="paragraph"><p>Maven</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">FROM jenkins/ssh-agent:6.10.0-jdk17 as ssh-agent

# ca-certificates because curl will need it later on for the maven installation
RUN apt-get update &amp;&amp; apt-get install -y --no-install-recommends ca-certificates curl &amp;&amp; apt-get clean &amp;&amp; \
  rm -rf /var/lib/apt/lists/*

# Now time to install maven
ARG MAVEN_VERSION=3.9.2

# Set SHELL flags for RUN commands to allow -e and pipefail
# Rationale:https://github.com/hadolint/hadolint/wiki/DL4006
SHELL ["/bin/bash", "-eo", "pipefail", "-c"]

# Add a checksum for the maven binary
RUN curl -sS -L -O --output-dir /tmp/ --create-dirs  https://archive.apache.org/dist/maven/maven-3/${MAVEN_VERSION}/binaries/apache-maven-${MAVEN_VERSION}-bin.tar.gz \
    &amp;&amp; printf "%s" "$(sha512sum /tmp/apache-maven-${MAVEN_VERSION}-bin.tar.gz)" | sha512sum -c - \
    &amp;&amp; curl -sS -L -O --output-dir /tmp/ --create-dirs  https://downloads.apache.org/maven/maven-3/${MAVEN_VERSION}/binaries/apache-maven-${MAVEN_VERSION}-bin.tar.gz.sha512 \
    &amp;&amp; printf "%s /tmp/apache-maven-${MAVEN_VERSION}-bin.tar.gz" "$(cat /tmp/apache-maven-${MAVEN_VERSION}-bin.tar.gz.sha512)" | sha512sum --check --status - \
    &amp;&amp; tar xzf "/tmp/apache-maven-${MAVEN_VERSION}-bin.tar.gz" -C /opt/ \
    &amp;&amp; rm "/tmp/apache-maven-${MAVEN_VERSION}-bin.tar.gz" \
    &amp;&amp; ln -s /opt/apache-maven-${MAVEN_VERSION} /opt/maven \
    &amp;&amp; ln -s /opt/maven/bin/mvn /usr/bin/mvn \
    &amp;&amp; mkdir -p /etc/profile.d \
    &amp;&amp; echo "export JAVA_HOME=$JAVA_HOME \n \
             export M2_HOME=/opt/maven \n \
             export PATH=${M2_HOME}/bin:${PATH}" &gt; /etc/profile.d/maven.sh
ENV M2_HOME="/opt/maven"
ENV PATH="${M2_HOME}/bin/:${PATH}"
RUN echo "PATH=${PATH}" &gt;&gt; /etc/environment &amp;&amp; chown -R jenkins:jenkins "${JENKINS_AGENT_HOME}"</code></pre></div></div></div></section><section id="une_autre_forge_ça_vous_dit_4" data-auto-animate><h2>🔨🔥 Une autre forge, ça vous dit? 😐</h2><div class="slide-content"><div class="paragraph"><p>Python</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">  # Le service python est un agent Jenkins avec Python installé.
  python:
    build: dockerfiles/python/.  # Le Dockerfile pour construire l'image du service Python.
    container_name: desktop-jenkins_agent-1  # Le nom du conteneur.
    profiles:
      - python  # Les profils à appliquer au service. Cela permet de personnaliser le comportement du service en fonction des besoins spécifiques.
    depends_on:  # Les services dont ce service dépend.
      sidekick_service:
        condition: service_completed_successfully  # Le sidekick_service doit se terminer avec succès avant que ce service ne démarre.
      jenkins_controller:
        condition: service_started  # Le service jenkins_controller doit démarrer avant que ce service ne démarre.
    healthcheck:  # La commande de vérification de santé pour le service.
      test: [ "CMD-SHELL", "[ -f /home/jenkins/.ssh/authorized_keys ] || exit 1" ]  # Vérifie si le fichier authorized_keys existe dans le chemin /home/jenkins/.ssh.
      interval: 5s  # Le temps entre les vérifications de santé.
      timeout: 10s  # Le temps à attendre avant de considérer que la vérification a échoué.
      retries: 5  # Le nombre d'échecs consécutifs nécessaires pour considérer un service comme malsain.
    volumes:
      - agent-ssh-dir:/home/jenkins/.ssh:ro  # Monte le volume agent-ssh-dir au chemin /home/jenkins/.ssh à l'intérieur du conteneur en lecture seule.</code></pre></div></div></div></section><section id="une_autre_forge_ça_vous_dit_5" data-auto-animate><h2>🔨🔥 Une autre forge, ça vous dit? 😐</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile"># Use the base image
FROM jenkins/ssh-agent:5.12.0-jdk17 as ssh-agent

# Install necessary Dependencies
RUN apt-get update &amp;&amp; apt-get install -y --no-install-recommends \
    binutils ca-certificates curl git python3 python3-pip python3-setuptools python3-wheel python3-dev wget

# Create an alias for python3 as python
RUN ln -s /usr/bin/python3 /usr/bin/python

# Install required python packages
RUN pip install docker-py feedparser nosexcover prometheus_client pycobertura pylint pytest pytest-cov requests setuptools sphinx pyinstaller

# Add the Jenkins agent user to the environment
RUN echo "PATH=${PATH}" &gt;&gt; /etc/environment

# Set ownership for Jenkins agent home directory
RUN chown -R jenkins:jenkins "${JENKINS_AGENT_HOME}"</code></pre></div></div></div></section><section id="une_autre_forge_ça_vous_dit_6" data-auto-animate><h2>🔨🔥 Une autre forge, ça vous dit? 😐</h2><div class="slide-content"><div class="paragraph"><p>À vous maintenant!</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">git clone https://github.com/jenkins-docs/quickstart-tutorials.git</code></pre></div></div>
<div class="paragraph fragment"><p>À vous de modifier les sources de façon à passer par le cache ILI</p></div>
<div class="paragraph fragment"><p>Ensuite, ne restera qu&#8217;à lancer la "forge":</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker compose up --build -d --force-recreate maven</code></pre></div></div>
<div class="paragraph fragment"><p>Ou encore si vous voulez tout construire localement:</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker compose -f build-docker-compose.yaml up --build -d --force-recreate maven</code></pre></div></div></div></section><section data-background-image="media/jenkins-compose.png" data-background-size="cover" data-auto-animate></section><section id="autre_étude_de_cas" data-auto-animate><h2>Autre étude de cas 📚🔍</h2><div class="slide-content"><div class="paragraph"><p>Et pourquoi pas s&#8217;attaquer au docker compose qui a généré ce cours ?</p></div></div></section><section id="autre_étude_de_cas_2" data-auto-animate><h2>Autre étude de cas 📚🔍</h2><div class="slide-content"><div class="paragraph"><p>Et pourquoi pas s&#8217;attaquer au docker compose qui a généré ce cours ?</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml"># Ceci est un fichier Docker Compose pour un projet qui comprend plusieurs services.

# 'x-slides-base' est une ancre YAML qui définit une configuration commune pour plusieurs services.
x-slides-base: &amp;slides-base
  # La configuration de construction pour l'image Docker.
  build:
    # Le contexte de construction est le répertoire courant.
    context: ./
    args:
      # Active la fonction de mise en cache en ligne de Docker BuildKit.
      BUILDKIT_INLINE_CACHE: 1
  # Variables d'environnement pour le conteneur Docker.
  environment:
    - PRESENTATION_URL=${PRESENTATION_URL}
    - REPOSITORY_URL=${REPOSITORY_URL}
  # L'ID utilisateur qui exécute les commandes à l'intérieur du conteneur.
  user: ${CURRENT_UID}
  # Un montage tmpfs pour des opérations d'E/S plus rapides.
  tmpfs:
    - ${BUILD_DIR}
  # Volumes pour le conteneur Docker.
  volumes:
    - ./content:/app/content
    - ./assets:/app/assets
    - ${DIST_DIR}:/app/dist
    - ./gulp/gulpfile.js:/app/gulpfile.js
    - ./gulp/tasks:/app/tasks
    - ./npm-packages:/app/npm-packages

# Les services qui composent l'application.
services:
  # Le service 'serve'.
  serve:
    # Utilise la configuration commune définie par l'ancre 'x-slides-base'.
    &lt;&lt;: *slides-base
    # Expose le port 8000 du conteneur à l'hôte.
    ports:
      - "8000:8000"

  # Le service 'build'.
  build:
    &lt;&lt;: *slides-base
    # Ce service dépend du service 'qrcode'.
    depends_on:
      qrcode:
        # Le service 'qrcode' doit se terminer avec succès avant que ce service ne démarre.
        condition: service_completed_successfully
    # Le point d'entrée pour le conteneur Docker.
    entrypoint: &gt;
      sh -xc 'gulp build &amp;&amp; cp -r "${BUILD_DIR}"/* /app/dist/'

  # Le service 'qrcode'.
  qrcode:
    &lt;&lt;: *slides-base
    # Le point d'entrée pour le conteneur Docker.
    entrypoint: /app/node_modules/.bin/qrcode
    # La commande à exécuter dans le conteneur Docker.
    command: &gt;
      -t png -o /app/content/media/qrcode.png ${PRESENTATION_URL}

  # Le service 'pdf'.
  pdf:
    # L'image Docker pour ce service.
    image: ghcr.io/astefanutti/decktape:3.7.0
    # Ce service dépend du service 'build'.
    depends_on:
      build:
        # Le service 'build' doit se terminer avec succès avant que ce service ne démarre.
        condition: service_completed_successfully
    # L'ID utilisateur qui exécute les commandes à l'intérieur du conteneur.
    user: ${CURRENT_UID}
    # Volumes pour le conteneur Docker.
    volumes:
      - ${DIST_DIR}:/slides
    # La commande à exécuter dans le conteneur Docker.
    command: &gt;
      /slides/index.html /slides/slides.pdf --size='1024x768' --pause 0</code></pre></div></div></div></section><section id="autre_étude_de_cas_3" data-auto-animate><h2>Autre étude de cas 📚🔍</h2><div class="slide-content"><div class="paragraph"><p>Et pourquoi pas s&#8217;attaquer au docker compose qui a généré ce cours ?</p></div>
<div class="paragraph fragment"><p>Indigeste? 😨</p></div>
<div class="paragraph fragment"><p>Ne relevons que les points importants:</p></div>
<div class="paragraph fragment"><p>Les ancres&#8230;&#8203;</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml"># Ceci est un fichier Docker Compose pour un projet qui comprend plusieurs services.

# 'x-slides-base' est une ancre YAML qui définit une configuration commune pour plusieurs services.
x-slides-base: &amp;slides-base
  # La configuration de construction pour l'image Docker.
  build:
    # Le contexte de construction est le répertoire courant.
    context: ./
    args:
      # Active la fonction de mise en cache en ligne de Docker BuildKit.
      BUILDKIT_INLINE_CACHE: 1
  # Variables d'environnement pour le conteneur Docker.
  environment:
    - PRESENTATION_URL=${PRESENTATION_URL}
    - REPOSITORY_URL=${REPOSITORY_URL}
  # L'ID utilisateur qui exécute les commandes à l'intérieur du conteneur.
  user: ${CURRENT_UID}
  # Un montage tmpfs pour des opérations d'E/S plus rapides.
  tmpfs:
    - ${BUILD_DIR}
  # Volumes pour le conteneur Docker.
  volumes:
    - ./content:/app/content
    - ./assets:/app/assets
    - ${DIST_DIR}:/app/dist
    - ./gulp/gulpfile.js:/app/gulpfile.js
    - ./gulp/tasks:/app/tasks
    - ./npm-packages:/app/npm-packages</code></pre></div></div></div></section><section id="les_ancres_dans_docker_compose" data-auto-animate><h2>➡️🔄 Les ancres dans <code>docker compose</code> ⚓</h2><div class="slide-content"><div class="paragraph"><p>Docker Compose permet de définir et de gérer plusieurs services Docker dans un seul fichier YAML.</p></div>
<div class="ulist"><ul><li class="fragment"><p>Les ancres (<code>&amp;</code>) et les alias (<code>*</code>) sont des fonctionnalités YAML qui peuvent être utilisées dans Docker Compose pour réutiliser des configurations.</p></li><li class="fragment"><p>Une ancre est une référence à un objet ou à une valeur dans un fichier YAML.
Elle est définie en utilisant l&#8217;opérateur <code>&amp;</code> suivi d&#8217;un nom unique.</p></li></ul></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">x-slides-base: &amp;slides-base
  build:
    context: ./</code></pre></div></div>
<div class="paragraph fragment"><p>Dans cet exemple, <code>x-slides-base</code> est une ancre qui représente un objet avec une clé <code>build</code>.</p></div></div></section><section id="les_ancres_dans_docker_compose_2" data-auto-animate><h2>➡️🔄 Les ancres dans <code>docker compose</code> ⚓</h2><div class="slide-content"><div class="paragraph"><p>Les ancres peuvent être référencées ailleurs dans le fichier YAML en utilisant l&#8217;opérateur <code>*</code>.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">services:
  serve:
    &lt;&lt;: *slides-base</code></pre></div></div>
<div class="ulist"><ul><li class="fragment"><p>Les ancres permettent de réutiliser des configurations, ce qui rend le fichier Docker Compose plus lisible et plus facile à maintenir.</p></li><li class="fragment"><p>Si vous devez modifier une configuration qui est utilisée à plusieurs endroits, vous pouvez simplement modifier l&#8217;ancre.</p></li><li class="fragment"><p>En conclusion, les ancres et les alias sont des outils puissants pour gérer des configurations complexes dans Docker Compose. Ils permettent de réduire la duplication et d&#8217;améliorer la lisibilité de votre fichier Docker Compose.</p></li></ul></div></div></section><section id="autre_étude_de_cas_4" data-auto-animate><h2>Autre étude de cas 📚🔍</h2><div class="slide-content"><div class="paragraph"><p>Le fameux qrcode&#8230;&#8203;</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">  # Le service 'qrcode'.
  qrcode:
    &lt;&lt;: *slides-base
    # Le point d'entrée pour le conteneur Docker.
    entrypoint: /app/node_modules/.bin/qrcode
    # La commande à exécuter dans le conteneur Docker.
    command: &gt;
      -t png -o /app/content/media/qrcode.png ${PRESENTATION_URL}</code></pre></div></div></div></section><section id="autre_étude_de_cas_5" data-auto-animate><h2>Autre étude de cas 📚🔍</h2><div class="slide-content"><div class="paragraph"><p>Le service qui construit les slides à partir d'`asciidoc` avec <code>reveal.js</code>.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">  # Le service 'build'.
  build:
    &lt;&lt;: *slides-base
    # Ce service dépend du service 'qrcode'.
    depends_on:
      qrcode:
        # Le service 'qrcode' doit se terminer avec succès avant que ce service ne démarre.
        condition: service_completed_successfully
    # Le point d'entrée pour le conteneur Docker.
    entrypoint: &gt;
      sh -xc 'gulp build &amp;&amp; cp -r "${BUILD_DIR}"/* /app/dist/'</code></pre></div></div></div></section><section id="autre_étude_de_cas_6" data-auto-animate><h2>Autre étude de cas 📚🔍</h2><div class="slide-content"><div class="paragraph"><p>Le service qui construit les slides à partir d'`asciidoc` avec <code>reveal.js</code>.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">  # Le service 'serve'.
  serve:
    # Utilise la configuration commune définie par l'ancre 'x-slides-base'.
    &lt;&lt;: *slides-base
    # Expose le port 8000 du conteneur à l'hôte.
    ports:
      - "8000:8000"</code></pre></div></div></div></section><section id="autre_étude_de_cas_7" data-auto-animate><h2>Autre étude de cas 📚🔍</h2><div class="slide-content"><div class="paragraph"><p>Le service qui construit le pdf à partir des slides.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">  # Le service 'pdf'.
  pdf:
    # L'image Docker pour ce service.
    image: ghcr.io/astefanutti/decktape:3.7.0
    # Ce service dépend du service 'build'.
    depends_on:
      build:
        # Le service 'build' doit se terminer avec succès avant que ce service ne démarre.
        condition: service_completed_successfully
    # L'ID utilisateur qui exécute les commandes à l'intérieur du conteneur.
    user: ${CURRENT_UID}
    # Volumes pour le conteneur Docker.
    volumes:
      - ${DIST_DIR}:/slides
    # La commande à exécuter dans le conteneur Docker.
    command: &gt;
      /slides/index.html /slides/slides.pdf --size='1024x768' --pause 0</code></pre></div></div></div></section><section id="autre_étude_de_cas_8" data-auto-animate><h2>Autre étude de cas 📚🔍</h2><div class="slide-content"><div class="paragraph"><p>Pour rappel, l&#8217;ancre contenait :</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml"># 'x-slides-base' est une ancre YAML qui définit une configuration commune pour plusieurs services.
x-slides-base: &amp;slides-base
  # La configuration de construction pour l'image Docker.
  build:
    # Le contexte de construction est le répertoire courant.
    context: ./
    args:
      # Active la fonction de mise en cache en ligne de Docker BuildKit.
      BUILDKIT_INLINE_CACHE: 1
  # Variables d'environnement pour le conteneur Docker.
  environment:
    - PRESENTATION_URL=${PRESENTATION_URL}
    - REPOSITORY_URL=${REPOSITORY_URL}
  # L'ID utilisateur qui exécute les commandes à l'intérieur du conteneur.
  user: ${CURRENT_UID}
  # Un montage tmpfs pour des opérations d'E/S plus rapides.
  tmpfs:
    - ${BUILD_DIR}
  # Volumes pour le conteneur Docker.
  volumes:
    - ./content:/app/content
    - ./assets:/app/assets
    - ${DIST_DIR}:/app/dist
    - ./gulp/gulpfile.js:/app/gulpfile.js
    - ./gulp/tasks:/app/tasks
    - ./npm-packages:/app/npm-packages</code></pre></div></div></div></section><section id="build_quoi" class="columns" data-auto-animate><h2>➡️🔄 Build quoi? 🛠️📦</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="ulist"><ul><li class="fragment"><p>Docker BuildKit est un outil de construction de Docker qui apporte de nombreuses améliorations par rapport à l&#8217;ancien système de construction.</p></li><li class="fragment"><p>L&#8217;une de ces améliorations est la mise en cache en ligne.</p></li><li class="fragment"><p>La mise en cache en ligne est une fonctionnalité de Docker BuildKit qui permet de réutiliser les couches de cache existantes lors de la construction d&#8217;une image Docker.</p></li></ul></div>
<div class="imageblock fragment"><img src="media/multi-layered-cake-removebg-preview.png" alt="multi layered cake removebg preview" height="100px"></div></div></div>
<div class="openblock column is-one-third"><div class="content"><div class="paragraph fragment"><p>Elle est activée en définissant l&#8217;argument <code>BUILDKIT_INLINE_CACHE</code> à <code>1</code>.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">args:
  BUILDKIT_INLINE_CACHE: 1</code></pre></div></div></div></div></div></section><section id="environnement" class="columns" data-auto-animate><h2>➡️🔄 Environnement 🌍🌿</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">  # Variables d'environnement pour le conteneur Docker.
  environment:
    - PRESENTATION_URL=${PRESENTATION_URL}
    - REPOSITORY_URL=${REPOSITORY_URL}</code></pre></div></div></div></div>
<div class="openblock column"><div class="content"><div class="paragraph"><p>Deux variables d&#8217;environnement sont définies pour le conteneur Docker : <code>PRESENTATION_URL</code> et <code>REPOSITORY_URL</code>.</p></div>
<div class="paragraph fragment"><p>Ces variables sont définies à l&#8217;aide de la syntaxe <code>${VARIABLE_NAME}</code>, qui est une manière standard d&#8217;accéder aux variables d&#8217;environnement dans les fichiers de configuration YAML.</p></div></div></div></div></section><section id="environnement_2" data-auto-animate><h2>➡️🔄 Environnement 🌍🌿</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">  # Variables d'environnement pour le conteneur Docker.
  environment:
    - PRESENTATION_URL=${PRESENTATION_URL}
    - REPOSITORY_URL=${REPOSITORY_URL}</code></pre></div></div>
<div class="paragraph"><p>Lorsque Docker Compose rencontre cette syntaxe, il cherche la valeur de la variable d&#8217;environnement dans plusieurs endroits, en suivant un ordre spécifique :</p></div>
<div class="ulist"><ul><li class="fragment"><p>Il vérifie d&#8217;abord si la variable est définie dans le shell courant.</p></li><li class="fragment"><p>Si c&#8217;est le cas, il utilise cette valeur.</p></li><li class="fragment"><p>Si la variable n&#8217;est pas définie dans le shell, Docker Compose cherche ensuite dans un fichier <code>.env</code> situé dans le même répertoire que le fichier <code>docker-compose.yml</code>.</p></li><li class="fragment"><p>Si la variable est définie dans ce fichier, Docker Compose utilise cette valeur.</p></li></ul></div></div></section><section id="environnement_3" data-auto-animate><h2>➡️🔄 Environnement 🌍🌿</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">  # Variables d'environnement pour le conteneur Docker.
  environment:
    - PRESENTATION_URL=${PRESENTATION_URL}
    - REPOSITORY_URL=${REPOSITORY_URL}</code></pre></div></div>
<div class="ulist"><ul><li><p>Si la variable n&#8217;est définie ni dans le shell ni dans le fichier <code>.env</code>, Docker Compose utilise la valeur par défaut spécifiée dans le fichier <code>docker-compose.yml</code> (s&#8217;il y en a une).</p></li><li><p>Dans notre cas, aucune valeur par défaut n&#8217;est spécifiée, donc si la variable n&#8217;est définie ni dans le shell ni dans le fichier <code>.env</code>, Docker Compose générera une erreur.</p></li></ul></div></div></section><section id="autre_étude_de_cas_9" data-auto-animate><h2>Autre étude de cas 📚🔍</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">  # L'ID utilisateur qui exécute les commandes à l'intérieur du conteneur.
  user: ${CURRENT_UID}</code></pre></div></div>
<div class="ulist"><ul><li class="fragment"><p>Dans Docker, chaque instruction dans le Dockerfile est exécutée par un utilisateur particulier.</p></li><li class="fragment"><p>Par défaut, cet utilisateur est root, mais pour des raisons de sécurité, il est souvent recommandé d&#8217;exécuter les processus en tant qu&#8217;utilisateur non root.</p></li><li class="fragment"><p>Cette ligne définit l&#8217;ID de l&#8217;utilisateur qui exécutera les commandes à l&#8217;intérieur du conteneur Docker à la valeur de la variable d&#8217;environnement <code>CURRENT_UID</code>.</p></li><li class="fragment"><p>La syntaxe <code>${CURRENT_UID}</code> est utilisée pour accéder à la valeur d&#8217;une variable d&#8217;environnement.</p></li><li class="fragment"><p>Dans ce cas, Docker Compose recherchera une variable d&#8217;environnement nommée <code>CURRENT_UID</code> et utilisera sa valeur.</p></li><li class="fragment"><p>Si <code>CURRENT_UID</code> n&#8217;est pas défini dans l&#8217;environnement où Docker Compose est exécuté, Docker Compose renverra une erreur.</p></li></ul></div></div></section><section id="autre_étude_de_cas_10" data-auto-animate><h2>Autre étude de cas 📚🔍</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml"># Ce Dockerfile met en place un environnement Node.js avec des outils et dépendances supplémentaires.
# Il est basé sur l'image Docker officielle de Node.js (version 22, variante Alpine).

FROM node:23-alpine

# Installer la dernière version des dépendances requises
# hadolint ignore=DL3018
RUN apk add --no-cache \
  curl \ # Outil pour transférer des données avec des URLs
  git \ # Système de contrôle de version distribué
  tini \ # Un init minuscule mais valide pour les conteneurs
  unzip # Outil pour décompresser les fichiers zip

# Installer les dépendances NPM globalement (dernières versions)
# hadolint ignore=DL3016,DL3059
RUN npm install --global npm npm-check-updates # Mettre à jour npm à la dernière version et installer npm-check-updates

# Copier les dépendances NPM de l'application dans l'image Docker
COPY ./npm-packages /app/npm-packages
# Créer des liens symboliques pour package.json et package-lock.json à la racine de /app
# Cela permet d'exécuter les opérations npm sans erreur ENOENT
RUN ln -s /app/npm-packages/package.json /app/package.json \
  &amp;&amp; ln -s /app/npm-packages/package-lock.json /app/package-lock.json

# Définir le répertoire de travail dans l'image Docker à /app
WORKDIR /app

# Télécharger et installer une version spécifique de FontAwesome
ARG FONTAWESOME_VERSION=6.4.0
RUN curl --silent --show-error --location --output /tmp/fontawesome.zip \
    "https://use.fontawesome.com/releases/v${FONTAWESOME_VERSION}/fontawesome-free-${FONTAWESOME_VERSION}-web.zip" \
  &amp;&amp; unzip -q /tmp/fontawesome.zip -d /tmp \
  &amp;&amp; mv /tmp/"fontawesome-free-${FONTAWESOME_VERSION}-web" /app/fontawesome \
  &amp;&amp; rm -rf /tmp/font*

# Installer les dépendances NPM en utilisant le package-lock.json
# Si l'installation échoue, revenir à une installation npm régulière
RUN { npm install-clean &amp;&amp; npx update-browserslist-db@latest; } || npm install

# Lier la commande gulp pour qu'elle soit disponible dans le PATH
# hadolint ignore=DL3059
RUN npm link gulp

# Copier les tâches gulp et la configuration dans l'image Docker
COPY ./gulp/tasks /app/tasks
COPY ./gulp/gulpfile.js /app/gulpfile.js

# Définir un volume pour le répertoire /app
VOLUME ["/app"]

# Exposer le port 8000 pour HTTP
EXPOSE 8000

# Utiliser tini comme point d'entrée, et exécuter gulp par défaut
ENTRYPOINT ["/sbin/tini","-g","gulp"]
CMD ["default"]</code></pre></div></div></div></section><section id="autre_étude_de_cas_11" data-auto-animate><h2>Autre étude de cas 📚🔍</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">RUN npm install --global npm npm-check-updates # Mettre à jour npm à la dernière version et installer npm-check-updates

# Copier les dépendances NPM de l'application dans l'image Docker
COPY ./npm-packages /app/npm-packages
# Créer des liens symboliques pour package.json et package-lock.json à la racine de /app
# Cela permet d'exécuter les opérations npm sans erreur ENOENT
RUN ln -s /app/npm-packages/package.json /app/package.json \
  &amp;&amp; ln -s /app/npm-packages/package-lock.json /app/package-lock.json</code></pre></div></div>
<div class="ulist"><ul><li class="fragment"><p>Ce Dockerfile met en place un environnement <code>Node.js</code> avec des outils et dépendances supplémentaires.</p></li><li class="fragment"><p>Il installe les dernières versions de <code>npm</code> et <code>npm-check-updates</code> globalement, copie les dépendances <code>npm</code> de l&#8217;application dans l&#8217;image Docker, et crée des liens symboliques pour <code>package.json</code> et <code>package-lock.json</code> à la racine de <code>/app</code>.</p></li></ul></div></div></section><section id="autre_étude_de_cas_12" data-auto-animate><h2>Autre étude de cas 📚🔍</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">ARG FONTAWESOME_VERSION=6.4.0
RUN curl --silent --show-error --location --output /tmp/fontawesome.zip \
    "https://use.fontawesome.com/releases/v${FONTAWESOME_VERSION}/fontawesome-free-${FONTAWESOME_VERSION}-web.zip" \
  &amp;&amp; unzip -q /tmp/fontawesome.zip -d /tmp \
  &amp;&amp; mv /tmp/"fontawesome-free-${FONTAWESOME_VERSION}-web" /app/fontawesome \
  &amp;&amp; rm -rf /tmp/font*</code></pre></div></div>
<div class="ulist"><ul><li class="fragment"><p>Il télécharge également et installe une version spécifique de <code>FontAwesome</code></p></li></ul></div></div></section><section id="autre_étude_de_cas_13" data-auto-animate><h2>Autre étude de cas 📚🔍</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile"># Installer les dépendances NPM en utilisant le package-lock.json
# Si l'installation échoue, revenir à une installation npm régulière
RUN { npm install-clean &amp;&amp; npx update-browserslist-db@latest; } || npm install

# Lier la commande gulp pour qu'elle soit disponible dans le PATH
# hadolint ignore=DL3059
RUN npm link gulp</code></pre></div></div>
<div class="ulist"><ul><li class="fragment"><p>Il installe les dépendances <code>npm</code> en utilisant le <code>package-lock.json</code> (en revenant à une installation <code>npm</code> régulière si nécessaire), et lie la commande <code>gulp</code> pour qu&#8217;elle soit disponible dans le <code>PATH</code>.</p></li></ul></div></div></section><section id="autre_étude_de_cas_14" data-auto-animate><h2>Autre étude de cas 📚🔍</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile"># Copier les tâches gulp et la configuration dans l'image Docker
COPY ./gulp/tasks /app/tasks
COPY ./gulp/gulpfile.js /app/gulpfile.js

# Définir un volume pour le répertoire /app
VOLUME ["/app"]

# Exposer le port 8000 pour HTTP
EXPOSE 8000</code></pre></div></div>
<div class="ulist"><ul><li class="fragment"><p>Les tâches <code>gulp</code> et la configuration sont copiées dans l&#8217;image Docker, un volume est défini pour le répertoire <code>/app</code>, et le port <code>8000</code> est exposé pour <code>HTTP</code>.</p></li></ul></div></div></section><section id="autre_étude_de_cas_15" data-auto-animate><h2>Autre étude de cas 📚🔍</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile"># Utiliser tini comme point d'entrée, et exécuter gulp par défaut
ENTRYPOINT ["/sbin/tini","-g","gulp"]
CMD ["default"]</code></pre></div></div>
<div class="ulist"><ul><li class="fragment"><p>Le point d&#8217;entrée est défini sur <code>tini</code>, et <code>gulp</code> est exécuté par défaut.</p></li></ul></div></div></section><section id="tini_dans_docker"><h2>🐋 Tini dans Docker</h2></section><section id="quest_ce_que_tini"><h2>🤔 Qu&#8217;est-ce que Tini ?</h2><div class="slide-content"><div class="paragraph"><p>Tini est un <code>init</code> minuscule mais valide pour les conteneurs. Il est conçu pour être le système init le plus simple possible.</p></div></div></section><section id="que_fait_tini"><h2>🛠️ Que fait Tini ?</h2><div class="slide-content"><div class="paragraph"><p>Tini fait deux choses :</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Il génère votre processus en tant que son enfant (directement, pas en tant que petit-enfant, comme le ferait un shell).</p></li><li><p>Il attend ensuite les signaux et les transmet au processus enfant.</p></li></ol></div></div></section><section id="pourquoi_tini_est_il_utile_dans_docker"><h2>🎯 Pourquoi Tini est-il utile dans Docker ?</h2><div class="slide-content"><div class="olist arabic"><ol class="arabic"><li><p>Docker exécute un seul processus dans un conteneur par défaut. Si ce processus génère des processus enfants et ne les récolte pas correctement, ils deviennent des processus zombies.</p></li><li><p>Tini assure que ces processus zombies sont correctement récoltés, améliorant ainsi le comportement du conteneur et réduisant la probabilité de cas limites.</p></li></ol></div></div></section><section id="tini_dans_notre_dockerfile"><h2>🐋 Tini dans notre Dockerfile</h2><div class="slide-content"><div class="paragraph"><p>Dans notre Dockerfile, nous utilisons Tini comme point d&#8217;entrée :</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile">ENTRYPOINT ["/sbin/tini","-g","gulp"]</code></pre></div></div>
<div class="olist arabic"><ol class="arabic"><li><p>Cela signifie que Tini est le premier processus qui est lancé dans notre conteneur.</p></li><li><p>Il lancera ensuite <code>gulp</code> en tant que processus enfant.</p></li><li><p>Tout signal envoyé au conteneur sera transmis par Tini à <code>gulp</code>.</p></li><li><p>Si <code>gulp</code> génère des processus enfants et ne les récolte pas, Tini le fera.</p></li></ol></div></div></section><section id="docker_peut_travailler_main_dans_la_main_avec_dautres_outils" data-auto-animate><h2>🐋 Docker peut travailler main dans la main avec d&#8217;autres outils&#8230;&#8203; 👫🤝</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-makefile hljs" data-noescape="true" data-lang="makefile"># Ce Makefile est utilisé pour gérer le projet Docker Compose.

# Définir les valeurs par défaut pour les variables DIST_DIR et REPOSITORY_URL.
DIST_DIR ?= $(CURDIR)/dist
REPOSITORY_URL ?= file://$(CURDIR)
export REPOSITORY_URL DIST_DIR

# Activer Docker BuildKit pour une construction plus rapide et la mise en cache des images.
DOCKER_BUILDKIT ?= 1
COMPOSE_DOCKER_CLI_BUILD ?= 1
export DOCKER_BUILDKIT COMPOSE_DOCKER_CLI_BUILD

# Définition des commandes shell réutilisables pour Docker Compose.

# compose_cmd est une fonction qui exécute la commande 'docker compose' avec le fichier docker-compose.yml du répertoire courant.
# Elle prend un argument $(1) qui représente les options supplémentaires à passer à la commande 'docker compose'.
# $(CURDIR) est une variable d'environnement dans le Makefile qui représente le répertoire courant dans lequel
# le Makefile est exécuté. C'est une fonctionnalité intégrée de GNU Make. Elle est souvent utilisée pour référencer
# des fichiers ou des répertoires relatifs au répertoire courant.
compose_cmd = docker compose --file=$(CURDIR)/docker-compose.yml $(1)

# compose_up est une fonction qui utilise compose_cmd pour exécuter 'docker compose up'.
# Elle prend un argument $(1) qui représente les options supplémentaires à passer à la commande 'docker compose up'.
# L'option '--build' est toujours incluse, ce qui signifie que Docker construira les images avant de démarrer les conteneurs.
compose_up = $(call compose_cmd, up --build $(1))

# compose_run est une fonction qui utilise compose_cmd pour exécuter 'docker compose run'.
# Elle prend un argument $(1) qui représente les options supplémentaires à passer à la commande 'docker compose run'.
# L'option '--user=0' est toujours incluse, ce qui signifie que les commandes seront exécutées en tant que root à l'intérieur du conteneur.
compose_run = $(call compose_cmd, run --user=0 $(1))

# La cible par défaut. Elle nettoie le projet, le construit et le vérifie.
all: clean build verify

# Construire le projet à l'intérieur d'un conteneur Docker.
# Cette règle Makefile utilise la fonction compose_up définie précédemment pour exécuter 'docker compose up' avec l'option '--exit-code-from=build'.
# L'option '--exit-code-from=build' signifie que la commande 'docker compose up' renverra le code de sortie du service 'build'.
# Si le service 'build' se termine avec un code de sortie non nul (ce qui signifie qu'une erreur s'est produite), alors 'docker compose up' se terminera également avec un code de sortie non nul.
# Cela permet à Make de savoir si la construction du projet a réussi ou non.
build:
 @$(call compose_up,--exit-code-from=build build)

# Vérifier le projet. Actuellement désactivé.
verify:
 @echo "Vérification désactivée"

# Démarrer les services 'serve' et 'qrcode'.
serve:
 @$(call compose_up, --force-recreate serve qrcode)

# Démarrer un shell à l'intérieur du conteneur du service 'serve'.
shell:
 @$(call compose_run,--entrypoint=sh --rm serve)

# Mettre à jour le fichier de verrouillage pour les dépendances npm.
dependencies-lock-update:
 @$(call compose_run,--entrypoint=npm --rm serve install --package-lock)

# Mettre à jour les dépendances npm et le fichier de verrouillage.
dependencies-update:
 @$(call compose_run,--entrypoint=ncu --workdir=/app/npm-packages --rm serve -u)
 @make -C $(CURDIR) dependencies-lock-update

# Construire une version PDF du projet.
pdf:
 @$(call compose_up, --exit-code-from=pdf pdf)

# Nettoyer le projet en arrêtant et en supprimant les conteneurs Docker, les réseaux et les volumes.
clean:
 @$(call compose_cmd, down -v --remove-orphans)
 @rm -rf $(DIST_DIR)

# Démarrer le service 'qrcode'.
qrcode:
 @$(call compose_up, qrcode)

# Déclarer des cibles factices.
.PHONY: all build verify serve qrcode pdf dependencies-update dependencies-lock-update</code></pre></div></div></div></section><section id="docker_peut_travailler_main_dans_la_main_avec_dautres_outils_2" data-auto-animate><h2>🐋 Docker peut travailler main dans la main avec d&#8217;autres outils&#8230;&#8203; 👫🤝</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-makefile hljs" data-noescape="true" data-lang="makefile"># Activer Docker BuildKit pour une construction plus rapide et la mise en cache des images.
DOCKER_BUILDKIT ?= 1
COMPOSE_DOCKER_CLI_BUILD ?= 1
export DOCKER_BUILDKIT COMPOSE_DOCKER_CLI_BUILD</code></pre></div></div>
<div class="paragraph"><p>Cette configuration de docker compose concerne Docker BuildKit, une fonctionnalité de Docker qui améliore les performances de construction des images Docker.</p></div>
<div class="ulist"><ul><li><p>La ligne <code>DOCKER_BUILDKIT ?= 1</code> vérifie si la variable d&#8217;environnement <code>DOCKER_BUILDKIT</code> est déjà définie.</p><div class="ulist"><ul><li><p>Si ce n&#8217;est pas le cas, elle lui attribue la valeur <code>1</code>, ce qui active Docker BuildKit.</p></li></ul></div></li><li><p>De même, <code>COMPOSE_DOCKER_CLI_BUILD ?= 1</code> vérifie si la variable d&#8217;environnement <code>COMPOSE_DOCKER_CLI_BUILD</code> est déjà définie.</p><div class="ulist"><ul><li><p>Si ce n&#8217;est pas le cas, elle lui attribue la valeur <code>1</code>.</p></li><li><p>Cette variable d&#8217;environnement est utilisée pour activer l&#8217;utilisation de Docker CLI lors de l&#8217;utilisation de Docker Compose.</p></li><li><p>C&#8217;est nécessaire car Docker Compose ne supporte pas BuildKit par défaut, donc cette variable d&#8217;environnement est une solution de contournement pour l&#8217;activer.
En résumé, ces deux lignes de code activent Docker BuildKit pour améliorer les performances de construction des images Docker lors de l&#8217;utilisation de Docker Compose.</p></li></ul></div></li></ul></div></div></section><section id="docker_peut_travailler_main_dans_la_main_avec_dautres_outils_3" data-auto-animate><h2>🐋 Docker peut travailler main dans la main avec d&#8217;autres outils&#8230;&#8203; 👫🤝</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-makefile hljs" data-noescape="true" data-lang="makefile"># Définition des commandes shell réutilisables pour Docker Compose.

# compose_cmd est une fonction qui exécute la commande 'docker compose' avec le fichier docker-compose.yml du répertoire courant.
# Elle prend un argument $(1) qui représente les options supplémentaires à passer à la commande 'docker compose'.
# $(CURDIR) est une variable d'environnement dans le Makefile qui représente le répertoire courant dans lequel
# le Makefile est exécuté. C'est une fonctionnalité intégrée de GNU Make. Elle est souvent utilisée pour référencer
# des fichiers ou des répertoires relatifs au répertoire courant.
compose_cmd = docker compose --file=$(CURDIR)/docker-compose.yml $(1)

# compose_up est une fonction qui utilise compose_cmd pour exécuter 'docker compose up'.
# Elle prend un argument $(1) qui représente les options supplémentaires à passer à la commande 'docker compose up'.
# L'option '--build' est toujours incluse, ce qui signifie que Docker construira les images avant de démarrer les conteneurs.
compose_up = $(call compose_cmd, up --build $(1))

# compose_run est une fonction qui utilise compose_cmd pour exécuter 'docker compose run'.
# Elle prend un argument $(1) qui représente les options supplémentaires à passer à la commande 'docker compose run'.
# L'option '--user=0' est toujours incluse, ce qui signifie que les commandes seront exécutées en tant que root à l'intérieur du conteneur.
compose_run = $(call compose_cmd, run --user=0 $(1))</code></pre></div></div></div></section><section id="docker_peut_travailler_main_dans_la_main_avec_dautres_outils_4" data-auto-animate><h2>🐋 Docker peut travailler main dans la main avec d&#8217;autres outils&#8230;&#8203; 👫🤝</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-makefile hljs" data-noescape="true" data-lang="makefile"># Construire le projet à l'intérieur d'un conteneur Docker.
# Cette règle Makefile utilise la fonction compose_up définie précédemment pour exécuter 'docker compose up' avec l'option '--exit-code-from=build'.
# L'option '--exit-code-from=build' signifie que la commande 'docker compose up' renverra le code de sortie du service 'build'.
# Si le service 'build' se termine avec un code de sortie non nul (ce qui signifie qu'une erreur s'est produite), alors 'docker compose up' se terminera également avec un code de sortie non nul.
# Cela permet à Make de savoir si la construction du projet a réussi ou non.
build:
 @$(call compose_up,--exit-code-from=build build)</code></pre></div></div>
<div class="ulist"><ul><li class="fragment"><p>Cette règle <code>Makefile</code> est utilisée pour construire le projet à l&#8217;intérieur d&#8217;un conteneur Docker.</p></li><li class="fragment"><p>Elle utilise la fonction <code>compose_up</code> pour exécuter la commande <code>docker compose up</code> avec l&#8217;option <code>--exit-code-from=build</code>.</p></li><li class="fragment"><p>Cette option permet à la commande <code>docker compose up</code> de renvoyer le code de sortie du service <code>build</code>, ce qui permet à Make de savoir si la construction du projet a réussi ou non.</p></li></ul></div></div></section><section id="fin_du_chapitre_docker_compose"><h2>📖🔚 Fin du chapitre docker compose 🐋🐙</h2><div class="slide-content"><div class="imageblock"><img src="media/bitmoji-whale%20friend.png" alt="bitmoji whale friend" height="500px"></div></div></section></section>
<section><section id="bonus"><h2>Bonus</h2></section><section id="les_petits_plus"><h2>Les petits plus</h2><div class="slide-content"><div class="imageblock"><img src="media/902050214-image2.png" alt="902050214 image2"></div>
<div class="imageblock"><img src="media/902050214-image2.png" alt="902050214 image2"></div>
<div class="imageblock"><img src="media/902050214-image2.png" alt="902050214 image2"></div>
<div class="imageblock"><img src="media/902050214-image2.png" alt="902050214 image2"></div>
<div class="imageblock"><img src="media/902050214-image2.png" alt="902050214 image2"></div>
<div class="imageblock"><img src="media/902050214-image2.png" alt="902050214 image2"></div></div></section><section id="il_en_remet_une_couche" data-auto-animate><h2>"Il en remet une couche"</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker history nginx
IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT
f35646e83998        4 weeks ago         /bin/sh -c #(nop)  CMD ["nginx" "-g" "daemon…   0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  STOPSIGNAL SIGTERM           0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  EXPOSE 80                    0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  ENTRYPOINT ["/docker-entr…   0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop) COPY file:0fd5fca330dcd6a7…   1.04kB
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop) COPY file:1d0a4127e78a26c1…   1.96kB
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop) COPY file:e7e183879c35719c…   1.2kB
&lt;missing&gt;           4 weeks ago         /bin/sh -c set -x     &amp;&amp; addgroup --system -…   63.6MB
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  ENV PKG_RELEASE=1~buster     0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  ENV NJS_VERSION=0.4.4        0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  ENV NGINX_VERSION=1.19.3     0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  LABEL maintainer=NGINX Do…   0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  CMD ["bash"]                 0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop) ADD file:0dc53e7886c35bc21…   69.2MB</code></pre></div></div></div></section><section id="il_en_remet_une_couche_2" data-auto-animate><h2>"Il en remet une couche"</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker history nginx
IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT
f35646e83998        4 weeks ago         /bin/sh -c #(nop)  CMD ["nginx" "-g" "daemon…   0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  STOPSIGNAL SIGTERM           0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  EXPOSE 80                    0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  ENTRYPOINT ["/docker-entr…   0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop) COPY file:0fd5fca330dcd6a7…   1.04kB
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop) COPY file:1d0a4127e78a26c1…   1.96kB
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop) COPY file:e7e183879c35719c…   1.2kB
&lt;missing&gt;           4 weeks ago         /bin/sh -c set -x     &amp;&amp; addgroup --system -…   63.6MB
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  ENV PKG_RELEASE=1~buster     0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  ENV NJS_VERSION=0.4.4        0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  ENV NGINX_VERSION=1.19.3     0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  LABEL maintainer=NGINX Do…   0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  CMD ["bash"]                 0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop) ADD file:0dc53e7886c35bc21…   69.2MB</code></pre></div></div>
<div class="paragraph"><p>Il est préférable de limiter le nombre de couches pour limiter la bande passante.</p></div></div></section><section id="il_en_remet_une_couche_3" data-auto-animate><h2>"Il en remet une couche"</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">RUN apk add \
     patch \
     tar \
     mercurial \
     git \
     ruby \
     ruby-devel \
     rubygem-bundler \
     make \
     gcc-c++ \
     zlib-devel \
     libxml2-devel \
     docker \
     nodejs \
     npm \
     sssd \
 &amp;&amp; mkdir -p /var/lib/docker-builder \
 &amp;&amp; mkdir -p /etc/docker-builder</code></pre></div></div></div></section><section id="ne_pas_charger_inutilement"><h2>Ne pas charger inutilement !</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash"> &amp;&amp; apk remove make gcc maven ... \
 &amp;&amp; rm -f previously-downloaded.tar.gz \
 &amp;&amp; apk clean all \
 &amp;&amp; rm -rf /tmp/*</code></pre></div></div>
<div class="paragraph fragment"><p>Il est utile, pour des raisons d&#8217;espace, de nettoyer le filesystem de ses futurs containers, en donnant les bonnes instructions dans le Dockerfile.</p></div></div></section><section id="documentez"><h2>Documentez !</h2><div class="slide-content"><div class="paragraph"><p>Les mots clés <code>EXPOSE</code> et <code>LABEL</code> peuvent fournir de précieuses informations aux utilisateurs de vos images !</p></div>
<div class="paragraph"><p>(les ports exposés par défaut, les auteurs de l&#8217;image, la version d&#8217;un middleware embarqué, …)</p></div></div></section><section id="préparez_vous_au_read_only"><h2>Préparez-vous au read-only</h2><div class="slide-content"><div class="paragraph"><p>Il est possible de lister toutes les modifications qui ont été apportées au filesystem d&#8217;un container.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker diff 29f1c4
C /run
A /run/nginx.pid
C /var
C /var/lib
C /var/lib/nginx
C /var/lib/nginx/tmp
A /var/lib/nginx/tmp/client_body
A /var/lib/nginx/tmp/fastcgi
A /var/lib/nginx/tmp/proxy
A /var/lib/nginx/tmp/scgi
A /var/lib/nginx/tmp/uwsgi
C /var/log
C /var/log/nginx
A /var/log/nginx/access.log
A /var/log/nginx/error.log</code></pre></div></div>
<div class="paragraph fragment"><p>Une bonne piste pour savoir quels volumes déclarer !</p></div></div></section><section id="healthcheck"><h2>HealthCheck</h2><div class="slide-content"><div class="paragraph"><p>Savoir que mon PID 1 est toujours en cours d&#8217;exécution n&#8217;est peut-être pas la meilleure piste pour savoir si mon conteneur est en bonne santé !</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">FROM ghost:3
RUN apt update &amp;&amp; apt install curl -y \
        &amp;&amp; rm -rf /var/lib/apt/lists/*

HEALTHCHECK --interval=1m --timeout=30s --retries=3 CMD curl --fail http://localhost:2368 || exit 1</code></pre></div></div>
<div class="paragraph"><p>source : <a href="https://www.grottedubarbu.fr/docker-healthcheck/" class="bare">https://www.grottedubarbu.fr/docker-healthcheck/</a></p></div></div></section><section id="debugging"><h2>Debugging</h2><div class="slide-content"><div class="imageblock"><img src="media/1939424428-image3.gif" alt="1939424428 image3"></div></div></section><section id="une_tonne_doutils"><h2>Une tonne d&#8217;outils !</h2><div class="slide-content"><div class="paragraph"><p>Les logs</p></div>
<div class="ulist"><ul><li><p>des containers</p></li><li><p>du démon Docker</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container exec
docker inspect
docker cp
docker history
docker stats</code></pre></div></div></div></section><section id="debugging_les_logs"><h2>Debugging : Les logs</h2><div class="slide-content"><div class="paragraph"><p>rappel : <code>docker container logs</code> permet de lister les logs des conteneurs.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container logs 47d6
Fri Nov 20 00:39:52 UTC 2023
Fri Nov 20 00:39:53 UTC 2023</code></pre></div></div></div></section><section id="concentrateur_de_logs"><h2>Concentrateur de logs</h2><div class="slide-content"><div class="paragraph"><p>Par défaut, les logs des conteneurs sont stockés dans des fichiers json. Mais comment faire pour les envoyer vers un concentrateur ?</p></div>
<div class="listingblock fragment"><div class="content"><pre>docker container run -d
--log-driver=gelf
--log-opt gelf-address=udp://localhost:12201
-p 88:80
nginx</pre></div></div>
<div class="paragraph fragment"><p>on spécifie un driver</p></div>
<div class="paragraph fragment"><p>on configure le driver</p></div></div></section><section id="travaux_pratiques_13"><h2>Travaux pratiques #13</h2><div class="slide-content"><div class="paragraph"><p>Étapes</p></div>
<div class="paragraph"><p>Lancer une stack ELK grâce aux fichiers fournis dans le repo <a href="https://gitlab.univ-artois.fr/bruno.verachten/devops-docker-tp13" class="bare">https://gitlab.univ-artois.fr/bruno.verachten/devops-docker-tp13</a></p></div>
<div class="paragraph"><p>Alimenter en logs avec la commande <code>docker container run --log-driver=gelf --log-opt gelf-address=udp://localhost:12201 alpine bash -c 'seq 1 100'</code></p></div>
<div class="paragraph"><p>Créer un index "timestamp" sur Kibana puis aller à l&#8217;écran "discover"</p></div>
<div class="paragraph"><p>Lancer un conteneur nginx et concentrez ses logs dans ELK</p></div></div></section><section id="gitlab_et_dependabot" class="columns"><h2>GitLab et Dependabot</h2><div class="slide-content"><div class="imageblock column"><img src="https://about.gitlab.com/images/press/press-kit-icon.svg" alt="press kit icon" height="200px"></div>
<div class="imageblock column"><img src="https://avatars.githubusercontent.com/u/27347476?s=200&v=4" alt="27347476?s=200&amp;v=4" height="200px"></div></div></section><section id="quest_ce_que_dependabot"><h2>🤔 Qu&#8217;est-ce que Dependabot ?</h2><div class="slide-content"><div class="paragraph"><p>Dependabot est un outil qui vous aide à maintenir vos dépendances à jour.</p></div>
<div class="imageblock"><img src="https://avatars.githubusercontent.com/u/27347476?s=200&v=4" alt="27347476?s=200&amp;v=4"></div>
<div class="paragraph fragment"><p>Il ouvre automatiquement des merge requests pour les mises à jour de dépendances dans vos projets GitLab.</p></div></div></section><section id="comment_dependabot_fonctionne_t_il_avec_docker"><h2>🛠️ Comment Dependabot fonctionne-t-il avec Docker ?</h2><div class="slide-content"><div class="paragraph"><p>Dependabot peut analyser vos <code>Dockerfiles</code> et vos fichiers <code>docker-compose</code> pour trouver les dépendances qui peuvent être mises à jour.</p></div>
<div class="paragraph fragment"><p>Il crée ensuite des merge requests pour chaque mise à jour de dépendance.</p></div></div></section><section id="pourquoi_utiliser_dependabot_avec_docker"><h2>🎯 Pourquoi utiliser Dependabot avec Docker ?</h2><div class="slide-content"><div class="olist arabic"><ol class="arabic"><li><p>Garder vos dépendances à jour est crucial pour la sécurité et la stabilité de vos applications.</p></li><li><p>Dependabot automatise ce processus, vous faisant gagner du temps et réduisant le risque d&#8217;oublier une mise à jour importante.</p></li><li><p>Dependabot n&#8217;est pas magique, il faut que votre CI soit capable de construire votre application avec les nouvelles dépendances.</p></li><li><p>Ce qui n&#8217;est pas testé ne fonctionne pas.</p></li></ol></div></div></section><section id="comment_configurer_dependabot_pour_gitlab" data-auto-animate><h2>🚀 Comment configurer Dependabot pour GitLab ? 🦊🛠️</h2><div class="slide-content"><div class="ulist"><ul><li><p>Malheureusement, il n&#8217;y a pas encore de support officiel pour GitLab dans Dependabot (et vice versa).</p></li><li><p>Notre forge Gitlab est définie dans un fichier docker-compose.yml, et Dependabot aussi.</p></li><li><p>Dependabot doit avoir accès à notre forge GitLab pour pouvoir ouvrir des merge requests.</p></li><li><p>Suivons donc <a href="https://dependabot-gitlab.gitlab.io/dependabot/guide/getting-started.html#step-2-set-up-access-tokens">la documentation officielle</a>.</p></li></ul></div></div></section><section data-background-image="media/personal-access-token.png" data-background-size="cover" data-auto-animate></section><section data-background-image="media/personal-access-token-settings.png" data-background-size="cover" data-auto-animate></section><section id="comment_configurer_dependabot_pour_gitlab_2" data-auto-animate><h2>🚀 Comment configurer Dependabot pour GitLab ? 🦊🛠️</h2><div class="slide-content"><div class="admonitionblock warning"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content">Notez bien le token, vous ne le reverrez plus jamais.</td></tr></table></div>
<div class="paragraph"><p><a href="https://dependabot-gitlab.gitlab.io/dependabot/guide/getting-started.html#step-3-start-the-app">L&#8217;étape suivante</a>, c&#8217;est de positionner les valeurs de certaines variables d&#8217;environnement.
Ça peut être dans un <code>.env</code>, ou dans les variables d&#8217;environnement de votre machine.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">export SETTINGS__GITLAB_URL=http://localhost
export SETTINGS__GITLAB_ACCESS_TOKEN=glpat-LXUfrxeFXuRJXNTNNifD</code></pre></div></div></div></section><section id="comment_configurer_dependabot_pour_gitlab_3" data-auto-animate><h2>🚀 Comment configurer Dependabot pour GitLab ? 🦊🛠️</h2><div class="slide-content"><div class="paragraph"><p>Démarrez l&#8217;application avec <code>docker compose</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">curl -s https://gitlab.com/dependabot-gitlab/dependabot/-/raw/v3.8.0-alpha.1/docker-compose.yml | docker compose -f - up -d</code></pre></div></div>
<div class="imageblock fragment"><img src="media/dependabot-cant-see-gitlab.png" alt="dependabot cant see gitlab"></div>
<div class="paragraph fragment"><p>😢</p></div></div></section><section id="comment_configurer_dependabot_pour_gitlab_4" data-auto-animate><h2>🚀 Comment configurer Dependabot pour GitLab ? 🦊🛠️</h2><div class="slide-content"><div class="paragraph"><p>Vous vous souvenez du chapitre sur les réseaux Docker ?</p></div>
<div class="ulist"><ul><li class="fragment"><p>Dans Docker, chaque conteneur a son propre espace de nom réseau, ce qui signifie que localhost à l&#8217;intérieur d&#8217;un conteneur fait référence au conteneur lui-même, et non à la machine hôte ou à d&#8217;autres conteneurs.</p></li><li class="fragment"><p>Lorsque vous essayez de faire un <code>ping</code> sur <code>gitlab-instance-gitlab-1</code> depuis le conteneur web, il ne connaît pas le nom d&#8217;hôte <code>gitlab-instance-gitlab-1</code> car il n&#8217;est pas dans le même espace de nom réseau.</p></li><li class="fragment"><p>Pour permettre aux conteneurs de communiquer entre eux, ils doivent être dans le même réseau Docker.</p></li></ul></div></div></section><section id="comment_configurer_dependabot_pour_gitlab_5" data-auto-animate><h2>🚀 Comment configurer Dependabot pour GitLab ? 🦊🛠️</h2><div class="slide-content"><div class="ulist"><ul><li><p>Lorsque vous utilisez Docker Compose, il crée automatiquement un réseau par défaut pour votre application et tout service défini dans le <code>docker-compose.yml</code> peut atteindre les autres en utilisant le nom du service comme nom d&#8217;hôte.</p></li></ul></div>
<div class="ulist"><ul><li class="fragment"><p>Dans notre cas, le conteneur <code>web</code> et le conteneur <code>gitlab-instance-gitlab-1</code> ne sont pas dans le même réseau Docker.</p></li><li class="fragment"><p>Vous pouvez vérifier cela en inspectant les réseaux de chaque conteneur à l&#8217;aide de la commande <code>docker inspect</code>.</p></li><li class="fragment"><p>S&#8217;ils ne sont pas dans le même réseau, nous pouvons créer un réseau et ajouter les deux services à celui-ci dans notre fichier <code>docker-compose.yml</code>.</p></li></ul></div></div></section><section id="comment_configurer_dependabot_pour_gitlab_6" data-auto-animate><h2>🚀 Comment configurer Dependabot pour GitLab ? 🦊🛠️</h2><div class="slide-content"><div class="ulist"><ul><li><p>Voici un exemple :</p></li></ul></div>
<div class="listingblock"><div class="content"><pre>version: '3'
services:
  web:
    image: web
    networks:
      - mynetwork
  gitlab-instance-gitlab-1:
    image: gitlab
    networks:
      - mynetwork
networks:
  mynetwork:</pre></div></div>
<div class="ulist"><ul><li class="fragment"><p>Après avoir mis à jour votre fichier <code>docker-compose.yml</code>, vous devez recréer vos conteneurs pour que les modifications prennent effet.</p></li><li class="fragment"><p>Vous pouvez le faire avec la commande <code>docker compose up -d --force-recreate</code>.</p></li><li class="fragment"><p>Après cela, vous devriez pouvoir faire un <code>ping</code> sur <code>gitlab-instance-gitlab-1</code> depuis le conteneur web.</p></li></ul></div></div></section><section id="comment_configurer_dependabot_pour_gitlab_7" data-auto-animate><h2>🚀 Comment configurer Dependabot pour GitLab ? 🦊🛠️</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">  web:
    image: *base_image
    networks:
[...]
networks:
  mynetwork:</code></pre></div></div>
<div class="paragraph fragment"><p>Et&#8230;&#8203;</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">  gitlab:
    # The Docker image to use for the GitLab server
    image: 'gitlab/gitlab-ce:16.6.0-ce.0'
    networks:
      - mynetwork
[...]
networks:
  mynetwork:</code></pre></div></div></div></section><section id="comment_configurer_dependabot_pour_gitlab_8" data-auto-animate><h2>🚀 Comment configurer Dependabot pour GitLab ? 🦊🛠️</h2><div class="slide-content"><div class="paragraph"><p>Sauf que&#8230;&#8203;</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">root@95def7cb933d:/home/dependabot/app# nmap -sn 172.30.0.0/16
Starting Nmap 7.80 ( https://nmap.org ) at 2023-11-21 20:45 UTC
Nmap scan report for 172.30.0.1
Host is up (0.0000090s latency).
MAC Address: 02:42:50:A6:7C:5A (Unknown)
Nmap scan report for symbiosis-gitlab-1.symbiosis_mynetwork (172.30.0.2)
Host is up (0.000012s latency).
MAC Address: 02:42:AC:1E:00:02 (Unknown)
Nmap scan report for symbiosis-gitlab-runner-1-1.symbiosis_mynetwork (172.30.0.3)
Host is up (0.000015s latency).
MAC Address: 02:42:AC:1E:00:03 (Unknown)
Nmap scan report for symbiosis-gitlab-runner-2-1.symbiosis_mynetwork (172.30.0.4)
Host is up (0.000032s latency).
MAC Address: 02:42:AC:1E:00:04 (Unknown)
Nmap scan report for symbiosis-redis-1.symbiosis_mynetwork (172.30.0.5)
Host is up (0.0000070s latency).
MAC Address: 02:42:AC:1E:00:05 (Unknown)
Nmap scan report for symbiosis-mongodb-1.symbiosis_mynetwork (172.30.0.6)
Host is up (0.000016s latency).
MAC Address: 02:42:AC:1E:00:06 (Unknown)
Nmap scan report for symbiosis-docker-1.symbiosis_mynetwork (172.30.0.7)
Host is up (0.000021s latency).
MAC Address: 02:42:AC:1E:00:07 (Unknown)
Nmap scan report for symbiosis-worker-1.symbiosis_mynetwork (172.30.0.9)
Host is up (0.000024s latency).
MAC Address: 02:42:AC:1E:00:09 (Unknown)
Nmap scan report for 95def7cb933d (172.30.0.10)
Host is up.</code></pre></div></div></div></section><section id="comment_configurer_dependabot_pour_gitlab_9" data-auto-animate><h2>🚀 Comment configurer Dependabot pour GitLab ? 🦊🛠️</h2><div class="slide-content"><div class="paragraph"><p>Victoire?</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker compose -f docker-compose-dependabot.yml exec -it -u root web b
ash
root@95def7cb933d:/home/dependabot/app# ping symbiosis-gitlab-1.symbiosis_mynetwork
PING symbiosis-gitlab-1.symbiosis_mynetwork (172.30.0.2) 56(84) bytes of data.
64 bytes from symbiosis-gitlab-1.symbiosis_mynetwork (172.30.0.2): icmp_seq=1 ttl=64 time=0.165 ms
64 bytes from symbiosis-gitlab-1.symbiosis_mynetwork (172.30.0.2): icmp_seq=2 ttl=64 time=0.053 ms
64 bytes from symbiosis-gitlab-1.symbiosis_mynetwork (172.30.0.2): icmp_seq=3 ttl=64 time=0.039 ms
64 bytes from symbiosis-gitlab-1.symbiosis_mynetwork (172.30.0.2): icmp_seq=4 ttl=64 time=0.040 ms
64 bytes from symbiosis-gitlab-1.symbiosis_mynetwork (172.30.0.2): icmp_seq=5 ttl=64 time=0.056 ms
^C
--- symbiosis-gitlab-1.symbiosis_mynetwork ping statistics ---
5 packets transmitted, 5 received, 0% packet loss, time 4165ms
rtt min/avg/max/mdev = 0.039/0.070/0.165/0.047 ms</code></pre></div></div>
<div class="imageblock fragment"><img src="media/dependabot-404-gitlab.png" alt="dependabot 404 gitlab"></div>
<div class="paragraph fragment"><p>On y est presque!</p></div>
<aside class="notes"><div class="paragraph"><p>dependabot gitlab
updatecli
renovabot gitlab</p></div>
<div class="paragraph"><p>gitlab complet docker compose
jenkins complet docker compose
Kube?</p></div>
<div class="paragraph"><p>services ashutosh mix and match de conteneurs</p></div>
<div class="paragraph"><p>build arm64, cloud et buildx</p></div></aside></div></section><section id="debugging_docker_exec"><h2>Debugging : docker exec</h2><div class="slide-content"><div class="paragraph"><p>rappel : `docker container exec `permet de lancer une commande dans un container</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker exec &lt;containerID&gt; echo "hello"</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker exec –it &lt;containerID&gt; bash</code></pre></div></div></div></section><section id="debugging_docker_inspect"><h2>Debugging : docker inspect</h2><div class="slide-content"><div class="paragraph"><p>rappel : `docker inspect `permet de lister toutes les caractéristiques d&#8217;une image ou d&#8217;un container.</p></div>
<div class="paragraph"><p>On peut filtrer le retour de la commande avec <code>jq</code> ou l&#8217;option <code>--format</code>.</p></div></div></section><section id="debugging_docker_cp"><h2>Debugging : docker cp</h2><div class="slide-content"><div class="paragraph"><p>Cette commande permet d&#8217;échanger des fichiers entre un conteneur et la machine hôte.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker cp --help
Usage:  docker cp [OPTIONS] CONTAINER:SRC_PATH DEST_PATH|-
        docker cp [OPTIONS] SRC_PATH|- CONTAINER:DEST_PATH
Copy files/folders between a container and the local filesystem
Options:
  -a, --archive       Archive mode (copy all uid/gid information)
  -L, --follow-link   Always follow symbol link in SRC_PATH</code></pre></div></div></div></section><section id="debugging_docker_history"><h2>Debugging : docker history</h2><div class="slide-content"><div class="paragraph"><p>Cette commande permet d&#8217;afficher la concaténation de tous les Dockerfiles qui ont abouti à cette image.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker history nginx
IMAGE               CREATED             CREATED BY                                      SIZE                f35646e83998        4 weeks ago         /bin/sh -c #(nop)  CMD ["nginx" "-g" "daemon…   0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  STOPSIGNAL SIGTERM           0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  EXPOSE 80                    0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  ENTRYPOINT ["/docker-entr…   0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop) COPY file:0fd5fca330dcd6a7…   1.04kB
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop) COPY file:1d0a4127e78a26c1…   1.96kB
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop) COPY file:e7e183879c35719c…   1.2kB
&lt;missing&gt;           4 weeks ago         /bin/sh -c set -x     &amp;&amp; addgroup --system -…   63.6MB
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  ENV PKG_RELEASE=1~buster     0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  ENV NJS_VERSION=0.4.4        0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  ENV NGINX_VERSION=1.19.3     0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  LABEL maintainer=NGINX Do…   0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  CMD ["bash"]                 0B
&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop) ADD file:0dc53e7886c35bc21…   69.2MB</code></pre></div></div></div></section><section id="debugging_docker_stats"><h2>Debugging : docker stats</h2><div class="slide-content"><div class="paragraph"><p>Cette commande permet d&#8217;avoir les stats en temps réel d&#8217;un conteneur.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker stats 42f128
CONTAINER           CPU %     MEM USAGE/LIMIT     MEM %     NET I/O
42f128              0.00%     1.454 MB/4.145 GB   0.04%     648 B/648 B</code></pre></div></div></div></section><section id="travaux_pratiques_14"><h2>🎓 Travaux pratiques #14</h2><div class="slide-content"><div class="paragraph"><p>Notre valeureux collègue Jean-Michel s&#8217;initiait à l&#8217;art mystérieux de Docker, et généreusement partageait ses créations sous forme d&#8217;images Docker pour l&#8217;entreprise.</p></div>
<div class="paragraph"><p>Michel a soudainement décroché le jackpot du Loto, laissant derrière lui son bureau du jour au lendemain, alors qu&#8217;il était sur le point de nous offrir une image Nginx.</p></div>
<div class="paragraph"><p>Désormais, nous n&#8217;avons que le binaire de son chef-d&#8217;œuvre, accessible à cette adresse :</p></div>
<div class="paragraph"><p><a href="https://owncloud.univ-artois.fr/index.php/s/9s8XBLXvRwBJsrm" class="bare">https://owncloud.univ-artois.fr/index.php/s/9s8XBLXvRwBJsrm</a></p></div>
<div class="paragraph"><p>Rassurez-vous, on nous a dit que <code>docker load</code> est la première étape de la formule magique pour percer les secrets de son œuvre.</p></div>
<div class="paragraph"><p>À vos claviers ! 🧙‍♂️✨</p></div></div></section><section id="solution_travaux_pratiques_14" data-auto-animate><h2>✅ Solution travaux pratiques #14🕵️‍♂️🔍</h2><div class="slide-content"><div class="paragraph"><p><code>docker load</code> est la première étape de la formule magique</p></div>
<div class="paragraph fragment"><p>Okay&#8230;&#8203;</p></div>
<div class="paragraph fragment"><p>🧙‍♂️✨</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker load -i bad-nginx.dkr
Loaded image: bad-nginx:1</code></pre></div></div>
<div class="paragraph fragment"><p>Nous voilà bien avancés&#8230;&#8203;</p></div>
<div class="paragraph fragment"><p>On essaye de lancer un conteneur basé dessus ?</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run -d --name bad-1 bad-nginx:1
f4caa4a641729c0ab3d7b5974fa735c128047f75292c7f16495b72c7c6808502</code></pre></div></div>
<div class="paragraph fragment"><p>C&#8217;est lancé ?</p></div></div></section><section id="solution_travaux_pratiques_14_2" data-auto-animate><h2>✅ Solution travaux pratiques #14🕵️‍♂️🔍</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container ls --format '{{.Names}}' | grep "bad"</code></pre></div></div>
<div class="paragraph fragment"><p>Oups, il n&#8217;est pas là&#8230;&#8203;</p></div>
<div class="paragraph fragment"><p>Essayons encore.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container ls -a --format '{{.Names}}' | grep "bad"
bad-1</code></pre></div></div>
<div class="paragraph fragment"><p>C&#8217;est donc lancé, mais il a crashé.</p></div>
<div class="paragraph fragment"><p>Allons donc chercher les logs&#8230;&#8203;</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container logs bad-1
Error : nginx is not executable</code></pre></div></div>
<div class="paragraph fragment"><p>On a trouvé le problème !</p></div>
<div class="paragraph fragment"><p>Spoiler alert : on a trouvé UN problème, pas LE problème.</p></div></div></section><section id="solution_travaux_pratiques_14_3" data-auto-animate><h2>✅ Solution travaux pratiques #14🕵️‍♂️🔍</h2><div class="slide-content"><div class="paragraph"><p>Je ne sais pas ce qu&#8217;a fait Jean-Michel, mais il a cassé le binaire de Nginx.</p></div>
<div class="paragraph fragment"><p>Est-ce un problème de permission, de dépendance, de version, de compilation ?</p></div>
<div class="paragraph fragment"><p>En tous cas, c&#8217;est cassé.</p></div>
<div class="paragraph fragment"><p>Regardons un peu ce que nous dit docker inspect de tout ça&#8230;&#8203;</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">docker image inspect bad-nginx:1
[
    {
        "Id": "sha256:a469e4d1cb0c61324298fc6fde09f78f211420a1848b690dec35d9ac324a6cab",
        "RepoTags": [
            "bad-nginx:1"
        ],
        [...]
        "ContainerConfig": {
            [...]
            "ExposedPorts": {
                "80/tcp": {}
            },</code></pre></div></div>
<div class="paragraph fragment"><p>Port 80 exposé, c&#8217;est bon signe.</p></div></div></section><section id="solution_travaux_pratiques_14_4" data-auto-animate><h2>✅ Solution travaux pratiques #14🕵️‍♂️🔍</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">            [...]
            "Env": [
                "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
            ],</code></pre></div></div>
<div class="paragraph fragment"><p>On a un PATH, c&#8217;est bon signe.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">            "Cmd": [
                "/bin/sh",
                "-c",
                "#(nop) ",
                "CMD [\"/bin/sh\" \"-c\" \"nginx\"]"
            ],</code></pre></div></div>
<div class="paragraph fragment"><p>On a un CMD, c&#8217;est bon signe.</p></div></div></section><section id="solution_travaux_pratiques_14_5" data-auto-animate><h2>✅ Solution travaux pratiques #14🕵️‍♂️🔍</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">            [...]
            "Entrypoint": [
                "/bin/sh",
                "-c",
                "/tmp/entrypoint.sh"
            ],</code></pre></div></div>
<div class="paragraph fragment"><p>On a un Entrypoint, c&#8217;est bon signe.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">            [...]
            "Labels": {
                [...]
                "org.label-schema.name": "CentOS Base Image",
                [...]
            }
        },
        "DockerVersion": "18.09.0",
        [...]
        "Architecture": "amd64",
        "Os": "linux",
        [...]
    }
]</code></pre></div></div></div></section><section id="solution_travaux_pratiques_14_6" data-auto-animate><h2>✅ Solution travaux pratiques #14🕵️‍♂️🔍</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">            [...]
            "Labels": {
                [...]
                "org.label-schema.name": "CentOS Base Image",
                [...]
            }
        },
        "DockerVersion": "18.09.0",
        [...]
        "Architecture": "amd64",
        "Os": "linux",
        [...]
    }
]</code></pre></div></div>
<div class="paragraph fragment"><p>C&#8217;est bien une image Linux <code>amd64</code> (donc pour ton PC, mais pas pour ton Mac M1, toi là-bas), mais argh, c&#8217;est basé sur CentOS, pas sur Alpine ou Debian !</p></div>
<div class="paragraph fragment"><p>Ça a été construit avec une vieille version de Docker.</p></div>
<div class="paragraph fragment"><p>Qu&#8217;est-ce qu&#8217;on fait maintenant ?</p></div></div></section><section id="solution_travaux_pratiques_14_7" class="columns" data-auto-animate><h2>✅ Solution travaux pratiques #14🕵️‍♂️🔍</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="paragraph"><p>Tournons-nous vers l&#8217;histoire !</p></div>
<div class="imageblock"><img src="https://img.20mn.fr/JejnWnikSbSj5suCAo9pug/1200x768_stephane-bern-arrive-elysee-4-octobre-2017.jpg" alt="1200x768 stephane bern arrive elysee 4 octobre 2017"></div></div></div>
<div class="openblock column"><div class="content"><div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker history bad-nginx:1
IMAGE          CREATED       CREATED BY                                      SIZE      COMMENT
a469e4d1cb0c   3 years ago   /bin/sh -c #(nop)  CMD ["/bin/sh" "-c" "ngin…   0B
&lt;missing&gt;      3 years ago   /bin/sh -c #(nop)  ENTRYPOINT ["/bin/sh" "-c…   0B
&lt;missing&gt;      3 years ago   /bin/sh -c #(nop)  EXPOSE 80                    0B
&lt;missing&gt;      3 years ago   /bin/sh -c #(nop) COPY file:b0fc89bcaf962602…   98B
&lt;missing&gt;      3 years ago   /bin/sh -c yum install -y nginx &amp;&amp; yum clean…   56.7MB
&lt;missing&gt;      3 years ago   /bin/sh -c #(nop)  CMD ["/bin/bash"]            0B
&lt;missing&gt;      3 years ago   /bin/sh -c #(nop)  LABEL org.label-schema.sc…   0B
&lt;missing&gt;      3 years ago   /bin/sh -c #(nop) ADD file:538afc0c5c964ce0d…   215MB</code></pre></div></div>
<div class="paragraph fragment"><p>Ça se lit de bas en haut&#8230;&#8203;</p></div>
<div class="paragraph fragment"><p>Le premier <code>ADD</code> est l&#8217;image de base, CentOS.</p></div>
<div class="paragraph fragment"><p>La deuxième ligne, c&#8217;est une métadata, on s&#8217;en fiche un peu.</p></div>
<div class="paragraph fragment"><p>La troisième ligne, c&#8217;est le <code>CMD</code> de l&#8217;image de base, qui est <code>bash</code>.</p></div>
<div class="paragraph fragment"><p>La quatrième ligne, c&#8217;est l&#8217;installation de Nginx par l&#8217;infâme <code>yum</code> de Centos (déjà repéré dans le <code>docker inspect</code>).</p></div></div></div></div></section><section id="solution_travaux_pratiques_14_8" data-auto-animate><h2>✅ Solution travaux pratiques #14🕵️‍♂️🔍</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker history bad-nginx:1
IMAGE          CREATED       CREATED BY                                      SIZE      COMMENT
a469e4d1cb0c   3 years ago   /bin/sh -c #(nop)  CMD ["/bin/sh" "-c" "ngin…   0B
&lt;missing&gt;      3 years ago   /bin/sh -c #(nop)  ENTRYPOINT ["/bin/sh" "-c…   0B
&lt;missing&gt;      3 years ago   /bin/sh -c #(nop)  EXPOSE 80                    0B
&lt;missing&gt;      3 years ago   /bin/sh -c #(nop) COPY file:b0fc89bcaf962602…   98B
&lt;missing&gt;      3 years ago   /bin/sh -c yum install -y nginx &amp;&amp; yum clean…   56.7MB
&lt;missing&gt;      3 years ago   /bin/sh -c #(nop)  CMD ["/bin/bash"]            0B
&lt;missing&gt;      3 years ago   /bin/sh -c #(nop)  LABEL org.label-schema.sc…   0B
&lt;missing&gt;      3 years ago   /bin/sh -c #(nop) ADD file:538afc0c5c964ce0d…   215MB</code></pre></div></div>
<div class="paragraph fragment"><p>La cinquième ligne, c&#8217;est sans doute la copie du fichier <code>index.html</code>.</p></div>
<div class="paragraph fragment"><p>La sixième ligne, c&#8217;est l' <code>EXPOSE</code> de l&#8217;image finale, qui est <code>80</code> (déjà repéré dans le <code>docker inspect</code>).</p></div>
<div class="paragraph fragment"><p>La septième ligne, c&#8217;est le <code>ENTRYPOINT</code> de l&#8217;image finale, qui est <code>/bin/sh -c /tmp/entrypoint.sh</code> (déjà repéré dans le <code>docker inspect</code>).</p></div></div></section><section id="solution_travaux_pratiques_14_9" data-auto-animate><h2>✅ Solution travaux pratiques #14🕵️‍♂️🔍</h2><div class="slide-content"><div class="paragraph"><p>Résumons-nous&#8230;&#8203; On a:</p></div>
<div class="ulist"><ul><li class="fragment"><p>une image de base CentOS (à remplacer par Alpine ou Debian)</p></li><li class="fragment"><p>une installation de <code>nginx</code>.</p></li><li class="fragment"><p>un port <code>80</code> exposé</p></li><li class="fragment"><p>un <code>ENTRYPOINT</code> qui lance un script <code>nginx</code></p></li><li class="fragment"><p>un fichier HTML, qu&#8217;on n&#8217;a pas encore récupéré
Ça progresse&#8230;&#8203; On peut donc créer un premier 💀 Dockerfile</p></li></ul></div></div></section><section id="solution_travaux_pratiques_14_10" data-auto-animate><h2>✅ Solution travaux pratiques #14🕵️‍♂️🔍💀</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile"># Utiliser Alpine ou Debian comme image de base
FROM alpine

# Mettre à jour le système et installer nginx
RUN apk update &amp;&amp; apk add nginx

# Exposer le port 80
EXPOSE 80

# Ajouter un fichier HTML (remplacer /chemin/vers/votre/fichier.html par le chemin réel vers votre fichier HTML)
ADD /chemin/vers/votre/fichier.html /usr/share/nginx/html

# Définir le point d'entrée pour lancer nginx
ENTRYPOINT ["nginx", "-g", "daemon off;"]</code></pre></div></div>
<div class="paragraph fragment"><p>Comment récupérer ce fichu fichier HTML?</p></div></div></section><section id="solution_travaux_pratiques_14_11" class="columns" data-auto-animate><h2>✅ Solution travaux pratiques #14🕵️‍♂️🔍</h2><div class="slide-content"><div class="openblock column is-half"><div class="content"><div class="paragraph"><p>Essayons de lancer un conteneur basé sur notre image, et de récupérer le fichier HTML.</p></div>
<div class="paragraph fragment"><p>Le binaire <code>nginx</code> est non fonctionnel, essayons de lancer un conteneur avec un shell.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container run -it --name bad-2 --entrypoint=sh bad-nginx:1 sh
/usr/bin/sh: /usr/bin/sh: cannot execute binary file</code></pre></div></div></div></div>
<div class="openblock column is-one-quarter"><div class="content"><div class="imageblock fragment"><img src="https://media.tenor.com/3gzS4mCevVkAAAAC/francais-queendugif.gif" alt="francais queendugif"></div>
<div class="paragraph fragment"><p>Oui, je sais, il y a une faute dans la légende du gif&#8230;&#8203;</p></div></div></div>
<div class="openblock column is-one-quarter"><div class="content"><div class="admonitionblock warning fragment"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content">Jean-Micheeeeeeeeeeeeeeeeel, j&#8217;ai deux mots à te dire! 😡</td></tr></table></div></div></div></div></section><section id="solution_travaux_pratiques_14_12" data-auto-animate><h2>✅ Solution travaux pratiques #14🕵️‍♂️🔍</h2><div class="slide-content"><div class="paragraph"><p>Le conteneur qui tourne, on oublie, donc&#8230;&#8203; Jean-Michel a laissé un terrain miné derrière lui. 💣</p></div>
<div class="paragraph fragment"><p>Mais on a d&#8217;autres armes en réserve&#8230;&#8203; Le <code>docker container create</code> par exemple !</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">docker container create --name temp_container bad-nginx:1
9149745197df413f7966181f6ca517b68713edd32ff7c35cea6e958d549a7553</code></pre></div></div>
<div class="paragraph fragment"><p>Utilisons maintenant docker cp pour récupérer le fichier HTML.</p></div>
<div class="paragraph fragment"><p>Quel est le répertoire où nginx s&#8217;attend à trouver ses fichiers HTML à servir?</p></div>
<div class="paragraph fragment"><p><code>/usr/share/nginx/html</code></p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">mkdir /tmp/html &amp;&amp; cd /tmp/html
docker cp temp_container:/usr/share/nginx/html .</code></pre></div></div></div></section><section id="solution_travaux_pratiques_14_13" data-auto-animate><h2>✅ Solution travaux pratiques #14🕵️‍♂️🔍</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">head html/index.html</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"&gt;

&lt;html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"&gt;
    &lt;head&gt;
        &lt;title&gt;Test Page for the Nginx HTTP Server on Red Hat Enterprise Linux&lt;/title&gt;
        &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /&gt;
        &lt;style type="text/css"&gt;
            /*&lt;![CDATA[*/
            body {
                background-color: #fff;</code></pre></div></div>
<div class="paragraph fragment"><p>Jean-Michel n&#8217;avait même pas fini de remplir son fichier HTML&#8230;&#8203;
C&#8217;est encore le fichier de base de nginx sous CentOs.
😞</p></div>
<div class="paragraph fragment"><p>Jean-Michel, t&#8217;assures pas une 🥜, là&#8230;&#8203;</p></div></div></section><section id="solution_travaux_pratiques_14_14" data-auto-animate><h2>✅ Solution travaux pratiques #14🕵️‍♂️🔍</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-noescape="true" data-lang="dockerfile"># Ce Dockerfile met en place un serveur web simple en utilisant Nginx sur Alpine Linux.

# Utilise Alpine Linux comme image de base. Alpine Linux est une distribution Linux légère et orientée sécurité.
FROM alpine

# Met à jour la liste des paquets du système et installe Nginx.
# Nginx est un serveur web populaire qui peut également être utilisé comme proxy inverse, équilibreur de charge et cache HTTP.
RUN apk update &amp;&amp; apk add nginx &amp;&amp; rm -rf /var/cache/apk/*

# Expose le port 80 au monde extérieur. C'est le port standard pour le trafic HTTP.
EXPOSE 80

# Ajoute un fichier HTML à la racine du document Nginx.
# Remplacez /chemin/vers/votre/fichier.html par le chemin réel vers votre fichier HTML.
ADD /chemin/vers/votre/fichier.html /usr/share/nginx/html

# Définit le point d'entrée pour le conteneur. Cette commande sera exécutée lorsque le conteneur démarre.
# La commande "nginx" démarre le serveur Nginx.
# Le flag "-g" nous permet de définir des directives globales. Dans ce cas, nous disons à Nginx de fonctionner au premier plan (daemon off;).
ENTRYPOINT ["nginx", "-g", "daemon off;"]</code></pre></div></div>
<div class="paragraph fragment"><p>Finalement, le 💀 de notre <code>Dockerfile</code> était déjà bon&#8230;&#8203;</p></div>
<div class="paragraph fragment"><p>Ou presque&#8230;&#8203; Rien ne vous gêne dans ce Dockerfile?</p></div>
<div class="paragraph fragment"><p>👫 don&#8217;t let 👫&#8230;&#8203;</p></div></div></section><section id="lazy_docker" data-auto-animate><h2>🐳😴 Lazy Docker</h2><div class="slide-content"><div class="paragraph"><p><a href="https://blog.stephane-robert.info/docs/conteneurs/moteurs-conteneurs/lazydocker/" class="bare">https://blog.stephane-robert.info/docs/conteneurs/moteurs-conteneurs/lazydocker/</a></p></div></div></section><section id="conseils_pour_léval" class="columns" data-auto-animate><h2>Conseils pour l&#8217;éval'</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="imageblock"><img src="media/final%20answer.png" alt="final answer" height="500px"></div></div></div>
<div class="openblock column"><div class="content"><div class="ulist"><ul><li><p><a href="https://moodle.univ-artois.fr/mod/resource/view.php?id=39414" class="bare">https://moodle.univ-artois.fr/mod/resource/view.php?id=39414</a></p></li><li><p><a href="https://moodle.univ-artois.fr/mod/choicegroup/view.php?id=39415" class="bare">https://moodle.univ-artois.fr/mod/choicegroup/view.php?id=39415</a></p></li><li><p><a href="https://moodle.univ-artois.fr/mod/assign/view.php?id=39416" class="bare">https://moodle.univ-artois.fr/mod/assign/view.php?id=39416</a></p></li></ul></div></div></div></div></section><section id="conseils_pour_leval" data-auto-animate><h2>Conseils pour l&#8217;eval'</h2><div class="slide-content"><div class="imageblock"><img src="media/dont%20panic.png" alt="dont panic" height="500px"></div></div></section><section id="vous_devez_avoir_les_compétences_suivantes"><h2>Vous devez avoir les compétences suivantes:</h2><div class="slide-content"><div class="paragraph"><p>Savoir lancer un container avec toutes les options</p></div>
<div class="ulist"><ul><li><p><code>-v, -p, -w, -e, --rm, etc.</code></p></li></ul></div>
<div class="paragraph"><p>Écrire un Dockerfile optimisé pour "dockeriser" une application</p></div>
<div class="ulist"><ul><li><p>pas trop gourmand, facile à modifier, paramétrable.</p></li></ul></div>
<div class="paragraph"><p>Étudier une image ou un conteneur pour tout débug éventuel.</p></div>
<div class="paragraph"><p>Savoir s&#8217;outiller pour avoir des images qui servent d&#8217;environnement d&#8217;exécution à votre CI.</p></div>
<div class="paragraph"><p>Monter un écosystème applicatif complexe via docker-compose.</p></div></div></section><section id="que_revoir"><h2>Que revoir ?</h2><div class="slide-content"><div class="paragraph"><p>Les TPs sont vos meilleurs amis.</p></div>
<div class="paragraph"><p>La documentation officielle de Docker</p></div>
<div class="paragraph"><p><a href="https://docs.docker.com/engine/reference/run/" class="bare">https://docs.docker.com/engine/reference/run/</a></p></div>
<div class="paragraph"><p><a href="https://docs.docker.com/engine/reference/builder/" class="bare">https://docs.docker.com/engine/reference/builder/</a></p></div>
<div class="paragraph"><p><a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/" class="bare">https://docs.docker.com/develop/develop-images/dockerfile_best-practices/</a></p></div></div></section><section id="one_more_thing"><h2>🤔👉 One more thing</h2><div class="slide-content"><div class="imageblock"><img src="media/415439355-image7.png" alt="415439355 image7" height="500px"></div></div></section></section>
<section><section id="bibliographie" data-background-color="rgb(248, 228, 130)" data-state="invert"><h2>Bibliographie</h2></section><section id="ligne_de_commande_2"><h2>Ligne de commande</h2><div class="slide-content"><div class="ulist"><ul><li><p><a href="https://tldp.org" class="bare">https://tldp.org</a></p></li><li><p><a href="https://en.wikipedia.org/wiki/POSIX" class="bare">https://en.wikipedia.org/wiki/POSIX</a></p></li><li><p><a href="https://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop" class="bare">https://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop</a></p></li><li><p><a href="https://linuxhandbook.com/linux-directory-structure/" class="bare">https://linuxhandbook.com/linux-directory-structure/</a></p></li><li><p><a href="https://blog.stephane-robert.info/docs/admin-serveurs/linux/script-shell/" class="bare">https://blog.stephane-robert.info/docs/admin-serveurs/linux/script-shell/</a></p></li><li><p><a href="https://linuxopsys.com/topics/bash-script-examples" class="bare">https://linuxopsys.com/topics/bash-script-examples</a></p></li></ul></div></div></section><section id="git_vcs"><h2>Git / VCS</h2><div class="slide-content"><div class="ulist"><ul><li><p><a href="https://docs.github.com" class="bare">https://docs.github.com</a></p></li><li><p><a href="https://git-scm.com/book/en/v2/Getting-Started-About-Version-Control" class="bare">https://git-scm.com/book/en/v2/Getting-Started-About-Version-Control</a></p></li><li><p><a href="http://martinfowler.com/bliki/VersionControlTools.html" class="bare">http://martinfowler.com/bliki/VersionControlTools.html</a></p></li><li><p><a href="http://martinfowler.com/bliki/FeatureBranch.html" class="bare">http://martinfowler.com/bliki/FeatureBranch.html</a></p></li><li><p><a href="https://about.gitlab.com/2014/09/29/gitlab-flow/" class="bare">https://about.gitlab.com/2014/09/29/gitlab-flow/</a></p></li><li><p><a href="https://www.atlassian.com/git/tutorials/comparing-workflows" class="bare">https://www.atlassian.com/git/tutorials/comparing-workflows</a></p></li><li><p><a href="http://nvie.com/posts/a-successful-git-branching-model/" class="bare">http://nvie.com/posts/a-successful-git-branching-model/</a></p></li><li><p><a href="https://blog.stephane-robert.info/docs/developper/version/git/introduction/" class="bare">https://blog.stephane-robert.info/docs/developper/version/git/introduction/</a></p></li></ul></div></div></section><section id="intégration_continue"><h2>Intégration Continue</h2><div class="slide-content"><div class="ulist"><ul><li><p><a href="http://martinfowler.com/articles/continuousIntegration.html" class="bare">http://martinfowler.com/articles/continuousIntegration.html</a></p></li><li><p><a href="http://martinfowler.com/bliki/ContinuousDelivery.html" class="bare">http://martinfowler.com/bliki/ContinuousDelivery.html</a></p></li><li><p><a href="https://jaxenter.com/implementing-continuous-delivery-117916.html" class="bare">https://jaxenter.com/implementing-continuous-delivery-117916.html</a></p></li><li><p><a href="https://technologyconversations.com/2014/04/29/continuous-delivery-introduction-to-concepts-and-tools/" class="bare">https://technologyconversations.com/2014/04/29/continuous-delivery-introduction-to-concepts-and-tools/</a></p></li><li><p><a href="http://blog.arungupta.me/continuous-integration-delivery-deployment-maturity-model" class="bare">http://blog.arungupta.me/continuous-integration-delivery-deployment-maturity-model</a></p></li><li><p><a href="http://blog.crisp.se/2013/02/05/yassalsundman/continuous-delivery-vs-continuous-deployment" class="bare">http://blog.crisp.se/2013/02/05/yassalsundman/continuous-delivery-vs-continuous-deployment</a></p></li></ul></div></div></section><section id="docker_2"><h2>Docker</h2><div class="slide-content"><div class="ulist"><ul><li><p><a href="https://labs.play-with-docker.com/" class="bare">https://labs.play-with-docker.com/</a></p></li><li><p><a href="https://dduportal.github.io/cours/cnam-docker-2018" class="bare">https://dduportal.github.io/cours/cnam-docker-2018</a></p></li><li><p><a href="https://kodekloud.com/blog/docker-for-beginners/" class="bare">https://kodekloud.com/blog/docker-for-beginners/</a></p></li><li><p><a href="https://www.slideshare.net/dotCloud/why-docker" class="bare">https://www.slideshare.net/dotCloud/why-docker</a></p></li><li><p><a href="https://docs.docker.com/engine/reference/builder/" class="bare">https://docs.docker.com/engine/reference/builder/</a></p></li><li><p><a href="https://www.r-bloggers.com/2021/05/best-practices-for-r-with-docker/" class="bare">https://www.r-bloggers.com/2021/05/best-practices-for-r-with-docker/</a></p></li><li><p><a href="https://github.com/wagoodman/dive" class="bare">https://github.com/wagoodman/dive</a></p></li><li><p><a href="https://docs.docker.com/engine/tutorials/networkingcontainers/" class="bare">https://docs.docker.com/engine/tutorials/networkingcontainers/</a></p></li><li><p><a href="https://towardsdatascience.com/docker-networking-919461b7f498" class="bare">https://towardsdatascience.com/docker-networking-919461b7f498</a></p></li><li><p><a href="https://blog.stephane-robert.info/post/docker-buildkit-partie-1/" class="bare">https://blog.stephane-robert.info/post/docker-buildkit-partie-1/</a></p></li><li><p><a href="https://dev.to/montells/docker-args-1ael" class="bare">https://dev.to/montells/docker-args-1ael</a></p></li></ul></div></div></section><section id="devops"><h2>DevOps</h2><div class="slide-content"><div class="ulist"><ul><li><p><a href="https://blog.stephane-robert.info/docs/glossaire/introduction/" class="bare">https://blog.stephane-robert.info/docs/glossaire/introduction/</a></p></li></ul></div></div></section></section>
<section id="merci" data-background-color="rgb(248, 228, 130)" data-state="invert"><h2>Merci !</h2><div class="slide-content"><div class="paragraph"><p><span class="icon"><i class="fa fa-envelope"></i></span> <a href="mailto:gounthar@gmail.com">gounthar@gmail.com</a></p></div>
<div class="paragraph small"><small><a href="https://gounthar.github.io/gounthar/cours-devops-docker/main">Slides: https://gounthar.github.io/gounthar/cours-devops-docker/main</a></small></div>
<div class="imageblock"><img src="media/qrcode.png" alt="QRCode to this presentation" height="150"></div>
<div class="paragraph small"><small><a href="https://github.com/gounthar/gounthar/cours-devops-docker" target="_blank">Source on <span class="icon"><i class="fab fa-github"></i></span> : https://github.com/gounthar/gounthar/cours-devops-docker</a></small></div>
<aside class="notes"><div class="ulist"><ul><li><p>Pour transformer des diapos extraites de PowerPoint en les croppant et en remplaçant le blanc par du transparent:</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">for i in {3..10}
do
  convert Diapositive${i}.PNG -crop 9583x4167+1917+1750 -transparent white -resize 1920x output${i}_with_transparency.png
done</code></pre></div></div>
<div class="ulist"><ul><li><p>Pour transformer un PPT en asciidoc (pour en récupérer le texte et les images, il ne faut rien en attendre d&#8217;autre):</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">java -jar pptx2adoc.jar Slide.pptx</code></pre></div></div>
<div class="ulist"><ul><li><p>Le projet se trouve là: <a href="https://github.com/ullenboom/ppt2asciidocslides" class="bare">https://github.com/ullenboom/ppt2asciidocslides</a></p><div class="ulist"><ul><li><p>Certains des memes ont été généré grâce à memerator: <a href="https://damemerator.netlify.app/" class="bare">https://damemerator.netlify.app/</a></p></li></ul></div></li></ul></div></aside></div></section></div></div><script src="./reveal.js/dist/reveal.js"></script><script>Array.prototype.slice.call(document.querySelectorAll('.slides section')).forEach(function(slide) {
  if (slide.getAttribute('data-background-color')) return;
  // user needs to explicitly say he wants CSS color to override otherwise we might break custom css or theme (#226)
  if (!(slide.classList.contains('canvas') || slide.classList.contains('background'))) return;
  var bgColor = getComputedStyle(slide).backgroundColor;
  if (bgColor !== 'rgba(0, 0, 0, 0)' && bgColor !== 'transparent') {
    slide.setAttribute('data-background-color', bgColor);
    slide.style.backgroundColor = 'transparent';
  }
});

// More info about config & dependencies:
// - https://github.com/hakimel/reveal.js#configuration
// - https://github.com/hakimel/reveal.js#dependencies
Reveal.initialize({
  // Display presentation control arrows
  controls: true,
  // Help the user learn the controls by providing hints, for example by
  // bouncing the down arrow when they first encounter a vertical slide
  controlsTutorial: true,
  // Determines where controls appear, "edges" or "bottom-right"
  controlsLayout: 'bottom-right',
  // Visibility rule for backwards navigation arrows; "faded", "hidden"
  // or "visible"
  controlsBackArrows: 'faded',
  // Display a presentation progress bar
  progress: true,
  // Display the page number of the current slide
  slideNumber: 'true',
  // Control which views the slide number displays on
  showSlideNumber: 'all',
  // Add the current slide number to the URL hash so that reloading the
  // page/copying the URL will return you to the same slide
  hash: true,
  // Push each slide change to the browser history. Implies `hash: true`
  history: true,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Disables the default reveal.js slide layout so that you can use custom CSS layout
  disableLayout: false,
  // Vertical centering of slides
  center: true,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // See https://github.com/hakimel/reveal.js/#navigation-mode
  navigationMode: 'default',
  // Randomizes the order of slides each time the presentation loads
  shuffle: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags whether to include the current fragment in the URL,
  // so that reloading brings you to the same fragment position
  fragmentInURL: false,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Flags if we should show a help overlay when the questionmark
  // key is pressed
  help: true,
  // Flags if speaker notes should be visible to all viewers
  showNotes: false,
  // Global override for autolaying embedded media (video/audio/iframe)
  // - null: Media will only autoplay if data-autoplay is present
  // - true: All media will autoplay, regardless of individual setting
  // - false: No media will autoplay, regardless of individual setting
  autoPlayMedia: null,
  // Global override for preloading lazy-loaded iframes
  // - null: Iframes with data-src AND data-preload will be loaded when within
  //   the viewDistance, iframes with only data-src will be loaded when visible
  // - true: All iframes with data-src will be loaded when within the viewDistance
  // - false: All iframes with data-src will be loaded only when visible
  preloadIframes: null,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Use this method for navigation when auto-sliding
  autoSlideMethod: Reveal.navigateNext,
  // Specify the average time in seconds that you think you will spend
  // presenting each slide. This is used to show a pacing timer in the
  // speaker view
  defaultTiming: 120,
  // Specify the total time in seconds that is available to
  // present.  If this is set to a nonzero value, the pacing
  // timer will work out the time available for each slide,
  // instead of using the defaultTiming value
  totalTime: 0,
  // Specify the minimum amount of time you want to allot to
  // each slide, if using the totalTime calculation method.  If
  // the automated time allocation causes slide pacing to fall
  // below this threshold, then you will see an alert in the
  // speaker notes window
  minimumTimePerSlide: 0,
  // Enable slide navigation via mouse wheel
  mouseWheel: false,
  // Hide cursor if inactive
  hideInactiveCursor: true,
  // Time before the cursor is hidden (in ms)
  hideCursorTime: 5000,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  // Add `data-preview-link` and `data-preview-link="false"` to customise each link
  // individually
  previewLinks: false,
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: 'slide',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'fade',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Number of slides away from the current that are visible on mobile
  // devices. It is advisable to set this to a lower number than
  // viewDistance in order to save resources.
  mobileViewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: '',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '',
  // Number of pixels to move the parallax background per slide
  // - Calculated automatically unless specified
  // - Set to 0 to disable movement along an axis
  parallaxBackgroundHorizontal: null,
  parallaxBackgroundVertical: null,
  // The display mode that will be used to show slides
  display: 'block',

  // The "normal" size of the presentation, aspect ratio will be preserved
  // when the presentation is scaled to fit different resolutions. Can be
  // specified using percentage units.
  width: 1280,
  height: 720,

  // Factor of the display size that should remain empty around the content
  margin: 0.1,

  // Bounds for smallest/largest possible scale to apply to content
  minScale: 0.2,
  maxScale: 1.5,

  // PDF Export Options
  // Put each fragment on a separate page
  pdfSeparateFragments: true,
  // For slides that do not fit on a page, max number of pages
  pdfMaxPagesPerSlide: 1,

  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: './reveal.js/plugin/zoom/zoom.js', async: true, callback: function () { Reveal.registerPlugin(RevealZoom) } },
      { src: './reveal.js/plugin/notes/notes.js', async: true, callback: function () { Reveal.registerPlugin(RevealNotes) } }
  ],
});</script><script>var dom = {};
dom.slides = document.querySelector('.reveal .slides');

function getRemainingHeight(element, slideElement, height) {
  height = height || 0;
  if (element) {
    var newHeight, oldHeight = element.style.height;
    // Change the .stretch element height to 0 in order find the height of all
    // the other elements
    element.style.height = '0px';
    // In Overview mode, the parent (.slide) height is set of 700px.
    // Restore it temporarily to its natural height.
    slideElement.style.height = 'auto';
    newHeight = height - slideElement.offsetHeight;
    // Restore the old height, just in case
    element.style.height = oldHeight + 'px';
    // Clear the parent (.slide) height. .removeProperty works in IE9+
    slideElement.style.removeProperty('height');
    return newHeight;
  }
  return height;
}

function layoutSlideContents(width, height) {
  // Handle sizing of elements with the 'stretch' class
  toArray(dom.slides.querySelectorAll('section .stretch')).forEach(function (element) {
    // Determine how much vertical space we can use
    var limit = 5; // hard limit
    var parent = element.parentNode;
    while (parent.nodeName !== 'SECTION' && limit > 0) {
      parent = parent.parentNode;
      limit--;
    }
    if (limit === 0) {
      // unable to find parent, aborting!
      return;
    }
    var remainingHeight = getRemainingHeight(element, parent, height);
    // Consider the aspect ratio of media elements
    if (/(img|video)/gi.test(element.nodeName)) {
      var nw = element.naturalWidth || element.videoWidth, nh = element.naturalHeight || element.videoHeight;
      var es = Math.min(width / nw, remainingHeight / nh);
      element.style.width = (nw * es) + 'px';
      element.style.height = (nh * es) + 'px';
    } else {
      element.style.width = width + 'px';
      element.style.height = remainingHeight + 'px';
    }
  });
}

function toArray(o) {
  return Array.prototype.slice.call(o);
}

Reveal.addEventListener('slidechanged', function () {
  layoutSlideContents(1280, 720)
});
Reveal.addEventListener('ready', function () {
  layoutSlideContents(1280, 720)
});
Reveal.addEventListener('resize', function () {
  layoutSlideContents(1280, 720)
});</script><link rel="stylesheet" href="./reveal.js/plugin/highlight/monokai.css"/>
<script src="highlightjs/highlight.min.js"></script>
<script src="highlightjs/languages/groovy.min.js"></script>
<script src="highlightjs/languages/dockerfile.min.js"></script>
<script src="highlightjs/languages/yaml.min.js"></script>
<script src="highlightjs/languages/json.min.js"></script>
<script src="highlightjs/languages/bash.min.js"></script>
<script src="highlightjs/languages/java.min.js"></script>
<script src="highlightjs/languages/javascript.min.js"></script>
<script src="highlightjs/languages/xml.min.js"></script>
<script src="highlightjs/languages/sql.min.js"></script>
<script src="highlightjs/languages/properties.min.js"></script>
<script src="highlightjs/languages/markdown.min.js"></script>
<script src="highlightjs/languages/plaintext.min.js"></script>
<script src="highlightjs/languages/diff.min.js"></script>
<script src="highlightjs/languages/http.min.js"></script>
<script src="highlightjs/languages/apache.min.js"></script>

<script>

/* highlightjs-line-numbers.js 2.6.0 | (C) 2018 Yauheni Pakala | MIT License | github.com/wcoder/highlightjs-line-numbers.js */
/* Edited by Hakim for reveal.js; removed async timeout */
!function(n,e){"use strict";function t(){var n=e.createElement("style");n.type="text/css",n.innerHTML=g(".{0}{border-collapse:collapse}.{0} td{padding:0}.{1}:before{content:attr({2})}",[v,L,b]),e.getElementsByTagName("head")[0].appendChild(n)}function r(t){"interactive"===e.readyState||"complete"===e.readyState?i(t):n.addEventListener("DOMContentLoaded",function(){i(t)})}function i(t){try{var r=e.querySelectorAll("code.hljs,code.nohighlight");for(var i in r)r.hasOwnProperty(i)&&l(r[i],t)}catch(o){n.console.error("LineNumbers error: ",o)}}function l(n,e){"object"==typeof n&&f(function(){n.innerHTML=s(n,e)})}function o(n,e){if("string"==typeof n){var t=document.createElement("code");return t.innerHTML=n,s(t,e)}}function s(n,e){e=e||{singleLine:!1};var t=e.singleLine?0:1;return c(n),a(n.innerHTML,t)}function a(n,e){var t=u(n);if(""===t[t.length-1].trim()&&t.pop(),t.length>e){for(var r="",i=0,l=t.length;i<l;i++)r+=g('<tr><td class="{0}"><div class="{1} {2}" {3}="{5}"></div></td><td class="{4}"><div class="{1}">{6}</div></td></tr>',[j,m,L,b,p,i+1,t[i].length>0?t[i]:" "]);return g('<table class="{0}">{1}</table>',[v,r])}return n}function c(n){var e=n.childNodes;for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];h(r.textContent)>0&&(r.childNodes.length>0?c(r):d(r.parentNode))}}function d(n){var e=n.className;if(/hljs-/.test(e)){for(var t=u(n.innerHTML),r=0,i="";r<t.length;r++){var l=t[r].length>0?t[r]:" ";i+=g('<span class="{0}">{1}</span>\n',[e,l])}n.innerHTML=i.trim()}}function u(n){return 0===n.length?[]:n.split(y)}function h(n){return(n.trim().match(y)||[]).length}function f(e){e()}function g(n,e){return n.replace(/{(\d+)}/g,function(n,t){return e[t]?e[t]:n})}var v="hljs-ln",m="hljs-ln-line",p="hljs-ln-code",j="hljs-ln-numbers",L="hljs-ln-n",b="data-line-number",y=/\r\n|\r|\n/g;n.hljs?(n.hljs.initLineNumbersOnLoad=r,n.hljs.lineNumbersBlock=l,n.hljs.lineNumbersValue=o,t()):n.console.error("highlight.js not detected!")}(window,document);

/**
 * This reveal.js plugin is wrapper around the highlight.js
 * syntax highlighting library.
 */
(function( root, factory ) {
  if (typeof define === 'function' && define.amd) {
    root.RevealHighlight = factory();
  } else if( typeof exports === 'object' ) {
    module.exports = factory();
  } else {
    // Browser globals (root is window)
    root.RevealHighlight = factory();
  }
}( this, function() {

  // Function to perform a better "data-trim" on code snippets
  // Will slice an indentation amount on each line of the snippet (amount based on the line having the lowest indentation length)
  function betterTrim(snippetEl) {
    // Helper functions
    function trimLeft(val) {
      // Adapted from https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/Trim#Polyfill
      return val.replace(/^[\s\uFEFF\xA0]+/g, '');
    }
    function trimLineBreaks(input) {
      var lines = input.split('\n');

      // Trim line-breaks from the beginning
      for (var i = 0; i < lines.length; i++) {
        if (lines[i].trim() === '') {
          lines.splice(i--, 1);
        } else break;
      }

      // Trim line-breaks from the end
      for (var i = lines.length-1; i >= 0; i--) {
        if (lines[i].trim() === '') {
          lines.splice(i, 1);
        } else break;
      }

      return lines.join('\n');
    }

    // Main function for betterTrim()
    return (function(snippetEl) {
      var content = trimLineBreaks(snippetEl.innerHTML);
      var lines = content.split('\n');
      // Calculate the minimum amount to remove on each line start of the snippet (can be 0)
      var pad = lines.reduce(function(acc, line) {
        if (line.length > 0 && trimLeft(line).length > 0 && acc > line.length - trimLeft(line).length) {
          return line.length - trimLeft(line).length;
        }
        return acc;
      }, Number.POSITIVE_INFINITY);
      // Slice each line with this amount
      return lines.map(function(line, index) {
        return line.slice(pad);
      })
        .join('\n');
    })(snippetEl);
  }

  var RevealHighlight = {

    HIGHLIGHT_STEP_DELIMITER: '|',
    HIGHLIGHT_LINE_DELIMITER: ',',
    HIGHLIGHT_LINE_RANGE_DELIMITER: '-',

    init: function( reveal ) {

      // Read the plugin config options and provide fallbacks
      var config = Reveal.getConfig().highlight || {};
      config.highlightOnLoad = typeof config.highlightOnLoad === 'boolean' ? config.highlightOnLoad : true;
      config.escapeHTML = typeof config.escapeHTML === 'boolean' ? config.escapeHTML : true;

      [].slice.call( reveal.getRevealElement().querySelectorAll( 'pre code' ) ).forEach( function( block ) {

        block.parentNode.className = 'code-wrapper';

        // Code can optionally be wrapped in script template to avoid
        // HTML being parsed by the browser (i.e. when you need to
        // include <, > or & in your code).
        let substitute = block.querySelector( 'script[type="text/template"]' );
        if( substitute ) {
          // textContent handles the HTML entity escapes for us
          block.textContent = substitute.innerHTML;
        }

        // Trim whitespace if the "data-trim" attribute is present
        if( block.hasAttribute( 'data-trim' ) && typeof block.innerHTML.trim === 'function' ) {
          block.innerHTML = betterTrim( block );
        }

        // Escape HTML tags unless the "data-noescape" attrbute is present
        if( config.escapeHTML && !block.hasAttribute( 'data-noescape' )) {
          block.innerHTML = block.innerHTML.replace( /</g,"&lt;").replace(/>/g, '&gt;' );
        }

        // Re-highlight when focus is lost (for contenteditable code)
        block.addEventListener( 'focusout', function( event ) {
          hljs.highlightElement( event.currentTarget );
        }, false );

        if( config.highlightOnLoad ) {
          RevealHighlight.highlightBlock( block );
        }
      } );

      // If we're printing to PDF, scroll the code highlights of
      // all blocks in the deck into view at once
      reveal.on( 'pdf-ready', function() {
        [].slice.call( reveal.getRevealElement().querySelectorAll( 'pre code[data-line-numbers].current-fragment' ) ).forEach( function( block ) {
          RevealHighlight.scrollHighlightedLineIntoView( block, {}, true );
        } );
      } );
    },

    /**
     * Highlights a code block. If the <code> node has the
     * 'data-line-numbers' attribute we also generate slide
     * numbers.
     *
     * If the block contains multiple line highlight steps,
     * we clone the block and create a fragment for each step.
     */
    highlightBlock: function( block ) {

      hljs.highlightElement( block );

      // Don't generate line numbers for empty code blocks
      if( block.innerHTML.trim().length === 0 ) return;

      if( block.hasAttribute( 'data-line-numbers' ) ) {
        hljs.lineNumbersBlock( block, { singleLine: true } );

        var scrollState = { currentBlock: block };

        // If there is at least one highlight step, generate
        // fragments
        var highlightSteps = RevealHighlight.deserializeHighlightSteps( block.getAttribute( 'data-line-numbers' ) );
        if( highlightSteps.length > 1 ) {

          // If the original code block has a fragment-index,
          // each clone should follow in an incremental sequence
          var fragmentIndex = parseInt( block.getAttribute( 'data-fragment-index' ), 10 );

          if( typeof fragmentIndex !== 'number' || isNaN( fragmentIndex ) ) {
            fragmentIndex = null;
          }

          // Generate fragments for all steps except the original block
          highlightSteps.slice(1).forEach( function( highlight ) {

            var fragmentBlock = block.cloneNode( true );
            fragmentBlock.setAttribute( 'data-line-numbers', RevealHighlight.serializeHighlightSteps( [ highlight ] ) );
            fragmentBlock.classList.add( 'fragment' );
            block.parentNode.appendChild( fragmentBlock );
            RevealHighlight.highlightLines( fragmentBlock );

            if( typeof fragmentIndex === 'number' ) {
              fragmentBlock.setAttribute( 'data-fragment-index', fragmentIndex );
              fragmentIndex += 1;
            }
            else {
              fragmentBlock.removeAttribute( 'data-fragment-index' );
            }

            // Scroll highlights into view as we step through them
            fragmentBlock.addEventListener( 'visible', RevealHighlight.scrollHighlightedLineIntoView.bind( Plugin, fragmentBlock, scrollState ) );
            fragmentBlock.addEventListener( 'hidden', RevealHighlight.scrollHighlightedLineIntoView.bind( Plugin, fragmentBlock.previousSibling, scrollState ) );

          } );

          block.removeAttribute( 'data-fragment-index' )
          block.setAttribute( 'data-line-numbers', RevealHighlight.serializeHighlightSteps( [ highlightSteps[0] ] ) );

        }

        // Scroll the first highlight into view when the slide
        // becomes visible. Note supported in IE11 since it lacks
        // support for Element.closest.
        var slide = typeof block.closest === 'function' ? block.closest( 'section:not(.stack)' ) : null;
        if( slide ) {
          var scrollFirstHighlightIntoView = function() {
            RevealHighlight.scrollHighlightedLineIntoView( block, scrollState, true );
            slide.removeEventListener( 'visible', scrollFirstHighlightIntoView );
          }
          slide.addEventListener( 'visible', scrollFirstHighlightIntoView );
        }

        RevealHighlight.highlightLines( block );

      }

    },

    /**
     * Animates scrolling to the first highlighted line
     * in the given code block.
     */
    scrollHighlightedLineIntoView: function( block, scrollState, skipAnimation ) {

      cancelAnimationFrame( scrollState.animationFrameID );

      // Match the scroll position of the currently visible
      // code block
      if( scrollState.currentBlock ) {
        block.scrollTop = scrollState.currentBlock.scrollTop;
      }

      // Remember the current code block so that we can match
      // its scroll position when showing/hiding fragments
      scrollState.currentBlock = block;

      var highlightBounds = RevealHighlight.getHighlightedLineBounds( block )
      var viewportHeight = block.offsetHeight;

      // Subtract padding from the viewport height
      var blockStyles = getComputedStyle( block );
      viewportHeight -= parseInt( blockStyles.paddingTop ) + parseInt( blockStyles.paddingBottom );

      // Scroll position which centers all highlights
      var startTop = block.scrollTop;
      var targetTop = highlightBounds.top + ( Math.min( highlightBounds.bottom - highlightBounds.top, viewportHeight ) - viewportHeight ) / 2;

      // Account for offsets in position applied to the
      // <table> that holds our lines of code
      var lineTable = block.querySelector( '.hljs-ln' );
      if( lineTable ) targetTop += lineTable.offsetTop - parseInt( blockStyles.paddingTop );

      // Make sure the scroll target is within bounds
      targetTop = Math.max( Math.min( targetTop, block.scrollHeight - viewportHeight ), 0 );

      if( skipAnimation === true || startTop === targetTop ) {
        block.scrollTop = targetTop;
      }
      else {

        // Don't attempt to scroll if there is no overflow
        if( block.scrollHeight <= viewportHeight ) return;

        var time = 0;
        var animate = function() {
          time = Math.min( time + 0.02, 1 );

          // Update our eased scroll position
          block.scrollTop = startTop + ( targetTop - startTop ) * RevealHighlight.easeInOutQuart( time );

          // Keep animating unless we've reached the end
          if( time < 1 ) {
            scrollState.animationFrameID = requestAnimationFrame( animate );
          }
        };

        animate();

      }

    },

    /**
     * The easing function used when scrolling.
     */
    easeInOutQuart: function( t ) {

      // easeInOutQuart
      return t<.5 ? 8*t*t*t*t : 1-8*(--t)*t*t*t;

    },

    getHighlightedLineBounds: function( block ) {

      var highlightedLines = block.querySelectorAll( '.highlight-line' );
      if( highlightedLines.length === 0 ) {
        return { top: 0, bottom: 0 };
      }
      else {
        var firstHighlight = highlightedLines[0];
        var lastHighlight = highlightedLines[ highlightedLines.length -1 ];

        return {
          top: firstHighlight.offsetTop,
          bottom: lastHighlight.offsetTop + lastHighlight.offsetHeight
        }
      }

    },

    /**
     * Visually emphasize specific lines within a code block.
     * This only works on blocks with line numbering turned on.
     *
     * @param {HTMLElement} block a <code> block
     * @param {String} [linesToHighlight] The lines that should be
     * highlighted in this format:
     * "1" 		= highlights line 1
     * "2,5"	= highlights lines 2 & 5
     * "2,5-7"	= highlights lines 2, 5, 6 & 7
     */
    highlightLines: function( block, linesToHighlight ) {

      var highlightSteps = RevealHighlight.deserializeHighlightSteps( linesToHighlight || block.getAttribute( 'data-line-numbers' ) );

      if( highlightSteps.length ) {

        highlightSteps[0].forEach( function( highlight ) {

          var elementsToHighlight = [];

          // Highlight a range
          if( typeof highlight.end === 'number' ) {
            elementsToHighlight = [].slice.call( block.querySelectorAll( 'table tr:nth-child(n+'+highlight.start+'):nth-child(-n+'+highlight.end+')' ) );
          }
          // Highlight a single line
          else if( typeof highlight.start === 'number' ) {
            elementsToHighlight = [].slice.call( block.querySelectorAll( 'table tr:nth-child('+highlight.start+')' ) );
          }

          if( elementsToHighlight.length ) {
            elementsToHighlight.forEach( function( lineElement ) {
              lineElement.classList.add( 'highlight-line' );
            } );

            block.classList.add( 'has-highlights' );
          }

        } );

      }

    },

    /**
     * Parses and formats a user-defined string of line
     * numbers to highlight.
     *
     * @example
     * RevealHighlight.deserializeHighlightSteps( '1,2|3,5-10' )
     * // [
     * //   [ { start: 1 }, { start: 2 } ],
     * //   [ { start: 3 }, { start: 5, end: 10 } ]
     * // ]
     */
    deserializeHighlightSteps: function( highlightSteps ) {

      // Remove whitespace
      highlightSteps = highlightSteps.replace( /\s/g, '' );

      // Divide up our line number groups
      highlightSteps = highlightSteps.split( RevealHighlight.HIGHLIGHT_STEP_DELIMITER );

      return highlightSteps.map( function( highlights ) {

        return highlights.split( RevealHighlight.HIGHLIGHT_LINE_DELIMITER ).map( function( highlight ) {

          // Parse valid line numbers
          if( /^[\d-]+$/.test( highlight ) ) {

            highlight = highlight.split( RevealHighlight.HIGHLIGHT_LINE_RANGE_DELIMITER );

            var lineStart = parseInt( highlight[0], 10 ),
              lineEnd = parseInt( highlight[1], 10 );

            if( isNaN( lineEnd ) ) {
              return {
                start: lineStart
              };
            }
            else {
              return {
                start: lineStart,
                end: lineEnd
              };
            }

          }
          // If no line numbers are provided, no code will be highlighted
          else {

            return {};

          }

        } );

      } );

    },

    /**
     * Serializes parsed line number data into a string so
     * that we can store it in the DOM.
     */
    serializeHighlightSteps: function( highlightSteps ) {

      return highlightSteps.map( function( highlights ) {

        return highlights.map( function( highlight ) {

          // Line range
          if( typeof highlight.end === 'number' ) {
            return highlight.start + RevealHighlight.HIGHLIGHT_LINE_RANGE_DELIMITER + highlight.end;
          }
          // Single line
          else if( typeof highlight.start === 'number' ) {
            return highlight.start;
          }
          // All lines
          else {
            return '';
          }

        } ).join( RevealHighlight.HIGHLIGHT_LINE_DELIMITER );

      } ).join( RevealHighlight.HIGHLIGHT_STEP_DELIMITER );

    }

  }

  Reveal.registerPlugin( 'highlight', RevealHighlight );

  return RevealHighlight;

}));
        
hljs.configure({
  ignoreUnescapedHTML: true,
});
hljs.highlightAll();
</script><script src="reveal.js/plugin/reveal.js-copycode/copycode.js"></script>
<script src="reveal.js/reveal.js-plugins/menu/menu.js"></script>
<script src="reveal.js/plugin/search/search.js"></script>
<link rel="stylesheet" href="reveal.js/reveal.js-plugins/chalkboard/style.css">
<link rel="stylesheet" href="reveal.js/reveal.js-plugins/customcontrols/style.css">
<script src="reveal.js/reveal.js-plugins/chalkboard/plugin.js"></script>
<script src="reveal.js/reveal.js-plugins/customcontrols/plugin.js"></script>
<script>
  Reveal.configure({
    copycode: {
      button: "hover", // Allow not showing button when exporting to PDF
      display: "both",
      clipboardjspath: "scripts/clipboard.min.js",
      style: {
        scale: 0.7,
      },
    },
    customcontrols: {
      controls: [
        { icon: '<i class="fa fa-pen-square"></i>',
          title: 'Toggle chalkboard (B)',
          action: 'RevealChalkboard.toggleChalkboard();'
        },
        { icon: '<i class="fa fa-pen"></i>',
          title: 'Toggle notes canvas (C)',
          action: 'RevealChalkboard.toggleNotesCanvas();'
        }
      ]
    },
  })
  Reveal.registerPlugin(CopyCode)
  Reveal.registerPlugin(RevealMenu)
  Reveal.registerPlugin(RevealSearch)
  Reveal.registerPlugin(RevealChalkboard)
  Reveal.registerPlugin(RevealCustomControls)
</script></body></html>