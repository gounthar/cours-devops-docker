= Les volumes

image::1300236655-image2.jpeg[]

[%auto-animate]
== ğŸ”´ğŸ”µğŸŸ¢ 3 types de gestion de donnÃ©es

image::3_types_gestions_donnees.png[height=600]

[.notes]
--
Vue d'ensemble des trois types de gestion des donnÃ©es couramment utilisÃ©s dans Docker :

1. Mapping de SystÃ¨me de Fichiers (Filesystem Mapping) :
**Description** : Le mappage de systÃ¨me de fichiers consiste Ã  partager un rÃ©pertoire de votre systÃ¨me hÃ´te avec un conteneur Docker.
Cela permet au conteneur d'accÃ©der et de modifier des fichiers dans ce rÃ©pertoire.
**Utilisation** : Utile pour partager des fichiers ou des donnÃ©es de configuration avec un conteneur.
Les donnÃ©es sont stockÃ©es sur le systÃ¨me hÃ´te, mais sont accessibles depuis le conteneur.
**Exemple** : `docker container run -v /chemin/du/systeme/hote:/chemin/dans/le/conteneur`

2. Volumes :
**Description** : Les volumes sont un mÃ©canisme de stockage persistant qui permet de stocker des donnÃ©es en dehors du systÃ¨me de fichiers du conteneur.
Ils sont gÃ©rÃ©s par Docker et offrent une plus grande flexibilitÃ© que le simple mappage de systÃ¨me de fichiers.
**Utilisation** : IdÃ©aux pour stocker des donnÃ©es qui doivent survivre Ã  l'arrÃªt ou Ã  la suppression d'un conteneur.
Les volumes sont indÃ©pendants du cycle de vie du conteneur.
**Exemple** : `docker run -v nom_du_volume:/chemin/dans/le/conteneur`

3. SystÃ¨me de Fichiers RAM (RAM Filesystem) :
**Description** : Il s'agit d'un systÃ¨me de fichiers temporaire stockÃ© en mÃ©moire RAM.
Les donnÃ©es sont stockÃ©es de maniÃ¨re Ã©phÃ©mÃ¨re, ce qui signifie qu'elles sont perdues lorsque le conteneur est arrÃªtÃ©.
**Utilisation** : Utile lorsque des donnÃ©es temporaires doivent Ãªtre stockÃ©es en mÃ©moire pour des performances Ã©levÃ©es.
Les donnÃ©es n'existent que tant que le conteneur est en cours d'exÃ©cution.
**Exemple** : `docker run --tmpfs /chemin/dans/le/conteneur`

En rÃ©sumÃ©, ces trois mÃ©thodes de gestion des donnÃ©es en Docker offrent des avantages diffÃ©rents en fonction des besoins spÃ©cifiques d'un conteneur. Le mappage de systÃ¨me de fichiers est utile pour partager des fichiers depuis le systÃ¨me hÃ´te, les volumes sont idÃ©aux pour la persistance des donnÃ©es, tandis que les systÃ¨mes de fichiers RAM sont parfaits pour des donnÃ©es temporaires Ã  haute performance.
--

[.columns]
[%auto-animate]
== ğŸ”´ğŸ”µğŸŸ¢ 3 types de gestion de donnÃ©es

[.column.is-one-third]
--
image::mapping_fs.png[]
--

[.column]
--

Partage d'un rÃ©pertoire de votre systÃ¨me hÃ´te avec un conteneur Docker.

[%step]
- Utile pour partager des fichiers ou des donnÃ©es de configuration avec un conteneur.
[%step]
- DonnÃ©es stockÃ©es sur le systÃ¨me hÃ´te, mais accessibles depuis le conteneur.

[%step]
[source,bash]
----
docker container run -v /chemin/du/systeme/hote:/chemin/dans/le/conteneur
----
--

[.notes]
--
1. Mapping de SystÃ¨me de Fichiers (Filesystem Mapping) :
**Description** : Le mappage de systÃ¨me de fichiers consiste Ã  partager un rÃ©pertoire de votre systÃ¨me hÃ´te avec un conteneur Docker.
Cela permet au conteneur d'accÃ©der et de modifier des fichiers dans ce rÃ©pertoire.
**Utilisation** : Utile pour partager des fichiers ou des donnÃ©es de configuration avec un conteneur.
Les donnÃ©es sont stockÃ©es sur le systÃ¨me hÃ´te, mais sont accessibles depuis le conteneur.
**Exemple** : `docker container run -v /chemin/du/systeme/hote:/chemin/dans/le/conteneur`
--

[.columns]
[%auto-animate]
== ğŸ”´ğŸ”µğŸŸ¢ 3 types de gestion de donnÃ©es

[.column.is-one-third]
--
image::volumes.png[]
--

[.column]
--
Stockage persistant => donnÃ©es en dehors du systÃ¨me de fichiers du conteneur.

[%step]
- Utile pour stocker des donnÃ©es qui doivent survivre Ã  l'arrÃªt ou Ã  la suppression d'un conteneur.
[%step]
- Volumes indÃ©pendants du cycle de vie du conteneur.

[%step]
[source,bash]
----
docker container run -v nom_du_volume:/chemin/dans/le/conteneur
----
--

[.notes]
--
Volumes :
**Description** : Les volumes sont un mÃ©canisme de stockage persistant qui permet de stocker des donnÃ©es en dehors du systÃ¨me de fichiers du conteneur.
Ils sont gÃ©rÃ©s par Docker et offrent une plus grande flexibilitÃ© que le simple mappage de systÃ¨me de fichiers.
**Utilisation** : IdÃ©aux pour stocker des donnÃ©es qui doivent survivre Ã  l'arrÃªt ou Ã  la suppression d'un conteneur.
Les volumes sont indÃ©pendants du cycle de vie du conteneur.
**Exemple** : `docker container run -v nom_du_volume:/chemin/dans/le/conteneur`
--

[.columns]
[%auto-animate]
== ğŸ”´ğŸ”µğŸŸ¢ 3 types de gestion de donnÃ©es

[.column.is-one-third]
--
image::fs_ram.png[]
--

[.column]
--

SystÃ¨me de fichiers temporaire stockÃ© en RAM.

[%step]
- Utile lorsque des donnÃ©es temporaires doivent Ãªtre stockÃ©es en mÃ©moire pour des performances Ã©levÃ©es.
[%step]
- Les donnÃ©es n'existent que tant que le conteneur est en cours d'exÃ©cution.

[%step]
[source,bash]
----
docker container run --tmpfs /chemin/dans/le/conteneur
----
--

[.notes]
--
SystÃ¨me de Fichiers RAM (RAM Filesystem) :
**Description** : Il s'agit d'un systÃ¨me de fichiers temporaire stockÃ© en mÃ©moire RAM.
Les donnÃ©es sont stockÃ©es de maniÃ¨re Ã©phÃ©mÃ¨re, ce qui signifie qu'elles sont perdues lorsque le conteneur est arrÃªtÃ©.
**Utilisation** : Utile lorsque des donnÃ©es temporaires doivent Ãªtre stockÃ©es en mÃ©moire pour des performances Ã©levÃ©es.
Les donnÃ©es n'existent que tant que le conteneur est en cours d'exÃ©cution.
**Exemple** : `docker container run --tmpfs /chemin/dans/le/conteneur`

En rÃ©sumÃ©, ces trois mÃ©thodes de gestion des donnÃ©es en Docker offrent des avantages diffÃ©rents en fonction des besoins spÃ©cifiques d'un conteneur. Le mappage de systÃ¨me de fichiers est utile pour partager des fichiers depuis le systÃ¨me hÃ´te, les volumes sont idÃ©aux pour la persistance des donnÃ©es, tandis que les systÃ¨mes de fichiers RAM sont parfaits pour des donnÃ©es temporaires Ã  haute performance.
--

[%auto-animate]
== ğŸ”´ğŸ”µğŸŸ¢ 3 types de gestion de donnÃ©es

image::1329201553-image3.png[]

== ğŸ—ºï¸ğŸ“‚ Mapping de FileSystem

image::293990221-image4.png[height=600]

== ğŸ—ºï¸ğŸ“‚ Mapping de FileSystem

**__"CrÃ©er une image avec les sources de mon application web juste pour distribuer des ressources statiques via Apache ! Merci Docker !"__**

Un Ã©tudiant excÃ©dÃ©

image::1105931517-image5.png[]

== ğŸ—ºï¸ğŸ“‚ Mapping de FileSystem

image::1771886276-image6.png[width=1000]
[.small]
Source : https://hub.docker.com/_/nginx
[%step]
image::383920810-image7.png[]

== ğŸ—ºï¸ğŸ“‚ Mapping de FileSystem

Partage de dossier
[%step]
image::partage_dossier.png[]

[%step]
Partage de fichier
[%step]
image::partage_fichier.png[]


[%step]
CAUTION: Le chemin dans la machine hÃ´te doit Ãªtre un chemin absolu !
[%step]
WARNING: L'exemple ci-dessus ne peut donc pas fonctionner

== ğŸ“¦ğŸ“ Les volumes

image::726805516-image8.png[height=600]

== ğŸ“¦ğŸ“ Les volumes

Il est possible de crÃ©er des "espaces mÃ©moire" que l'on peut mettre Ã  disposition des containers.

[%step]
[source,bash]
----
docker volume create --name my-data
----
[%step]
[source,bash]
----
docker run -v my-data:/data busybox ls /data
----

[%step]
CAUTION: *my_data* n'est plus un chemin absolu, mais juste le nom du volume

== ğŸ“¦ğŸ“ Les volumes

Lister tous les volumes

[source,bash]
----
docker volume ls
----

[%step]
Supprimer un volume
[%step]
[source,bash]
----
docker volume rm my-data
----
[%step]
Inspecter un volume
[%step]
[source,bash]
----
docker volume inspect my-data
----

== ğŸ“¦ğŸ“ğŸ•¶ï¸ Les volumes "anonymes"

[source,dockerfile]
----
include::../code-samples/volumes/anonymes/Dockerfile[]
----

[%step]
CrÃ©ation d'un volume anonyme mappÃ© sur le rÃ©pertoire /data des containers basÃ©s sur cette image

[%auto-animate]
== ğŸ’¾ğŸ§  FileSystem en RAM

[source,bash]
----
docker container run
  -d
  --read-only
  --tmpfs /run/httpd
  --tmpfs /tmp
  httpd
----

[%step]
CAUTION: Les donnÃ©es sont perdues Ã  l'arrÃªt du container.

[%auto-animate]
== ğŸ’¾ğŸ§  FileSystem en RAM

image::volumes-output21_with_transparency.png[]

CAUTION: Les donnÃ©es sont perdues Ã  l'arrÃªt du container.

[.notes]
--
[source,bash]
----
for i in {21..22}; do convert Diapositive${i}.PNG -crop 9342x3359+2250+1652 -transparent white -resize x1080 volumes-output${i}_with_transparency.png; done
----
--

[%auto-animate]
== ğŸ’¾ğŸ§  FileSystem en RAM

image::volumes-output22_with_transparency.png[]

CAUTION: Les donnÃ©es sont perdues Ã  l'arrÃªt du container.

[.notes]
--
[source,bash]
----
for i in {21..22}; do convert Diapositive${i}.PNG -crop 9342x3359+2250+1652 -transparent white -resize x1080 volumes-output${i}_with_transparency.png; done
----
--

[%auto-animate]
== ğŸ“ŠğŸ“ Bilan de compÃ©tences

* CrÃ©ation d'images
* CrÃ©ation des containers
** cycle de vie
** nommage
** dÃ©bug
** rÃ©seau
** volumes

[%auto-animate]
== ğŸ“ŠğŸ“ Bilan de compÃ©tences

* CrÃ©ation d'images âœ…
* CrÃ©ation des containers âœ…
** cycle de vie âœ…
** nommage âœ…
** dÃ©bug âœ…
** rÃ©seau  âœ…
** volumes âœ…

== ğŸ“ Travaux pratiques #8

Lancer un container `nginx `et lui faire distribuer une page web externe au container.

image::1763880002-image10.png[]

[%auto-animate]
== âœ… Solution travaux pratiques #8

[.title]
En utilisant un montage de rÃ©pertoire (Bind Mount) :

[%step]
Utilisez un montage de rÃ©pertoire pour mapper un rÃ©pertoire de l'hÃ´te vers le conteneur Nginx.
[%step]
Placez vos fichiers HTML dans un rÃ©pertoire sur votre machine hÃ´te, puis mappez ce rÃ©pertoire vers le conteneur Nginx.

[%step]
[source,bash]
----
docker container run -d -p 80:80 --name mon-nginx -v /chemin/vers/la/page/web/sur/lhote:/usr/share/nginx/html nginx
----
[%step]
Remplacez `/chemin/vers/la/page/web/sur/lhote` par le chemin rÃ©el vers le rÃ©pertoire contenant vos fichiers de la page web sur l'hÃ´te.

== ğŸ“ Travaux pratiques #9
[.title]
Ã‰tapes:
[%step]
* CrÃ©er un volume nommÃ© "data"
* DÃ©marrer un container attachÃ© Ã  ce volume
* Lancer un processus qui Ã©crit un fichier dans le volume
* DÃ©marrer un second container attachÃ© Ã  ce volume
* Lire les donnÃ©es du volume depuis le second container
* Supprimer le volume

== ğŸ“  Travaux pratiques #10
Ã‰crire un Dockerfile qui:
[%step]
* Ajoute des fichiers dans un dossier
* DÃ©clare ce dossier comme volume anonyme
* Ajoute d'autres fichiers dans ce dossier

[%step]
**Que verra-ton dans ce dossier au sein de nos containers ?**

[%auto-animate]
== âœ… Solution travaux pratiques #10

Tout d'abord, crÃ©ez un rÃ©pertoire pour votre projet et placez-vous dedans.
[%step]
CrÃ©ez un Dockerfile avec le contenu suivant :

[%step]
[source,dockerfile]
----
include::../code-samples/volumes/tp10/Dockerfile[]
----

[%step]
Ensuite, vous pouvez crÃ©er une image Docker Ã  partir de ce Dockerfile en exÃ©cutant la commande suivante dans le mÃªme rÃ©pertoire que le Dockerfile :

[%step]
[source,bash]
----
docker image build -t mon-image .
----

[%auto-animate]
== âœ… Solution travaux pratiques #10

[source,bash]
----
docker image build -t mon-image .
----
Assurez-vous que "mon-image" est le nom que vous souhaitez donner Ã  votre image Docker.
AprÃ¨s avoir crÃ©Ã© l'image, vous pouvez exÃ©cuter un conteneur basÃ© sur cette image :

[%step]
[source,bash]
----
docker container run -it mon-image
----

[%step]
Lorsque vous Ãªtes dans le conteneur, accÃ©dez au dossier /mon-dossier :

[%step]
[source,bash]
----
cd /mon-dossier
----
[%step]
Vous verrez les fichiers "fichier1.txt", "fichier2.txt" et "fichier3.txt" dans ce dossier.

[%step]
[source,bash]
----
ls
----
[%step]
[source,bash]
----
fichier1.txt  fichier2.txt  fichier3.txt
----
[%step]
[source,bash]
----
cat *
----
[%step]
[source,bash]
----
Contenu du fichier 1
Contenu du fichier 2
Nouveau contenu du fichier 3
----

[%auto-animate]
== âœ… Solution travaux pratiques #10
[source,bash]
----
cat *
----
[source,bash]
----
Contenu du fichier 1
Contenu du fichier 2
Nouveau contenu du fichier 3
----

[%step]
Vous devriez voir la liste des fichiers et leurs contenus.

[%step]
Cela montre que les fichiers que vous avez ajoutÃ©s dans le dossier, mÃªme aprÃ¨s avoir dÃ©clarÃ© ce dossier comme un volume anonyme, restent accessibles dans le conteneur.

[%step]
C'est ainsi que vous pouvez ajouter des fichiers dans un dossier, le dÃ©clarer comme un volume anonyme, puis ajouter d'autres fichiers dans ce dossier tout en y ayant accÃ¨s Ã  l'intÃ©rieur du conteneur.
