= Les volumes

image::1300236655-image2.jpeg[]

[%auto-animate]
== üî¥üîµüü¢ 3 types de gestion de donn√©es

image::3_types_gestions_donnees.png[height=600]

[.notes]
--
Vue d'ensemble des trois types de gestion des donn√©es couramment utilis√©s dans Docker :

1. Mapping de Syst√®me de Fichiers (Filesystem Mapping) :
**Description** : Le mappage de syst√®me de fichiers consiste √† partager un r√©pertoire de votre syst√®me h√¥te avec un conteneur Docker.
Cela permet au conteneur d'acc√©der et de modifier des fichiers dans ce r√©pertoire.
**Utilisation** : Utile pour partager des fichiers ou des donn√©es de configuration avec un conteneur.
Les donn√©es sont stock√©es sur le syst√®me h√¥te, mais sont accessibles depuis le conteneur.
**Exemple** : `docker container run -v /chemin/du/systeme/hote:/chemin/dans/le/conteneur`

2. Volumes :
**Description** : Les volumes sont un m√©canisme de stockage persistant qui permet de stocker des donn√©es en dehors du syst√®me de fichiers du conteneur.
Ils sont g√©r√©s par Docker et offrent une plus grande flexibilit√© que le simple mappage de syst√®me de fichiers.
**Utilisation** : Id√©aux pour stocker des donn√©es qui doivent survivre √† l'arr√™t ou √† la suppression d'un conteneur.
Les volumes sont ind√©pendants du cycle de vie du conteneur.
**Exemple** : `docker run -v nom_du_volume:/chemin/dans/le/conteneur`

3. Syst√®me de Fichiers RAM (RAM Filesystem) :
**Description** : Il s'agit d'un syst√®me de fichiers temporaire stock√© en m√©moire RAM.
Les donn√©es sont stock√©es de mani√®re √©ph√©m√®re, ce qui signifie qu'elles sont perdues lorsque le conteneur est arr√™t√©.
**Utilisation** : Utile lorsque des donn√©es temporaires doivent √™tre stock√©es en m√©moire pour des performances √©lev√©es.
Les donn√©es n'existent que tant que le conteneur est en cours d'ex√©cution.
**Exemple** : `docker run --tmpfs /chemin/dans/le/conteneur`

En r√©sum√©, ces trois m√©thodes de gestion des donn√©es en Docker offrent des avantages diff√©rents en fonction des besoins sp√©cifiques d'un conteneur. Le mappage de syst√®me de fichiers est utile pour partager des fichiers depuis le syst√®me h√¥te, les volumes sont id√©aux pour la persistance des donn√©es, tandis que les syst√®mes de fichiers RAM sont parfaits pour des donn√©es temporaires √† haute performance.
--

[.columns]
[%auto-animate]
== üî¥üîµüü¢ 3 types de gestion de donn√©es

[.column.is-one-third]
--
image::mapping_fs.png[]
--

[.column]
--

Partage d'un r√©pertoire de votre syst√®me h√¥te avec un conteneur Docker.

[%step]
- Utile pour partager des fichiers ou des donn√©es de configuration avec un conteneur.
[%step]
- Donn√©es stock√©es sur le syst√®me h√¥te, mais accessibles depuis le conteneur.

[%step]
[source,bash]
----
docker container run -v /chemin/du/systeme/hote:/chemin/dans/le/conteneur
----
--

[.notes]
--
1. Mapping de Syst√®me de Fichiers (Filesystem Mapping) :
**Description** : Le mappage de syst√®me de fichiers consiste √† partager un r√©pertoire de votre syst√®me h√¥te avec un conteneur Docker.
Cela permet au conteneur d'acc√©der et de modifier des fichiers dans ce r√©pertoire.
**Utilisation** : Utile pour partager des fichiers ou des donn√©es de configuration avec un conteneur.
Les donn√©es sont stock√©es sur le syst√®me h√¥te, mais sont accessibles depuis le conteneur.
**Exemple** : `docker container run -v /chemin/du/systeme/hote:/chemin/dans/le/conteneur`
--

[.columns]
[%auto-animate]
== üî¥üîµüü¢ 3 types de gestion de donn√©es

[.column.is-one-third]
--
image::volumes.png[]
--

[.column]
--
Stockage persistant => donn√©es en dehors du syst√®me de fichiers du conteneur.

[%step]
- Utile pour stocker des donn√©es qui doivent survivre √† l'arr√™t ou √† la suppression d'un conteneur.
[%step]
- Volumes ind√©pendants du cycle de vie du conteneur.

[%step]
[source,bash]
----
docker container run -v nom_du_volume:/chemin/dans/le/conteneur
----
--

[.notes]
--
Volumes :
**Description** : Les volumes sont un m√©canisme de stockage persistant qui permet de stocker des donn√©es en dehors du syst√®me de fichiers du conteneur.
Ils sont g√©r√©s par Docker et offrent une plus grande flexibilit√© que le simple mappage de syst√®me de fichiers.
**Utilisation** : Id√©aux pour stocker des donn√©es qui doivent survivre √† l'arr√™t ou √† la suppression d'un conteneur.
Les volumes sont ind√©pendants du cycle de vie du conteneur.
**Exemple** : `docker container run -v nom_du_volume:/chemin/dans/le/conteneur`
--

[.columns]
[%auto-animate]
== üî¥üîµüü¢ 3 types de gestion de donn√©es

[.column.is-one-third]
--
image::fs_ram.png[]
--

[.column]
--

Syst√®me de fichiers temporaire stock√© en RAM.

[%step]
- Utile lorsque des donn√©es temporaires doivent √™tre stock√©es en m√©moire pour des performances √©lev√©es.
[%step]
- Les donn√©es n'existent que tant que le conteneur est en cours d'ex√©cution.

[%step]
[source,bash]
----
docker container run --tmpfs /chemin/dans/le/conteneur
----
--

[.notes]
--
Syst√®me de Fichiers RAM (RAM Filesystem) :
**Description** : Il s'agit d'un syst√®me de fichiers temporaire stock√© en m√©moire RAM.
Les donn√©es sont stock√©es de mani√®re √©ph√©m√®re, ce qui signifie qu'elles sont perdues lorsque le conteneur est arr√™t√©.
**Utilisation** : Utile lorsque des donn√©es temporaires doivent √™tre stock√©es en m√©moire pour des performances √©lev√©es.
Les donn√©es n'existent que tant que le conteneur est en cours d'ex√©cution.
**Exemple** : `docker container run --tmpfs /chemin/dans/le/conteneur`

En r√©sum√©, ces trois m√©thodes de gestion des donn√©es en Docker offrent des avantages diff√©rents en fonction des besoins sp√©cifiques d'un conteneur. Le mappage de syst√®me de fichiers est utile pour partager des fichiers depuis le syst√®me h√¥te, les volumes sont id√©aux pour la persistance des donn√©es, tandis que les syst√®mes de fichiers RAM sont parfaits pour des donn√©es temporaires √† haute performance.
--

[%auto-animate]
== üî¥üîµüü¢ 3 types de gestion de donn√©es

image::1329201553-image3.png[]

== üó∫Ô∏èüìÇ Mapping de FileSystem

image::293990221-image4.png[height=600]

== üó∫Ô∏èüìÇ Mapping de FileSystem

**__"Cr√©er une image avec les sources de mon application web juste pour distribuer des ressources statiques via Apache ! Merci Docker !"__**

Un √©tudiant exc√©d√©

image::1105931517-image5.png[]

== üó∫Ô∏èüìÇ Mapping de FileSystem

image::1771886276-image6.png[width=1000]
[.small]
Source : https://hub.docker.com/_/nginx
[%step]
image::383920810-image7.png[]

== üó∫Ô∏èüìÇ Mapping de FileSystem

Partage de dossier
[%step]
image::partage_dossier.png[]

[%step]
Partage de fichier
[%step]
image::partage_fichier.png[]


[%step]
CAUTION: Le chemin dans la machine h√¥te doit √™tre un chemin absolu !
[%step]
WARNING: L'exemple ci-dessus ne peut donc pas fonctionner

== üì¶üìÅ Les volumes

image::726805516-image8.png[height=600]

== üì¶üìÅ Les volumes

Il est possible de cr√©er des "espaces m√©moire" que l'on peut mettre √† disposition des containers.

[%step]
[source,bash]
----
docker volume create --name my-data
----
[%step]
[source,bash]
----
docker run -v my-data:/data busybox ls /data
----

[%step]
CAUTION: *my_data* n'est plus un chemin absolu, mais juste le nom du volume

== üì¶üìÅ Les volumes

Lister tous les volumes

[source,bash]
----
docker volume ls
----

[%step]
Supprimer un volume
[%step]
[source,bash]
----
docker volume rm my-data
----
[%step]
Inspecter un volume
[%step]
[source,bash]
----
docker volume inspect my-data
----

== üì¶üìÅüï∂Ô∏è Les volumes "anonymes"

[source,dockerfile]
----
include::../code-samples/volumes/anonymes/Dockerfile[]
----

[%step]
Cr√©ation d'un volume anonyme mapp√© sur le r√©pertoire /data des containers bas√©s sur cette image

[%auto-animate]
== üíæüß† FileSystem en RAM

[source,bash]
----
docker container run
  -d
  --read-only
  --tmpfs /run/httpd
  --tmpfs /tmp
  httpd
----

[%step]
CAUTION: Les donn√©es sont perdues √† l'arr√™t du container.

[%auto-animate]
== üíæüß† FileSystem en RAM

image::volumes-output21_with_transparency.png[]

CAUTION: Les donn√©es sont perdues √† l'arr√™t du container.

[.notes]
--
[source,bash]
----
for i in {21..22}; do convert Diapositive${i}.PNG -crop 9342x3359+2250+1652 -transparent white -resize x1080 volumes-output${i}_with_transparency.png; done
----
--

[%auto-animate]
== üíæüß† FileSystem en RAM

image::volumes-output22_with_transparency.png[]

CAUTION: Les donn√©es sont perdues √† l'arr√™t du container.

[.notes]
--
[source,bash]
----
for i in {21..22}; do convert Diapositive${i}.PNG -crop 9342x3359+2250+1652 -transparent white -resize x1080 volumes-output${i}_with_transparency.png; done
----
--

[%auto-animate]
== üìäüìù Bilan de comp√©tences

* Cr√©ation d'images
* Cr√©ation des containers
** cycle de vie
** nommage
** d√©bug
** r√©seau
** volumes

[%auto-animate]
== üìäüìù Bilan de comp√©tences

* Cr√©ation d'images ‚úÖ
* Cr√©ation des containers ‚úÖ
** cycle de vie ‚úÖ
** nommage ‚úÖ
** d√©bug ‚úÖ
** r√©seau  ‚úÖ
** volumes ‚úÖ

[%auto-animate]
== üéì Travaux pratiques #8

Lancer un container `nginx `et lui faire distribuer une page web externe au container.

image::1763880002-image10.png[]

[%auto-animate]

[%auto-animate]
== ‚úÖ Solution travaux pratiques #8

[.title]
En utilisant un montage de r√©pertoire (Bind Mount) :

[%step]
Utilisez un montage de r√©pertoire pour mapper un r√©pertoire de l'h√¥te vers le conteneur Nginx.
[%step]
Placez vos fichiers HTML dans un r√©pertoire sur votre machine h√¥te, puis mappez ce r√©pertoire vers le conteneur Nginx.

[%step]
[source,bash]
----
docker container run -d -p 80:80 --name mon-nginx -v /chemin/vers/la/page/web/sur/lhote:/usr/share/nginx/html nginx
----
[%step]
Remplacez `/chemin/vers/la/page/web/sur/lhote` par le chemin r√©el vers le r√©pertoire contenant vos fichiers de la page web sur l'h√¥te.

[%auto-animate]
== ‚úÖ Solution travaux pratiques #8
[.title]
En utilisant un volume nomm√© (Named Volume) :

[%step]
Cr√©ez un volume nomm√© et copiez vos fichiers de la page web dedans.

[%step]
Montez ce volume nomm√© dans le conteneur Nginx.

[%step]
Tout d'abord, cr√©ez un volume nomm√© :
[%step]
[source,bash]
----
docker volume create mon-nginx-html
----
[%step]
Copiez vos fichiers de la page web dans ce volume :

[%step]
[source,bash]
----
docker container run --rm \
  --volume mon-nginx-html:/cible \   # Montez le volume nomm√© "mon-nginx-html" dans le conteneur sous le r√©pertoire "/cible".
  --volume /chemin/vers/la/page/web/sur/lhote:/html \ # Montez le r√©pertoire o√π se trouve le fichier html
  --workdir /cible \                # D√©finissez le r√©pertoire de travail √† "/cible" dans le conteneur.
  busybox cp -r /html .   # Copiez r√©cursivement le contenu depuis "/chemin/vers/la/page/web/sur/lhote" dans le r√©pertoire actuel du conteneur.
----
[%step]
Maintenant, lancez le conteneur Nginx et montez le volume nomm√© :

[%step]
[source,bash]
----
docker container run -d -p 80:80 --name mon-nginx -v mon-nginx-html:/usr/share/nginx/html nginx
----

== üéì Travaux pratiques #9
[.title]
√âtapes:
[%step]
* Cr√©er un volume nomm√© "data"
* D√©marrer un container attach√© √† ce volume
* Lancer un processus qui √©crit un fichier dans le volume
* D√©marrer un second container attach√© √† ce volume
* Lire les donn√©es du volume depuis le second container
* Supprimer le volume

== ‚úÖ Solution travaux pratiques #9

Cr√©er un volume nomm√© "data" :
[%step]
[source,bash]
----
docker volume create data
----
[%step]
D√©marrer un premier conteneur attach√© √† ce volume :
[%step]
[source,bash]
----
docker container run -it --name premier-container -v data:/donnees busybox
----
[%step]
Dans le premier conteneur, lancez un processus qui √©crit un fichier dans le volume (par exemple, un fichier texte) :
[%step]
[source,bash]
----
echo "Donn√©es du premier conteneur" > /donnees/mon-fichier.txt
----
[%step]
Quittez le premier conteneur.
[%step]
D√©marrer un second conteneur attach√© au m√™me volume :
[%step]
[source,bash]
----
docker container run -it --name second-container -v data:/donnees busybox
----

== ‚úÖ Solution travaux pratiques #9

D√©marrer un second conteneur attach√© au m√™me volume :
[source,bash]
----
docker container run -it --name second-container -v data:/donnees busybox
----
Dans le second conteneur, lisez les donn√©es du volume (le fichier texte) :
[%step]
[source,bash]
----
cat /donnees/mon-fichier.txt
----
[%step]
Vous devriez voir le contenu du fichier affich√© √† l'√©cran.
[%step]
Quittez le second conteneur.
[%step]
Vous pouvez maintenant supprimer le volume "data" car vous n'en avez plus besoin :
[%step]
[source,bash]
----
docker volume rm data
----

== üéì  Travaux pratiques #10
√âcrire un Dockerfile qui:
[%step]
* Ajoute des fichiers dans un dossier
* D√©clare ce dossier comme volume anonyme
* Ajoute d'autres fichiers dans ce dossier

[%step]
**Que verra-ton dans ce dossier au sein de nos containers ?**

[%auto-animate]
== ‚úÖ Solution travaux pratiques #10

Tout d'abord, cr√©ez un r√©pertoire pour votre projet et placez-vous dedans.
[%step]
Cr√©ez un Dockerfile avec le contenu suivant :

[%step]
[source,dockerfile]
----
include::../code-samples/volumes/tp10/Dockerfile[]
----

[%step]
Ensuite, vous pouvez cr√©er une image Docker √† partir de ce Dockerfile en ex√©cutant la commande suivante dans le m√™me r√©pertoire que le Dockerfile :

[%step]
[source,bash]
----
docker image build -t mon-image .
----

[%auto-animate]
== ‚úÖ Solution travaux pratiques #10

[source,bash]
----
docker image build -t mon-image .
----
Assurez-vous que "mon-image" est le nom que vous souhaitez donner √† votre image Docker.
Apr√®s avoir cr√©√© l'image, vous pouvez ex√©cuter un conteneur bas√© sur cette image :

[%step]
[source,bash]
----
docker container run -it mon-image
----

[%step]
Lorsque vous √™tes dans le conteneur, acc√©dez au dossier /mon-dossier :

[%step]
[source,bash]
----
cd /mon-dossier
----
[%step]
Vous verrez les fichiers "fichier1.txt", "fichier2.txt" et "fichier3.txt" dans ce dossier.

[%step]
[source,bash]
----
ls
----
[%step]
[source,bash]
----
fichier1.txt  fichier2.txt  fichier3.txt
----
[%step]
[source,bash]
----
cat *
----
[%step]
[source,bash]
----
Contenu du fichier 1
Contenu du fichier 2
Nouveau contenu du fichier 3
----

[%auto-animate]
== ‚úÖ Solution travaux pratiques #10
[source,bash]
----
cat *
----
[source,bash]
----
Contenu du fichier 1
Contenu du fichier 2
Nouveau contenu du fichier 3
----

[%step]
Vous devriez voir la liste des fichiers et leurs contenus.

[%step]
Cela montre que les fichiers que vous avez ajout√©s dans le dossier, m√™me apr√®s avoir d√©clar√© ce dossier comme un volume anonyme, restent accessibles dans le conteneur.

[%step]
C'est ainsi que vous pouvez ajouter des fichiers dans un dossier, le d√©clarer comme un volume anonyme, puis ajouter d'autres fichiers dans ce dossier tout en y ayant acc√®s √† l'int√©rieur du conteneur.